(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const style="";window.global=window;var Output=function({regl:r,precision:e,label:t="",width:n,height:s}){this.regl=r,this.precision=e,this.label=t,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=Array(2).fill().map(()=>this.regl.framebuffer({color:this.regl.texture({mag:"nearest",width:n,height:s,format:"rgba"}),depthStencil:!1}))};Output.prototype.resize=function(r,e){this.fbos.forEach(t=>{t.resize(r,e)})};Output.prototype.getCurrent=function(){return this.fbos[this.pingPongIndex]};Output.prototype.getTexture=function(){var r=this.pingPongIndex?0:1;return this.fbos[r]};Output.prototype.init=function(){return this.transformIndex=0,this.fragHeader=`
  precision ${this.precision} float;

  uniform float time;
  varying vec2 uv;
  `,this.fragBody="",this.vert=`
  precision ${this.precision} float;
  attribute vec2 position;
  varying vec2 uv;

  void main () {
    uv = position;
    gl_Position = vec4(2.0 * position - 1.0, 0, 1);
  }`,this.attributes={position:this.positionBuffer},this.uniforms={time:this.regl.prop("time"),resolution:this.regl.prop("resolution")},this.frag=`
       ${this.fragHeader}

      void main () {
        vec4 c = vec4(0, 0, 0, 0);
        vec2 st = uv;
        ${this.fragBody}
        gl_FragColor = c;
      }
  `,this};Output.prototype.render=function(r){let e=r[0];var t=this,n=Object.assign(e.uniforms,{prevBuffer:()=>t.fbos[t.pingPongIndex]});t.draw=t.regl({frag:e.frag,vert:t.vert,attributes:t.attributes,uniforms:n,count:3,framebuffer:()=>(t.pingPongIndex=t.pingPongIndex?0:1,t.fbos[t.pingPongIndex])})};Output.prototype.tick=function(r){this.draw(r)};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var inherits_browserExports=inherits_browser.exports;function EventEmitter$1(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var events=EventEmitter$1;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._maxListeners=void 0;EventEmitter$1.defaultMaxListeners=10;EventEmitter$1.prototype.setMaxListeners=function(r){if(!isNumber$1(r)||r<0||isNaN(r))throw TypeError("n must be a positive number");return this._maxListeners=r,this};EventEmitter$1.prototype.emit=function(r){var e,t,n,s,o,u;if(this._events||(this._events={}),r==="error"&&(!this._events.error||isObject$1(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(t=this._events[r],isUndefined(t))return!1;if(isFunction$1(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),t.apply(this,s)}else if(isObject$1(t))for(s=Array.prototype.slice.call(arguments,1),u=t.slice(),n=u.length,o=0;o<n;o++)u[o].apply(this,s);return!0};EventEmitter$1.prototype.addListener=function(r,e){var t;if(!isFunction$1(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",r,isFunction$1(e.listener)?e.listener:e),this._events[r]?isObject$1(this._events[r])?this._events[r].push(e):this._events[r]=[this._events[r],e]:this._events[r]=e,isObject$1(this._events[r])&&!this._events[r].warned&&(isUndefined(this._maxListeners)?t=EventEmitter$1.defaultMaxListeners:t=this._maxListeners,t&&t>0&&this._events[r].length>t&&(this._events[r].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[r].length),typeof console.trace=="function"&&console.trace())),this};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.once=function(r,e){if(!isFunction$1(e))throw TypeError("listener must be a function");var t=!1;function n(){this.removeListener(r,n),t||(t=!0,e.apply(this,arguments))}return n.listener=e,this.on(r,n),this};EventEmitter$1.prototype.removeListener=function(r,e){var t,n,s,o;if(!isFunction$1(e))throw TypeError("listener must be a function");if(!this._events||!this._events[r])return this;if(t=this._events[r],s=t.length,n=-1,t===e||isFunction$1(t.listener)&&t.listener===e)delete this._events[r],this._events.removeListener&&this.emit("removeListener",r,e);else if(isObject$1(t)){for(o=s;o-- >0;)if(t[o]===e||t[o].listener&&t[o].listener===e){n=o;break}if(n<0)return this;t.length===1?(t.length=0,delete this._events[r]):t.splice(n,1),this._events.removeListener&&this.emit("removeListener",r,e)}return this};EventEmitter$1.prototype.removeAllListeners=function(r){var e,t;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[r]&&delete this._events[r],this;if(arguments.length===0){for(e in this._events)e!=="removeListener"&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(t=this._events[r],isFunction$1(t))this.removeListener(r,t);else if(t)for(;t.length;)this.removeListener(r,t[t.length-1]);return delete this._events[r],this};EventEmitter$1.prototype.listeners=function(r){var e;return!this._events||!this._events[r]?e=[]:isFunction$1(this._events[r])?e=[this._events[r]]:e=this._events[r].slice(),e};EventEmitter$1.prototype.listenerCount=function(r){if(this._events){var e=this._events[r];if(isFunction$1(e))return 1;if(e)return e.length}return 0};EventEmitter$1.listenerCount=function(r,e){return r.listenerCount(e)};function isFunction$1(r){return typeof r=="function"}function isNumber$1(r){return typeof r=="number"}function isObject$1(r){return typeof r=="object"&&r!==null}function isUndefined(r){return r===void 0}var browser=commonjsGlobal.performance&&commonjsGlobal.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},raf$2={exports:{}},performanceNow={exports:{}};(function(){var r,e,t,n,s,o;typeof performance<"u"&&performance!==null&&performance.now?performanceNow.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(performanceNow.exports=function(){return(r()-s)/1e6},e=process.hrtime,r=function(){var u;return u=e(),u[0]*1e9+u[1]},n=r(),o=process.uptime()*1e9,s=n-o):Date.now?(performanceNow.exports=function(){return Date.now()-t},t=Date.now()):(performanceNow.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(commonjsGlobal);var performanceNowExports=performanceNow.exports,now$1=performanceNowExports,root=typeof window>"u"?commonjsGlobal:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf$1=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf$1&&i<vendors.length;i++)raf$1=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf$1||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf$1=function(r){if(queue.length===0){var e=now$1(),t=Math.max(0,frameDuration-(e-last));last=t+e,setTimeout(function(){var n=queue.slice(0);queue.length=0;for(var s=0;s<n.length;s++)if(!n[s].cancelled)try{n[s].callback(last)}catch(o){setTimeout(function(){throw o},0)}},Math.round(t))}return queue.push({handle:++id,callback:r,cancelled:!1}),id},caf=function(r){for(var e=0;e<queue.length;e++)queue[e].handle===r&&(queue[e].cancelled=!0)}}raf$2.exports=function(r){return raf$1.call(root,r)};raf$2.exports.cancel=function(){caf.apply(root,arguments)};raf$2.exports.polyfill=function(r){r||(r=root),r.requestAnimationFrame=raf$1,r.cancelAnimationFrame=caf};var rafExports=raf$2.exports,inherits=inherits_browserExports,EventEmitter=events.EventEmitter,now=browser,raf=rafExports,rafLoop=Engine;function Engine(r){if(!(this instanceof Engine))return new Engine(r);this.running=!1,this.last=now(),this._frame=0,this._tick=this.tick.bind(this),r&&this.on("tick",r)}inherits(Engine,EventEmitter);Engine.prototype.start=function(){if(!this.running)return this.running=!0,this.last=now(),this._frame=raf(this._tick),this};Engine.prototype.stop=function(){return this.running=!1,this._frame!==0&&raf.cancel(this._frame),this._frame=0,this};Engine.prototype.tick=function(){this._frame=raf(this._tick);var r=now(),e=r-this.last;this.emit("tick",e),this.last=r};const loop=getDefaultExportFromCjs(rafLoop);function Webcam(r){return navigator.mediaDevices.enumerateDevices().then(e=>e.filter(t=>t.kind==="videoinput")).then(e=>{let t={audio:!1,video:!0};return e[r]&&(t.video={deviceId:{exact:e[r].deviceId}}),window.navigator.mediaDevices.getUserMedia(t)}).then(e=>{const t=document.createElement("video");return t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.setAttribute("playsinline",""),t.srcObject=e,new Promise((n,s)=>{t.addEventListener("loadedmetadata",()=>{t.play().then(()=>n({video:t}))})})}).catch(console.log.bind(console))}function Screen(r){return new Promise(function(e,t){navigator.mediaDevices.getDisplayMedia(r).then(n=>{const s=document.createElement("video");s.srcObject=n,s.addEventListener("loadedmetadata",()=>{s.play(),e({video:s})})}).catch(n=>t(n))})}class HydraSource{constructor({regl:e,width:t,height:n,pb:s,label:o=""}){this.label=o,this.regl=e,this.src=null,this.dynamic=!0,this.width=t,this.height=n,this.tex=this.regl.texture({shape:[1,1]}),this.pb=s}init(e,t){"src"in e&&(this.src=e.src,this.tex=this.regl.texture({data:this.src,...t})),"dynamic"in e&&(this.dynamic=e.dynamic)}initCam(e,t){const n=this;Webcam(e).then(s=>{n.src=s.video,n.dynamic=!0,n.tex=n.regl.texture({data:n.src,...t})}).catch(s=>console.log("could not get camera",s))}initVideo(e="",t){const n=document.createElement("video");n.crossOrigin="anonymous",n.autoplay=!0,n.loop=!0,n.muted=!0,n.addEventListener("loadeddata",()=>{this.src=n,n.play(),this.tex=this.regl.texture({data:this.src,...t}),this.dynamic=!0}),n.src=e}initImage(e="",t){const n=document.createElement("img");n.crossOrigin="anonymous",n.src=e,n.onload=()=>{this.src=n,this.dynamic=!1,this.tex=this.regl.texture({data:this.src,...t})}}initStream(e,t){let n=this;e&&this.pb&&(this.pb.initSource(e),this.pb.on("got video",function(s,o){s===e&&(n.src=o,n.dynamic=!0,n.tex=n.regl.texture({data:n.src,...t}))}))}initScreen(e=0,t){const n=this;Screen().then(function(s){n.src=s.video,n.tex=n.regl.texture({data:n.src,...t}),n.dynamic=!0}).catch(s=>console.log("could not get screen",s))}resize(e,t){this.width=e,this.height=t}clear(){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach(e=>e.stop()),this.src=null,this.tex=this.regl.texture({shape:[1,1]})}tick(e){this.src!==null&&this.dynamic===!0&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.tex.resize(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.tex.width&&this.tex.resize(this.src.width,this.src.height),this.tex.subimage(this.src))}getTexture(){return this.tex}}const mouse={};function mouseButtons(r){if(typeof r=="object"){if("buttons"in r)return r.buttons;if("which"in r){var e=r.which;if(e===2)return 4;if(e===3)return 2;if(e>0)return 1<<e-1}else if("button"in r){var e=r.button;if(e===1)return 4;if(e===2)return 2;if(e>=0)return 1<<e}}return 0}mouse.buttons=mouseButtons;function mouseElement(r){return r.target||r.srcElement||window}mouse.element=mouseElement;function mouseRelativeX(r){return typeof r=="object"&&"pageX"in r?r.pageX:0}mouse.x=mouseRelativeX;function mouseRelativeY(r){return typeof r=="object"&&"pageY"in r?r.pageY:0}mouse.y=mouseRelativeY;function mouseListen(r,e){e||(e=r,r=window);var t=0,n=0,s=0,o={shift:!1,alt:!1,control:!1,meta:!1},u=!1;function c(K){var se=!1;return"altKey"in K&&(se=se||K.altKey!==o.alt,o.alt=!!K.altKey),"shiftKey"in K&&(se=se||K.shiftKey!==o.shift,o.shift=!!K.shiftKey),"ctrlKey"in K&&(se=se||K.ctrlKey!==o.control,o.control=!!K.ctrlKey),"metaKey"in K&&(se=se||K.metaKey!==o.meta,o.meta=!!K.metaKey),se}function h(K,se){var ye=mouse.x(se),G=mouse.y(se);"buttons"in se&&(K=se.buttons|0),(K!==t||ye!==n||G!==s||c(se))&&(t=K|0,n=ye||0,s=G||0,e&&e(t,n,s,o))}function f(K){h(0,K)}function d(){(t||n||s||o.shift||o.alt||o.meta||o.control)&&(n=s=0,t=0,o.shift=o.alt=o.control=o.meta=!1,e&&e(0,0,0,o))}function p(K){c(K)&&e&&e(t,n,s,o)}function S(K){mouse.buttons(K)===0?h(0,K):h(t,K)}function E(K){h(t|mouse.buttons(K),K)}function N(K){h(t&~mouse.buttons(K),K)}function D(){u||(u=!0,r.addEventListener("mousemove",S),r.addEventListener("mousedown",E),r.addEventListener("mouseup",N),r.addEventListener("mouseleave",f),r.addEventListener("mouseenter",f),r.addEventListener("mouseout",f),r.addEventListener("mouseover",f),r.addEventListener("blur",d),r.addEventListener("keyup",p),r.addEventListener("keydown",p),r.addEventListener("keypress",p),r!==window&&(window.addEventListener("blur",d),window.addEventListener("keyup",p),window.addEventListener("keydown",p),window.addEventListener("keypress",p)))}function L(){u&&(u=!1,r.removeEventListener("mousemove",S),r.removeEventListener("mousedown",E),r.removeEventListener("mouseup",N),r.removeEventListener("mouseleave",f),r.removeEventListener("mouseenter",f),r.removeEventListener("mouseout",f),r.removeEventListener("mouseover",f),r.removeEventListener("blur",d),r.removeEventListener("keyup",p),r.removeEventListener("keydown",p),r.removeEventListener("keypress",p),r!==window&&(window.removeEventListener("blur",d),window.removeEventListener("keyup",p),window.removeEventListener("keydown",p),window.removeEventListener("keypress",p)))}D();var W={element:r};return Object.defineProperties(W,{enabled:{get:function(){return u},set:function(K){K?D():L()},enumerable:!0},buttons:{get:function(){return t},enumerable:!0},x:{get:function(){return n},enumerable:!0},y:{get:function(){return s},enumerable:!0},mods:{get:function(){return o},enumerable:!0}}),W}var meyda_min={exports:{}},dct_1,hasRequiredDct$1;function requireDct$1(){if(hasRequiredDct$1)return dct_1;hasRequiredDct$1=1;var r=null,e=function(n){r=r||{},r[n]=new Array(n*n);for(var s=Math.PI/n,o=0;o<n;o++)for(var u=0;u<n;u++)r[n][u+o*n]=Math.cos(s*(u+.5)*o)};function t(n,s){var o=n.length;s=s||2,(!r||!r[o])&&e(o);var u=n.map(function(){return 0});return u.map(function(c,h){return s*n.reduce(function(f,d,p,S){return f+d*r[o][p+h*o]},0)})}return dct_1=t,dct_1}var dct,hasRequiredDct;function requireDct(){return hasRequiredDct||(hasRequiredDct=1,dct=requireDct$1()),dct}var utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;function r(d){if(Array.isArray(d)){for(var p=0,S=Array(d.length);p<d.length;p++)S[p]=d[p];return S}else return Array.from(d)}var e={},t={},n=function(p){var S={};S.real=p.real===void 0?p.slice():p.real.slice();var E=S.real.length;return t[E]===void 0&&(t[E]=Array.apply(null,Array(E)).map(Number.prototype.valueOf,0)),S.imag=t[E].slice(),S},s=function(p){if(e[p]===void 0){for(var S=(p-1).toString(2).length,E="0".repeat(S),N={},D=0;D<p;D++){var L=D.toString(2);L=E.substr(L.length)+L,L=[].concat(r(L)).reverse().join(""),N[D]=parseInt(L,2)}e[p]=N}return e[p]},o=function(p,S){return{real:p.real*S.real-p.imag*S.imag,imag:p.real*S.imag+p.imag*S.real}},u=function(p,S){return{real:p.real+S.real,imag:p.imag+S.imag}},c=function(p,S){return{real:p.real-S.real,imag:p.imag-S.imag}},h=function(p,S){var E=-2*Math.PI*p/S;return{real:Math.cos(E),imag:Math.sin(E)}},f=function(p){return p.imag*=-1,p};return utils={bitReverseArray:s,multiply:o,add:u,subtract:c,euler:h,conj:f,constructComplexArray:n},utils}var fft_1,hasRequiredFft;function requireFft(){if(hasRequiredFft)return fft_1;hasRequiredFft=1;var r=requireUtils(),e=function(s){var o={};s.real===void 0||s.imag===void 0?o=r.constructComplexArray(s):(o.real=s.real.slice(),o.imag=s.imag.slice());var u=o.real.length,c=Math.log2(u);if(Math.round(c)!=c)throw new Error("Input size must be a power of 2.");if(o.real.length!=o.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var h=r.bitReverseArray(u),f={real:[],imag:[]},d=0;d<u;d++)f.real[h[d]]=o.real[d],f.imag[h[d]]=o.imag[d];for(var p=0;p<u;p++)o.real[p]=f.real[p],o.imag[p]=f.imag[p];for(var S=1;S<=c;S++)for(var E=Math.pow(2,S),N=0;N<E/2;N++)for(var D=r.euler(N,E),L=0;L<u/E;L++){var W=E*L+N,K=E*L+N+E/2,se={real:o.real[W],imag:o.imag[W]},ye={real:o.real[K],imag:o.imag[K]},G=r.multiply(D,ye),C=r.subtract(se,G);o.real[K]=C.real,o.imag[K]=C.imag;var T=r.add(G,se);o.real[W]=T.real,o.imag[W]=T.imag}return o},t=function(s){if(s.real===void 0||s.imag===void 0)throw new Error("IFFT only accepts a complex input.");for(var o=s.real.length,u={real:[],imag:[]},c=0;c<o;c++){var h={real:s.real[c],imag:s.imag[c]},f=r.conj(h);u.real[c]=f.real,u.imag[c]=f.imag}var d=e(u);return u.real=d.real.map(function(p){return p/o}),u.imag=d.imag.map(function(p){return p/o}),u};return fft_1={fft:e,ifft:t},fft_1}(function(r,e){(function(t,n){r.exports=n(requireDct(),requireFft())})(commonjsGlobal,function(t,n){function s(C,T,O){if(O||arguments.length===2)for(var k,q=0,J=T.length;q<J;q++)!k&&q in T||(k||(k=Array.prototype.slice.call(T,0,q)),k[q]=T[q]);return C.concat(k||Array.prototype.slice.call(T))}var o=Object.freeze({__proto__:null,blackman:function(C){for(var T=new Float32Array(C),O=2*Math.PI/(C-1),k=2*O,q=0;q<C/2;q++)T[q]=.42-.5*Math.cos(q*O)+.08*Math.cos(q*k);for(q=Math.ceil(C/2);q>0;q--)T[C-q]=T[q-1];return T},hamming:function(C){for(var T=new Float32Array(C),O=0;O<C;O++)T[O]=.54-.46*Math.cos(2*Math.PI*(O/C-1));return T},hanning:function(C){for(var T=new Float32Array(C),O=0;O<C;O++)T[O]=.5-.5*Math.cos(2*Math.PI*O/(C-1));return T},sine:function(C){for(var T=Math.PI/(C-1),O=new Float32Array(C),k=0;k<C;k++)O[k]=Math.sin(T*k);return O}}),u={};function c(C){for(;C%2==0&&C>1;)C/=2;return C===1}function h(C,T){if(T!=="rect"){if(T!==""&&T||(T="hanning"),u[T]||(u[T]={}),!u[T][C.length])try{u[T][C.length]=o[T](C.length)}catch{throw new Error("Invalid windowing function")}C=function(O,k){for(var q=[],J=0;J<Math.min(O.length,k.length);J++)q[J]=O[J]*k[J];return q}(C,u[T][C.length])}return C}function f(C,T,O){for(var k=new Float32Array(C),q=0;q<k.length;q++)k[q]=q*T/O,k[q]=13*Math.atan(k[q]/1315.8)+3.5*Math.atan(Math.pow(k[q]/7518,2));return k}function d(C){return Float32Array.from(C)}function p(C){return 1125*Math.log(1+C/700)}function S(C,T,O){for(var k,q=new Float32Array(C+2),J=new Float32Array(C+2),ie=T/2,xe=p(0),fe=(p(ie)-xe)/(C+1),we=new Array(C+2),Ee=0;Ee<q.length;Ee++)q[Ee]=Ee*fe,J[Ee]=(k=q[Ee],700*(Math.exp(k/1125)-1)),we[Ee]=Math.floor((O+1)*J[Ee]/T);for(var De=new Array(C),Fe=0;Fe<De.length;Fe++){for(De[Fe]=new Array(O/2+1).fill(0),Ee=we[Fe];Ee<we[Fe+1];Ee++)De[Fe][Ee]=(Ee-we[Fe])/(we[Fe+1]-we[Fe]);for(Ee=we[Fe+1];Ee<we[Fe+2];Ee++)De[Fe][Ee]=(we[Fe+2]-Ee)/(we[Fe+2]-we[Fe+1])}return De}function E(C,T,O,k,q,J,ie){k===void 0&&(k=5),q===void 0&&(q=2),J===void 0&&(J=!0),ie===void 0&&(ie=440);var xe=Math.floor(O/2)+1,fe=new Array(O).fill(0).map(function(dt,pt){return C*function(Je,lt){return Math.log2(16*Je/lt)}(T*pt/O,ie)});fe[0]=fe[1]-1.5*C;var we,Ee,De,Fe=fe.slice(1).map(function(dt,pt){return Math.max(dt-fe[pt])},1).concat([1]),We=Math.round(C/2),je=new Array(C).fill(0).map(function(dt,pt){return fe.map(function(Je){return(10*C+We+Je-pt)%C-We})}),qe=je.map(function(dt,pt){return dt.map(function(Je,lt){return Math.exp(-.5*Math.pow(2*je[pt][lt]/Fe[lt],2))})});if(Ee=(we=qe)[0].map(function(){return 0}),De=we.reduce(function(dt,pt){return pt.forEach(function(Je,lt){dt[lt]+=Math.pow(Je,2)}),dt},Ee).map(Math.sqrt),qe=we.map(function(dt,pt){return dt.map(function(Je,lt){return Je/(De[lt]||1)})}),q){var ft=fe.map(function(dt){return Math.exp(-.5*Math.pow((dt/C-k)/q,2))});qe=qe.map(function(dt){return dt.map(function(pt,Je){return pt*ft[Je]})})}return J&&(qe=s(s([],qe.slice(3),!0),qe.slice(0,3),!0)),qe.map(function(dt){return dt.slice(0,xe)})}function N(C,T){for(var O=0,k=0,q=0;q<T.length;q++)O+=Math.pow(q,C)*Math.abs(T[q]),k+=T[q];return O/k}function D(C){var T=C.ampSpectrum,O=C.barkScale,k=C.numberOfBarkBands,q=k===void 0?24:k;if(typeof T!="object"||typeof O!="object")throw new TypeError;var J=q,ie=new Float32Array(J),xe=0,fe=T,we=new Int32Array(J+1);we[0]=0;for(var Ee=O[fe.length-1]/J,De=1,Fe=0;Fe<fe.length;Fe++)for(;O[Fe]>Ee;)we[De++]=Fe,Ee=De*O[fe.length-1]/J;for(we[J]=fe.length-1,Fe=0;Fe<J;Fe++){for(var We=0,je=we[Fe];je<we[Fe+1];je++)We+=fe[je];ie[Fe]=Math.pow(We,.23)}for(Fe=0;Fe<ie.length;Fe++)xe+=ie[Fe];return{specific:ie,total:xe}}function L(C){var T=C.ampSpectrum;if(typeof T!="object")throw new TypeError;for(var O=new Float32Array(T.length),k=0;k<O.length;k++)O[k]=Math.pow(T[k],2);return O}function W(C){var T=C.ampSpectrum,O=C.melFilterBank,k=C.bufferSize;if(typeof T!="object")throw new TypeError("Valid ampSpectrum is required to generate melBands");if(typeof O!="object")throw new TypeError("Valid melFilterBank is required to generate melBands");for(var q=L({ampSpectrum:T}),J=O.length,ie=Array(J),xe=new Float32Array(J),fe=0;fe<xe.length;fe++){ie[fe]=new Float32Array(k/2),xe[fe]=0;for(var we=0;we<k/2;we++)ie[fe][we]=O[fe][we]*q[we],xe[fe]+=ie[fe][we];xe[fe]=Math.log(xe[fe]+1)}return Array.prototype.slice.call(xe)}var K=Object.freeze({__proto__:null,amplitudeSpectrum:function(C){return C.ampSpectrum},buffer:function(C){return C.signal},chroma:function(C){var T=C.ampSpectrum,O=C.chromaFilterBank;if(typeof T!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof O!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var k=O.map(function(J,ie){return T.reduce(function(xe,fe,we){return xe+fe*J[we]},0)}),q=Math.max.apply(Math,k);return q?k.map(function(J){return J/q}):k},complexSpectrum:function(C){return C.complexSpectrum},energy:function(C){var T=C.signal;if(typeof T!="object")throw new TypeError;for(var O=0,k=0;k<T.length;k++)O+=Math.pow(Math.abs(T[k]),2);return O},loudness:D,melBands:W,mfcc:function(C){var T=C.ampSpectrum,O=C.melFilterBank,k=C.numberOfMFCCCoefficients,q=C.bufferSize,J=Math.min(40,Math.max(1,k||13));if(O.length<J)throw new Error("Insufficient filter bank for requested number of coefficients");var ie=W({ampSpectrum:T,melFilterBank:O,bufferSize:q});return t(ie).slice(0,J)},perceptualSharpness:function(C){for(var T=D({ampSpectrum:C.ampSpectrum,barkScale:C.barkScale}),O=T.specific,k=0,q=0;q<O.length;q++)k+=q<15?(q+1)*O[q+1]:.066*Math.exp(.171*(q+1));return k*=.11/T.total},perceptualSpread:function(C){for(var T=D({ampSpectrum:C.ampSpectrum,barkScale:C.barkScale}),O=0,k=0;k<T.specific.length;k++)T.specific[k]>O&&(O=T.specific[k]);return Math.pow((T.total-O)/T.total,2)},powerSpectrum:L,rms:function(C){var T=C.signal;if(typeof T!="object")throw new TypeError;for(var O=0,k=0;k<T.length;k++)O+=Math.pow(T[k],2);return O/=T.length,O=Math.sqrt(O)},spectralCentroid:function(C){var T=C.ampSpectrum;if(typeof T!="object")throw new TypeError;return N(1,T)},spectralCrest:function(C){var T=C.ampSpectrum;if(typeof T!="object")throw new TypeError;var O=0,k=-1/0;return T.forEach(function(q){O+=Math.pow(q,2),k=q>k?q:k}),O/=T.length,O=Math.sqrt(O),k/O},spectralFlatness:function(C){var T=C.ampSpectrum;if(typeof T!="object")throw new TypeError;for(var O=0,k=0,q=0;q<T.length;q++)O+=Math.log(T[q]),k+=T[q];return Math.exp(O/T.length)*T.length/k},spectralFlux:function(C){var T=C.signal,O=C.previousSignal,k=C.bufferSize;if(typeof T!="object"||typeof O!="object")throw new TypeError;for(var q=0,J=-k/2;J<T.length/2-1;J++)x=Math.abs(T[J])-Math.abs(O[J]),q+=(x+Math.abs(x))/2;return q},spectralKurtosis:function(C){var T=C.ampSpectrum;if(typeof T!="object")throw new TypeError;var O=T,k=N(1,O),q=N(2,O),J=N(3,O),ie=N(4,O);return(-3*Math.pow(k,4)+6*k*q-4*k*J+ie)/Math.pow(Math.sqrt(q-Math.pow(k,2)),4)},spectralRolloff:function(C){var T=C.ampSpectrum,O=C.sampleRate;if(typeof T!="object")throw new TypeError;for(var k=T,q=O/(2*(k.length-1)),J=0,ie=0;ie<k.length;ie++)J+=k[ie];for(var xe=.99*J,fe=k.length-1;J>xe&&fe>=0;)J-=k[fe],--fe;return(fe+1)*q},spectralSkewness:function(C){var T=C.ampSpectrum;if(typeof T!="object")throw new TypeError;var O=N(1,T),k=N(2,T),q=N(3,T);return(2*Math.pow(O,3)-3*O*k+q)/Math.pow(Math.sqrt(k-Math.pow(O,2)),3)},spectralSlope:function(C){var T=C.ampSpectrum,O=C.sampleRate,k=C.bufferSize;if(typeof T!="object")throw new TypeError;for(var q=0,J=0,ie=new Float32Array(T.length),xe=0,fe=0,we=0;we<T.length;we++){q+=T[we];var Ee=we*O/k;ie[we]=Ee,xe+=Ee*Ee,J+=Ee,fe+=Ee*T[we]}return(T.length*fe-J*q)/(q*(xe-Math.pow(J,2)))},spectralSpread:function(C){var T=C.ampSpectrum;if(typeof T!="object")throw new TypeError;return Math.sqrt(N(2,T)-Math.pow(N(1,T),2))},zcr:function(C){var T=C.signal;if(typeof T!="object")throw new TypeError;for(var O=0,k=1;k<T.length;k++)(T[k-1]>=0&&T[k]<0||T[k-1]<0&&T[k]>=0)&&O++;return O}}),se=function(){function C(T,O){var k=this;if(this._m=O,!T.audioContext)throw this._m.errors.noAC;if(T.bufferSize&&!c(T.bufferSize))throw this._m._errors.notPow2;if(!T.source)throw this._m._errors.noSource;this._m.audioContext=T.audioContext,this._m.bufferSize=T.bufferSize||this._m.bufferSize||256,this._m.hopSize=T.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=T.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=T.callback,this._m.windowingFunction=T.windowingFunction||"hanning",this._m.featureExtractors=K,this._m.EXTRACTION_STARTED=T.startImmediately||!1,this._m.channel=typeof T.channel=="number"?T.channel:0,this._m.inputs=T.inputs||1,this._m.outputs=T.outputs||1,this._m.numberOfMFCCCoefficients=T.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=T.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=T.featureExtractors||[],this._m.barkScale=f(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=S(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(T.source),this._m.spn.onaudioprocess=function(q){var J;k._m.inputData!==null&&(k._m.previousInputData=k._m.inputData),k._m.inputData=q.inputBuffer.getChannelData(k._m.channel),k._m.previousInputData?((J=new Float32Array(k._m.previousInputData.length+k._m.inputData.length-k._m.hopSize)).set(k._m.previousInputData.slice(k._m.hopSize)),J.set(k._m.inputData,k._m.previousInputData.length-k._m.hopSize)):J=k._m.inputData;var ie=function(xe,fe,we){if(xe.length<fe)throw new Error("Buffer is too short for frame length");if(we<1)throw new Error("Hop length cannot be less that 1");if(fe<1)throw new Error("Frame length cannot be less that 1");var Ee=1+Math.floor((xe.length-fe)/we);return new Array(Ee).fill(0).map(function(De,Fe){return xe.slice(Fe*we,Fe*we+fe)})}(J,k._m.bufferSize,k._m.hopSize);ie.forEach(function(xe){k._m.frame=xe;var fe=k._m.extract(k._m._featuresToExtract,k._m.frame,k._m.previousFrame);typeof k._m.callback=="function"&&k._m.EXTRACTION_STARTED&&k._m.callback(fe),k._m.previousFrame=k._m.frame})}}return C.prototype.start=function(T){this._m._featuresToExtract=T||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},C.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},C.prototype.setSource=function(T){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=T,this._m.source.connect(this._m.spn)},C.prototype.setChannel=function(T){T<=this._m.inputs?this._m.channel=T:console.error("Channel ".concat(T," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(T," when instantiating the MeydaAnalyzer"))},C.prototype.get=function(T){return this._m.inputData?this._m.extract(T||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},C}(),ye={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:K,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:h,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(C){return new se(C,Object.assign({},ye))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(C,T,O){var k=this;if(!T)throw this._errors.invalidInput;if(typeof T!="object")throw this._errors.invalidInput;if(!C)throw this._errors.featureUndef;if(!c(T.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=f(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=S(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=E(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in T&&T.buffer===void 0?this.signal=d(T):this.signal=T;var q=G(T,this.windowingFunction,this.bufferSize);if(this.signal=q.windowedSignal,this.complexSpectrum=q.complexSpectrum,this.ampSpectrum=q.ampSpectrum,O){var J=G(O,this.windowingFunction,this.bufferSize);this.previousSignal=J.windowedSignal,this.previousComplexSpectrum=J.complexSpectrum,this.previousAmpSpectrum=J.ampSpectrum}var ie=function(xe){return k.featureExtractors[xe]({ampSpectrum:k.ampSpectrum,chromaFilterBank:k.chromaFilterBank,complexSpectrum:k.complexSpectrum,signal:k.signal,bufferSize:k.bufferSize,sampleRate:k.sampleRate,barkScale:k.barkScale,melFilterBank:k.melFilterBank,previousSignal:k.previousSignal,previousAmpSpectrum:k.previousAmpSpectrum,previousComplexSpectrum:k.previousComplexSpectrum,numberOfMFCCCoefficients:k.numberOfMFCCCoefficients,numberOfBarkBands:k.numberOfBarkBands})};if(typeof C=="object")return C.reduce(function(xe,fe){var we;return Object.assign({},xe,((we={})[fe]=ie(fe),we))},{});if(typeof C=="string")return ie(C);throw this._errors.invalidFeatureFmt}},G=function(C,T,O){var k={};C.buffer===void 0?k.signal=d(C):k.signal=C,k.windowedSignal=h(k.signal,T),k.complexSpectrum=n.fft(k.windowedSignal),k.ampSpectrum=new Float32Array(O/2);for(var q=0;q<O/2;q++)k.ampSpectrum[q]=Math.sqrt(Math.pow(k.complexSpectrum.real[q],2)+Math.pow(k.complexSpectrum.imag[q],2));return k};return typeof window<"u"&&(window.Meyda=ye),ye})})(meyda_min);var meyda_minExports=meyda_min.exports;const Meyda=getDefaultExportFromCjs(meyda_minExports);class Audio{constructor({numBins:e=4,cutoff:t=2,smooth:n=.4,max:s=15,scale:o=10,isDrawing:u=!1,parentEl:c=document.body}){this.vol=0,this.scale=o,this.max=s,this.cutoff=t,this.smooth=n,this.setBins(e),this.beat={holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0},this.onBeat=()=>{},this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width="100px",this.canvas.style.height="80px",this.canvas.style.position="absolute",this.canvas.style.right="0px",this.canvas.style.bottom="0px",c.appendChild(this.canvas),this.isDrawing=u,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#DFFFFF",this.ctx.strokeStyle="#0ff",this.ctx.lineWidth=.5,window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(h=>{this.stream=h,this.context=new AudioContext;let f=this.context.createMediaStreamSource(h);this.meyda=Meyda.createMeydaAnalyzer({audioContext:this.context,source:f,featureExtractors:["loudness"]})}).catch(h=>console.log("ERROR",h))}detectBeat(e){e>this.beat._cutoff&&e>this.beat.threshold?(this.onBeat(),this.beat._cutoff=e*1.2,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick(){if(this.meyda){var e=this.meyda.get();if(e&&e!==null){this.vol=e.loudness.total,this.detectBeat(this.vol);const t=(s,o)=>s+o;let n=Math.floor(e.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map((s,o)=>e.loudness.specific.slice(o*n,(o+1)*n).reduce(t)).map((s,o)=>s*(1-this.settings[o].smooth)+this.prevBins[o]*this.settings[o].smooth),this.fft=this.bins.map((s,o)=>Math.max(0,(s-this.settings[o].cutoff)/this.settings[o].scale)),this.isDrawing&&this.draw()}}}setCutoff(e){this.cutoff=e,this.settings=this.settings.map(t=>(t.cutoff=e,t))}setSmooth(e){this.smooth=e,this.settings=this.settings.map(t=>(t.smooth=e,t))}setBins(e){this.bins=Array(e).fill(0),this.prevBins=Array(e).fill(0),this.fft=Array(e).fill(0),this.settings=Array(e).fill(0).map(()=>({cutoff:this.cutoff,scale:this.scale,smooth:this.smooth})),this.bins.forEach((t,n)=>{window["a"+n]=(s=1,o=0)=>()=>a.fft[n]*s+o})}setScale(e){this.scale=e,this.settings=this.settings.map(t=>(t.scale=e,t))}setMax(e){this.max=e,console.log("set max is deprecated")}hide(){this.isDrawing=!1,this.canvas.style.display="none"}show(){this.isDrawing=!0,this.canvas.style.display="block"}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var e=this.canvas.width/this.bins.length,t=this.canvas.height/(this.max*2);this.bins.forEach((n,s)=>{var o=n*t;this.ctx.fillRect(s*e,this.canvas.height-o,e,o);var u=this.canvas.height-t*this.settings[s].cutoff;this.ctx.beginPath(),this.ctx.moveTo(s*e,u),this.ctx.lineTo((s+1)*e,u),this.ctx.stroke();var c=this.canvas.height-t*(this.settings[s].scale+this.settings[s].cutoff);this.ctx.beginPath(),this.ctx.moveTo(s*e,c),this.ctx.lineTo((s+1)*e,c),this.ctx.stroke()})}}class VideoRecorder{constructor(e){this.mediaSource=new MediaSource,this.stream=e,this.output=document.createElement("video"),this.output.autoplay=!0,this.output.loop=!0;let t=this;this.mediaSource.addEventListener("sourceopen",()=>{console.log("MediaSource opened"),t.sourceBuffer=t.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log("Source buffer: ",sourceBuffer)})}start(){let e={mimeType:"video/webm;codecs=vp9"};this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(t){console.log("Unable to create MediaRecorder with options Object: ",t);try{e={mimeType:"video/webm,codecs=vp9"},this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(n){console.log("Unable to create MediaRecorder with options Object: ",n);try{e="video/vp8",this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(s){alert(`MediaRecorder is not supported by this browser.

Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.`),console.error("Exception while creating MediaRecorder:",s);return}}}console.log("Created MediaRecorder",this.mediaRecorder,"with options",e),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}stop(){this.mediaRecorder.stop()}_handleStop(){const e=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),t=window.URL.createObjectURL(e);this.output.src=t;const n=document.createElement("a");n.style.display="none",n.href=t;let s=new Date;n.download=`hydra-${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}-${s.getHours()}.${s.getMinutes()}.${s.getSeconds()}.webm`,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(t)},300)}_handleDataAvailable(e){e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)}}const easing={linear:function(r){return r},easeInQuad:function(r){return r*r},easeOutQuad:function(r){return r*(2-r)},easeInOutQuad:function(r){return r<.5?2*r*r:-1+(4-2*r)*r},easeInCubic:function(r){return r*r*r},easeOutCubic:function(r){return--r*r*r+1},easeInOutCubic:function(r){return r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1},easeInQuart:function(r){return r*r*r*r},easeOutQuart:function(r){return 1- --r*r*r*r},easeInOutQuart:function(r){return r<.5?8*r*r*r*r:1-8*--r*r*r*r},easeInQuint:function(r){return r*r*r*r*r},easeOutQuint:function(r){return 1+--r*r*r*r*r},easeInOutQuint:function(r){return r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r},sin:function(r){return(1+Math.sin(Math.PI*r-Math.PI/2))/2}};var map=(r,e,t,n,s)=>(r-e)*(s-n)/(t-e)+n;const ArrayUtils={init:()=>{Array.prototype.fast=function(r=1){return this._speed=r,this},Array.prototype.smooth=function(r=1){return this._smooth=r,this},Array.prototype.ease=function(r="linear"){return typeof r=="function"?(this._smooth=1,this._ease=r):easing[r]&&(this._smooth=1,this._ease=easing[r]),this},Array.prototype.offset=function(r=.5){return this._offset=r%1,this},Array.prototype.fit=function(r=0,e=1){let t=Math.min(...this),n=Math.max(...this);var s=this.map(o=>map(o,t,n,r,e));return s._speed=this._speed,s._smooth=this._smooth,s._ease=this._ease,s}},getValue:(r=[])=>({time:e,bpm:t})=>{let n=r._speed?r._speed:1,s=r._smooth?r._smooth:0,o=e*n*(t/60)+(r._offset||0);if(s!==0){let u=r._ease?r._ease:easing.linear,c=o-s/2,h=r[Math.floor(c%r.length)],f=r[Math.floor((c+1)%r.length)],d=Math.min(c%1/s,1);return u(d)*(f-h)+h}else return r[Math.floor(o%r.length)],r[Math.floor(o%r.length)]}},Sandbox=parent=>{var initialCode="",sandbox=createSandbox(initialCode),addToContext=(r,e)=>{initialCode+=`
      var ${r} = ${e}
    `,sandbox=createSandbox(initialCode)};return{addToContext,eval:r=>sandbox.eval(r)};function createSandbox(initial){eval(initial);var localEval=function(code){eval(code)};return{eval:localEval}}};class EvalSandbox{constructor(e,t,n=[]){this.makeGlobal=t,this.sandbox=Sandbox(),this.parent=e;var s=Object.keys(e);s.forEach(o=>this.add(o)),this.userProps=n}add(e){this.makeGlobal&&(window[e]=this.parent[e]),this.sandbox.addToContext(e,`parent.${e}`)}set(e,t){this.makeGlobal&&(window[e]=t),this.parent[e]=t}tick(){this.makeGlobal&&this.userProps.forEach(e=>{this.parent[e]=window[e]})}eval(e){this.sandbox.eval(e)}}const DEFAULT_CONVERSIONS={float:{vec4:{name:"sum",args:[[1,1,1,1]]},vec2:{name:"sum",args:[[1,1]]}}},ensure_decimal_dot=r=>(r=r.toString(),r.indexOf(".")<0&&(r+="."),r);function formatArguments(r,e,t){const n=r.transform.inputs,s=r.userArgs,{generators:o}=r.synth,{src:u}=o;return n.map((c,h)=>{const f={value:c.default,type:c.type,isUniform:!1,name:c.name,vecLen:0};if(f.type==="float"&&(f.value=ensure_decimal_dot(c.default)),c.type.startsWith("vec"))try{f.vecLen=Number.parseInt(c.type.substr(3))}catch{console.log(`Error determining length of vector input type ${c.type} (${c.name})`)}if(s.length>h&&(f.value=s[h],typeof s[h]=="function"?(f.value=(S,E,N)=>{try{const D=s[h](E);return typeof D=="number"?D:(console.warn("function does not return a number",s[h]),c.default)}catch(D){return console.warn("ERROR",D),c.default}},f.isUniform=!0):s[h].constructor===Array&&(f.value=(S,E,N)=>ArrayUtils.getValue(s[h])(E),f.isUniform=!0)),!(e<0)){if(f.value&&f.value.transforms){const S=f.value.transforms[f.value.transforms.length-1];if(S.transform.glsl_return_type!==c.type){const E=DEFAULT_CONVERSIONS[c.type];if(typeof E<"u"){const N=E[S.transform.glsl_return_type];if(typeof N<"u"){const{name:D,args:L}=N;f.value=f.value[D](...L)}}}f.isUniform=!1}else if(f.type==="float"&&typeof f.value=="number")f.value=ensure_decimal_dot(f.value);else if(f.type.startsWith("vec")&&typeof f.value=="object"&&Array.isArray(f.value))f.isUniform=!1,f.value=`${f.type}(${f.value.map(ensure_decimal_dot).join(", ")})`;else if(c.type==="sampler2D"){var d=f.value;f.value=()=>d.getTexture(),f.isUniform=!0}else if(f.value.getTexture&&c.type==="vec4"){var p=f.value;f.value=u(p),f.isUniform=!1}f.isUniform&&(f.name+=e)}return f})}function generateGlsl(r){var e={uniforms:[],glslFunctions:[],fragColor:""},t=generateGlsl$1(r,e)("st");e.fragColor=t;let n={};return e.uniforms.forEach(s=>n[s.name]=s),e.uniforms=Object.values(n),e}function generateGlsl$1(r,e){var t=()=>"";return r.forEach(n=>{var s=formatArguments(n,e.uniforms.length);s.forEach(c=>{c.isUniform&&e.uniforms.push(c)}),contains(n,e.glslFunctions)||e.glslFunctions.push(n);var o=t;if(n.transform.type==="src")t=c=>`${shaderString(c,n.name,s,e)}`;else if(n.transform.type==="coord")t=c=>`${o(`${shaderString(c,n.name,s,e)}`)}`;else if(n.transform.type==="color")t=c=>`${shaderString(`${o(c)}`,n.name,s,e)}`;else if(n.transform.type==="combine"){var u=s[0].value&&s[0].value.transforms?c=>`${generateGlsl$1(s[0].value.transforms,e)(c)}`:s[0].isUniform?()=>s[0].name:()=>s[0].value;t=c=>`${shaderString(`${o(c)}, ${u(c)}`,n.name,s.slice(1),e)}`}else if(n.transform.type==="combineCoord"){var u=s[0].value&&s[0].value.transforms?h=>`${generateGlsl$1(s[0].value.transforms,e)(h)}`:s[0].isUniform?()=>s[0].name:()=>s[0].value;t=h=>`${o(`${shaderString(`${h}, ${u(h)}`,n.name,s.slice(1),e)}`)}`}}),t}function shaderString(r,e,t,n){const s=t.map(o=>o.isUniform?o.name:o.value&&o.value.transforms?`${generateGlsl$1(o.value.transforms,n)("st")}`:o.value).reduce((o,u)=>`${o}, ${u}`,"");return`${e}(${r}${s})`}function contains(r,e){for(var t=0;t<e.length;t++)if(r.name==e[t].name)return!0;return!1}const utilityGlsl={_luminance:{type:"util",glsl:`float _luminance(vec3 rgb){
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }`},_noise:{type:"util",glsl:`
    //	Simplex 3D Noise
    //	by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

  float _noise(vec3 v){
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    vec3 x1 = x0 - i1 + 1.0 * C.xxx;
    vec3 x2 = x0 - i2 + 2.0 * C.xxx;
    vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i = mod(i, 289.0 );
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    float n_ = 1.0/7.0; // N=7
    vec3  ns = n_ * D.wyz - D.xzx;

    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);

    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );

    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));

    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);

  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }
    `},_rgbToHsv:{type:"util",glsl:`vec3 _rgbToHsv(vec3 c){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }`},_hsvToRgb:{type:"util",glsl:`vec3 _hsvToRgb(vec3 c){
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }`}};var GlslSource=function(r){return this.transforms=[],this.transforms.push(r),this.defaultOutput=r.defaultOutput,this.synth=r.synth,this.type="GlslSource",this.defaultUniforms=r.defaultUniforms,this};GlslSource.prototype.addTransform=function(r){this.transforms.push(r)};GlslSource.prototype.out=function(r){var e=r||this.defaultOutput,t=this.glsl(e);if(this.synth.currentFunctions=[],e)try{e.render(t)}catch(n){console.log("shader could not compile",n)}};GlslSource.prototype.glsl=function(){var r=[],e=[];return this.transforms.forEach(t=>{t.transform.type==="renderpass"?console.warn("no support for renderpass"):e.push(t)}),e.length>0&&r.push(this.compile(e)),r};GlslSource.prototype.compile=function(r){var e=generateGlsl(r,this.synth),t={};e.uniforms.forEach(s=>{t[s.name]=s.value});var n=`
  precision ${this.defaultOutput.precision} float;
  ${Object.values(e.uniforms).map(s=>{let o=s.type;switch(s.type){case"texture":o="sampler2D";break}return`
      uniform ${o} ${s.name};`}).join("")}
  uniform float time;
  uniform vec2 resolution;
  varying vec2 uv;
  uniform sampler2D prevBuffer;

  ${Object.values(utilityGlsl).map(s=>`
            ${s.glsl}
          `).join("")}

  ${e.glslFunctions.map(s=>`
            ${s.transform.glsl}
          `).join("")}

  void main () {
    vec4 c = vec4(1, 0, 0, 1);
    vec2 st = gl_FragCoord.xy/resolution.xy;
    gl_FragColor = ${e.fragColor};
  }
  `;return{frag:n,uniforms:Object.assign({},this.defaultUniforms,t)}};const glslFunctions=()=>[{name:"noise",type:"src",inputs:[{type:"float",name:"scale",default:10},{type:"float",name:"offset",default:.1}],glsl:"   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);"},{name:"voronoi",type:"src",inputs:[{type:"float",name:"scale",default:5},{type:"float",name:"speed",default:.3},{type:"float",name:"blending",default:.3}],glsl:`   vec3 color = vec3(.0);
   // Scale
   _st *= scale;
   // Tile the space
   vec2 i_st = floor(_st);
   vec2 f_st = fract(_st);
   float m_dist = 10.;  // minimun distance
   vec2 m_point;        // minimum point
   for (int j=-1; j<=1; j++ ) {
   for (int i=-1; i<=1; i++ ) {
   vec2 neighbor = vec2(float(i),float(j));
   vec2 p = i_st + neighbor;
   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   vec2 diff = neighbor + point - f_st;
   float dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color += dot(m_point,vec2(.3,.6));
   color *= 1.0 - blending*m_dist;
   return vec4(color, 1.0);`},{name:"osc",type:"src",inputs:[{type:"float",name:"frequency",default:60},{type:"float",name:"sync",default:.1},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st;
   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;
   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   return vec4(r, g, b, 1.0);`},{name:"shape",type:"src",inputs:[{type:"float",name:"sides",default:3},{type:"float",name:"radius",default:.3},{type:"float",name:"smoothing",default:.01}],glsl:`   vec2 st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   float a = atan(st.x,st.y)+3.1416;
   float r = (2.*3.1416)/sides;
   float d = cos(floor(.5+a/r)*r-a)*length(st);
   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);`},{name:"gradient",type:"src",inputs:[{type:"float",name:"speed",default:0}],glsl:"   return vec4(_st, sin(time*speed), 1.0);"},{name:"src",type:"src",inputs:[{type:"sampler2D",name:"tex",default:NaN}],glsl:`   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);
   return texture2D(tex, fract(_st));`},{name:"solid",type:"src",inputs:[{type:"float",name:"r",default:0},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:1}],glsl:"   return vec4(r, g, b, a);"},{name:"rotate",type:"coord",inputs:[{type:"float",name:"angle",default:10},{type:"float",name:"speed",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float ang = angle + speed *time;
   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy += 0.5;
   return xy;`},{name:"scale",type:"coord",inputs:[{type:"float",name:"amount",default:1.5},{type:"float",name:"xMult",default:1},{type:"float",name:"yMult",default:1},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 xy = _st - vec2(offsetX, offsetY);
   xy*=(1.0/vec2(amount*xMult, amount*yMult));
   xy+=vec2(offsetX, offsetY);
   return xy;
   `},{name:"pixelate",type:"coord",inputs:[{type:"float",name:"pixelX",default:20},{type:"float",name:"pixelY",default:20}],glsl:`   vec2 xy = vec2(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"posterize",type:"color",inputs:[{type:"float",name:"bins",default:3},{type:"float",name:"gamma",default:.6}],glsl:`   vec4 c2 = pow(_c0, vec4(gamma));
   c2 *= vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4(1.0/gamma));
   return vec4(c2.xyz, _c0.a);`},{name:"shift",type:"color",inputs:[{type:"float",name:"r",default:.5},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:0}],glsl:`   vec4 c2 = vec4(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4(c2.rgba);`},{name:"repeat",type:"coord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:0},{type:"float",name:"offsetY",default:0}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) * offsetX;
   st.y += step(1., mod(st.x,2.0)) * offsetY;
   return fract(st);`},{name:"modulateRepeat",type:"combineCoord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;
   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;
   return fract(st);`},{name:"repeatX",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatX",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"repeatY",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatY",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"kaleid",type:"coord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st;
   st -= 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2(cos(a), sin(a));`},{name:"modulateKaleid",type:"combineCoord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st - 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2(cos(a), sin(a));`},{name:"scroll",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"scrollY",default:.5},{type:"float",name:"speedX",default:0},{type:"float",name:"speedY",default:0}],glsl:`
   _st.x += scrollX + time*speedX;
   _st.y += scrollY + time*speedY;
   return fract(_st);`},{name:"scrollX",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += scrollX + time*speed;
   return fract(_st);`},{name:"modulateScrollX",type:"combineCoord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += _c0.r*scrollX + time*speed;
   return fract(_st);`},{name:"scrollY",type:"coord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += scrollY + time*speed;
   return fract(_st);`},{name:"modulateScrollY",type:"combineCoord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += _c0.r*scrollY + time*speed;
   return fract(_st);`},{name:"add",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0+_c1)*amount + _c0*(1.0-amount);"},{name:"sub",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0-_c1)*amount + _c0*(1.0-amount);"},{name:"layer",type:"combine",inputs:[],glsl:"   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));"},{name:"blend",type:"combine",inputs:[{type:"float",name:"amount",default:.5}],glsl:"   return _c0*(1.0-amount)+_c1*amount;"},{name:"mult",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _c0*(1.0-amount)+(_c0*_c1)*amount;"},{name:"diff",type:"combine",inputs:[],glsl:"   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));"},{name:"modulate",type:"combineCoord",inputs:[{type:"float",name:"amount",default:.1}],glsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;`},{name:"modulateScale",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:1}],glsl:`   vec2 xy = _st - vec2(0.5);
   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy+=vec2(0.5);
   return xy;`},{name:"modulatePixelate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:10},{type:"float",name:"offset",default:3}],glsl:`   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"modulateRotate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float angle = offset + _c0.x * multiple;
   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy += 0.5;
   return xy;`},{name:"modulateHue",type:"combineCoord",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);"},{name:"invert",type:"color",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);"},{name:"contrast",type:"color",inputs:[{type:"float",name:"amount",default:1.6}],glsl:`   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);
   return vec4(c.rgb, _c0.a);`},{name:"brightness",type:"color",inputs:[{type:"float",name:"amount",default:.4}],glsl:"   return vec4(_c0.rgb + vec3(amount), _c0.a);"},{name:"mask",type:"combine",inputs:[],glsl:`   float a = _luminance(_c1.rgb);
  return vec4(_c0.rgb*a, a*_c0.a);`},{name:"luma",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.1}],glsl:`   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4(_c0.rgb*a, a);`},{name:"thresh",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.04}],glsl:"   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);"},{name:"color",type:"color",inputs:[{type:"float",name:"r",default:1},{type:"float",name:"g",default:1},{type:"float",name:"b",default:1},{type:"float",name:"a",default:1}],glsl:`   vec4 c = vec4(r, g, b, a);
   vec4 pos = step(0.0, c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));`},{name:"saturate",type:"color",inputs:[{type:"float",name:"amount",default:2}],glsl:`   const vec3 W = vec3(0.2125, 0.7154, 0.0721);
   vec3 intensity = vec3(dot(_c0.rgb, W));
   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);`},{name:"hue",type:"color",inputs:[{type:"float",name:"hue",default:.4}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c.r += hue;
   //  c.r = fract(c.r);
   return vec4(_hsvToRgb(c), _c0.a);`},{name:"colorama",type:"color",inputs:[{type:"float",name:"amount",default:.005}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c += vec3(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4(c, _c0.a);`},{name:"prev",type:"src",inputs:[],glsl:"   return texture2D(prevBuffer, fract(_st));"},{name:"sum",type:"color",inputs:[{type:"vec4",name:"scale",default:1}],glsl:`   vec4 v = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded
   vec2 v = _st.xy * s.xy;
   return v.x + v.y;`},{name:"r",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.r * scale + offset);"},{name:"g",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.g * scale + offset);"},{name:"b",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.b * scale + offset);"},{name:"a",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.a * scale + offset);"}];class GeneratorFactory{constructor({defaultUniforms:e,defaultOutput:t,extendTransforms:n=[],changeListener:s=()=>{}}={}){this.defaultOutput=t,this.defaultUniforms=e,this.changeListener=s,this.extendTransforms=n,this.generators={},this.init()}init(){const e=glslFunctions();return this.glslTransforms={},this.generators=Object.entries(this.generators).reduce((t,[n,s])=>(this.changeListener({type:"remove",synth:this,method:n}),t),{}),this.sourceClass=(()=>class extends GlslSource{})(),Array.isArray(this.extendTransforms)?e.concat(this.extendTransforms):typeof this.extendTransforms=="object"&&this.extendTransforms.type&&e.push(this.extendTransforms),e.map(t=>this.setFunction(t))}_addMethod(e,t){const n=this;if(this.glslTransforms[e]=t,t.type==="src"){const s=(...o)=>new this.sourceClass({name:e,transform:t,userArgs:o,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:n});return this.generators[e]=s,this.changeListener({type:"add",synth:this,method:e}),s}else this.sourceClass.prototype[e]=function(...s){return this.transforms.push({name:e,transform:t,userArgs:s,synth:n}),this}}setFunction(e){var t=processGlsl(e);t&&this._addMethod(e.name,t)}}const typeLookup={src:{returnType:"vec4",args:["vec2 _st"]},coord:{returnType:"vec2",args:["vec2 _st"]},color:{returnType:"vec4",args:["vec4 _c0"]},combine:{returnType:"vec4",args:["vec4 _c0","vec4 _c1"]},combineCoord:{returnType:"vec2",args:["vec2 _st","vec4 _c0"]}};function processGlsl(r){let e=typeLookup[r.type];if(e){let t=e.args.map(u=>u).join(", "),n=r.inputs.map(u=>`${u.type} ${u.name}`).join(", "),s=`${t}${n.length>0?", "+n:""}`,o=`
  ${e.returnType} ${r.name}(${s}) {
      ${r.glsl}
  }
`;return(r.type==="combine"||r.type==="combineCoord")&&r.inputs.unshift({name:"color",type:"vec4"}),Object.assign({},r,{glsl:o})}else console.warn(`type ${r.type} not recognized`,r)}var regl$1={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(commonjsGlobal,function(){var t=function(l){return l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array||l instanceof Int8Array||l instanceof Int16Array||l instanceof Int32Array||l instanceof Float32Array||l instanceof Float64Array||l instanceof Uint8ClampedArray},n=function(l,v){for(var w=Object.keys(v),H=0;H<w.length;++H)l[w[H]]=v[w[H]];return l},s=`
`;function o(l){return typeof atob<"u"?atob(l):"base64:"+l}function u(l){var v=new Error("(regl) "+l);throw console.error(v),v}function c(l,v){l||u(v)}function h(l){return l?": "+l:""}function f(l,v,w){l in v||u("unknown parameter ("+l+")"+h(w)+". possible values: "+Object.keys(v).join())}function d(l,v){t(l)||u("invalid parameter type"+h(v)+". must be a typed array")}function p(l,v){switch(v){case"number":return typeof l=="number";case"object":return typeof l=="object";case"string":return typeof l=="string";case"boolean":return typeof l=="boolean";case"function":return typeof l=="function";case"undefined":return typeof l>"u";case"symbol":return typeof l=="symbol"}}function S(l,v,w){p(l,v)||u("invalid parameter type"+h(w)+". expected "+v+", got "+typeof l)}function E(l,v){l>=0&&(l|0)===l||u("invalid parameter type, ("+l+")"+h(v)+". must be a nonnegative integer")}function N(l,v,w){v.indexOf(l)<0&&u("invalid value"+h(w)+". must be one of: "+v)}var D=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function L(l){Object.keys(l).forEach(function(v){D.indexOf(v)<0&&u('invalid regl constructor argument "'+v+'". must be one of '+D)})}function W(l,v){for(l=l+"";l.length<v;)l=" "+l;return l}function K(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function se(l,v){this.number=l,this.line=v,this.errors=[]}function ye(l,v,w){this.file=l,this.line=v,this.message=w}function G(){var l=new Error,v=(l.stack||l).toString(),w=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(v);if(w)return w[1];var H=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(v);return H?H[1]:"unknown"}function C(){var l=new Error,v=(l.stack||l).toString(),w=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(v);if(w)return w[1];var H=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(v);return H?H[1]:"unknown"}function T(l,v){var w=l.split(`
`),H=1,ne=0,X={unknown:new K,0:new K};X.unknown.name=X[0].name=v||G(),X.unknown.lines.push(new se(0,""));for(var Z=0;Z<w.length;++Z){var le=w[Z],de=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(le);if(de)switch(de[1]){case"line":var _e=/(\d+)(\s+\d+)?/.exec(de[2]);_e&&(H=_e[1]|0,_e[2]&&(ne=_e[2]|0,ne in X||(X[ne]=new K)));break;case"define":var pe=/SHADER_NAME(_B64)?\s+(.*)$/.exec(de[2]);pe&&(X[ne].name=pe[1]?o(pe[2]):pe[2]);break}X[ne].lines.push(new se(H++,le))}return Object.keys(X).forEach(function(Ae){var Ne=X[Ae];Ne.lines.forEach(function(he){Ne.index[he.number]=he})}),X}function O(l){var v=[];return l.split(`
`).forEach(function(w){if(!(w.length<5)){var H=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(w);H?v.push(new ye(H[1]|0,H[2]|0,H[3].trim())):w.length>0&&v.push(new ye("unknown",0,w))}}),v}function k(l,v){v.forEach(function(w){var H=l[w.file];if(H){var ne=H.index[w.line];if(ne){ne.errors.push(w),H.hasErrors=!0;return}}l.unknown.hasErrors=!0,l.unknown.lines[0].errors.push(w)})}function q(l,v,w,H,ne){if(!l.getShaderParameter(v,l.COMPILE_STATUS)){var X=l.getShaderInfoLog(v),Z=H===l.FRAGMENT_SHADER?"fragment":"vertex";De(w,"string",Z+" shader source must be a string",ne);var le=T(w,ne),de=O(X);k(le,de),Object.keys(le).forEach(function(_e){var pe=le[_e];if(!pe.hasErrors)return;var Ae=[""],Ne=[""];function he(Te,U){Ae.push(Te),Ne.push(U||"")}he("file number "+_e+": "+pe.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),pe.lines.forEach(function(Te){if(Te.errors.length>0){he(W(Te.number,4)+"|  ","background-color:yellow; font-weight:bold"),he(Te.line+s,"color:red; background-color:yellow; font-weight:bold");var U=0;Te.errors.forEach(function(Q){var ve=Q.message,Oe=/^\s*'(.*)'\s*:\s*(.*)$/.exec(ve);if(Oe){var ae=Oe[1];switch(ve=Oe[2],ae){case"assign":ae="=";break}U=Math.max(Te.line.indexOf(ae,U),0)}else U=0;he(W("| ",6)),he(W("^^^",U+3)+s,"font-weight:bold"),he(W("| ",6)),he(ve+s,"font-weight:bold")}),he(W("| ",6)+s)}else he(W(Te.number,4)+"|  "),he(Te.line+s,"color:red")}),typeof document<"u"&&!window.chrome?(Ne[0]=Ae.join("%c"),console.log.apply(console,Ne)):console.log(Ae.join(""))}),c.raise("Error compiling "+Z+" shader, "+le[0].name)}}function J(l,v,w,H,ne){if(!l.getProgramParameter(v,l.LINK_STATUS)){var X=l.getProgramInfoLog(v),Z=T(w,ne),le=T(H,ne),de='Error linking program with vertex shader, "'+le[0].name+'", and fragment shader "'+Z[0].name+'"';typeof document<"u"?console.log("%c"+de+s+"%c"+X,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(de+s+X),c.raise(de)}}function ie(l){l._commandRef=G()}function xe(l,v,w,H){ie(l);function ne(de){return de?H.id(de):0}l._fragId=ne(l.static.frag),l._vertId=ne(l.static.vert);function X(de,_e){Object.keys(_e).forEach(function(pe){de[H.id(pe)]=!0})}var Z=l._uniformSet={};X(Z,v.static),X(Z,v.dynamic);var le=l._attributeSet={};X(le,w.static),X(le,w.dynamic),l._hasCount="count"in l.static||"count"in l.dynamic||"elements"in l.static||"elements"in l.dynamic}function fe(l,v){var w=C();u(l+" in command "+(v||G())+(w==="unknown"?"":" called from "+w))}function we(l,v,w){l||fe(v,w||G())}function Ee(l,v,w,H){l in v||fe("unknown parameter ("+l+")"+h(w)+". possible values: "+Object.keys(v).join(),H||G())}function De(l,v,w,H){p(l,v)||fe("invalid parameter type"+h(w)+". expected "+v+", got "+typeof l,H||G())}function Fe(l){l()}function We(l,v,w){l.texture?N(l.texture._texture.internalformat,v,"unsupported texture format for attachment"):N(l.renderbuffer._renderbuffer.format,w,"unsupported renderbuffer format for attachment")}var je=33071,qe=9728,ft=9984,dt=9985,pt=9986,Je=9987,lt=5120,Ft=5121,$e=5122,Qt=5123,Kt=5124,nn=5125,Jt=5126,nr=32819,rr=32820,Pe=33635,Ye=34042,Nt=36193,ct={};ct[lt]=ct[Ft]=1,ct[$e]=ct[Qt]=ct[Nt]=ct[Pe]=ct[nr]=ct[rr]=2,ct[Kt]=ct[nn]=ct[Jt]=ct[Ye]=4;function ht(l,v){return l===rr||l===nr||l===Pe?2:l===Ye?4:ct[l]*v}function vt(l){return!(l&l-1)&&!!l}function Lt(l,v,w){var H,ne=v.width,X=v.height,Z=v.channels;c(ne>0&&ne<=w.maxTextureSize&&X>0&&X<=w.maxTextureSize,"invalid texture shape"),(l.wrapS!==je||l.wrapT!==je)&&c(vt(ne)&&vt(X),"incompatible wrap mode for texture, both width and height must be power of 2"),v.mipmask===1?ne!==1&&X!==1&&c(l.minFilter!==ft&&l.minFilter!==pt&&l.minFilter!==dt&&l.minFilter!==Je,"min filter requires mipmap"):(c(vt(ne)&&vt(X),"texture must be a square power of 2 to support mipmapping"),c(v.mipmask===(ne<<1)-1,"missing or incomplete mipmap data")),v.type===Jt&&(w.extensions.indexOf("oes_texture_float_linear")<0&&c(l.minFilter===qe&&l.magFilter===qe,"filter not supported, must enable oes_texture_float_linear"),c(!l.genMipmaps,"mipmap generation not supported with float textures"));var le=v.images;for(H=0;H<16;++H)if(le[H]){var de=ne>>H,_e=X>>H;c(v.mipmask&1<<H,"missing mipmap data");var pe=le[H];if(c(pe.width===de&&pe.height===_e,"invalid shape for mip images"),c(pe.format===v.format&&pe.internalformat===v.internalformat&&pe.type===v.type,"incompatible type for mip image"),!pe.compressed)if(pe.data){var Ae=Math.ceil(ht(pe.type,Z)*de/pe.unpackAlignment)*pe.unpackAlignment;c(pe.data.byteLength===Ae*_e,"invalid data for image, buffer size is inconsistent with image format")}else pe.element||pe.copy}else l.genMipmaps||c((v.mipmask&1<<H)===0,"extra mipmap data");v.compressed&&c(!l.genMipmaps,"mipmap generation for compressed images not supported")}function Xt(l,v,w,H){var ne=l.width,X=l.height,Z=l.channels;c(ne>0&&ne<=H.maxTextureSize&&X>0&&X<=H.maxTextureSize,"invalid texture shape"),c(ne===X,"cube map must be square"),c(v.wrapS===je&&v.wrapT===je,"wrap mode not supported by cube map");for(var le=0;le<w.length;++le){var de=w[le];c(de.width===ne&&de.height===X,"inconsistent cube map face shape"),v.genMipmaps&&(c(!de.compressed,"can not generate mipmap for compressed textures"),c(de.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var _e=de.images,pe=0;pe<16;++pe){var Ae=_e[pe];if(Ae){var Ne=ne>>pe,he=X>>pe;c(de.mipmask&1<<pe,"missing mipmap data"),c(Ae.width===Ne&&Ae.height===he,"invalid shape for mip images"),c(Ae.format===l.format&&Ae.internalformat===l.internalformat&&Ae.type===l.type,"incompatible type for mip image"),Ae.compressed||(Ae.data?c(Ae.data.byteLength===Ne*he*Math.max(ht(Ae.type,Z),Ae.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ae.element||Ae.copy)}}}}var g=n(c,{optional:Fe,raise:u,commandRaise:fe,command:we,parameter:f,commandParameter:Ee,constructor:L,type:S,commandType:De,isTypedArray:d,nni:E,oneOf:N,shaderError:q,linkError:J,callSite:C,saveCommandRef:ie,saveDrawInfo:xe,framebufferFormat:We,guessCommand:G,texture2D:Lt,textureCube:Xt}),Ln=0,Mr=0,Fr=5,Mo=6;function un(l,v){this.id=Ln++,this.type=l,this.data=v}function Ri(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Vn(l){if(l.length===0)return[];var v=l.charAt(0),w=l.charAt(l.length-1);if(l.length>1&&v===w&&(v==='"'||v==="'"))return['"'+Ri(l.substr(1,l.length-2))+'"'];var H=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(l);if(H)return Vn(l.substr(0,H.index)).concat(Vn(H[1])).concat(Vn(l.substr(H.index+H[0].length)));var ne=l.split(".");if(ne.length===1)return['"'+Ri(l)+'"'];for(var X=[],Z=0;Z<ne.length;++Z)X=X.concat(Vn(ne[Z]));return X}function Mi(l){return"["+Vn(l).join("][")+"]"}function Fo(l,v){return new un(l,Mi(v+""))}function Do(l){return typeof l=="function"&&!l._reglType||l instanceof un}function Fi(l,v){if(typeof l=="function")return new un(Mr,l);if(typeof l=="number"||typeof l=="boolean")return new un(Fr,l);if(Array.isArray(l))return new un(Mo,l.map((w,H)=>Fi(w,v+"["+H+"]")));if(l instanceof un)return l;g(!1,"invalid option type in uniform "+v)}var Gt={DynamicVariable:un,define:Fo,isDynamic:Do,unbox:Fi,accessor:Mi},Dr={next:typeof requestAnimationFrame=="function"?function(l){return requestAnimationFrame(l)}:function(l){return setTimeout(l,16)},cancel:typeof cancelAnimationFrame=="function"?function(l){return cancelAnimationFrame(l)}:clearTimeout},Di=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Po(){var l={"":0},v=[""];return{id:function(w){var H=l[w];return H||(H=l[w]=v.length,v.push(w),H)},str:function(w){return v[w]}}}function Lo(l,v,w){var H=document.createElement("canvas");n(H.style,{border:0,margin:0,padding:0,top:0,left:0}),l.appendChild(H),l===document.body&&(H.style.position="absolute",n(l.style,{margin:0,padding:0}));function ne(){var le=window.innerWidth,de=window.innerHeight;if(l!==document.body){var _e=l.getBoundingClientRect();le=_e.right-_e.left,de=_e.bottom-_e.top}H.width=w*le,H.height=w*de,n(H.style,{width:le+"px",height:de+"px"})}var X;l!==document.body&&typeof ResizeObserver=="function"?(X=new ResizeObserver(function(){setTimeout(ne)}),X.observe(l)):window.addEventListener("resize",ne,!1);function Z(){X?X.disconnect():window.removeEventListener("resize",ne),l.removeChild(H)}return ne(),{canvas:H,onDestroy:Z}}function Vo(l,v){function w(H){try{return l.getContext(H,v)}catch{return null}}return w("webgl")||w("experimental-webgl")||w("webgl-experimental")}function Bo(l){return typeof l.nodeName=="string"&&typeof l.appendChild=="function"&&typeof l.getBoundingClientRect=="function"}function Go(l){return typeof l.drawArrays=="function"||typeof l.drawElements=="function"}function Pi(l){return typeof l=="string"?l.split():(g(Array.isArray(l),"invalid extension array"),l)}function Li(l){return typeof l=="string"?(g(typeof document<"u","not supported outside of DOM"),document.querySelector(l)):l}function Uo(l){var v=l||{},w,H,ne,X,Z={},le=[],de=[],_e=typeof window>"u"?1:window.devicePixelRatio,pe=!1,Ae=function(Te){Te&&g.raise(Te)},Ne=function(){};if(typeof v=="string"?(g(typeof document<"u","selector queries only supported in DOM enviroments"),w=document.querySelector(v),g(w,"invalid query string for element")):typeof v=="object"?Bo(v)?w=v:Go(v)?(X=v,ne=X.canvas):(g.constructor(v),"gl"in v?X=v.gl:"canvas"in v?ne=Li(v.canvas):"container"in v&&(H=Li(v.container)),"attributes"in v&&(Z=v.attributes,g.type(Z,"object","invalid context attributes")),"extensions"in v&&(le=Pi(v.extensions)),"optionalExtensions"in v&&(de=Pi(v.optionalExtensions)),"onDone"in v&&(g.type(v.onDone,"function","invalid or missing onDone callback"),Ae=v.onDone),"profile"in v&&(pe=!!v.profile),"pixelRatio"in v&&(_e=+v.pixelRatio,g(_e>0,"invalid pixel ratio"))):g.raise("invalid arguments to regl"),w&&(w.nodeName.toLowerCase()==="canvas"?ne=w:H=w),!X){if(!ne){g(typeof document<"u","must manually specify webgl context outside of DOM environments");var he=Lo(H||document.body,Ae,_e);if(!he)return null;ne=he.canvas,Ne=he.onDestroy}Z.premultipliedAlpha===void 0&&(Z.premultipliedAlpha=!0),X=Vo(ne,Z)}return X?{gl:X,canvas:ne,container:H,extensions:le,optionalExtensions:de,pixelRatio:_e,profile:pe,onDone:Ae,onDestroy:Ne}:(Ne(),Ae("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Wo(l,v){var w={};function H(Z){g.type(Z,"string","extension name must be string");var le=Z.toLowerCase(),de;try{de=w[le]=l.getExtension(le)}catch{}return!!de}for(var ne=0;ne<v.extensions.length;++ne){var X=v.extensions[ne];if(!H(X))return v.onDestroy(),v.onDone('"'+X+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return v.optionalExtensions.forEach(H),{extensions:w,restore:function(){Object.keys(w).forEach(function(Z){if(w[Z]&&!H(Z))throw new Error("(regl): error restoring extension "+Z)})}}}function Vt(l,v){for(var w=Array(l),H=0;H<l;++H)w[H]=v(H);return w}var qo=5120,jo=5121,$o=5122,zo=5123,Xo=5124,Ho=5125,Yo=5126;function Zo(l){for(var v=16;v<=1<<28;v*=16)if(l<=v)return v;return 0}function Vi(l){var v,w;return v=(l>65535)<<4,l>>>=v,w=(l>255)<<3,l>>>=w,v|=w,w=(l>15)<<2,l>>>=w,v|=w,w=(l>3)<<1,l>>>=w,v|=w,v|l>>1}function Bi(){var l=Vt(8,function(){return[]});function v(X){var Z=Zo(X),le=l[Vi(Z)>>2];return le.length>0?le.pop():new ArrayBuffer(Z)}function w(X){l[Vi(X.byteLength)>>2].push(X)}function H(X,Z){var le=null;switch(X){case qo:le=new Int8Array(v(Z),0,Z);break;case jo:le=new Uint8Array(v(Z),0,Z);break;case $o:le=new Int16Array(v(2*Z),0,Z);break;case zo:le=new Uint16Array(v(2*Z),0,Z);break;case Xo:le=new Int32Array(v(4*Z),0,Z);break;case Ho:le=new Uint32Array(v(4*Z),0,Z);break;case Yo:le=new Float32Array(v(4*Z),0,Z);break;default:return null}return le.length!==Z?le.subarray(0,Z):le}function ne(X){w(X.buffer)}return{alloc:v,free:w,allocType:H,freeType:ne}}var Tt=Bi();Tt.zero=Bi();var Qo=3408,Ko=3410,Jo=3411,ea=3412,ta=3413,na=3414,ra=3415,ia=33901,sa=33902,oa=3379,aa=3386,ca=34921,ua=36347,la=36348,ha=35661,fa=35660,da=34930,pa=36349,ma=34076,va=34024,_a=7936,ga=7937,ya=7938,Aa=35724,Ta=34047,ba=36063,Sa=34852,ir=3553,Gi=34067,xa=34069,Na=33984,Bn=6408,Pr=5126,Ui=5121,Lr=36160,Ca=36053,wa=36064,Ea=16384,Oa=function(l,v){var w=1;v.ext_texture_filter_anisotropic&&(w=l.getParameter(Ta));var H=1,ne=1;v.webgl_draw_buffers&&(H=l.getParameter(Sa),ne=l.getParameter(ba));var X=!!v.oes_texture_float;if(X){var Z=l.createTexture();l.bindTexture(ir,Z),l.texImage2D(ir,0,Bn,1,1,0,Bn,Pr,null);var le=l.createFramebuffer();if(l.bindFramebuffer(Lr,le),l.framebufferTexture2D(Lr,wa,ir,Z,0),l.bindTexture(ir,null),l.checkFramebufferStatus(Lr)!==Ca)X=!1;else{l.viewport(0,0,1,1),l.clearColor(1,0,0,1),l.clear(Ea);var de=Tt.allocType(Pr,4);l.readPixels(0,0,1,1,Bn,Pr,de),l.getError()?X=!1:(l.deleteFramebuffer(le),l.deleteTexture(Z),X=de[0]===1),Tt.freeType(de)}}var _e=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),pe=!0;if(!_e){var Ae=l.createTexture(),Ne=Tt.allocType(Ui,36);l.activeTexture(Na),l.bindTexture(Gi,Ae),l.texImage2D(xa,0,Bn,3,3,0,Bn,Ui,Ne),Tt.freeType(Ne),l.bindTexture(Gi,null),l.deleteTexture(Ae),pe=!l.getError()}return{colorBits:[l.getParameter(Ko),l.getParameter(Jo),l.getParameter(ea),l.getParameter(ta)],depthBits:l.getParameter(na),stencilBits:l.getParameter(ra),subpixelBits:l.getParameter(Qo),extensions:Object.keys(v).filter(function(he){return!!v[he]}),maxAnisotropic:w,maxDrawbuffers:H,maxColorAttachments:ne,pointSizeDims:l.getParameter(ia),lineWidthDims:l.getParameter(sa),maxViewportDims:l.getParameter(aa),maxCombinedTextureUnits:l.getParameter(ha),maxCubeMapSize:l.getParameter(ma),maxRenderbufferSize:l.getParameter(va),maxTextureUnits:l.getParameter(da),maxTextureSize:l.getParameter(oa),maxAttributes:l.getParameter(ca),maxVertexUniforms:l.getParameter(ua),maxVertexTextureUnits:l.getParameter(fa),maxVaryingVectors:l.getParameter(la),maxFragmentUniforms:l.getParameter(pa),glsl:l.getParameter(Aa),renderer:l.getParameter(ga),vendor:l.getParameter(_a),version:l.getParameter(ya),readFloat:X,npotTextureCube:pe}};function jt(l){return!!l&&typeof l=="object"&&Array.isArray(l.shape)&&Array.isArray(l.stride)&&typeof l.offset=="number"&&l.shape.length===l.stride.length&&(Array.isArray(l.data)||t(l.data))}var Ut=function(l){return Object.keys(l).map(function(v){return l[v]})},sr={shape:Ma,flatten:Ra};function Ia(l,v,w){for(var H=0;H<v;++H)w[H]=l[H]}function ka(l,v,w,H){for(var ne=0,X=0;X<v;++X)for(var Z=l[X],le=0;le<w;++le)H[ne++]=Z[le]}function Wi(l,v,w,H,ne,X){for(var Z=X,le=0;le<v;++le)for(var de=l[le],_e=0;_e<w;++_e)for(var pe=de[_e],Ae=0;Ae<H;++Ae)ne[Z++]=pe[Ae]}function qi(l,v,w,H,ne){for(var X=1,Z=w+1;Z<v.length;++Z)X*=v[Z];var le=v[w];if(v.length-w===4){var de=v[w+1],_e=v[w+2],pe=v[w+3];for(Z=0;Z<le;++Z)Wi(l[Z],de,_e,pe,H,ne),ne+=X}else for(Z=0;Z<le;++Z)qi(l[Z],v,w+1,H,ne),ne+=X}function Ra(l,v,w,H){var ne=1;if(v.length)for(var X=0;X<v.length;++X)ne*=v[X];else ne=0;var Z=H||Tt.allocType(w,ne);switch(v.length){case 0:break;case 1:Ia(l,v[0],Z);break;case 2:ka(l,v[0],v[1],Z);break;case 3:Wi(l,v[0],v[1],v[2],Z,0);break;default:qi(l,v,0,Z,0)}return Z}function Ma(l){for(var v=[],w=l;w.length;w=w[0])v.push(w.length);return v}var Vr={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Fa=5120,Da=5122,Pa=5124,La=5121,Va=5123,Ba=5125,Ga=5126,Ua=5126,ln={int8:Fa,int16:Da,int32:Pa,uint8:La,uint16:Va,uint32:Ba,float:Ga,float32:Ua},Wa=35048,qa=35040,or={dynamic:Wa,stream:qa,static:35044},Br=sr.flatten,ji=sr.shape,$i=35044,ja=35040,Gr=5121,Ur=5126,rn=[];rn[5120]=1,rn[5122]=2,rn[5124]=4,rn[5121]=1,rn[5123]=2,rn[5125]=4,rn[5126]=4;function ar(l){return Vr[Object.prototype.toString.call(l)]|0}function zi(l,v){for(var w=0;w<v.length;++w)l[w]=v[w]}function Xi(l,v,w,H,ne,X,Z){for(var le=0,de=0;de<w;++de)for(var _e=0;_e<H;++_e)l[le++]=v[ne*de+X*_e+Z]}function $a(l,v,w,H){var ne=0,X={};function Z(U){this.id=ne++,this.buffer=l.createBuffer(),this.type=U,this.usage=$i,this.byteLength=0,this.dimension=1,this.dtype=Gr,this.persistentData=null,w.profile&&(this.stats={size:0})}Z.prototype.bind=function(){l.bindBuffer(this.type,this.buffer)},Z.prototype.destroy=function(){Ne(this)};var le=[];function de(U,Q){var ve=le.pop();return ve||(ve=new Z(U)),ve.bind(),Ae(ve,Q,ja,0,1,!1),ve}function _e(U){le.push(U)}function pe(U,Q,ve){U.byteLength=Q.byteLength,l.bufferData(U.type,Q,ve)}function Ae(U,Q,ve,Oe,ae,Ie){var ue;if(U.usage=ve,Array.isArray(Q)){if(U.dtype=Oe||Ur,Q.length>0){var be;if(Array.isArray(Q[0])){ue=ji(Q);for(var ce=1,Se=1;Se<ue.length;++Se)ce*=ue[Se];U.dimension=ce,be=Br(Q,ue,U.dtype),pe(U,be,ve),Ie?U.persistentData=be:Tt.freeType(be)}else if(typeof Q[0]=="number"){U.dimension=ae;var Ve=Tt.allocType(U.dtype,Q.length);zi(Ve,Q),pe(U,Ve,ve),Ie?U.persistentData=Ve:Tt.freeType(Ve)}else t(Q[0])?(U.dimension=Q[0].length,U.dtype=Oe||ar(Q[0])||Ur,be=Br(Q,[Q.length,Q[0].length],U.dtype),pe(U,be,ve),Ie?U.persistentData=be:Tt.freeType(be)):g.raise("invalid buffer data")}}else if(t(Q))U.dtype=Oe||ar(Q),U.dimension=ae,pe(U,Q,ve),Ie&&(U.persistentData=new Uint8Array(new Uint8Array(Q.buffer)));else if(jt(Q)){ue=Q.shape;var ze=Q.stride,Ce=Q.offset,ge=0,oe=0,Ue=0,Ze=0;ue.length===1?(ge=ue[0],oe=1,Ue=ze[0],Ze=0):ue.length===2?(ge=ue[0],oe=ue[1],Ue=ze[0],Ze=ze[1]):g.raise("invalid shape"),U.dtype=Oe||ar(Q.data)||Ur,U.dimension=oe;var Re=Tt.allocType(U.dtype,ge*oe);Xi(Re,Q.data,ge,oe,Ue,Ze,Ce),pe(U,Re,ve),Ie?U.persistentData=Re:Tt.freeType(Re)}else Q instanceof ArrayBuffer?(U.dtype=Gr,U.dimension=ae,pe(U,Q,ve),Ie&&(U.persistentData=new Uint8Array(new Uint8Array(Q)))):g.raise("invalid buffer data")}function Ne(U){v.bufferCount--,H(U);var Q=U.buffer;g(Q,"buffer must not be deleted already"),l.deleteBuffer(Q),U.buffer=null,delete X[U.id]}function he(U,Q,ve,Oe){v.bufferCount++;var ae=new Z(Q);X[ae.id]=ae;function Ie(ce){var Se=$i,Ve=null,ze=0,Ce=0,ge=1;return Array.isArray(ce)||t(ce)||jt(ce)||ce instanceof ArrayBuffer?Ve=ce:typeof ce=="number"?ze=ce|0:ce&&(g.type(ce,"object","buffer arguments must be an object, a number or an array"),"data"in ce&&(g(Ve===null||Array.isArray(Ve)||t(Ve)||jt(Ve),"invalid data for buffer"),Ve=ce.data),"usage"in ce&&(g.parameter(ce.usage,or,"invalid buffer usage"),Se=or[ce.usage]),"type"in ce&&(g.parameter(ce.type,ln,"invalid buffer type"),Ce=ln[ce.type]),"dimension"in ce&&(g.type(ce.dimension,"number","invalid dimension"),ge=ce.dimension|0),"length"in ce&&(g.nni(ze,"buffer length must be a nonnegative integer"),ze=ce.length|0)),ae.bind(),Ve?Ae(ae,Ve,Se,Ce,ge,Oe):(ze&&l.bufferData(ae.type,ze,Se),ae.dtype=Ce||Gr,ae.usage=Se,ae.dimension=ge,ae.byteLength=ze),w.profile&&(ae.stats.size=ae.byteLength*rn[ae.dtype]),Ie}function ue(ce,Se){g(Se+ce.byteLength<=ae.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+ce.byteLength+" starting from offset "+Se+" to a buffer of size "+ae.byteLength),l.bufferSubData(ae.type,Se,ce)}function be(ce,Se){var Ve=(Se||0)|0,ze;if(ae.bind(),t(ce)||ce instanceof ArrayBuffer)ue(ce,Ve);else if(Array.isArray(ce)){if(ce.length>0)if(typeof ce[0]=="number"){var Ce=Tt.allocType(ae.dtype,ce.length);zi(Ce,ce),ue(Ce,Ve),Tt.freeType(Ce)}else if(Array.isArray(ce[0])||t(ce[0])){ze=ji(ce);var ge=Br(ce,ze,ae.dtype);ue(ge,Ve),Tt.freeType(ge)}else g.raise("invalid buffer data")}else if(jt(ce)){ze=ce.shape;var oe=ce.stride,Ue=0,Ze=0,Re=0,tt=0;ze.length===1?(Ue=ze[0],Ze=1,Re=oe[0],tt=0):ze.length===2?(Ue=ze[0],Ze=ze[1],Re=oe[0],tt=oe[1]):g.raise("invalid shape");var Xe=Array.isArray(ce.data)?ae.dtype:ar(ce.data),et=Tt.allocType(Xe,Ue*Ze);Xi(et,ce.data,Ue,Ze,Re,tt,ce.offset),ue(et,Ve),Tt.freeType(et)}else g.raise("invalid data for buffer subdata");return Ie}return ve||Ie(U),Ie._reglType="buffer",Ie._buffer=ae,Ie.subdata=be,w.profile&&(Ie.stats=ae.stats),Ie.destroy=function(){Ne(ae)},Ie}function Te(){Ut(X).forEach(function(U){U.buffer=l.createBuffer(),l.bindBuffer(U.type,U.buffer),l.bufferData(U.type,U.persistentData||U.byteLength,U.usage)})}return w.profile&&(v.getTotalBufferSize=function(){var U=0;return Object.keys(X).forEach(function(Q){U+=X[Q].stats.size}),U}),{create:he,createStream:de,destroyStream:_e,clear:function(){Ut(X).forEach(Ne),le.forEach(Ne)},getBuffer:function(U){return U&&U._buffer instanceof Z?U._buffer:null},restore:Te,_initBuffer:Ae}}var za=0,Xa=0,Ha=1,Ya=1,Za=4,Qa=4,Tn={points:za,point:Xa,lines:Ha,line:Ya,triangles:Za,triangle:Qa,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ka=0,Ja=1,Gn=4,ec=5120,bn=5121,Hi=5122,Sn=5123,Yi=5124,hn=5125,Wr=34963,tc=35040,nc=35044;function rc(l,v,w,H){var ne={},X=0,Z={uint8:bn,uint16:Sn};v.oes_element_index_uint&&(Z.uint32=hn);function le(Te){this.id=X++,ne[this.id]=this,this.buffer=Te,this.primType=Gn,this.vertCount=0,this.type=0}le.prototype.bind=function(){this.buffer.bind()};var de=[];function _e(Te){var U=de.pop();return U||(U=new le(w.create(null,Wr,!0,!1)._buffer)),Ae(U,Te,tc,-1,-1,0,0),U}function pe(Te){de.push(Te)}function Ae(Te,U,Q,ve,Oe,ae,Ie){Te.buffer.bind();var ue;if(U){var be=Ie;!Ie&&(!t(U)||jt(U)&&!t(U.data))&&(be=v.oes_element_index_uint?hn:Sn),w._initBuffer(Te.buffer,U,Q,be,3)}else l.bufferData(Wr,ae,Q),Te.buffer.dtype=ue||bn,Te.buffer.usage=Q,Te.buffer.dimension=3,Te.buffer.byteLength=ae;if(ue=Ie,!Ie){switch(Te.buffer.dtype){case bn:case ec:ue=bn;break;case Sn:case Hi:ue=Sn;break;case hn:case Yi:ue=hn;break;default:g.raise("unsupported type for element array")}Te.buffer.dtype=ue}Te.type=ue,g(ue!==hn||!!v.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var ce=Oe;ce<0&&(ce=Te.buffer.byteLength,ue===Sn?ce>>=1:ue===hn&&(ce>>=2)),Te.vertCount=ce;var Se=ve;if(ve<0){Se=Gn;var Ve=Te.buffer.dimension;Ve===1&&(Se=Ka),Ve===2&&(Se=Ja),Ve===3&&(Se=Gn)}Te.primType=Se}function Ne(Te){H.elementsCount--,g(Te.buffer!==null,"must not double destroy elements"),delete ne[Te.id],Te.buffer.destroy(),Te.buffer=null}function he(Te,U){var Q=w.create(null,Wr,!0),ve=new le(Q._buffer);H.elementsCount++;function Oe(ae){if(!ae)Q(),ve.primType=Gn,ve.vertCount=0,ve.type=bn;else if(typeof ae=="number")Q(ae),ve.primType=Gn,ve.vertCount=ae|0,ve.type=bn;else{var Ie=null,ue=nc,be=-1,ce=-1,Se=0,Ve=0;Array.isArray(ae)||t(ae)||jt(ae)?Ie=ae:(g.type(ae,"object","invalid arguments for elements"),"data"in ae&&(Ie=ae.data,g(Array.isArray(Ie)||t(Ie)||jt(Ie),"invalid data for element buffer")),"usage"in ae&&(g.parameter(ae.usage,or,"invalid element buffer usage"),ue=or[ae.usage]),"primitive"in ae&&(g.parameter(ae.primitive,Tn,"invalid element buffer primitive"),be=Tn[ae.primitive]),"count"in ae&&(g(typeof ae.count=="number"&&ae.count>=0,"invalid vertex count for elements"),ce=ae.count|0),"type"in ae&&(g.parameter(ae.type,Z,"invalid buffer type"),Ve=Z[ae.type]),"length"in ae?Se=ae.length|0:(Se=ce,Ve===Sn||Ve===Hi?Se*=2:(Ve===hn||Ve===Yi)&&(Se*=4))),Ae(ve,Ie,ue,be,ce,Se,Ve)}return Oe}return Oe(Te),Oe._reglType="elements",Oe._elements=ve,Oe.subdata=function(ae,Ie){return Q.subdata(ae,Ie),Oe},Oe.destroy=function(){Ne(ve)},Oe}return{create:he,createStream:_e,destroyStream:pe,getElements:function(Te){return typeof Te=="function"&&Te._elements instanceof le?Te._elements:null},clear:function(){Ut(ne).forEach(Ne)}}}var Zi=new Float32Array(1),ic=new Uint32Array(Zi.buffer),sc=5123;function Qi(l){for(var v=Tt.allocType(sc,l.length),w=0;w<l.length;++w)if(isNaN(l[w]))v[w]=65535;else if(l[w]===1/0)v[w]=31744;else if(l[w]===-1/0)v[w]=64512;else{Zi[0]=l[w];var H=ic[0],ne=H>>>31<<15,X=(H<<1>>>24)-127,Z=H>>13&1024-1;if(X<-24)v[w]=ne;else if(X<-14){var le=-14-X;v[w]=ne+(Z+1024>>le)}else X>15?v[w]=ne+31744:v[w]=ne+(X+15<<10)+Z}return v}function gt(l){return Array.isArray(l)||t(l)}var Ki=function(l){return!(l&l-1)&&!!l},oc=34467,Ht=3553,qr=34067,cr=34069,fn=6408,jr=6406,ur=6407,Un=6409,lr=6410,Ji=32854,$r=32855,es=36194,ac=32819,cc=32820,uc=33635,lc=34042,zr=6402,hr=34041,Xr=35904,Hr=35906,xn=36193,Yr=33776,Zr=33777,Qr=33778,Kr=33779,ts=35986,ns=35987,rs=34798,is=35840,ss=35841,os=35842,as=35843,cs=36196,Nn=5121,Jr=5123,ei=5125,Wn=5126,hc=10242,fc=10243,dc=10497,ti=33071,pc=33648,mc=10240,vc=10241,ni=9728,_c=9729,ri=9984,us=9985,ls=9986,ii=9987,gc=33170,fr=4352,yc=4353,Ac=4354,Tc=34046,bc=3317,Sc=37440,xc=37441,Nc=37443,hs=37444,qn=33984,Cc=[ri,ls,us,ii],dr=[0,Un,lr,ur,fn],Wt={};Wt[Un]=Wt[jr]=Wt[zr]=1,Wt[hr]=Wt[lr]=2,Wt[ur]=Wt[Xr]=3,Wt[fn]=Wt[Hr]=4;function Cn(l){return"[object "+l+"]"}var fs=Cn("HTMLCanvasElement"),ds=Cn("OffscreenCanvas"),ps=Cn("CanvasRenderingContext2D"),ms=Cn("ImageBitmap"),vs=Cn("HTMLImageElement"),_s=Cn("HTMLVideoElement"),wc=Object.keys(Vr).concat([fs,ds,ps,ms,vs,_s]),wn=[];wn[Nn]=1,wn[Wn]=4,wn[xn]=2,wn[Jr]=2,wn[ei]=4;var kt=[];kt[Ji]=2,kt[$r]=2,kt[es]=2,kt[hr]=4,kt[Yr]=.5,kt[Zr]=.5,kt[Qr]=1,kt[Kr]=1,kt[ts]=.5,kt[ns]=1,kt[rs]=1,kt[is]=.5,kt[ss]=.25,kt[os]=.5,kt[as]=.25,kt[cs]=.5;function gs(l){return Array.isArray(l)&&(l.length===0||typeof l[0]=="number")}function ys(l){if(!Array.isArray(l))return!1;var v=l.length;return!(v===0||!gt(l[0]))}function dn(l){return Object.prototype.toString.call(l)}function As(l){return dn(l)===fs}function Ts(l){return dn(l)===ds}function Ec(l){return dn(l)===ps}function Oc(l){return dn(l)===ms}function Ic(l){return dn(l)===vs}function kc(l){return dn(l)===_s}function si(l){if(!l)return!1;var v=dn(l);return wc.indexOf(v)>=0?!0:gs(l)||ys(l)||jt(l)}function bs(l){return Vr[Object.prototype.toString.call(l)]|0}function Rc(l,v){var w=v.length;switch(l.type){case Nn:case Jr:case ei:case Wn:var H=Tt.allocType(l.type,w);H.set(v),l.data=H;break;case xn:l.data=Qi(v);break;default:g.raise("unsupported texture type, must specify a typed array")}}function Ss(l,v){return Tt.allocType(l.type===xn?Wn:l.type,v)}function xs(l,v){l.type===xn?(l.data=Qi(v),Tt.freeType(v)):l.data=v}function Mc(l,v,w,H,ne,X){for(var Z=l.width,le=l.height,de=l.channels,_e=Z*le*de,pe=Ss(l,_e),Ae=0,Ne=0;Ne<le;++Ne)for(var he=0;he<Z;++he)for(var Te=0;Te<de;++Te)pe[Ae++]=v[w*he+H*Ne+ne*Te+X];xs(l,pe)}function pr(l,v,w,H,ne,X){var Z;if(typeof kt[l]<"u"?Z=kt[l]:Z=Wt[l]*wn[v],X&&(Z*=6),ne){for(var le=0,de=w;de>=1;)le+=Z*de*de,de/=2;return le}else return Z*w*H}function Fc(l,v,w,H,ne,X,Z){var le={"don't care":fr,"dont care":fr,nice:Ac,fast:yc},de={repeat:dc,clamp:ti,mirror:pc},_e={nearest:ni,linear:_c},pe=n({mipmap:ii,"nearest mipmap nearest":ri,"linear mipmap nearest":us,"nearest mipmap linear":ls,"linear mipmap linear":ii},_e),Ae={none:0,browser:hs},Ne={uint8:Nn,rgba4:ac,rgb565:uc,"rgb5 a1":cc},he={alpha:jr,luminance:Un,"luminance alpha":lr,rgb:ur,rgba:fn,rgba4:Ji,"rgb5 a1":$r,rgb565:es},Te={};v.ext_srgb&&(he.srgb=Xr,he.srgba=Hr),v.oes_texture_float&&(Ne.float32=Ne.float=Wn),v.oes_texture_half_float&&(Ne.float16=Ne["half float"]=xn),v.webgl_depth_texture&&(n(he,{depth:zr,"depth stencil":hr}),n(Ne,{uint16:Jr,uint32:ei,"depth stencil":lc})),v.webgl_compressed_texture_s3tc&&n(Te,{"rgb s3tc dxt1":Yr,"rgba s3tc dxt1":Zr,"rgba s3tc dxt3":Qr,"rgba s3tc dxt5":Kr}),v.webgl_compressed_texture_atc&&n(Te,{"rgb atc":ts,"rgba atc explicit alpha":ns,"rgba atc interpolated alpha":rs}),v.webgl_compressed_texture_pvrtc&&n(Te,{"rgb pvrtc 4bppv1":is,"rgb pvrtc 2bppv1":ss,"rgba pvrtc 4bppv1":os,"rgba pvrtc 2bppv1":as}),v.webgl_compressed_texture_etc1&&(Te["rgb etc1"]=cs);var U=Array.prototype.slice.call(l.getParameter(oc));Object.keys(Te).forEach(function(b){var Y=Te[b];U.indexOf(Y)>=0&&(he[b]=Y)});var Q=Object.keys(he);w.textureFormats=Q;var ve=[];Object.keys(he).forEach(function(b){var Y=he[b];ve[Y]=b});var Oe=[];Object.keys(Ne).forEach(function(b){var Y=Ne[b];Oe[Y]=b});var ae=[];Object.keys(_e).forEach(function(b){var Y=_e[b];ae[Y]=b});var Ie=[];Object.keys(pe).forEach(function(b){var Y=pe[b];Ie[Y]=b});var ue=[];Object.keys(de).forEach(function(b){var Y=de[b];ue[Y]=b});var be=Q.reduce(function(b,Y){var z=he[Y];return z===Un||z===jr||z===Un||z===lr||z===zr||z===hr||v.ext_srgb&&(z===Xr||z===Hr)?b[z]=z:z===$r||Y.indexOf("rgba")>=0?b[z]=fn:b[z]=ur,b},{});function ce(){this.internalformat=fn,this.format=fn,this.type=Nn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=hs,this.width=0,this.height=0,this.channels=0}function Se(b,Y){b.internalformat=Y.internalformat,b.format=Y.format,b.type=Y.type,b.compressed=Y.compressed,b.premultiplyAlpha=Y.premultiplyAlpha,b.flipY=Y.flipY,b.unpackAlignment=Y.unpackAlignment,b.colorSpace=Y.colorSpace,b.width=Y.width,b.height=Y.height,b.channels=Y.channels}function Ve(b,Y){if(!(typeof Y!="object"||!Y)){if("premultiplyAlpha"in Y&&(g.type(Y.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),b.premultiplyAlpha=Y.premultiplyAlpha),"flipY"in Y&&(g.type(Y.flipY,"boolean","invalid texture flip"),b.flipY=Y.flipY),"alignment"in Y&&(g.oneOf(Y.alignment,[1,2,4,8],"invalid texture unpack alignment"),b.unpackAlignment=Y.alignment),"colorSpace"in Y&&(g.parameter(Y.colorSpace,Ae,"invalid colorSpace"),b.colorSpace=Ae[Y.colorSpace]),"type"in Y){var z=Y.type;g(v.oes_texture_float||!(z==="float"||z==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),g(v.oes_texture_half_float||!(z==="half float"||z==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),g(v.webgl_depth_texture||!(z==="uint16"||z==="uint32"||z==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),g.parameter(z,Ne,"invalid texture type"),b.type=Ne[z]}var ke=b.width,nt=b.height,y=b.channels,m=!1;"shape"in Y?(g(Array.isArray(Y.shape)&&Y.shape.length>=2,"shape must be an array"),ke=Y.shape[0],nt=Y.shape[1],Y.shape.length===3&&(y=Y.shape[2],g(y>0&&y<=4,"invalid number of channels"),m=!0),g(ke>=0&&ke<=w.maxTextureSize,"invalid width"),g(nt>=0&&nt<=w.maxTextureSize,"invalid height")):("radius"in Y&&(ke=nt=Y.radius,g(ke>=0&&ke<=w.maxTextureSize,"invalid radius")),"width"in Y&&(ke=Y.width,g(ke>=0&&ke<=w.maxTextureSize,"invalid width")),"height"in Y&&(nt=Y.height,g(nt>=0&&nt<=w.maxTextureSize,"invalid height")),"channels"in Y&&(y=Y.channels,g(y>0&&y<=4,"invalid number of channels"),m=!0)),b.width=ke|0,b.height=nt|0,b.channels=y|0;var R=!1;if("format"in Y){var B=Y.format;g(v.webgl_depth_texture||!(B==="depth"||B==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),g.parameter(B,he,"invalid texture format");var j=b.internalformat=he[B];b.format=be[j],B in Ne&&("type"in Y||(b.type=Ne[B])),B in Te&&(b.compressed=!0),R=!0}!m&&R?b.channels=Wt[b.format]:m&&!R?b.channels!==dr[b.format]&&(b.format=b.internalformat=dr[b.channels]):R&&m&&g(b.channels===Wt[b.format],"number of channels inconsistent with specified format")}}function ze(b){l.pixelStorei(Sc,b.flipY),l.pixelStorei(xc,b.premultiplyAlpha),l.pixelStorei(Nc,b.colorSpace),l.pixelStorei(bc,b.unpackAlignment)}function Ce(){ce.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function ge(b,Y){var z=null;if(si(Y)?z=Y:Y&&(g.type(Y,"object","invalid pixel data type"),Ve(b,Y),"x"in Y&&(b.xOffset=Y.x|0),"y"in Y&&(b.yOffset=Y.y|0),si(Y.data)&&(z=Y.data)),g(!b.compressed||z instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Y.copy){g(!z,"can not specify copy and data field for the same texture");var ke=ne.viewportWidth,nt=ne.viewportHeight;b.width=b.width||ke-b.xOffset,b.height=b.height||nt-b.yOffset,b.needsCopy=!0,g(b.xOffset>=0&&b.xOffset<ke&&b.yOffset>=0&&b.yOffset<nt&&b.width>0&&b.width<=ke&&b.height>0&&b.height<=nt,"copy texture read out of bounds")}else if(!z)b.width=b.width||1,b.height=b.height||1,b.channels=b.channels||4;else if(t(z))b.channels=b.channels||4,b.data=z,!("type"in Y)&&b.type===Nn&&(b.type=bs(z));else if(gs(z))b.channels=b.channels||4,Rc(b,z),b.alignment=1,b.needsFree=!0;else if(jt(z)){var y=z.data;!Array.isArray(y)&&b.type===Nn&&(b.type=bs(y));var m=z.shape,R=z.stride,B,j,F,M,P,A;m.length===3?(F=m[2],A=R[2]):(g(m.length===2,"invalid ndarray pixel data, must be 2 or 3D"),F=1,A=1),B=m[0],j=m[1],M=R[0],P=R[1],b.alignment=1,b.width=B,b.height=j,b.channels=F,b.format=b.internalformat=dr[F],b.needsFree=!0,Mc(b,y,M,P,A,z.offset)}else if(As(z)||Ts(z)||Ec(z))As(z)||Ts(z)?b.element=z:b.element=z.canvas,b.width=b.element.width,b.height=b.element.height,b.channels=4;else if(Oc(z))b.element=z,b.width=z.width,b.height=z.height,b.channels=4;else if(Ic(z))b.element=z,b.width=z.naturalWidth,b.height=z.naturalHeight,b.channels=4;else if(kc(z))b.element=z,b.width=z.videoWidth,b.height=z.videoHeight,b.channels=4;else if(ys(z)){var I=b.width||z[0].length,_=b.height||z.length,V=b.channels;gt(z[0][0])?V=V||z[0][0].length:V=V||1;for(var $=sr.shape(z),te=1,re=0;re<$.length;++re)te*=$[re];var ee=Ss(b,te);sr.flatten(z,$,"",ee),xs(b,ee),b.alignment=1,b.width=I,b.height=_,b.channels=V,b.format=b.internalformat=dr[V],b.needsFree=!0}b.type===Wn?g(w.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):b.type===xn&&g(w.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function oe(b,Y,z){var ke=b.element,nt=b.data,y=b.internalformat,m=b.format,R=b.type,B=b.width,j=b.height;ze(b),ke?l.texImage2D(Y,z,m,m,R,ke):b.compressed?l.compressedTexImage2D(Y,z,y,B,j,0,nt):b.needsCopy?(H(),l.copyTexImage2D(Y,z,m,b.xOffset,b.yOffset,B,j,0)):l.texImage2D(Y,z,m,B,j,0,m,R,nt||null)}function Ue(b,Y,z,ke,nt){var y=b.element,m=b.data,R=b.internalformat,B=b.format,j=b.type,F=b.width,M=b.height;ze(b),y?l.texSubImage2D(Y,nt,z,ke,B,j,y):b.compressed?l.compressedTexSubImage2D(Y,nt,z,ke,R,F,M,m):b.needsCopy?(H(),l.copyTexSubImage2D(Y,nt,z,ke,b.xOffset,b.yOffset,F,M)):l.texSubImage2D(Y,nt,z,ke,F,M,B,j,m)}var Ze=[];function Re(){return Ze.pop()||new Ce}function tt(b){b.needsFree&&Tt.freeType(b.data),Ce.call(b),Ze.push(b)}function Xe(){ce.call(this),this.genMipmaps=!1,this.mipmapHint=fr,this.mipmask=0,this.images=Array(16)}function et(b,Y,z){var ke=b.images[0]=Re();b.mipmask=1,ke.width=b.width=Y,ke.height=b.height=z,ke.channels=b.channels=4}function ot(b,Y){var z=null;if(si(Y))z=b.images[0]=Re(),Se(z,b),ge(z,Y),b.mipmask=1;else if(Ve(b,Y),Array.isArray(Y.mipmap))for(var ke=Y.mipmap,nt=0;nt<ke.length;++nt)z=b.images[nt]=Re(),Se(z,b),z.width>>=nt,z.height>>=nt,ge(z,ke[nt]),b.mipmask|=1<<nt;else z=b.images[0]=Re(),Se(z,b),ge(z,Y),b.mipmask=1;Se(b,b.images[0]),b.compressed&&(b.internalformat===Yr||b.internalformat===Zr||b.internalformat===Qr||b.internalformat===Kr)&&g(b.width%4===0&&b.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function St(b,Y){for(var z=b.images,ke=0;ke<z.length;++ke){if(!z[ke])return;oe(z[ke],Y,ke)}}var Ot=[];function it(){var b=Ot.pop()||new Xe;ce.call(b),b.mipmask=0;for(var Y=0;Y<16;++Y)b.images[Y]=null;return b}function Ct(b){for(var Y=b.images,z=0;z<Y.length;++z)Y[z]&&tt(Y[z]),Y[z]=null;Ot.push(b)}function mt(){this.minFilter=ni,this.magFilter=ni,this.wrapS=ti,this.wrapT=ti,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=fr}function xt(b,Y){if("min"in Y){var z=Y.min;g.parameter(z,pe),b.minFilter=pe[z],Cc.indexOf(b.minFilter)>=0&&!("faces"in Y)&&(b.genMipmaps=!0)}if("mag"in Y){var ke=Y.mag;g.parameter(ke,_e),b.magFilter=_e[ke]}var nt=b.wrapS,y=b.wrapT;if("wrap"in Y){var m=Y.wrap;typeof m=="string"?(g.parameter(m,de),nt=y=de[m]):Array.isArray(m)&&(g.parameter(m[0],de),g.parameter(m[1],de),nt=de[m[0]],y=de[m[1]])}else{if("wrapS"in Y){var R=Y.wrapS;g.parameter(R,de),nt=de[R]}if("wrapT"in Y){var B=Y.wrapT;g.parameter(B,de),y=de[B]}}if(b.wrapS=nt,b.wrapT=y,"anisotropic"in Y){var j=Y.anisotropic;g(typeof j=="number"&&j>=1&&j<=w.maxAnisotropic,"aniso samples must be between 1 and "),b.anisotropic=Y.anisotropic}if("mipmap"in Y){var F=!1;switch(typeof Y.mipmap){case"string":g.parameter(Y.mipmap,le,"invalid mipmap hint"),b.mipmapHint=le[Y.mipmap],b.genMipmaps=!0,F=!0;break;case"boolean":F=b.genMipmaps=Y.mipmap;break;case"object":g(Array.isArray(Y.mipmap),"invalid mipmap type"),b.genMipmaps=!1,F=!0;break;default:g.raise("invalid mipmap type")}F&&!("min"in Y)&&(b.minFilter=ri)}}function wt(b,Y){l.texParameteri(Y,vc,b.minFilter),l.texParameteri(Y,mc,b.magFilter),l.texParameteri(Y,hc,b.wrapS),l.texParameteri(Y,fc,b.wrapT),v.ext_texture_filter_anisotropic&&l.texParameteri(Y,Tc,b.anisotropic),b.genMipmaps&&(l.hint(gc,b.mipmapHint),l.generateMipmap(Y))}var Et=0,It={},Rt=w.maxTextureUnits,yt=Array(Rt).map(function(){return null});function Qe(b){ce.call(this),this.mipmask=0,this.internalformat=fn,this.id=Et++,this.refCount=1,this.target=b,this.texture=l.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new mt,Z.profile&&(this.stats={size:0})}function Mt(b){l.activeTexture(qn),l.bindTexture(b.target,b.texture)}function ut(){var b=yt[0];b?l.bindTexture(b.target,b.texture):l.bindTexture(Ht,null)}function Be(b){var Y=b.texture;g(Y,"must not double destroy texture");var z=b.unit,ke=b.target;z>=0&&(l.activeTexture(qn+z),l.bindTexture(ke,null),yt[z]=null),l.deleteTexture(Y),b.texture=null,b.params=null,b.pixels=null,b.refCount=0,delete It[b.id],X.textureCount--}n(Qe.prototype,{bind:function(){var b=this;b.bindCount+=1;var Y=b.unit;if(Y<0){for(var z=0;z<Rt;++z){var ke=yt[z];if(ke){if(ke.bindCount>0)continue;ke.unit=-1}yt[z]=b,Y=z;break}Y>=Rt&&g.raise("insufficient number of texture units"),Z.profile&&X.maxTextureUnits<Y+1&&(X.maxTextureUnits=Y+1),b.unit=Y,l.activeTexture(qn+Y),l.bindTexture(b.target,b.texture)}return Y},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Be(this)}});function rt(b,Y){var z=new Qe(Ht);It[z.id]=z,X.textureCount++;function ke(m,R){var B=z.texInfo;mt.call(B);var j=it();return typeof m=="number"?typeof R=="number"?et(j,m|0,R|0):et(j,m|0,m|0):m?(g.type(m,"object","invalid arguments to regl.texture"),xt(B,m),ot(j,m)):et(j,1,1),B.genMipmaps&&(j.mipmask=(j.width<<1)-1),z.mipmask=j.mipmask,Se(z,j),g.texture2D(B,j,w),z.internalformat=j.internalformat,ke.width=j.width,ke.height=j.height,Mt(z),St(j,Ht),wt(B,Ht),ut(),Ct(j),Z.profile&&(z.stats.size=pr(z.internalformat,z.type,j.width,j.height,B.genMipmaps,!1)),ke.format=ve[z.internalformat],ke.type=Oe[z.type],ke.mag=ae[B.magFilter],ke.min=Ie[B.minFilter],ke.wrapS=ue[B.wrapS],ke.wrapT=ue[B.wrapT],ke}function nt(m,R,B,j){g(!!m,"must specify image data");var F=R|0,M=B|0,P=j|0,A=Re();return Se(A,z),A.width=0,A.height=0,ge(A,m),A.width=A.width||(z.width>>P)-F,A.height=A.height||(z.height>>P)-M,g(z.type===A.type&&z.format===A.format&&z.internalformat===A.internalformat,"incompatible format for texture.subimage"),g(F>=0&&M>=0&&F+A.width<=z.width&&M+A.height<=z.height,"texture.subimage write out of bounds"),g(z.mipmask&1<<P,"missing mipmap data"),g(A.data||A.element||A.needsCopy,"missing image data"),Mt(z),Ue(A,Ht,F,M,P),ut(),tt(A),ke}function y(m,R){var B=m|0,j=R|0||B;if(B===z.width&&j===z.height)return ke;ke.width=z.width=B,ke.height=z.height=j,Mt(z);for(var F=0;z.mipmask>>F;++F){var M=B>>F,P=j>>F;if(!M||!P)break;l.texImage2D(Ht,F,z.format,M,P,0,z.format,z.type,null)}return ut(),Z.profile&&(z.stats.size=pr(z.internalformat,z.type,B,j,!1,!1)),ke}return ke(b,Y),ke.subimage=nt,ke.resize=y,ke._reglType="texture2d",ke._texture=z,Z.profile&&(ke.stats=z.stats),ke.destroy=function(){z.decRef()},ke}function st(b,Y,z,ke,nt,y){var m=new Qe(qr);It[m.id]=m,X.cubeCount++;var R=new Array(6);function B(M,P,A,I,_,V){var $,te=m.texInfo;for(mt.call(te),$=0;$<6;++$)R[$]=it();if(typeof M=="number"||!M){var re=M|0||1;for($=0;$<6;++$)et(R[$],re,re)}else if(typeof M=="object")if(P)ot(R[0],M),ot(R[1],P),ot(R[2],A),ot(R[3],I),ot(R[4],_),ot(R[5],V);else if(xt(te,M),Ve(m,M),"faces"in M){var ee=M.faces;for(g(Array.isArray(ee)&&ee.length===6,"cube faces must be a length 6 array"),$=0;$<6;++$)g(typeof ee[$]=="object"&&!!ee[$],"invalid input for cube map face"),Se(R[$],m),ot(R[$],ee[$])}else for($=0;$<6;++$)ot(R[$],M);else g.raise("invalid arguments to cube map");for(Se(m,R[0]),w.npotTextureCube||g(Ki(m.width)&&Ki(m.height),"your browser does not support non power or two texture dimensions"),te.genMipmaps?m.mipmask=(R[0].width<<1)-1:m.mipmask=R[0].mipmask,g.textureCube(m,te,R,w),m.internalformat=R[0].internalformat,B.width=R[0].width,B.height=R[0].height,Mt(m),$=0;$<6;++$)St(R[$],cr+$);for(wt(te,qr),ut(),Z.profile&&(m.stats.size=pr(m.internalformat,m.type,B.width,B.height,te.genMipmaps,!0)),B.format=ve[m.internalformat],B.type=Oe[m.type],B.mag=ae[te.magFilter],B.min=Ie[te.minFilter],B.wrapS=ue[te.wrapS],B.wrapT=ue[te.wrapT],$=0;$<6;++$)Ct(R[$]);return B}function j(M,P,A,I,_){g(!!P,"must specify image data"),g(typeof M=="number"&&M===(M|0)&&M>=0&&M<6,"invalid face");var V=A|0,$=I|0,te=_|0,re=Re();return Se(re,m),re.width=0,re.height=0,ge(re,P),re.width=re.width||(m.width>>te)-V,re.height=re.height||(m.height>>te)-$,g(m.type===re.type&&m.format===re.format&&m.internalformat===re.internalformat,"incompatible format for texture.subimage"),g(V>=0&&$>=0&&V+re.width<=m.width&&$+re.height<=m.height,"texture.subimage write out of bounds"),g(m.mipmask&1<<te,"missing mipmap data"),g(re.data||re.element||re.needsCopy,"missing image data"),Mt(m),Ue(re,cr+M,V,$,te),ut(),tt(re),B}function F(M){var P=M|0;if(P!==m.width){B.width=m.width=P,B.height=m.height=P,Mt(m);for(var A=0;A<6;++A)for(var I=0;m.mipmask>>I;++I)l.texImage2D(cr+A,I,m.format,P>>I,P>>I,0,m.format,m.type,null);return ut(),Z.profile&&(m.stats.size=pr(m.internalformat,m.type,B.width,B.height,!1,!0)),B}}return B(b,Y,z,ke,nt,y),B.subimage=j,B.resize=F,B._reglType="textureCube",B._texture=m,Z.profile&&(B.stats=m.stats),B.destroy=function(){m.decRef()},B}function At(){for(var b=0;b<Rt;++b)l.activeTexture(qn+b),l.bindTexture(Ht,null),yt[b]=null;Ut(It).forEach(Be),X.cubeCount=0,X.textureCount=0}Z.profile&&(X.getTotalTextureSize=function(){var b=0;return Object.keys(It).forEach(function(Y){b+=It[Y].stats.size}),b});function Zt(){for(var b=0;b<Rt;++b){var Y=yt[b];Y&&(Y.bindCount=0,Y.unit=-1,yt[b]=null)}Ut(It).forEach(function(z){z.texture=l.createTexture(),l.bindTexture(z.target,z.texture);for(var ke=0;ke<32;++ke)if(z.mipmask&1<<ke)if(z.target===Ht)l.texImage2D(Ht,ke,z.internalformat,z.width>>ke,z.height>>ke,0,z.internalformat,z.type,null);else for(var nt=0;nt<6;++nt)l.texImage2D(cr+nt,ke,z.internalformat,z.width>>ke,z.height>>ke,0,z.internalformat,z.type,null);wt(z.texInfo,z.target)})}function An(){for(var b=0;b<Rt;++b){var Y=yt[b];Y&&(Y.bindCount=0,Y.unit=-1,yt[b]=null),l.activeTexture(qn+b),l.bindTexture(Ht,null),l.bindTexture(qr,null)}}return{create2D:rt,createCube:st,clear:At,getTexture:function(b){return null},restore:Zt,refresh:An}}var sn=36161,mr=32854,Ns=32855,Cs=36194,ws=33189,Es=36168,Os=34041,Is=35907,ks=34836,Rs=34842,Ms=34843,$t=[];$t[mr]=2,$t[Ns]=2,$t[Cs]=2,$t[ws]=2,$t[Es]=1,$t[Os]=4,$t[Is]=4,$t[ks]=16,$t[Rs]=8,$t[Ms]=6;function Fs(l,v,w){return $t[l]*v*w}var Dc=function(l,v,w,H,ne){var X={rgba4:mr,rgb565:Cs,"rgb5 a1":Ns,depth:ws,stencil:Es,"depth stencil":Os};v.ext_srgb&&(X.srgba=Is),v.ext_color_buffer_half_float&&(X.rgba16f=Rs,X.rgb16f=Ms),v.webgl_color_buffer_float&&(X.rgba32f=ks);var Z=[];Object.keys(X).forEach(function(he){var Te=X[he];Z[Te]=he});var le=0,de={};function _e(he){this.id=le++,this.refCount=1,this.renderbuffer=he,this.format=mr,this.width=0,this.height=0,ne.profile&&(this.stats={size:0})}_e.prototype.decRef=function(){--this.refCount<=0&&pe(this)};function pe(he){var Te=he.renderbuffer;g(Te,"must not double destroy renderbuffer"),l.bindRenderbuffer(sn,null),l.deleteRenderbuffer(Te),he.renderbuffer=null,he.refCount=0,delete de[he.id],H.renderbufferCount--}function Ae(he,Te){var U=new _e(l.createRenderbuffer());de[U.id]=U,H.renderbufferCount++;function Q(Oe,ae){var Ie=0,ue=0,be=mr;if(typeof Oe=="object"&&Oe){var ce=Oe;if("shape"in ce){var Se=ce.shape;g(Array.isArray(Se)&&Se.length>=2,"invalid renderbuffer shape"),Ie=Se[0]|0,ue=Se[1]|0}else"radius"in ce&&(Ie=ue=ce.radius|0),"width"in ce&&(Ie=ce.width|0),"height"in ce&&(ue=ce.height|0);"format"in ce&&(g.parameter(ce.format,X,"invalid renderbuffer format"),be=X[ce.format])}else typeof Oe=="number"?(Ie=Oe|0,typeof ae=="number"?ue=ae|0:ue=Ie):Oe?g.raise("invalid arguments to renderbuffer constructor"):Ie=ue=1;if(g(Ie>0&&ue>0&&Ie<=w.maxRenderbufferSize&&ue<=w.maxRenderbufferSize,"invalid renderbuffer size"),!(Ie===U.width&&ue===U.height&&be===U.format))return Q.width=U.width=Ie,Q.height=U.height=ue,U.format=be,l.bindRenderbuffer(sn,U.renderbuffer),l.renderbufferStorage(sn,be,Ie,ue),g(l.getError()===0,"invalid render buffer format"),ne.profile&&(U.stats.size=Fs(U.format,U.width,U.height)),Q.format=Z[U.format],Q}function ve(Oe,ae){var Ie=Oe|0,ue=ae|0||Ie;return Ie===U.width&&ue===U.height||(g(Ie>0&&ue>0&&Ie<=w.maxRenderbufferSize&&ue<=w.maxRenderbufferSize,"invalid renderbuffer size"),Q.width=U.width=Ie,Q.height=U.height=ue,l.bindRenderbuffer(sn,U.renderbuffer),l.renderbufferStorage(sn,U.format,Ie,ue),g(l.getError()===0,"invalid render buffer format"),ne.profile&&(U.stats.size=Fs(U.format,U.width,U.height))),Q}return Q(he,Te),Q.resize=ve,Q._reglType="renderbuffer",Q._renderbuffer=U,ne.profile&&(Q.stats=U.stats),Q.destroy=function(){U.decRef()},Q}ne.profile&&(H.getTotalRenderbufferSize=function(){var he=0;return Object.keys(de).forEach(function(Te){he+=de[Te].stats.size}),he});function Ne(){Ut(de).forEach(function(he){he.renderbuffer=l.createRenderbuffer(),l.bindRenderbuffer(sn,he.renderbuffer),l.renderbufferStorage(sn,he.format,he.width,he.height)}),l.bindRenderbuffer(sn,null)}return{create:Ae,clear:function(){Ut(de).forEach(pe)},restore:Ne}},en=36160,oi=36161,pn=3553,vr=34069,Ds=36064,Ps=36096,Ls=36128,Vs=33306,Bs=36053,Pc=36054,Lc=36055,Vc=36057,Bc=36061,Gc=36193,Uc=5121,Wc=5126,Gs=6407,Us=6408,qc=6402,jc=[Gs,Us],ai=[];ai[Us]=4,ai[Gs]=3;var _r=[];_r[Uc]=1,_r[Wc]=4,_r[Gc]=2;var $c=32854,zc=32855,Xc=36194,Hc=33189,Yc=36168,Ws=34041,Zc=35907,Qc=34836,Kc=34842,Jc=34843,eu=[$c,zc,Xc,Zc,Kc,Jc,Qc],En={};En[Bs]="complete",En[Pc]="incomplete attachment",En[Vc]="incomplete dimensions",En[Lc]="incomplete, missing attachment",En[Bc]="unsupported";function tu(l,v,w,H,ne,X){var Z={cur:null,next:null,dirty:!1,setFBO:null},le=["rgba"],de=["rgba4","rgb565","rgb5 a1"];v.ext_srgb&&de.push("srgba"),v.ext_color_buffer_half_float&&de.push("rgba16f","rgb16f"),v.webgl_color_buffer_float&&de.push("rgba32f");var _e=["uint8"];v.oes_texture_half_float&&_e.push("half float","float16"),v.oes_texture_float&&_e.push("float","float32");function pe(Ce,ge,oe){this.target=Ce,this.texture=ge,this.renderbuffer=oe;var Ue=0,Ze=0;ge?(Ue=ge.width,Ze=ge.height):oe&&(Ue=oe.width,Ze=oe.height),this.width=Ue,this.height=Ze}function Ae(Ce){Ce&&(Ce.texture&&Ce.texture._texture.decRef(),Ce.renderbuffer&&Ce.renderbuffer._renderbuffer.decRef())}function Ne(Ce,ge,oe){if(Ce)if(Ce.texture){var Ue=Ce.texture._texture,Ze=Math.max(1,Ue.width),Re=Math.max(1,Ue.height);g(Ze===ge&&Re===oe,"inconsistent width/height for supplied texture"),Ue.refCount+=1}else{var tt=Ce.renderbuffer._renderbuffer;g(tt.width===ge&&tt.height===oe,"inconsistent width/height for renderbuffer"),tt.refCount+=1}}function he(Ce,ge){ge&&(ge.texture?l.framebufferTexture2D(en,Ce,ge.target,ge.texture._texture.texture,0):l.framebufferRenderbuffer(en,Ce,oi,ge.renderbuffer._renderbuffer.renderbuffer))}function Te(Ce){var ge=pn,oe=null,Ue=null,Ze=Ce;typeof Ce=="object"&&(Ze=Ce.data,"target"in Ce&&(ge=Ce.target|0)),g.type(Ze,"function","invalid attachment data");var Re=Ze._reglType;return Re==="texture2d"?(oe=Ze,g(ge===pn)):Re==="textureCube"?(oe=Ze,g(ge>=vr&&ge<vr+6,"invalid cube map target")):Re==="renderbuffer"?(Ue=Ze,ge=oi):g.raise("invalid regl object for attachment"),new pe(ge,oe,Ue)}function U(Ce,ge,oe,Ue,Ze){if(oe){var Re=H.create2D({width:Ce,height:ge,format:Ue,type:Ze});return Re._texture.refCount=0,new pe(pn,Re,null)}else{var tt=ne.create({width:Ce,height:ge,format:Ue});return tt._renderbuffer.refCount=0,new pe(oi,null,tt)}}function Q(Ce){return Ce&&(Ce.texture||Ce.renderbuffer)}function ve(Ce,ge,oe){Ce&&(Ce.texture?Ce.texture.resize(ge,oe):Ce.renderbuffer&&Ce.renderbuffer.resize(ge,oe),Ce.width=ge,Ce.height=oe)}var Oe=0,ae={};function Ie(){this.id=Oe++,ae[this.id]=this,this.framebuffer=l.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function ue(Ce){Ce.colorAttachments.forEach(Ae),Ae(Ce.depthAttachment),Ae(Ce.stencilAttachment),Ae(Ce.depthStencilAttachment)}function be(Ce){var ge=Ce.framebuffer;g(ge,"must not double destroy framebuffer"),l.deleteFramebuffer(ge),Ce.framebuffer=null,X.framebufferCount--,delete ae[Ce.id]}function ce(Ce){var ge;l.bindFramebuffer(en,Ce.framebuffer);var oe=Ce.colorAttachments;for(ge=0;ge<oe.length;++ge)he(Ds+ge,oe[ge]);for(ge=oe.length;ge<w.maxColorAttachments;++ge)l.framebufferTexture2D(en,Ds+ge,pn,null,0);l.framebufferTexture2D(en,Vs,pn,null,0),l.framebufferTexture2D(en,Ps,pn,null,0),l.framebufferTexture2D(en,Ls,pn,null,0),he(Ps,Ce.depthAttachment),he(Ls,Ce.stencilAttachment),he(Vs,Ce.depthStencilAttachment);var Ue=l.checkFramebufferStatus(en);!l.isContextLost()&&Ue!==Bs&&g.raise("framebuffer configuration not supported, status = "+En[Ue]),l.bindFramebuffer(en,Z.next?Z.next.framebuffer:null),Z.cur=Z.next,l.getError()}function Se(Ce,ge){var oe=new Ie;X.framebufferCount++;function Ue(Re,tt){var Xe;g(Z.next!==oe,"can not update framebuffer which is currently in use");var et=0,ot=0,St=!0,Ot=!0,it=null,Ct=!0,mt="rgba",xt="uint8",wt=1,Et=null,It=null,Rt=null,yt=!1;if(typeof Re=="number")et=Re|0,ot=tt|0||et;else if(!Re)et=ot=1;else{g.type(Re,"object","invalid arguments for framebuffer");var Qe=Re;if("shape"in Qe){var Mt=Qe.shape;g(Array.isArray(Mt)&&Mt.length>=2,"invalid shape for framebuffer"),et=Mt[0],ot=Mt[1]}else"radius"in Qe&&(et=ot=Qe.radius),"width"in Qe&&(et=Qe.width),"height"in Qe&&(ot=Qe.height);("color"in Qe||"colors"in Qe)&&(it=Qe.color||Qe.colors,Array.isArray(it)&&g(it.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),it||("colorCount"in Qe&&(wt=Qe.colorCount|0,g(wt>0,"invalid color buffer count")),"colorTexture"in Qe&&(Ct=!!Qe.colorTexture,mt="rgba4"),"colorType"in Qe&&(xt=Qe.colorType,Ct?(g(v.oes_texture_float||!(xt==="float"||xt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),g(v.oes_texture_half_float||!(xt==="half float"||xt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):xt==="half float"||xt==="float16"?(g(v.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),mt="rgba16f"):(xt==="float"||xt==="float32")&&(g(v.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),mt="rgba32f"),g.oneOf(xt,_e,"invalid color type")),"colorFormat"in Qe&&(mt=Qe.colorFormat,le.indexOf(mt)>=0?Ct=!0:de.indexOf(mt)>=0?Ct=!1:Ct?g.oneOf(Qe.colorFormat,le,"invalid color format for texture"):g.oneOf(Qe.colorFormat,de,"invalid color format for renderbuffer"))),("depthTexture"in Qe||"depthStencilTexture"in Qe)&&(yt=!!(Qe.depthTexture||Qe.depthStencilTexture),g(!yt||v.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Qe&&(typeof Qe.depth=="boolean"?St=Qe.depth:(Et=Qe.depth,Ot=!1)),"stencil"in Qe&&(typeof Qe.stencil=="boolean"?Ot=Qe.stencil:(It=Qe.stencil,St=!1)),"depthStencil"in Qe&&(typeof Qe.depthStencil=="boolean"?St=Ot=Qe.depthStencil:(Rt=Qe.depthStencil,St=!1,Ot=!1))}var ut=null,Be=null,rt=null,st=null;if(Array.isArray(it))ut=it.map(Te);else if(it)ut=[Te(it)];else for(ut=new Array(wt),Xe=0;Xe<wt;++Xe)ut[Xe]=U(et,ot,Ct,mt,xt);g(v.webgl_draw_buffers||ut.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),g(ut.length<=w.maxColorAttachments,"too many color attachments, not supported"),et=et||ut[0].width,ot=ot||ut[0].height,Et?Be=Te(Et):St&&!Ot&&(Be=U(et,ot,yt,"depth","uint32")),It?rt=Te(It):Ot&&!St&&(rt=U(et,ot,!1,"stencil","uint8")),Rt?st=Te(Rt):!Et&&!It&&Ot&&St&&(st=U(et,ot,yt,"depth stencil","depth stencil")),g(!!Et+!!It+!!Rt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var At=null;for(Xe=0;Xe<ut.length;++Xe)if(Ne(ut[Xe],et,ot),g(!ut[Xe]||ut[Xe].texture&&jc.indexOf(ut[Xe].texture._texture.format)>=0||ut[Xe].renderbuffer&&eu.indexOf(ut[Xe].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Xe+" is invalid"),ut[Xe]&&ut[Xe].texture){var Zt=ai[ut[Xe].texture._texture.format]*_r[ut[Xe].texture._texture.type];At===null?At=Zt:g(At===Zt,"all color attachments much have the same number of bits per pixel.")}return Ne(Be,et,ot),g(!Be||Be.texture&&Be.texture._texture.format===qc||Be.renderbuffer&&Be.renderbuffer._renderbuffer.format===Hc,"invalid depth attachment for framebuffer object"),Ne(rt,et,ot),g(!rt||rt.renderbuffer&&rt.renderbuffer._renderbuffer.format===Yc,"invalid stencil attachment for framebuffer object"),Ne(st,et,ot),g(!st||st.texture&&st.texture._texture.format===Ws||st.renderbuffer&&st.renderbuffer._renderbuffer.format===Ws,"invalid depth-stencil attachment for framebuffer object"),ue(oe),oe.width=et,oe.height=ot,oe.colorAttachments=ut,oe.depthAttachment=Be,oe.stencilAttachment=rt,oe.depthStencilAttachment=st,Ue.color=ut.map(Q),Ue.depth=Q(Be),Ue.stencil=Q(rt),Ue.depthStencil=Q(st),Ue.width=oe.width,Ue.height=oe.height,ce(oe),Ue}function Ze(Re,tt){g(Z.next!==oe,"can not resize a framebuffer which is currently in use");var Xe=Math.max(Re|0,1),et=Math.max(tt|0||Xe,1);if(Xe===oe.width&&et===oe.height)return Ue;for(var ot=oe.colorAttachments,St=0;St<ot.length;++St)ve(ot[St],Xe,et);return ve(oe.depthAttachment,Xe,et),ve(oe.stencilAttachment,Xe,et),ve(oe.depthStencilAttachment,Xe,et),oe.width=Ue.width=Xe,oe.height=Ue.height=et,ce(oe),Ue}return Ue(Ce,ge),n(Ue,{resize:Ze,_reglType:"framebuffer",_framebuffer:oe,destroy:function(){be(oe),ue(oe)},use:function(Re){Z.setFBO({framebuffer:Ue},Re)}})}function Ve(Ce){var ge=Array(6);function oe(Ze){var Re;g(ge.indexOf(Z.next)<0,"can not update framebuffer which is currently in use");var tt={color:null},Xe=0,et=null,ot="rgba",St="uint8",Ot=1;if(typeof Ze=="number")Xe=Ze|0;else if(!Ze)Xe=1;else{g.type(Ze,"object","invalid arguments for framebuffer");var it=Ze;if("shape"in it){var Ct=it.shape;g(Array.isArray(Ct)&&Ct.length>=2,"invalid shape for framebuffer"),g(Ct[0]===Ct[1],"cube framebuffer must be square"),Xe=Ct[0]}else"radius"in it&&(Xe=it.radius|0),"width"in it?(Xe=it.width|0,"height"in it&&g(it.height===Xe,"must be square")):"height"in it&&(Xe=it.height|0);("color"in it||"colors"in it)&&(et=it.color||it.colors,Array.isArray(et)&&g(et.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),et||("colorCount"in it&&(Ot=it.colorCount|0,g(Ot>0,"invalid color buffer count")),"colorType"in it&&(g.oneOf(it.colorType,_e,"invalid color type"),St=it.colorType),"colorFormat"in it&&(ot=it.colorFormat,g.oneOf(it.colorFormat,le,"invalid color format for texture"))),"depth"in it&&(tt.depth=it.depth),"stencil"in it&&(tt.stencil=it.stencil),"depthStencil"in it&&(tt.depthStencil=it.depthStencil)}var mt;if(et)if(Array.isArray(et))for(mt=[],Re=0;Re<et.length;++Re)mt[Re]=et[Re];else mt=[et];else{mt=Array(Ot);var xt={radius:Xe,format:ot,type:St};for(Re=0;Re<Ot;++Re)mt[Re]=H.createCube(xt)}for(tt.color=Array(mt.length),Re=0;Re<mt.length;++Re){var wt=mt[Re];g(typeof wt=="function"&&wt._reglType==="textureCube","invalid cube map"),Xe=Xe||wt.width,g(wt.width===Xe&&wt.height===Xe,"invalid cube map shape"),tt.color[Re]={target:vr,data:mt[Re]}}for(Re=0;Re<6;++Re){for(var Et=0;Et<mt.length;++Et)tt.color[Et].target=vr+Re;Re>0&&(tt.depth=ge[0].depth,tt.stencil=ge[0].stencil,tt.depthStencil=ge[0].depthStencil),ge[Re]?ge[Re](tt):ge[Re]=Se(tt)}return n(oe,{width:Xe,height:Xe,color:mt})}function Ue(Ze){var Re,tt=Ze|0;if(g(tt>0&&tt<=w.maxCubeMapSize,"invalid radius for cube fbo"),tt===oe.width)return oe;var Xe=oe.color;for(Re=0;Re<Xe.length;++Re)Xe[Re].resize(tt);for(Re=0;Re<6;++Re)ge[Re].resize(tt);return oe.width=oe.height=tt,oe}return oe(Ce),n(oe,{faces:ge,resize:Ue,_reglType:"framebufferCube",destroy:function(){ge.forEach(function(Ze){Ze.destroy()})}})}function ze(){Z.cur=null,Z.next=null,Z.dirty=!0,Ut(ae).forEach(function(Ce){Ce.framebuffer=l.createFramebuffer(),ce(Ce)})}return n(Z,{getFramebuffer:function(Ce){if(typeof Ce=="function"&&Ce._reglType==="framebuffer"){var ge=Ce._framebuffer;if(ge instanceof Ie)return ge}return null},create:Se,createCube:Ve,clear:function(){Ut(ae).forEach(be)},restore:ze})}var nu=5126,qs=34962;function ci(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=nu,this.offset=0,this.stride=0,this.divisor=0}function ru(l,v,w,H,ne){for(var X=w.maxAttributes,Z=new Array(X),le=0;le<X;++le)Z[le]=new ci;var de=0,_e={},pe={Record:ci,scope:{},state:Z,currentVAO:null,targetVAO:null,restore:Ne()?ae:function(){},createVAO:Ie,getVAO:Te,destroyBuffer:Ae,setVAO:Ne()?U:Q,clear:Ne()?ve:function(){}};function Ae(ue){for(var be=0;be<Z.length;++be){var ce=Z[be];ce.buffer===ue&&(l.disableVertexAttribArray(be),ce.buffer=null)}}function Ne(){return v.oes_vertex_array_object}function he(){return v.angle_instanced_arrays}function Te(ue){return typeof ue=="function"&&ue._vao?ue._vao:null}function U(ue){if(ue!==pe.currentVAO){var be=Ne();ue?be.bindVertexArrayOES(ue.vao):be.bindVertexArrayOES(null),pe.currentVAO=ue}}function Q(ue){if(ue!==pe.currentVAO){if(ue)ue.bindAttrs();else for(var be=he(),ce=0;ce<Z.length;++ce){var Se=Z[ce];Se.buffer?(l.enableVertexAttribArray(ce),l.vertexAttribPointer(ce,Se.size,Se.type,Se.normalized,Se.stride,Se.offfset),be&&Se.divisor&&be.vertexAttribDivisorANGLE(ce,Se.divisor)):(l.disableVertexAttribArray(ce),l.vertexAttrib4f(ce,Se.x,Se.y,Se.z,Se.w))}pe.currentVAO=ue}}function ve(){Ut(_e).forEach(function(ue){ue.destroy()})}function Oe(){this.id=++de,this.attributes=[];var ue=Ne();ue?this.vao=ue.createVertexArrayOES():this.vao=null,_e[this.id]=this,this.buffers=[]}Oe.prototype.bindAttrs=function(){for(var ue=he(),be=this.attributes,ce=0;ce<be.length;++ce){var Se=be[ce];Se.buffer?(l.enableVertexAttribArray(ce),l.bindBuffer(qs,Se.buffer.buffer),l.vertexAttribPointer(ce,Se.size,Se.type,Se.normalized,Se.stride,Se.offset),ue&&Se.divisor&&ue.vertexAttribDivisorANGLE(ce,Se.divisor)):(l.disableVertexAttribArray(ce),l.vertexAttrib4f(ce,Se.x,Se.y,Se.z,Se.w))}for(var Ve=be.length;Ve<X;++Ve)l.disableVertexAttribArray(Ve)},Oe.prototype.refresh=function(){var ue=Ne();ue&&(ue.bindVertexArrayOES(this.vao),this.bindAttrs(),pe.currentVAO=this)},Oe.prototype.destroy=function(){if(this.vao){var ue=Ne();this===pe.currentVAO&&(pe.currentVAO=null,ue.bindVertexArrayOES(null)),ue.deleteVertexArrayOES(this.vao),this.vao=null}_e[this.id]&&(delete _e[this.id],H.vaoCount-=1)};function ae(){var ue=Ne();ue&&Ut(_e).forEach(function(be){be.refresh()})}function Ie(ue){var be=new Oe;H.vaoCount+=1;function ce(Se){g(Array.isArray(Se),"arguments to vertex array constructor must be an array"),g(Se.length<X,"too many attributes"),g(Se.length>0,"must specify at least one attribute");var Ve={},ze=be.attributes;ze.length=Se.length;for(var Ce=0;Ce<Se.length;++Ce){var ge=Se[Ce],oe=ze[Ce]=new ci,Ue=ge.data||ge;if(Array.isArray(Ue)||t(Ue)||jt(Ue)){var Ze;be.buffers[Ce]&&(Ze=be.buffers[Ce],t(Ue)&&Ze._buffer.byteLength>=Ue.byteLength?Ze.subdata(Ue):(Ze.destroy(),be.buffers[Ce]=null)),be.buffers[Ce]||(Ze=be.buffers[Ce]=ne.create(ge,qs,!1,!0)),oe.buffer=ne.getBuffer(Ze),oe.size=oe.buffer.dimension|0,oe.normalized=!1,oe.type=oe.buffer.dtype,oe.offset=0,oe.stride=0,oe.divisor=0,oe.state=1,Ve[Ce]=1}else ne.getBuffer(ge)?(oe.buffer=ne.getBuffer(ge),oe.size=oe.buffer.dimension|0,oe.normalized=!1,oe.type=oe.buffer.dtype,oe.offset=0,oe.stride=0,oe.divisor=0,oe.state=1):ne.getBuffer(ge.buffer)?(oe.buffer=ne.getBuffer(ge.buffer),oe.size=(+ge.size||oe.buffer.dimension)|0,oe.normalized=!!ge.normalized||!1,"type"in ge?(g.parameter(ge.type,ln,"invalid buffer type"),oe.type=ln[ge.type]):oe.type=oe.buffer.dtype,oe.offset=(ge.offset||0)|0,oe.stride=(ge.stride||0)|0,oe.divisor=(ge.divisor||0)|0,oe.state=1,g(oe.size>=1&&oe.size<=4,"size must be between 1 and 4"),g(oe.offset>=0,"invalid offset"),g(oe.stride>=0&&oe.stride<=255,"stride must be between 0 and 255"),g(oe.divisor>=0,"divisor must be positive"),g(!oe.divisor||!!v.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ge?(g(Ce>0,"first attribute must not be a constant"),oe.x=+ge.x||0,oe.y=+ge.y||0,oe.z=+ge.z||0,oe.w=+ge.w||0,oe.state=2):g(!1,"invalid attribute spec for location "+Ce)}for(var Re=0;Re<be.buffers.length;++Re)!Ve[Re]&&be.buffers[Re]&&(be.buffers[Re].destroy(),be.buffers[Re]=null);return be.refresh(),ce}return ce.destroy=function(){for(var Se=0;Se<be.buffers.length;++Se)be.buffers[Se]&&be.buffers[Se].destroy();be.buffers.length=0,be.destroy()},ce._vao=be,ce._reglType="vao",ce(ue)}return pe}var js=35632,iu=35633,su=35718,ou=35721;function au(l,v,w,H){var ne={},X={};function Z(U,Q,ve,Oe){this.name=U,this.id=Q,this.location=ve,this.info=Oe}function le(U,Q){for(var ve=0;ve<U.length;++ve)if(U[ve].id===Q.id){U[ve].location=Q.location;return}U.push(Q)}function de(U,Q,ve){var Oe=U===js?ne:X,ae=Oe[Q];if(!ae){var Ie=v.str(Q);ae=l.createShader(U),l.shaderSource(ae,Ie),l.compileShader(ae),g.shaderError(l,ae,Ie,U,ve),Oe[Q]=ae}return ae}var _e={},pe=[],Ae=0;function Ne(U,Q){this.id=Ae++,this.fragId=U,this.vertId=Q,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,H.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function he(U,Q,ve){var Oe,ae,Ie=de(js,U.fragId),ue=de(iu,U.vertId),be=U.program=l.createProgram();if(l.attachShader(be,Ie),l.attachShader(be,ue),ve)for(Oe=0;Oe<ve.length;++Oe){var ce=ve[Oe];l.bindAttribLocation(be,ce[0],ce[1])}l.linkProgram(be),g.linkError(l,be,v.str(U.fragId),v.str(U.vertId),Q);var Se=l.getProgramParameter(be,su);H.profile&&(U.stats.uniformsCount=Se);var Ve=U.uniforms;for(Oe=0;Oe<Se;++Oe)if(ae=l.getActiveUniform(be,Oe),ae)if(ae.size>1)for(var ze=0;ze<ae.size;++ze){var Ce=ae.name.replace("[0]","["+ze+"]");le(Ve,new Z(Ce,v.id(Ce),l.getUniformLocation(be,Ce),ae))}else le(Ve,new Z(ae.name,v.id(ae.name),l.getUniformLocation(be,ae.name),ae));var ge=l.getProgramParameter(be,ou);H.profile&&(U.stats.attributesCount=ge);var oe=U.attributes;for(Oe=0;Oe<ge;++Oe)ae=l.getActiveAttrib(be,Oe),ae&&le(oe,new Z(ae.name,v.id(ae.name),l.getAttribLocation(be,ae.name),ae))}H.profile&&(w.getMaxUniformsCount=function(){var U=0;return pe.forEach(function(Q){Q.stats.uniformsCount>U&&(U=Q.stats.uniformsCount)}),U},w.getMaxAttributesCount=function(){var U=0;return pe.forEach(function(Q){Q.stats.attributesCount>U&&(U=Q.stats.attributesCount)}),U});function Te(){ne={},X={};for(var U=0;U<pe.length;++U)he(pe[U],null,pe[U].attributes.map(function(Q){return[Q.location,Q.name]}))}return{clear:function(){var U=l.deleteShader.bind(l);Ut(ne).forEach(U),ne={},Ut(X).forEach(U),X={},pe.forEach(function(Q){l.deleteProgram(Q.program)}),pe.length=0,_e={},w.shaderCount=0},program:function(U,Q,ve,Oe){g.command(U>=0,"missing vertex shader",ve),g.command(Q>=0,"missing fragment shader",ve);var ae=_e[Q];ae||(ae=_e[Q]={});var Ie=ae[U];if(Ie&&(Ie.refCount++,!Oe))return Ie;var ue=new Ne(Q,U);return w.shaderCount++,he(ue,ve,Oe),Ie||(ae[U]=ue),pe.push(ue),n(ue,{destroy:function(){if(ue.refCount--,ue.refCount<=0){l.deleteProgram(ue.program);var be=pe.indexOf(ue);pe.splice(be,1),w.shaderCount--}ae[ue.vertId].refCount<=0&&(l.deleteShader(X[ue.vertId]),delete X[ue.vertId],delete _e[ue.fragId][ue.vertId]),Object.keys(_e[ue.fragId]).length||(l.deleteShader(ne[ue.fragId]),delete ne[ue.fragId],delete _e[ue.fragId])}})},restore:Te,shader:de,frag:-1,vert:-1}}var cu=6408,jn=5121,uu=3333,gr=5126;function lu(l,v,w,H,ne,X,Z){function le(pe){var Ae;v.next===null?(g(ne.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ae=jn):(g(v.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ae=v.next.colorAttachments[0].texture._texture.type,X.oes_texture_float?(g(Ae===jn||Ae===gr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ae===gr&&g(Z.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):g(Ae===jn,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Ne=0,he=0,Te=H.framebufferWidth,U=H.framebufferHeight,Q=null;t(pe)?Q=pe:pe&&(g.type(pe,"object","invalid arguments to regl.read()"),Ne=pe.x|0,he=pe.y|0,g(Ne>=0&&Ne<H.framebufferWidth,"invalid x offset for regl.read"),g(he>=0&&he<H.framebufferHeight,"invalid y offset for regl.read"),Te=(pe.width||H.framebufferWidth-Ne)|0,U=(pe.height||H.framebufferHeight-he)|0,Q=pe.data||null),Q&&(Ae===jn?g(Q instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ae===gr&&g(Q instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),g(Te>0&&Te+Ne<=H.framebufferWidth,"invalid width for read pixels"),g(U>0&&U+he<=H.framebufferHeight,"invalid height for read pixels"),w();var ve=Te*U*4;return Q||(Ae===jn?Q=new Uint8Array(ve):Ae===gr&&(Q=Q||new Float32Array(ve))),g.isTypedArray(Q,"data buffer for regl.read() must be a typedarray"),g(Q.byteLength>=ve,"data buffer for regl.read() too small"),l.pixelStorei(uu,4),l.readPixels(Ne,he,Te,U,cu,Ae,Q),Q}function de(pe){var Ae;return v.setFBO({framebuffer:pe.framebuffer},function(){Ae=le(pe)}),Ae}function _e(pe){return!pe||!("framebuffer"in pe)?le(pe):de(pe)}return _e}function On(l){return Array.prototype.slice.call(l)}function In(l){return On(l).join("")}function hu(){var l=0,v=[],w=[];function H(Ae){for(var Ne=0;Ne<w.length;++Ne)if(w[Ne]===Ae)return v[Ne];var he="g"+l++;return v.push(he),w.push(Ae),he}function ne(){var Ae=[];function Ne(){Ae.push.apply(Ae,On(arguments))}var he=[];function Te(){var U="v"+l++;return he.push(U),arguments.length>0&&(Ae.push(U,"="),Ae.push.apply(Ae,On(arguments)),Ae.push(";")),U}return n(Ne,{def:Te,toString:function(){return In([he.length>0?"var "+he.join(",")+";":"",In(Ae)])}})}function X(){var Ae=ne(),Ne=ne(),he=Ae.toString,Te=Ne.toString;function U(Q,ve){Ne(Q,ve,"=",Ae.def(Q,ve),";")}return n(function(){Ae.apply(Ae,On(arguments))},{def:Ae.def,entry:Ae,exit:Ne,save:U,set:function(Q,ve,Oe){U(Q,ve),Ae(Q,ve,"=",Oe,";")},toString:function(){return he()+Te()}})}function Z(){var Ae=In(arguments),Ne=X(),he=X(),Te=Ne.toString,U=he.toString;return n(Ne,{then:function(){return Ne.apply(Ne,On(arguments)),this},else:function(){return he.apply(he,On(arguments)),this},toString:function(){var Q=U();return Q&&(Q="else{"+Q+"}"),In(["if(",Ae,"){",Te(),"}",Q])}})}var le=ne(),de={};function _e(Ae,Ne){var he=[];function Te(){var ae="a"+he.length;return he.push(ae),ae}Ne=Ne||0;for(var U=0;U<Ne;++U)Te();var Q=X(),ve=Q.toString,Oe=de[Ae]=n(Q,{arg:Te,toString:function(){return In(["function(",he.join(),"){",ve(),"}"])}});return Oe}function pe(){var Ae=['"use strict";',le,"return {"];Object.keys(de).forEach(function(Te){Ae.push('"',Te,'":',de[Te].toString(),",")}),Ae.push("}");var Ne=In(Ae).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),he=Function.apply(null,v.concat(Ne));return he.apply(null,w)}return{global:le,link:H,block:ne,proc:_e,scope:X,cond:Z,compile:pe}}var kn="xyzw".split(""),$s=5121,Rn=1,ui=2,li=0,hi=1,fi=2,di=3,yr=4,zs=5,Xs=6,Hs="dither",Ys="blend.enable",Zs="blend.color",pi="blend.equation",mi="blend.func",Qs="depth.enable",Ks="depth.func",Js="depth.range",eo="depth.mask",vi="colorMask",to="cull.enable",no="cull.face",_i="frontFace",gi="lineWidth",ro="polygonOffset.enable",yi="polygonOffset.offset",io="sample.alpha",so="sample.enable",Ai="sample.coverage",oo="stencil.enable",ao="stencil.mask",Ti="stencil.func",bi="stencil.opFront",$n="stencil.opBack",co="scissor.enable",Ar="scissor.box",tn="viewport",zn="profile",mn="framebuffer",Xn="vert",Hn="frag",vn="elements",_n="primitive",gn="count",Tr="offset",br="instances",Yn="vao",Si="Width",xi="Height",Mn=mn+Si,Fn=mn+xi,fu=tn+Si,du=tn+xi,uo="drawingBuffer",lo=uo+Si,ho=uo+xi,pu=[mi,pi,Ti,bi,$n,Ai,tn,Ar,yi],Dn=34962,mu=34963,vu=35632,_u=35633,fo=3553,gu=34067,yu=2884,Au=3042,Tu=3024,bu=2960,Su=2929,xu=3089,Nu=32823,Cu=32926,wu=32928,Ni=5126,Sr=35664,xr=35665,Nr=35666,Ci=5124,Cr=35667,wr=35668,Er=35669,wi=35670,Or=35671,Ir=35672,kr=35673,Zn=35674,Qn=35675,Kn=35676,Jn=35678,er=35680,po=4,tr=1028,yn=1029,mo=2304,Ei=2305,Eu=32775,Ou=32776,Iu=519,on=7680,vo=0,_o=1,go=32774,ku=513,yo=36160,Ru=36064,Yt={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ao=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Pn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},an={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},To={frag:vu,vert:_u},Oi={cw:mo,ccw:Ei};function Rr(l){return Array.isArray(l)||t(l)||jt(l)}function bo(l){return l.sort(function(v,w){return v===tn?-1:w===tn?1:v<w?-1:1})}function Dt(l,v,w,H){this.thisDep=l,this.contextDep=v,this.propDep=w,this.append=H}function cn(l){return l&&!(l.thisDep||l.contextDep||l.propDep)}function bt(l){return new Dt(!1,!1,!1,l)}function Bt(l,v){var w=l.type;if(w===li){var H=l.data.length;return new Dt(!0,H>=1,H>=2,v)}else if(w===yr){var ne=l.data;return new Dt(ne.thisDep,ne.contextDep,ne.propDep,v)}else{if(w===zs)return new Dt(!1,!1,!1,v);if(w===Xs){for(var X=!1,Z=!1,le=!1,de=0;de<l.data.length;++de){var _e=l.data[de];if(_e.type===hi)le=!0;else if(_e.type===fi)Z=!0;else if(_e.type===di)X=!0;else if(_e.type===li){X=!0;var pe=_e.data;pe>=1&&(Z=!0),pe>=2&&(le=!0)}else _e.type===yr&&(X=X||_e.data.thisDep,Z=Z||_e.data.contextDep,le=le||_e.data.propDep)}return new Dt(X,Z,le,v)}else return new Dt(w===di,w===fi,w===hi,v)}}var So=new Dt(!1,!1,!1,function(){});function Mu(l,v,w,H,ne,X,Z,le,de,_e,pe,Ae,Ne,he,Te){var U=_e.Record,Q={add:32774,subtract:32778,"reverse subtract":32779};w.ext_blend_minmax&&(Q.min=Eu,Q.max=Ou);var ve=w.angle_instanced_arrays,Oe=w.webgl_draw_buffers,ae={dirty:!0,profile:Te.profile},Ie={},ue=[],be={},ce={};function Se(y){return y.replace(".","_")}function Ve(y,m,R){var B=Se(y);ue.push(y),Ie[B]=ae[B]=!!R,be[B]=m}function ze(y,m,R){var B=Se(y);ue.push(y),Array.isArray(R)?(ae[B]=R.slice(),Ie[B]=R.slice()):ae[B]=Ie[B]=R,ce[B]=m}Ve(Hs,Tu),Ve(Ys,Au),ze(Zs,"blendColor",[0,0,0,0]),ze(pi,"blendEquationSeparate",[go,go]),ze(mi,"blendFuncSeparate",[_o,vo,_o,vo]),Ve(Qs,Su,!0),ze(Ks,"depthFunc",ku),ze(Js,"depthRange",[0,1]),ze(eo,"depthMask",!0),ze(vi,vi,[!0,!0,!0,!0]),Ve(to,yu),ze(no,"cullFace",yn),ze(_i,_i,Ei),ze(gi,gi,1),Ve(ro,Nu),ze(yi,"polygonOffset",[0,0]),Ve(io,Cu),Ve(so,wu),ze(Ai,"sampleCoverage",[1,!1]),Ve(oo,bu),ze(ao,"stencilMask",-1),ze(Ti,"stencilFunc",[Iu,0,-1]),ze(bi,"stencilOpSeparate",[tr,on,on,on]),ze($n,"stencilOpSeparate",[yn,on,on,on]),Ve(co,xu),ze(Ar,"scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]),ze(tn,tn,[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var Ce={gl:l,context:Ne,strings:v,next:Ie,current:ae,draw:Ae,elements:X,buffer:ne,shader:pe,attributes:_e.state,vao:_e,uniforms:de,framebuffer:le,extensions:w,timer:he,isBufferArgs:Rr},ge={primTypes:Tn,compareFuncs:Pn,blendFuncs:Yt,blendEquations:Q,stencilOps:an,glTypes:ln,orientationType:Oi};g.optional(function(){Ce.isArrayLike=gt}),Oe&&(ge.backBuffer=[yn],ge.drawBuffer=Vt(H.maxDrawbuffers,function(y){return y===0?[0]:Vt(y,function(m){return Ru+m})}));var oe=0;function Ue(){var y=hu(),m=y.link,R=y.global;y.id=oe++,y.batchId="0";var B=m(Ce),j=y.shared={props:"a0"};Object.keys(Ce).forEach(function(I){j[I]=R.def(B,".",I)}),g.optional(function(){y.CHECK=m(g),y.commandStr=g.guessCommand(),y.command=m(y.commandStr),y.assert=function(I,_,V){I("if(!(",_,"))",this.CHECK,".commandRaise(",m(V),",",this.command,");")},ge.invalidBlendCombinations=Ao});var F=y.next={},M=y.current={};Object.keys(ce).forEach(function(I){Array.isArray(ae[I])&&(F[I]=R.def(j.next,".",I),M[I]=R.def(j.current,".",I))});var P=y.constants={};Object.keys(ge).forEach(function(I){P[I]=R.def(JSON.stringify(ge[I]))}),y.invoke=function(I,_){switch(_.type){case li:var V=["this",j.context,j.props,y.batchId];return I.def(m(_.data),".call(",V.slice(0,Math.max(_.data.length+1,4)),")");case hi:return I.def(j.props,_.data);case fi:return I.def(j.context,_.data);case di:return I.def("this",_.data);case yr:return _.data.append(y,I),_.data.ref;case zs:return _.data.toString();case Xs:return _.data.map(function($){return y.invoke(I,$)})}},y.attribCache={};var A={};return y.scopeAttrib=function(I){var _=v.id(I);if(_ in A)return A[_];var V=_e.scope[_];V||(V=_e.scope[_]=new U);var $=A[_]=m(V);return $},y}function Ze(y){var m=y.static,R=y.dynamic,B;if(zn in m){var j=!!m[zn];B=bt(function(M,P){return j}),B.enable=j}else if(zn in R){var F=R[zn];B=Bt(F,function(M,P){return M.invoke(P,F)})}return B}function Re(y,m){var R=y.static,B=y.dynamic;if(mn in R){var j=R[mn];return j?(j=le.getFramebuffer(j),g.command(j,"invalid framebuffer object"),bt(function(M,P){var A=M.link(j),I=M.shared;P.set(I.framebuffer,".next",A);var _=I.context;return P.set(_,"."+Mn,A+".width"),P.set(_,"."+Fn,A+".height"),A})):bt(function(M,P){var A=M.shared;P.set(A.framebuffer,".next","null");var I=A.context;return P.set(I,"."+Mn,I+"."+lo),P.set(I,"."+Fn,I+"."+ho),"null"})}else if(mn in B){var F=B[mn];return Bt(F,function(M,P){var A=M.invoke(P,F),I=M.shared,_=I.framebuffer,V=P.def(_,".getFramebuffer(",A,")");g.optional(function(){M.assert(P,"!"+A+"||"+V,"invalid framebuffer object")}),P.set(_,".next",V);var $=I.context;return P.set($,"."+Mn,V+"?"+V+".width:"+$+"."+lo),P.set($,"."+Fn,V+"?"+V+".height:"+$+"."+ho),V})}else return null}function tt(y,m,R){var B=y.static,j=y.dynamic;function F(A){if(A in B){var I=B[A];g.commandType(I,"object","invalid "+A,R.commandStr);var _=!0,V=I.x|0,$=I.y|0,te,re;return"width"in I?(te=I.width|0,g.command(te>=0,"invalid "+A,R.commandStr)):_=!1,"height"in I?(re=I.height|0,g.command(re>=0,"invalid "+A,R.commandStr)):_=!1,new Dt(!_&&m&&m.thisDep,!_&&m&&m.contextDep,!_&&m&&m.propDep,function(Le,Ke){var Me=Le.shared.context,Ge=te;"width"in I||(Ge=Ke.def(Me,".",Mn,"-",V));var He=re;return"height"in I||(He=Ke.def(Me,".",Fn,"-",$)),[V,$,Ge,He]})}else if(A in j){var ee=j[A],me=Bt(ee,function(Le,Ke){var Me=Le.invoke(Ke,ee);g.optional(function(){Le.assert(Ke,Me+"&&typeof "+Me+'==="object"',"invalid "+A)});var Ge=Le.shared.context,He=Ke.def(Me,".x|0"),at=Ke.def(Me,".y|0"),_t=Ke.def('"width" in ',Me,"?",Me,".width|0:","(",Ge,".",Mn,"-",He,")"),Pt=Ke.def('"height" in ',Me,"?",Me,".height|0:","(",Ge,".",Fn,"-",at,")");return g.optional(function(){Le.assert(Ke,_t+">=0&&"+Pt+">=0","invalid "+A)}),[He,at,_t,Pt]});return m&&(me.thisDep=me.thisDep||m.thisDep,me.contextDep=me.contextDep||m.contextDep,me.propDep=me.propDep||m.propDep),me}else return m?new Dt(m.thisDep,m.contextDep,m.propDep,function(Le,Ke){var Me=Le.shared.context;return[0,0,Ke.def(Me,".",Mn),Ke.def(Me,".",Fn)]}):null}var M=F(tn);if(M){var P=M;M=new Dt(M.thisDep,M.contextDep,M.propDep,function(A,I){var _=P.append(A,I),V=A.shared.context;return I.set(V,"."+fu,_[2]),I.set(V,"."+du,_[3]),_})}return{viewport:M,scissor_box:F(Ar)}}function Xe(y,m){var R=y.static,B=typeof R[Hn]=="string"&&typeof R[Xn]=="string";if(B){if(Object.keys(m.dynamic).length>0)return null;var j=m.static,F=Object.keys(j);if(F.length>0&&typeof j[F[0]]=="number"){for(var M=[],P=0;P<F.length;++P)g(typeof j[F[P]]=="number","must specify all vertex attribute locations when using vaos"),M.push([j[F[P]]|0,F[P]]);return M}}return null}function et(y,m,R){var B=y.static,j=y.dynamic;function F(_){if(_ in B){var V=v.id(B[_]);g.optional(function(){pe.shader(To[_],V,g.guessCommand())});var $=bt(function(){return V});return $.id=V,$}else if(_ in j){var te=j[_];return Bt(te,function(re,ee){var me=re.invoke(ee,te),Le=ee.def(re.shared.strings,".id(",me,")");return g.optional(function(){ee(re.shared.shader,".shader(",To[_],",",Le,",",re.command,");")}),Le})}return null}var M=F(Hn),P=F(Xn),A=null,I;return cn(M)&&cn(P)?(A=pe.program(P.id,M.id,null,R),I=bt(function(_,V){return _.link(A)})):I=new Dt(M&&M.thisDep||P&&P.thisDep,M&&M.contextDep||P&&P.contextDep,M&&M.propDep||P&&P.propDep,function(_,V){var $=_.shared.shader,te;M?te=M.append(_,V):te=V.def($,".",Hn);var re;P?re=P.append(_,V):re=V.def($,".",Xn);var ee=$+".program("+re+","+te;return g.optional(function(){ee+=","+_.command}),V.def(ee+")")}),{frag:M,vert:P,progVar:I,program:A}}function ot(y,m){var R=y.static,B=y.dynamic;function j(){if(vn in R){var _=R[vn];Rr(_)?_=X.getElements(X.create(_,!0)):_&&(_=X.getElements(_),g.command(_,"invalid elements",m.commandStr));var V=bt(function(te,re){if(_){var ee=te.link(_);return te.ELEMENTS=ee,ee}return te.ELEMENTS=null,null});return V.value=_,V}else if(vn in B){var $=B[vn];return Bt($,function(te,re){var ee=te.shared,me=ee.isBufferArgs,Le=ee.elements,Ke=te.invoke(re,$),Me=re.def("null"),Ge=re.def(me,"(",Ke,")"),He=te.cond(Ge).then(Me,"=",Le,".createStream(",Ke,");").else(Me,"=",Le,".getElements(",Ke,");");return g.optional(function(){te.assert(He.else,"!"+Ke+"||"+Me,"invalid elements")}),re.entry(He),re.exit(te.cond(Ge).then(Le,".destroyStream(",Me,");")),te.ELEMENTS=Me,Me})}return null}var F=j();function M(){if(_n in R){var _=R[_n];return g.commandParameter(_,Tn,"invalid primitve",m.commandStr),bt(function($,te){return Tn[_]})}else if(_n in B){var V=B[_n];return Bt(V,function($,te){var re=$.constants.primTypes,ee=$.invoke(te,V);return g.optional(function(){$.assert(te,ee+" in "+re,"invalid primitive, must be one of "+Object.keys(Tn))}),te.def(re,"[",ee,"]")})}else if(F)return cn(F)?F.value?bt(function($,te){return te.def($.ELEMENTS,".primType")}):bt(function(){return po}):new Dt(F.thisDep,F.contextDep,F.propDep,function($,te){var re=$.ELEMENTS;return te.def(re,"?",re,".primType:",po)});return null}function P(_,V){if(_ in R){var $=R[_]|0;return g.command(!V||$>=0,"invalid "+_,m.commandStr),bt(function(re,ee){return V&&(re.OFFSET=$),$})}else if(_ in B){var te=B[_];return Bt(te,function(re,ee){var me=re.invoke(ee,te);return V&&(re.OFFSET=me,g.optional(function(){re.assert(ee,me+">=0","invalid "+_)})),me})}else if(V&&F)return bt(function(re,ee){return re.OFFSET="0",0});return null}var A=P(Tr,!0);function I(){if(gn in R){var _=R[gn]|0;return g.command(typeof _=="number"&&_>=0,"invalid vertex count",m.commandStr),bt(function(){return _})}else if(gn in B){var V=B[gn];return Bt(V,function(re,ee){var me=re.invoke(ee,V);return g.optional(function(){re.assert(ee,"typeof "+me+'==="number"&&'+me+">=0&&"+me+"===("+me+"|0)","invalid vertex count")}),me})}else if(F)if(cn(F)){if(F)return A?new Dt(A.thisDep,A.contextDep,A.propDep,function(re,ee){var me=ee.def(re.ELEMENTS,".vertCount-",re.OFFSET);return g.optional(function(){re.assert(ee,me+">=0","invalid vertex offset/element buffer too small")}),me}):bt(function(re,ee){return ee.def(re.ELEMENTS,".vertCount")});var $=bt(function(){return-1});return g.optional(function(){$.MISSING=!0}),$}else{var te=new Dt(F.thisDep||A.thisDep,F.contextDep||A.contextDep,F.propDep||A.propDep,function(re,ee){var me=re.ELEMENTS;return re.OFFSET?ee.def(me,"?",me,".vertCount-",re.OFFSET,":-1"):ee.def(me,"?",me,".vertCount:-1")});return g.optional(function(){te.DYNAMIC=!0}),te}return null}return{elements:F,primitive:M(),count:I(),instances:P(br,!1),offset:A}}function St(y,m){var R=y.static,B=y.dynamic,j={};return ue.forEach(function(F){var M=Se(F);function P(A,I){if(F in R){var _=A(R[F]);j[M]=bt(function(){return _})}else if(F in B){var V=B[F];j[M]=Bt(V,function($,te){return I($,te,$.invoke(te,V))})}}switch(F){case to:case Ys:case Hs:case oo:case Qs:case co:case ro:case io:case so:case eo:return P(function(A){return g.commandType(A,"boolean",F,m.commandStr),A},function(A,I,_){return g.optional(function(){A.assert(I,"typeof "+_+'==="boolean"',"invalid flag "+F,A.commandStr)}),_});case Ks:return P(function(A){return g.commandParameter(A,Pn,"invalid "+F,m.commandStr),Pn[A]},function(A,I,_){var V=A.constants.compareFuncs;return g.optional(function(){A.assert(I,_+" in "+V,"invalid "+F+", must be one of "+Object.keys(Pn))}),I.def(V,"[",_,"]")});case Js:return P(function(A){return g.command(gt(A)&&A.length===2&&typeof A[0]=="number"&&typeof A[1]=="number"&&A[0]<=A[1],"depth range is 2d array",m.commandStr),A},function(A,I,_){g.optional(function(){A.assert(I,A.shared.isArrayLike+"("+_+")&&"+_+".length===2&&typeof "+_+'[0]==="number"&&typeof '+_+'[1]==="number"&&'+_+"[0]<="+_+"[1]","depth range must be a 2d array")});var V=I.def("+",_,"[0]"),$=I.def("+",_,"[1]");return[V,$]});case mi:return P(function(A){g.commandType(A,"object","blend.func",m.commandStr);var I="srcRGB"in A?A.srcRGB:A.src,_="srcAlpha"in A?A.srcAlpha:A.src,V="dstRGB"in A?A.dstRGB:A.dst,$="dstAlpha"in A?A.dstAlpha:A.dst;return g.commandParameter(I,Yt,M+".srcRGB",m.commandStr),g.commandParameter(_,Yt,M+".srcAlpha",m.commandStr),g.commandParameter(V,Yt,M+".dstRGB",m.commandStr),g.commandParameter($,Yt,M+".dstAlpha",m.commandStr),g.command(Ao.indexOf(I+", "+V)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+I+", "+V+")",m.commandStr),[Yt[I],Yt[V],Yt[_],Yt[$]]},function(A,I,_){var V=A.constants.blendFuncs;g.optional(function(){A.assert(I,_+"&&typeof "+_+'==="object"',"invalid blend func, must be an object")});function $(Me,Ge){var He=I.def('"',Me,Ge,'" in ',_,"?",_,".",Me,Ge,":",_,".",Me);return g.optional(function(){A.assert(I,He+" in "+V,"invalid "+F+"."+Me+Ge+", must be one of "+Object.keys(Yt))}),He}var te=$("src","RGB"),re=$("dst","RGB");g.optional(function(){var Me=A.constants.invalidBlendCombinations;A.assert(I,Me+".indexOf("+te+'+", "+'+re+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var ee=I.def(V,"[",te,"]"),me=I.def(V,"[",$("src","Alpha"),"]"),Le=I.def(V,"[",re,"]"),Ke=I.def(V,"[",$("dst","Alpha"),"]");return[ee,Le,me,Ke]});case pi:return P(function(A){if(typeof A=="string")return g.commandParameter(A,Q,"invalid "+F,m.commandStr),[Q[A],Q[A]];if(typeof A=="object")return g.commandParameter(A.rgb,Q,F+".rgb",m.commandStr),g.commandParameter(A.alpha,Q,F+".alpha",m.commandStr),[Q[A.rgb],Q[A.alpha]];g.commandRaise("invalid blend.equation",m.commandStr)},function(A,I,_){var V=A.constants.blendEquations,$=I.def(),te=I.def(),re=A.cond("typeof ",_,'==="string"');return g.optional(function(){function ee(me,Le,Ke){A.assert(me,Ke+" in "+V,"invalid "+Le+", must be one of "+Object.keys(Q))}ee(re.then,F,_),A.assert(re.else,_+"&&typeof "+_+'==="object"',"invalid "+F),ee(re.else,F+".rgb",_+".rgb"),ee(re.else,F+".alpha",_+".alpha")}),re.then($,"=",te,"=",V,"[",_,"];"),re.else($,"=",V,"[",_,".rgb];",te,"=",V,"[",_,".alpha];"),I(re),[$,te]});case Zs:return P(function(A){return g.command(gt(A)&&A.length===4,"blend.color must be a 4d array",m.commandStr),Vt(4,function(I){return+A[I]})},function(A,I,_){return g.optional(function(){A.assert(I,A.shared.isArrayLike+"("+_+")&&"+_+".length===4","blend.color must be a 4d array")}),Vt(4,function(V){return I.def("+",_,"[",V,"]")})});case ao:return P(function(A){return g.commandType(A,"number",M,m.commandStr),A|0},function(A,I,_){return g.optional(function(){A.assert(I,"typeof "+_+'==="number"',"invalid stencil.mask")}),I.def(_,"|0")});case Ti:return P(function(A){g.commandType(A,"object",M,m.commandStr);var I=A.cmp||"keep",_=A.ref||0,V="mask"in A?A.mask:-1;return g.commandParameter(I,Pn,F+".cmp",m.commandStr),g.commandType(_,"number",F+".ref",m.commandStr),g.commandType(V,"number",F+".mask",m.commandStr),[Pn[I],_,V]},function(A,I,_){var V=A.constants.compareFuncs;g.optional(function(){function ee(){A.assert(I,Array.prototype.join.call(arguments,""),"invalid stencil.func")}ee(_+"&&typeof ",_,'==="object"'),ee('!("cmp" in ',_,")||(",_,".cmp in ",V,")")});var $=I.def('"cmp" in ',_,"?",V,"[",_,".cmp]",":",on),te=I.def(_,".ref|0"),re=I.def('"mask" in ',_,"?",_,".mask|0:-1");return[$,te,re]});case bi:case $n:return P(function(A){g.commandType(A,"object",M,m.commandStr);var I=A.fail||"keep",_=A.zfail||"keep",V=A.zpass||"keep";return g.commandParameter(I,an,F+".fail",m.commandStr),g.commandParameter(_,an,F+".zfail",m.commandStr),g.commandParameter(V,an,F+".zpass",m.commandStr),[F===$n?yn:tr,an[I],an[_],an[V]]},function(A,I,_){var V=A.constants.stencilOps;g.optional(function(){A.assert(I,_+"&&typeof "+_+'==="object"',"invalid "+F)});function $(te){return g.optional(function(){A.assert(I,'!("'+te+'" in '+_+")||("+_+"."+te+" in "+V+")","invalid "+F+"."+te+", must be one of "+Object.keys(an))}),I.def('"',te,'" in ',_,"?",V,"[",_,".",te,"]:",on)}return[F===$n?yn:tr,$("fail"),$("zfail"),$("zpass")]});case yi:return P(function(A){g.commandType(A,"object",M,m.commandStr);var I=A.factor|0,_=A.units|0;return g.commandType(I,"number",M+".factor",m.commandStr),g.commandType(_,"number",M+".units",m.commandStr),[I,_]},function(A,I,_){g.optional(function(){A.assert(I,_+"&&typeof "+_+'==="object"',"invalid "+F)});var V=I.def(_,".factor|0"),$=I.def(_,".units|0");return[V,$]});case no:return P(function(A){var I=0;return A==="front"?I=tr:A==="back"&&(I=yn),g.command(!!I,M,m.commandStr),I},function(A,I,_){return g.optional(function(){A.assert(I,_+'==="front"||'+_+'==="back"',"invalid cull.face")}),I.def(_,'==="front"?',tr,":",yn)});case gi:return P(function(A){return g.command(typeof A=="number"&&A>=H.lineWidthDims[0]&&A<=H.lineWidthDims[1],"invalid line width, must be a positive number between "+H.lineWidthDims[0]+" and "+H.lineWidthDims[1],m.commandStr),A},function(A,I,_){return g.optional(function(){A.assert(I,"typeof "+_+'==="number"&&'+_+">="+H.lineWidthDims[0]+"&&"+_+"<="+H.lineWidthDims[1],"invalid line width")}),_});case _i:return P(function(A){return g.commandParameter(A,Oi,M,m.commandStr),Oi[A]},function(A,I,_){return g.optional(function(){A.assert(I,_+'==="cw"||'+_+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),I.def(_+'==="cw"?'+mo+":"+Ei)});case vi:return P(function(A){return g.command(gt(A)&&A.length===4,"color.mask must be length 4 array",m.commandStr),A.map(function(I){return!!I})},function(A,I,_){return g.optional(function(){A.assert(I,A.shared.isArrayLike+"("+_+")&&"+_+".length===4","invalid color.mask")}),Vt(4,function(V){return"!!"+_+"["+V+"]"})});case Ai:return P(function(A){g.command(typeof A=="object"&&A,M,m.commandStr);var I="value"in A?A.value:1,_=!!A.invert;return g.command(typeof I=="number"&&I>=0&&I<=1,"sample.coverage.value must be a number between 0 and 1",m.commandStr),[I,_]},function(A,I,_){g.optional(function(){A.assert(I,_+"&&typeof "+_+'==="object"',"invalid sample.coverage")});var V=I.def('"value" in ',_,"?+",_,".value:1"),$=I.def("!!",_,".invert");return[V,$]})}}),j}function Ot(y,m){var R=y.static,B=y.dynamic,j={};return Object.keys(R).forEach(function(F){var M=R[F],P;if(typeof M=="number"||typeof M=="boolean")P=bt(function(){return M});else if(typeof M=="function"){var A=M._reglType;A==="texture2d"||A==="textureCube"?P=bt(function(I){return I.link(M)}):A==="framebuffer"||A==="framebufferCube"?(g.command(M.color.length>0,'missing color attachment for framebuffer sent to uniform "'+F+'"',m.commandStr),P=bt(function(I){return I.link(M.color[0])})):g.commandRaise('invalid data for uniform "'+F+'"',m.commandStr)}else gt(M)?P=bt(function(I){var _=I.global.def("[",Vt(M.length,function(V){return g.command(typeof M[V]=="number"||typeof M[V]=="boolean","invalid uniform "+F,I.commandStr),M[V]}),"]");return _}):g.commandRaise('invalid or missing data for uniform "'+F+'"',m.commandStr);P.value=M,j[F]=P}),Object.keys(B).forEach(function(F){var M=B[F];j[F]=Bt(M,function(P,A){return P.invoke(A,M)})}),j}function it(y,m){var R=y.static,B=y.dynamic,j={};return Object.keys(R).forEach(function(F){var M=R[F],P=v.id(F),A=new U;if(Rr(M))A.state=Rn,A.buffer=ne.getBuffer(ne.create(M,Dn,!1,!0)),A.type=0;else{var I=ne.getBuffer(M);if(I)A.state=Rn,A.buffer=I,A.type=0;else if(g.command(typeof M=="object"&&M,"invalid data for attribute "+F,m.commandStr),"constant"in M){var _=M.constant;A.buffer="null",A.state=ui,typeof _=="number"?A.x=_:(g.command(gt(_)&&_.length>0&&_.length<=4,"invalid constant for attribute "+F,m.commandStr),kn.forEach(function(Le,Ke){Ke<_.length&&(A[Le]=_[Ke])}))}else{Rr(M.buffer)?I=ne.getBuffer(ne.create(M.buffer,Dn,!1,!0)):I=ne.getBuffer(M.buffer),g.command(!!I,'missing buffer for attribute "'+F+'"',m.commandStr);var V=M.offset|0;g.command(V>=0,'invalid offset for attribute "'+F+'"',m.commandStr);var $=M.stride|0;g.command($>=0&&$<256,'invalid stride for attribute "'+F+'", must be integer betweeen [0, 255]',m.commandStr);var te=M.size|0;g.command(!("size"in M)||te>0&&te<=4,'invalid size for attribute "'+F+'", must be 1,2,3,4',m.commandStr);var re=!!M.normalized,ee=0;"type"in M&&(g.commandParameter(M.type,ln,"invalid type for attribute "+F,m.commandStr),ee=ln[M.type]);var me=M.divisor|0;"divisor"in M&&(g.command(me===0||ve,'cannot specify divisor for attribute "'+F+'", instancing not supported',m.commandStr),g.command(me>=0,'invalid divisor for attribute "'+F+'"',m.commandStr)),g.optional(function(){var Le=m.commandStr,Ke=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(M).forEach(function(Me){g.command(Ke.indexOf(Me)>=0,'unknown parameter "'+Me+'" for attribute pointer "'+F+'" (valid parameters are '+Ke+")",Le)})}),A.buffer=I,A.state=Rn,A.size=te,A.normalized=re,A.type=ee||I.dtype,A.offset=V,A.stride=$,A.divisor=me}}j[F]=bt(function(Le,Ke){var Me=Le.attribCache;if(P in Me)return Me[P];var Ge={isStream:!1};return Object.keys(A).forEach(function(He){Ge[He]=A[He]}),A.buffer&&(Ge.buffer=Le.link(A.buffer),Ge.type=Ge.type||Ge.buffer+".dtype"),Me[P]=Ge,Ge})}),Object.keys(B).forEach(function(F){var M=B[F];function P(A,I){var _=A.invoke(I,M),V=A.shared,$=A.constants,te=V.isBufferArgs,re=V.buffer;g.optional(function(){A.assert(I,_+"&&(typeof "+_+'==="object"||typeof '+_+'==="function")&&('+te+"("+_+")||"+re+".getBuffer("+_+")||"+re+".getBuffer("+_+".buffer)||"+te+"("+_+'.buffer)||("constant" in '+_+"&&(typeof "+_+'.constant==="number"||'+V.isArrayLike+"("+_+".constant))))",'invalid dynamic attribute "'+F+'"')});var ee={isStream:I.def(!1)},me=new U;me.state=Rn,Object.keys(me).forEach(function(Ge){ee[Ge]=I.def(""+me[Ge])});var Le=ee.buffer,Ke=ee.type;I("if(",te,"(",_,")){",ee.isStream,"=true;",Le,"=",re,".createStream(",Dn,",",_,");",Ke,"=",Le,".dtype;","}else{",Le,"=",re,".getBuffer(",_,");","if(",Le,"){",Ke,"=",Le,".dtype;",'}else if("constant" in ',_,"){",ee.state,"=",ui,";","if(typeof "+_+'.constant === "number"){',ee[kn[0]],"=",_,".constant;",kn.slice(1).map(function(Ge){return ee[Ge]}).join("="),"=0;","}else{",kn.map(function(Ge,He){return ee[Ge]+"="+_+".constant.length>"+He+"?"+_+".constant["+He+"]:0;"}).join(""),"}}else{","if(",te,"(",_,".buffer)){",Le,"=",re,".createStream(",Dn,",",_,".buffer);","}else{",Le,"=",re,".getBuffer(",_,".buffer);","}",Ke,'="type" in ',_,"?",$.glTypes,"[",_,".type]:",Le,".dtype;",ee.normalized,"=!!",_,".normalized;");function Me(Ge){I(ee[Ge],"=",_,".",Ge,"|0;")}return Me("size"),Me("offset"),Me("stride"),Me("divisor"),I("}}"),I.exit("if(",ee.isStream,"){",re,".destroyStream(",Le,");","}"),ee}j[F]=Bt(M,P)}),j}function Ct(y,m){var R=y.static,B=y.dynamic;if(Yn in R){var j=R[Yn];return j!==null&&_e.getVAO(j)===null&&(j=_e.createVAO(j)),bt(function(M){return M.link(_e.getVAO(j))})}else if(Yn in B){var F=B[Yn];return Bt(F,function(M,P){var A=M.invoke(P,F);return P.def(M.shared.vao+".getVAO("+A+")")})}return null}function mt(y){var m=y.static,R=y.dynamic,B={};return Object.keys(m).forEach(function(j){var F=m[j];B[j]=bt(function(M,P){return typeof F=="number"||typeof F=="boolean"?""+F:M.link(F)})}),Object.keys(R).forEach(function(j){var F=R[j];B[j]=Bt(F,function(M,P){return M.invoke(P,F)})}),B}function xt(y,m,R,B,j){var F=y.static,M=y.dynamic;g.optional(function(){var Me=[mn,Xn,Hn,vn,_n,Tr,gn,br,zn,Yn].concat(ue);function Ge(He){Object.keys(He).forEach(function(at){g.command(Me.indexOf(at)>=0,'unknown parameter "'+at+'"',j.commandStr)})}Ge(F),Ge(M)});var P=Xe(y,m),A=Re(y),I=tt(y,A,j),_=ot(y,j),V=St(y,j),$=et(y,j,P);function te(Me){var Ge=I[Me];Ge&&(V[Me]=Ge)}te(tn),te(Se(Ar));var re=Object.keys(V).length>0,ee={framebuffer:A,draw:_,shader:$,state:V,dirty:re,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(ee.profile=Ze(y),ee.uniforms=Ot(R,j),ee.drawVAO=ee.scopeVAO=Ct(y),!ee.drawVAO&&$.program&&!P&&w.angle_instanced_arrays){var me=!0,Le=$.program.attributes.map(function(Me){var Ge=m.static[Me];return me=me&&!!Ge,Ge});if(me&&Le.length>0){var Ke=_e.getVAO(_e.createVAO(Le));ee.drawVAO=new Dt(null,null,null,function(Me,Ge){return Me.link(Ke)}),ee.useVAO=!0}}return P?ee.useVAO=!0:ee.attributes=it(m,j),ee.context=mt(B),ee}function wt(y,m,R){var B=y.shared,j=B.context,F=y.scope();Object.keys(R).forEach(function(M){m.save(j,"."+M);var P=R[M],A=P.append(y,m);Array.isArray(A)?F(j,".",M,"=[",A.join(),"];"):F(j,".",M,"=",A,";")}),m(F)}function Et(y,m,R,B){var j=y.shared,F=j.gl,M=j.framebuffer,P;Oe&&(P=m.def(j.extensions,".webgl_draw_buffers"));var A=y.constants,I=A.drawBuffer,_=A.backBuffer,V;R?V=R.append(y,m):V=m.def(M,".next"),B||m("if(",V,"!==",M,".cur){"),m("if(",V,"){",F,".bindFramebuffer(",yo,",",V,".framebuffer);"),Oe&&m(P,".drawBuffersWEBGL(",I,"[",V,".colorAttachments.length]);"),m("}else{",F,".bindFramebuffer(",yo,",null);"),Oe&&m(P,".drawBuffersWEBGL(",_,");"),m("}",M,".cur=",V,";"),B||m("}")}function It(y,m,R){var B=y.shared,j=B.gl,F=y.current,M=y.next,P=B.current,A=B.next,I=y.cond(P,".dirty");ue.forEach(function(_){var V=Se(_);if(!(V in R.state)){var $,te;if(V in M){$=M[V],te=F[V];var re=Vt(ae[V].length,function(me){return I.def($,"[",me,"]")});I(y.cond(re.map(function(me,Le){return me+"!=="+te+"["+Le+"]"}).join("||")).then(j,".",ce[V],"(",re,");",re.map(function(me,Le){return te+"["+Le+"]="+me}).join(";"),";"))}else{$=I.def(A,".",V);var ee=y.cond($,"!==",P,".",V);I(ee),V in be?ee(y.cond($).then(j,".enable(",be[V],");").else(j,".disable(",be[V],");"),P,".",V,"=",$,";"):ee(j,".",ce[V],"(",$,");",P,".",V,"=",$,";")}}}),Object.keys(R.state).length===0&&I(P,".dirty=false;"),m(I)}function Rt(y,m,R,B){var j=y.shared,F=y.current,M=j.current,P=j.gl;bo(Object.keys(R)).forEach(function(A){var I=R[A];if(!(B&&!B(I))){var _=I.append(y,m);if(be[A]){var V=be[A];cn(I)?_?m(P,".enable(",V,");"):m(P,".disable(",V,");"):m(y.cond(_).then(P,".enable(",V,");").else(P,".disable(",V,");")),m(M,".",A,"=",_,";")}else if(gt(_)){var $=F[A];m(P,".",ce[A],"(",_,");",_.map(function(te,re){return $+"["+re+"]="+te}).join(";"),";")}else m(P,".",ce[A],"(",_,");",M,".",A,"=",_,";")}})}function yt(y,m){ve&&(y.instancing=m.def(y.shared.extensions,".angle_instanced_arrays"))}function Qe(y,m,R,B,j){var F=y.shared,M=y.stats,P=F.current,A=F.timer,I=R.profile;function _(){return typeof performance>"u"?"Date.now()":"performance.now()"}var V,$;function te(Me){V=m.def(),Me(V,"=",_(),";"),typeof j=="string"?Me(M,".count+=",j,";"):Me(M,".count++;"),he&&(B?($=m.def(),Me($,"=",A,".getNumPendingQueries();")):Me(A,".beginQuery(",M,");"))}function re(Me){Me(M,".cpuTime+=",_(),"-",V,";"),he&&(B?Me(A,".pushScopeStats(",$,",",A,".getNumPendingQueries(),",M,");"):Me(A,".endQuery();"))}function ee(Me){var Ge=m.def(P,".profile");m(P,".profile=",Me,";"),m.exit(P,".profile=",Ge,";")}var me;if(I){if(cn(I)){I.enable?(te(m),re(m.exit),ee("true")):ee("false");return}me=I.append(y,m),ee(me)}else me=m.def(P,".profile");var Le=y.block();te(Le),m("if(",me,"){",Le,"}");var Ke=y.block();re(Ke),m.exit("if(",me,"){",Ke,"}")}function Mt(y,m,R,B,j){var F=y.shared;function M(A){switch(A){case Sr:case Cr:case Or:return 2;case xr:case wr:case Ir:return 3;case Nr:case Er:case kr:return 4;default:return 1}}function P(A,I,_){var V=F.gl,$=m.def(A,".location"),te=m.def(F.attributes,"[",$,"]"),re=_.state,ee=_.buffer,me=[_.x,_.y,_.z,_.w],Le=["buffer","normalized","offset","stride"];function Ke(){m("if(!",te,".buffer){",V,".enableVertexAttribArray(",$,");}");var Ge=_.type,He;if(_.size?He=m.def(_.size,"||",I):He=I,m("if(",te,".type!==",Ge,"||",te,".size!==",He,"||",Le.map(function(_t){return te+"."+_t+"!=="+_[_t]}).join("||"),"){",V,".bindBuffer(",Dn,",",ee,".buffer);",V,".vertexAttribPointer(",[$,He,Ge,_.normalized,_.stride,_.offset],");",te,".type=",Ge,";",te,".size=",He,";",Le.map(function(_t){return te+"."+_t+"="+_[_t]+";"}).join(""),"}"),ve){var at=_.divisor;m("if(",te,".divisor!==",at,"){",y.instancing,".vertexAttribDivisorANGLE(",[$,at],");",te,".divisor=",at,";}")}}function Me(){m("if(",te,".buffer){",V,".disableVertexAttribArray(",$,");",te,".buffer=null;","}if(",kn.map(function(Ge,He){return te+"."+Ge+"!=="+me[He]}).join("||"),"){",V,".vertexAttrib4f(",$,",",me,");",kn.map(function(Ge,He){return te+"."+Ge+"="+me[He]+";"}).join(""),"}")}re===Rn?Ke():re===ui?Me():(m("if(",re,"===",Rn,"){"),Ke(),m("}else{"),Me(),m("}"))}B.forEach(function(A){var I=A.name,_=R.attributes[I],V;if(_){if(!j(_))return;V=_.append(y,m)}else{if(!j(So))return;var $=y.scopeAttrib(I);g.optional(function(){y.assert(m,$+".state","missing attribute "+I)}),V={},Object.keys(new U).forEach(function(te){V[te]=m.def($,".",te)})}P(y.link(A),M(A.info.type),V)})}function ut(y,m,R,B,j){for(var F=y.shared,M=F.gl,P,A=0;A<B.length;++A){var I=B[A],_=I.name,V=I.info.type,$=R.uniforms[_],te=y.link(I),re=te+".location",ee;if($){if(!j($))continue;if(cn($)){var me=$.value;if(g.command(me!==null&&typeof me<"u",'missing uniform "'+_+'"',y.commandStr),V===Jn||V===er){g.command(typeof me=="function"&&(V===Jn&&(me._reglType==="texture2d"||me._reglType==="framebuffer")||V===er&&(me._reglType==="textureCube"||me._reglType==="framebufferCube")),"invalid texture for uniform "+_,y.commandStr);var Le=y.link(me._texture||me.color[0]._texture);m(M,".uniform1i(",re,",",Le+".bind());"),m.exit(Le,".unbind();")}else if(V===Zn||V===Qn||V===Kn){g.optional(function(){g.command(gt(me),"invalid matrix for uniform "+_,y.commandStr),g.command(V===Zn&&me.length===4||V===Qn&&me.length===9||V===Kn&&me.length===16,"invalid length for matrix uniform "+_,y.commandStr)});var Ke=y.global.def("new Float32Array(["+Array.prototype.slice.call(me)+"])"),Me=2;V===Qn?Me=3:V===Kn&&(Me=4),m(M,".uniformMatrix",Me,"fv(",re,",false,",Ke,");")}else{switch(V){case Ni:g.commandType(me,"number","uniform "+_,y.commandStr),P="1f";break;case Sr:g.command(gt(me)&&me.length===2,"uniform "+_,y.commandStr),P="2f";break;case xr:g.command(gt(me)&&me.length===3,"uniform "+_,y.commandStr),P="3f";break;case Nr:g.command(gt(me)&&me.length===4,"uniform "+_,y.commandStr),P="4f";break;case wi:g.commandType(me,"boolean","uniform "+_,y.commandStr),P="1i";break;case Ci:g.commandType(me,"number","uniform "+_,y.commandStr),P="1i";break;case Or:g.command(gt(me)&&me.length===2,"uniform "+_,y.commandStr),P="2i";break;case Cr:g.command(gt(me)&&me.length===2,"uniform "+_,y.commandStr),P="2i";break;case Ir:g.command(gt(me)&&me.length===3,"uniform "+_,y.commandStr),P="3i";break;case wr:g.command(gt(me)&&me.length===3,"uniform "+_,y.commandStr),P="3i";break;case kr:g.command(gt(me)&&me.length===4,"uniform "+_,y.commandStr),P="4i";break;case Er:g.command(gt(me)&&me.length===4,"uniform "+_,y.commandStr),P="4i";break}m(M,".uniform",P,"(",re,",",gt(me)?Array.prototype.slice.call(me):me,");")}continue}else ee=$.append(y,m)}else{if(!j(So))continue;ee=m.def(F.uniforms,"[",v.id(_),"]")}V===Jn?(g(!Array.isArray(ee),"must specify a scalar prop for textures"),m("if(",ee,"&&",ee,'._reglType==="framebuffer"){',ee,"=",ee,".color[0];","}")):V===er&&(g(!Array.isArray(ee),"must specify a scalar prop for cube maps"),m("if(",ee,"&&",ee,'._reglType==="framebufferCube"){',ee,"=",ee,".color[0];","}")),g.optional(function(){function Pt(zt,Io){y.assert(m,zt,'bad data or missing for uniform "'+_+'".  '+Io)}function Ii(zt){g(!Array.isArray(ee),"must not specify an array type for uniform"),Pt("typeof "+ee+'==="'+zt+'"',"invalid type, expected "+zt)}function qt(zt,Io){Array.isArray(ee)?g(ee.length===zt,"must have length "+zt):Pt(F.isArrayLike+"("+ee+")&&"+ee+".length==="+zt,"invalid vector, should have length "+zt,y.commandStr)}function Oo(zt){g(!Array.isArray(ee),"must not specify a value type"),Pt("typeof "+ee+'==="function"&&'+ee+'._reglType==="texture'+(zt===fo?"2d":"Cube")+'"',"invalid texture type",y.commandStr)}switch(V){case Ci:Ii("number");break;case Cr:qt(2);break;case wr:qt(3);break;case Er:qt(4);break;case Ni:Ii("number");break;case Sr:qt(2);break;case xr:qt(3);break;case Nr:qt(4);break;case wi:Ii("boolean");break;case Or:qt(2);break;case Ir:qt(3);break;case kr:qt(4);break;case Zn:qt(4);break;case Qn:qt(9);break;case Kn:qt(16);break;case Jn:Oo(fo);break;case er:Oo(gu);break}});var Ge=1;switch(V){case Jn:case er:var He=m.def(ee,"._texture");m(M,".uniform1i(",re,",",He,".bind());"),m.exit(He,".unbind();");continue;case Ci:case wi:P="1i";break;case Cr:case Or:P="2i",Ge=2;break;case wr:case Ir:P="3i",Ge=3;break;case Er:case kr:P="4i",Ge=4;break;case Ni:P="1f";break;case Sr:P="2f",Ge=2;break;case xr:P="3f",Ge=3;break;case Nr:P="4f",Ge=4;break;case Zn:P="Matrix2fv";break;case Qn:P="Matrix3fv";break;case Kn:P="Matrix4fv";break}if(m(M,".uniform",P,"(",re,","),P.charAt(0)==="M"){var at=Math.pow(V-Zn+2,2),_t=y.global.def("new Float32Array(",at,")");Array.isArray(ee)?m("false,(",Vt(at,function(Pt){return _t+"["+Pt+"]="+ee[Pt]}),",",_t,")"):m("false,(Array.isArray(",ee,")||",ee," instanceof Float32Array)?",ee,":(",Vt(at,function(Pt){return _t+"["+Pt+"]="+ee+"["+Pt+"]"}),",",_t,")")}else Ge>1?m(Vt(Ge,function(Pt){return Array.isArray(ee)?ee[Pt]:ee+"["+Pt+"]"})):(g(!Array.isArray(ee),"uniform value must not be an array"),m(ee));m(");")}}function Be(y,m,R,B){var j=y.shared,F=j.gl,M=j.draw,P=B.draw;function A(){var He=P.elements,at,_t=m;return He?((He.contextDep&&B.contextDynamic||He.propDep)&&(_t=R),at=He.append(y,_t)):at=_t.def(M,".",vn),at&&_t("if("+at+")"+F+".bindBuffer("+mu+","+at+".buffer.buffer);"),at}function I(){var He=P.count,at,_t=m;return He?((He.contextDep&&B.contextDynamic||He.propDep)&&(_t=R),at=He.append(y,_t),g.optional(function(){He.MISSING&&y.assert(m,"false","missing vertex count"),He.DYNAMIC&&y.assert(_t,at+">=0","missing vertex count")})):(at=_t.def(M,".",gn),g.optional(function(){y.assert(_t,at+">=0","missing vertex count")})),at}var _=A();function V(He){var at=P[He];return at?at.contextDep&&B.contextDynamic||at.propDep?at.append(y,R):at.append(y,m):m.def(M,".",He)}var $=V(_n),te=V(Tr),re=I();if(typeof re=="number"){if(re===0)return}else R("if(",re,"){"),R.exit("}");var ee,me;ve&&(ee=V(br),me=y.instancing);var Le=_+".type",Ke=P.elements&&cn(P.elements);function Me(){function He(){R(me,".drawElementsInstancedANGLE(",[$,re,Le,te+"<<(("+Le+"-"+$s+")>>1)",ee],");")}function at(){R(me,".drawArraysInstancedANGLE(",[$,te,re,ee],");")}_?Ke?He():(R("if(",_,"){"),He(),R("}else{"),at(),R("}")):at()}function Ge(){function He(){R(F+".drawElements("+[$,re,Le,te+"<<(("+Le+"-"+$s+")>>1)"]+");")}function at(){R(F+".drawArrays("+[$,te,re]+");")}_?Ke?He():(R("if(",_,"){"),He(),R("}else{"),at(),R("}")):at()}ve&&(typeof ee!="number"||ee>=0)?typeof ee=="string"?(R("if(",ee,">0){"),Me(),R("}else if(",ee,"<0){"),Ge(),R("}")):Me():Ge()}function rt(y,m,R,B,j){var F=Ue(),M=F.proc("body",j);return g.optional(function(){F.commandStr=m.commandStr,F.command=F.link(m.commandStr)}),ve&&(F.instancing=M.def(F.shared.extensions,".angle_instanced_arrays")),y(F,M,R,B),F.compile().body}function st(y,m,R,B){yt(y,m),R.useVAO?R.drawVAO?m(y.shared.vao,".setVAO(",R.drawVAO.append(y,m),");"):m(y.shared.vao,".setVAO(",y.shared.vao,".targetVAO);"):(m(y.shared.vao,".setVAO(null);"),Mt(y,m,R,B.attributes,function(){return!0})),ut(y,m,R,B.uniforms,function(){return!0}),Be(y,m,m,R)}function At(y,m){var R=y.proc("draw",1);yt(y,R),wt(y,R,m.context),Et(y,R,m.framebuffer),It(y,R,m),Rt(y,R,m.state),Qe(y,R,m,!1,!0);var B=m.shader.progVar.append(y,R);if(R(y.shared.gl,".useProgram(",B,".program);"),m.shader.program)st(y,R,m,m.shader.program);else{R(y.shared.vao,".setVAO(null);");var j=y.global.def("{}"),F=R.def(B,".id"),M=R.def(j,"[",F,"]");R(y.cond(M).then(M,".call(this,a0);").else(M,"=",j,"[",F,"]=",y.link(function(P){return rt(st,y,m,P,1)}),"(",B,");",M,".call(this,a0);"))}Object.keys(m.state).length>0&&R(y.shared.current,".dirty=true;")}function Zt(y,m,R,B){y.batchId="a1",yt(y,m);function j(){return!0}Mt(y,m,R,B.attributes,j),ut(y,m,R,B.uniforms,j),Be(y,m,m,R)}function An(y,m,R,B){yt(y,m);var j=R.contextDep,F=m.def(),M="a0",P="a1",A=m.def();y.shared.props=A,y.batchId=F;var I=y.scope(),_=y.scope();m(I.entry,"for(",F,"=0;",F,"<",P,";++",F,"){",A,"=",M,"[",F,"];",_,"}",I.exit);function V(Le){return Le.contextDep&&j||Le.propDep}function $(Le){return!V(Le)}if(R.needsContext&&wt(y,_,R.context),R.needsFramebuffer&&Et(y,_,R.framebuffer),Rt(y,_,R.state,V),R.profile&&V(R.profile)&&Qe(y,_,R,!1,!0),B)R.useVAO?R.drawVAO?V(R.drawVAO)?_(y.shared.vao,".setVAO(",R.drawVAO.append(y,_),");"):I(y.shared.vao,".setVAO(",R.drawVAO.append(y,I),");"):I(y.shared.vao,".setVAO(",y.shared.vao,".targetVAO);"):(I(y.shared.vao,".setVAO(null);"),Mt(y,I,R,B.attributes,$),Mt(y,_,R,B.attributes,V)),ut(y,I,R,B.uniforms,$),ut(y,_,R,B.uniforms,V),Be(y,I,_,R);else{var te=y.global.def("{}"),re=R.shader.progVar.append(y,_),ee=_.def(re,".id"),me=_.def(te,"[",ee,"]");_(y.shared.gl,".useProgram(",re,".program);","if(!",me,"){",me,"=",te,"[",ee,"]=",y.link(function(Le){return rt(Zt,y,R,Le,2)}),"(",re,");}",me,".call(this,a0[",F,"],",F,");")}}function b(y,m){var R=y.proc("batch",2);y.batchId="0",yt(y,R);var B=!1,j=!0;Object.keys(m.context).forEach(function(te){B=B||m.context[te].propDep}),B||(wt(y,R,m.context),j=!1);var F=m.framebuffer,M=!1;F?(F.propDep?B=M=!0:F.contextDep&&B&&(M=!0),M||Et(y,R,F)):Et(y,R,null),m.state.viewport&&m.state.viewport.propDep&&(B=!0);function P(te){return te.contextDep&&B||te.propDep}It(y,R,m),Rt(y,R,m.state,function(te){return!P(te)}),(!m.profile||!P(m.profile))&&Qe(y,R,m,!1,"a1"),m.contextDep=B,m.needsContext=j,m.needsFramebuffer=M;var A=m.shader.progVar;if(A.contextDep&&B||A.propDep)An(y,R,m,null);else{var I=A.append(y,R);if(R(y.shared.gl,".useProgram(",I,".program);"),m.shader.program)An(y,R,m,m.shader.program);else{R(y.shared.vao,".setVAO(null);");var _=y.global.def("{}"),V=R.def(I,".id"),$=R.def(_,"[",V,"]");R(y.cond($).then($,".call(this,a0,a1);").else($,"=",_,"[",V,"]=",y.link(function(te){return rt(An,y,m,te,2)}),"(",I,");",$,".call(this,a0,a1);"))}}Object.keys(m.state).length>0&&R(y.shared.current,".dirty=true;")}function Y(y,m){var R=y.proc("scope",3);y.batchId="a2";var B=y.shared,j=B.current;wt(y,R,m.context),m.framebuffer&&m.framebuffer.append(y,R),bo(Object.keys(m.state)).forEach(function(M){var P=m.state[M],A=P.append(y,R);gt(A)?A.forEach(function(I,_){R.set(y.next[M],"["+_+"]",I)}):R.set(B.next,"."+M,A)}),Qe(y,R,m,!0,!0),[vn,Tr,gn,br,_n].forEach(function(M){var P=m.draw[M];P&&R.set(B.draw,"."+M,""+P.append(y,R))}),Object.keys(m.uniforms).forEach(function(M){var P=m.uniforms[M].append(y,R);Array.isArray(P)&&(P="["+P.join()+"]"),R.set(B.uniforms,"["+v.id(M)+"]",P)}),Object.keys(m.attributes).forEach(function(M){var P=m.attributes[M].append(y,R),A=y.scopeAttrib(M);Object.keys(new U).forEach(function(I){R.set(A,"."+I,P[I])})}),m.scopeVAO&&R.set(B.vao,".targetVAO",m.scopeVAO.append(y,R));function F(M){var P=m.shader[M];P&&R.set(B.shader,"."+M,P.append(y,R))}F(Xn),F(Hn),Object.keys(m.state).length>0&&(R(j,".dirty=true;"),R.exit(j,".dirty=true;")),R("a1(",y.shared.context,",a0,",y.batchId,");")}function z(y){if(!(typeof y!="object"||gt(y))){for(var m=Object.keys(y),R=0;R<m.length;++R)if(Gt.isDynamic(y[m[R]]))return!0;return!1}}function ke(y,m,R){var B=m.static[R];if(!B||!z(B))return;var j=y.global,F=Object.keys(B),M=!1,P=!1,A=!1,I=y.global.def("{}");F.forEach(function(V){var $=B[V];if(Gt.isDynamic($)){typeof $=="function"&&($=B[V]=Gt.unbox($));var te=Bt($,null);M=M||te.thisDep,A=A||te.propDep,P=P||te.contextDep}else{switch(j(I,".",V,"="),typeof $){case"number":j($);break;case"string":j('"',$,'"');break;case"object":Array.isArray($)&&j("[",$.join(),"]");break;default:j(y.link($));break}j(";")}});function _(V,$){F.forEach(function(te){var re=B[te];if(Gt.isDynamic(re)){var ee=V.invoke($,re);$(I,".",te,"=",ee,";")}})}m.dynamic[R]=new Gt.DynamicVariable(yr,{thisDep:M,contextDep:P,propDep:A,ref:I,append:_}),delete m.static[R]}function nt(y,m,R,B,j){var F=Ue();F.stats=F.link(j),Object.keys(m.static).forEach(function(P){ke(F,m,P)}),pu.forEach(function(P){ke(F,y,P)});var M=xt(y,m,R,B,F);return At(F,M),Y(F,M),b(F,M),n(F.compile(),{destroy:function(){M.shader.program.destroy()}})}return{next:Ie,current:ae,procs:function(){var y=Ue(),m=y.proc("poll"),R=y.proc("refresh"),B=y.block();m(B),R(B);var j=y.shared,F=j.gl,M=j.next,P=j.current;B(P,".dirty=false;"),Et(y,m),Et(y,R,null,!0);var A;ve&&(A=y.link(ve)),w.oes_vertex_array_object&&R(y.link(w.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var I=0;I<H.maxAttributes;++I){var _=R.def(j.attributes,"[",I,"]"),V=y.cond(_,".buffer");V.then(F,".enableVertexAttribArray(",I,");",F,".bindBuffer(",Dn,",",_,".buffer.buffer);",F,".vertexAttribPointer(",I,",",_,".size,",_,".type,",_,".normalized,",_,".stride,",_,".offset);").else(F,".disableVertexAttribArray(",I,");",F,".vertexAttrib4f(",I,",",_,".x,",_,".y,",_,".z,",_,".w);",_,".buffer=null;"),R(V),ve&&R(A,".vertexAttribDivisorANGLE(",I,",",_,".divisor);")}return R(y.shared.vao,".currentVAO=null;",y.shared.vao,".setVAO(",y.shared.vao,".targetVAO);"),Object.keys(be).forEach(function($){var te=be[$],re=B.def(M,".",$),ee=y.block();ee("if(",re,"){",F,".enable(",te,")}else{",F,".disable(",te,")}",P,".",$,"=",re,";"),R(ee),m("if(",re,"!==",P,".",$,"){",ee,"}")}),Object.keys(ce).forEach(function($){var te=ce[$],re=ae[$],ee,me,Le=y.block();if(Le(F,".",te,"("),gt(re)){var Ke=re.length;ee=y.global.def(M,".",$),me=y.global.def(P,".",$),Le(Vt(Ke,function(Me){return ee+"["+Me+"]"}),");",Vt(Ke,function(Me){return me+"["+Me+"]="+ee+"["+Me+"];"}).join("")),m("if(",Vt(Ke,function(Me){return ee+"["+Me+"]!=="+me+"["+Me+"]"}).join("||"),"){",Le,"}")}else ee=B.def(M,".",$),me=B.def(P,".",$),Le(ee,");",P,".",$,"=",ee,";"),m("if(",ee,"!==",me,"){",Le,"}");R(Le)}),y.compile()}(),compile:nt}}function Fu(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Du=34918,Pu=34919,xo=35007,Lu=function(l,v){if(!v.ext_disjoint_timer_query)return null;var w=[];function H(){return w.pop()||v.ext_disjoint_timer_query.createQueryEXT()}function ne(ve){w.push(ve)}var X=[];function Z(ve){var Oe=H();v.ext_disjoint_timer_query.beginQueryEXT(xo,Oe),X.push(Oe),he(X.length-1,X.length,ve)}function le(){v.ext_disjoint_timer_query.endQueryEXT(xo)}function de(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var _e=[];function pe(){return _e.pop()||new de}function Ae(ve){_e.push(ve)}var Ne=[];function he(ve,Oe,ae){var Ie=pe();Ie.startQueryIndex=ve,Ie.endQueryIndex=Oe,Ie.sum=0,Ie.stats=ae,Ne.push(Ie)}var Te=[],U=[];function Q(){var ve,Oe,ae=X.length;if(ae!==0){U.length=Math.max(U.length,ae+1),Te.length=Math.max(Te.length,ae+1),Te[0]=0,U[0]=0;var Ie=0;for(ve=0,Oe=0;Oe<X.length;++Oe){var ue=X[Oe];v.ext_disjoint_timer_query.getQueryObjectEXT(ue,Pu)?(Ie+=v.ext_disjoint_timer_query.getQueryObjectEXT(ue,Du),ne(ue)):X[ve++]=ue,Te[Oe+1]=Ie,U[Oe+1]=ve}for(X.length=ve,ve=0,Oe=0;Oe<Ne.length;++Oe){var be=Ne[Oe],ce=be.startQueryIndex,Se=be.endQueryIndex;be.sum+=Te[Se]-Te[ce];var Ve=U[ce],ze=U[Se];ze===Ve?(be.stats.gpuTime+=be.sum/1e6,Ae(be)):(be.startQueryIndex=Ve,be.endQueryIndex=ze,Ne[ve++]=be)}Ne.length=ve}}return{beginQuery:Z,endQuery:le,pushScopeStats:he,update:Q,getNumPendingQueries:function(){return X.length},clear:function(){w.push.apply(w,X);for(var ve=0;ve<w.length;ve++)v.ext_disjoint_timer_query.deleteQueryEXT(w[ve]);X.length=0,w.length=0},restore:function(){X.length=0,w.length=0}}},Vu=16384,Bu=256,Gu=1024,Uu=34962,No="webglcontextlost",Co="webglcontextrestored",wo=1,Wu=2,qu=3;function Eo(l,v){for(var w=0;w<l.length;++w)if(l[w]===v)return w;return-1}function ju(l){var v=Uo(l);if(!v)return null;var w=v.gl,H=w.getContextAttributes(),ne=w.isContextLost(),X=Wo(w,v);if(!X)return null;var Z=Po(),le=Fu(),de=X.extensions,_e=Lu(w,de),pe=Di(),Ae=w.drawingBufferWidth,Ne=w.drawingBufferHeight,he={tick:0,time:0,viewportWidth:Ae,viewportHeight:Ne,framebufferWidth:Ae,framebufferHeight:Ne,drawingBufferWidth:Ae,drawingBufferHeight:Ne,pixelRatio:v.pixelRatio},Te={},U={elements:null,primitive:4,count:-1,offset:0,instances:-1},Q=Oa(w,de),ve=$a(w,le,v,ae),Oe=ru(w,de,Q,le,ve);function ae(Be){return Oe.destroyBuffer(Be)}var Ie=rc(w,de,ve,le),ue=au(w,Z,le,v),be=Fc(w,de,Q,function(){Ve.procs.poll()},he,le,v),ce=Dc(w,de,Q,le,v),Se=tu(w,de,Q,be,ce,le),Ve=Mu(w,Z,de,Q,ve,Ie,be,Se,Te,Oe,ue,U,he,_e,v),ze=lu(w,Se,Ve.procs.poll,he,H,de,Q),Ce=Ve.next,ge=w.canvas,oe=[],Ue=[],Ze=[],Re=[v.onDestroy],tt=null;function Xe(){if(oe.length===0){_e&&_e.update(),tt=null;return}tt=Dr.next(Xe),Rt();for(var Be=oe.length-1;Be>=0;--Be){var rt=oe[Be];rt&&rt(he,null,0)}w.flush(),_e&&_e.update()}function et(){!tt&&oe.length>0&&(tt=Dr.next(Xe))}function ot(){tt&&(Dr.cancel(Xe),tt=null)}function St(Be){Be.preventDefault(),ne=!0,ot(),Ue.forEach(function(rt){rt()})}function Ot(Be){w.getError(),ne=!1,X.restore(),ue.restore(),ve.restore(),be.restore(),ce.restore(),Se.restore(),Oe.restore(),_e&&_e.restore(),Ve.procs.refresh(),et(),Ze.forEach(function(rt){rt()})}ge&&(ge.addEventListener(No,St,!1),ge.addEventListener(Co,Ot,!1));function it(){oe.length=0,ot(),ge&&(ge.removeEventListener(No,St),ge.removeEventListener(Co,Ot)),ue.clear(),Se.clear(),ce.clear(),be.clear(),Ie.clear(),ve.clear(),Oe.clear(),_e&&_e.clear(),Re.forEach(function(Be){Be()})}function Ct(Be){g(!!Be,"invalid args to regl({...})"),g.type(Be,"object","invalid args to regl({...})");function rt(j){var F=n({},j);delete F.uniforms,delete F.attributes,delete F.context,delete F.vao,"stencil"in F&&F.stencil.op&&(F.stencil.opBack=F.stencil.opFront=F.stencil.op,delete F.stencil.op);function M(P){if(P in F){var A=F[P];delete F[P],Object.keys(A).forEach(function(I){F[P+"."+I]=A[I]})}}return M("blend"),M("depth"),M("cull"),M("stencil"),M("polygonOffset"),M("scissor"),M("sample"),"vao"in j&&(F.vao=j.vao),F}function st(j,F){var M={},P={};return Object.keys(j).forEach(function(A){var I=j[A];if(Gt.isDynamic(I)){P[A]=Gt.unbox(I,A);return}else if(F&&Array.isArray(I)){for(var _=0;_<I.length;++_)if(Gt.isDynamic(I[_])){P[A]=Gt.unbox(I,A);return}}M[A]=I}),{dynamic:P,static:M}}var At=st(Be.context||{},!0),Zt=st(Be.uniforms||{},!0),An=st(Be.attributes||{},!1),b=st(rt(Be),!1),Y={gpuTime:0,cpuTime:0,count:0},z=Ve.compile(b,An,Zt,At,Y),ke=z.draw,nt=z.batch,y=z.scope,m=[];function R(j){for(;m.length<j;)m.push(null);return m}function B(j,F){var M;if(ne&&g.raise("context lost"),typeof j=="function")return y.call(this,null,j,0);if(typeof F=="function")if(typeof j=="number")for(M=0;M<j;++M)y.call(this,null,F,M);else if(Array.isArray(j))for(M=0;M<j.length;++M)y.call(this,j[M],F,M);else return y.call(this,j,F,0);else if(typeof j=="number"){if(j>0)return nt.call(this,R(j|0),j|0)}else if(Array.isArray(j)){if(j.length)return nt.call(this,j,j.length)}else return ke.call(this,j)}return n(B,{stats:Y,destroy:function(){z.destroy()}})}var mt=Se.setFBO=Ct({framebuffer:Gt.define.call(null,wo,"framebuffer")});function xt(Be,rt){var st=0;Ve.procs.poll();var At=rt.color;At&&(w.clearColor(+At[0]||0,+At[1]||0,+At[2]||0,+At[3]||0),st|=Vu),"depth"in rt&&(w.clearDepth(+rt.depth),st|=Bu),"stencil"in rt&&(w.clearStencil(rt.stencil|0),st|=Gu),g(!!st,"called regl.clear with no buffer specified"),w.clear(st)}function wt(Be){if(g(typeof Be=="object"&&Be,"regl.clear() takes an object as input"),"framebuffer"in Be)if(Be.framebuffer&&Be.framebuffer_reglType==="framebufferCube")for(var rt=0;rt<6;++rt)mt(n({framebuffer:Be.framebuffer.faces[rt]},Be),xt);else mt(Be,xt);else xt(null,Be)}function Et(Be){g.type(Be,"function","regl.frame() callback must be a function"),oe.push(Be);function rt(){var st=Eo(oe,Be);g(st>=0,"cannot cancel a frame twice");function At(){var Zt=Eo(oe,At);oe[Zt]=oe[oe.length-1],oe.length-=1,oe.length<=0&&ot()}oe[st]=At}return et(),{cancel:rt}}function It(){var Be=Ce.viewport,rt=Ce.scissor_box;Be[0]=Be[1]=rt[0]=rt[1]=0,he.viewportWidth=he.framebufferWidth=he.drawingBufferWidth=Be[2]=rt[2]=w.drawingBufferWidth,he.viewportHeight=he.framebufferHeight=he.drawingBufferHeight=Be[3]=rt[3]=w.drawingBufferHeight}function Rt(){he.tick+=1,he.time=Qe(),It(),Ve.procs.poll()}function yt(){be.refresh(),It(),Ve.procs.refresh(),_e&&_e.update()}function Qe(){return(Di()-pe)/1e3}yt();function Mt(Be,rt){g.type(rt,"function","listener callback must be a function");var st;switch(Be){case"frame":return Et(rt);case"lost":st=Ue;break;case"restore":st=Ze;break;case"destroy":st=Re;break;default:g.raise("invalid event, must be one of frame,lost,restore,destroy")}return st.push(rt),{cancel:function(){for(var At=0;At<st.length;++At)if(st[At]===rt){st[At]=st[st.length-1],st.pop();return}}}}var ut=n(Ct,{clear:wt,prop:Gt.define.bind(null,wo),context:Gt.define.bind(null,Wu),this:Gt.define.bind(null,qu),draw:Ct({}),buffer:function(Be){return ve.create(Be,Uu,!1,!1)},elements:function(Be){return Ie.create(Be,!1)},texture:be.create2D,cube:be.createCube,renderbuffer:ce.create,framebuffer:Se.create,framebufferCube:Se.createCube,vao:Oe.createVAO,attributes:H,frame:Et,on:Mt,limits:Q,hasExtension:function(Be){return Q.extensions.indexOf(Be.toLowerCase())>=0},read:ze,destroy:it,_gl:w,_refresh:yt,poll:function(){Rt(),_e&&_e.update()},now:Qe,stats:le});return v.onDone(null,ut),ut}return ju})})(regl$1);var reglExports=regl$1.exports;const regl=getDefaultExportFromCjs(reglExports),Mouse=mouseListen();class HydraRenderer{constructor({pb:e=null,width:t=1280,height:n=720,numSources:s=4,numOutputs:o=4,makeGlobal:u=!0,autoLoop:c=!0,detectAudio:h=!0,enableStreamCapture:f=!0,canvas:d,precision:p,extendTransforms:S={}}={}){if(ArrayUtils.init(),this.pb=e,this.width=t,this.height=n,this.renderAll=!1,this.detectAudio=h,this._initCanvas(d),global.window.test="hi",this.synth={time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{fps:0},speed:1,mouse:Mouse,render:this._render.bind(this),setResolution:this.setResolution.bind(this),update:N=>{},hush:this.hush.bind(this),tick:this.tick.bind(this)},u&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,p&&["lowp","mediump","highp"].includes(p.toLowerCase()))this.precision=p.toLowerCase();else{let N=(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=N?"highp":"mediump"}if(this.extendTransforms=S,this.saveFrame=!1,this.captureStream=null,this.generator=void 0,this._initRegl(),this._initOutputs(o),this._initSources(s),this._generateGlslTransforms(),this.synth.screencap=()=>{this.saveFrame=!0},f)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new VideoRecorder(this.captureStream)}catch(N){console.warn(`[hydra-synth warning]
new MediaSource() is not currently supported on iOS.`),console.error(N)}h&&this._initAudio(),c&&loop(this.tick.bind(this)).start(),this.sandbox=new EvalSandbox(this.synth,u,["speed","update","bpm","fps"])}eval(e){this.sandbox.eval(e)}getScreenImage(e){this.imageCallback=e,this.saveFrame=!0}hush(){this.s.forEach(e=>{e.clear()}),this.o.forEach(e=>{this.synth.solid(0,0,0,0).out(e)}),this.synth.render(this.o[0]),this.sandbox.set("update",e=>{})}loadScript(e=""){return new Promise((n,s)=>{var o=document.createElement("script");o.onload=function(){console.log(`loaded script ${e}`),n()},o.onerror=u=>{console.log(`error loading script ${e}`,"log-error"),n()},o.src=e,document.head.appendChild(o)})}setResolution(e,t){this.canvas.width=e,this.canvas.height=t,this.width=e,this.height=t,this.sandbox.set("width",e),this.sandbox.set("height",t),console.log(this.width),this.o.forEach(n=>{n.resize(e,t)}),this.s.forEach(n=>{n.resize(e,t)}),this.regl._refresh(),console.log(this.canvas.width)}canvasToImage(e){const t=document.createElement("a");t.style.display="none";let n=new Date;t.download=`hydra-${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}-${n.getHours()}.${n.getMinutes()}.${n.getSeconds()}.png`,document.body.appendChild(t);var s=this;this.canvas.toBlob(o=>{s.imageCallback?(s.imageCallback(o),delete s.imageCallback):(t.href=URL.createObjectURL(o),console.log(t.href),t.click())},"image/png"),setTimeout(()=>{document.body.removeChild(t),window.URL.revokeObjectURL(t.href)},300)}_initAudio(){this.synth.a=new Audio({numBins:4,parentEl:this.canvas.parentNode})}_initCanvas(e){e?(this.canvas=e,this.width=e.width,this.height=e.height):(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",document.body.appendChild(this.canvas))}_initRegl(){this.regl=regl({canvas:this.canvas,pixelRatio:1}),this.regl.clear({color:[0,0,0,1]}),this.renderAll=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform sampler2D tex0;
      uniform sampler2D tex1;
      uniform sampler2D tex2;
      uniform sampler2D tex3;

      void main () {
        vec2 st = vec2(1.0 - uv.x, uv.y);
        st*= vec2(2);
        vec2 q = floor(st).xy*(vec2(2.0, 1.0));
        int quad = int(q.x) + int(q.y);
        st.x += step(1., mod(st.y,2.0));
        st.y += step(1., mod(st.x,2.0));
        st = fract(st);
        if(quad==0){
          gl_FragColor = texture2D(tex0, st);
        } else if(quad==1){
          gl_FragColor = texture2D(tex1, st);
        } else if (quad==2){
          gl_FragColor = texture2D(tex2, st);
        } else {
          gl_FragColor = texture2D(tex3, st);
        }

      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),tex1:this.regl.prop("tex1"),tex2:this.regl.prop("tex2"),tex3:this.regl.prop("tex3")},count:3,depth:{enable:!1}}),this.renderFbo=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform vec2 resolution;
      uniform sampler2D tex0;

      void main () {
        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));
      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),resolution:this.regl.prop("resolution")},count:3,depth:{enable:!1}})}_initOutputs(e){const t=this;this.o=Array(e).fill().map((n,s)=>{var o=new Output({regl:this.regl,width:this.width,height:this.height,precision:this.precision,label:`o${s}`});return o.id=s,t.synth["o"+s]=o,o}),this.output=this.o[0]}_initSources(e){this.s=[];for(var t=0;t<e;t++)this.createSource(t)}createSource(e){let t=new HydraSource({regl:this.regl,pb:this.pb,width:this.width,height:this.height,label:`s${e}`});return this.synth["s"+this.s.length]=t,this.s.push(t),t}_generateGlslTransforms(){var e=this;this.generator=new GeneratorFactory({defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener:({type:t,method:n,synth:s})=>{t==="add"&&(e.synth[n]=s.generators[n],e.sandbox&&e.sandbox.add(n))}}),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render(e){e?(this.output=e,this.isRenderingAll=!1):this.isRenderingAll=!0}tick(e,t){if(this.sandbox.tick(),this.detectAudio===!0&&this.synth.a.tick(),this.sandbox.set("time",this.synth.time+=e*.001*this.synth.speed),this.timeSinceLastUpdate+=e,!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps){if(this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate),this.synth.update)try{this.synth.update(this.timeSinceLastUpdate)}catch(n){console.log(n)}for(let n=0;n<this.s.length;n++)this.s[n].tick(this.synth.time);for(let n=0;n<this.o.length;n++)this.o[n].tick({time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height]});this.isRenderingAll?this.renderAll({tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height]}):this.renderFbo({tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height]}),this.timeSinceLastUpdate=0}this.saveFrame===!0&&(this.canvasToImage(),this.saveFrame=!1)}}const version="14.7.77",createExtendedExponentialRampToValueAutomationEvent=(r,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:r}),createExtendedLinearRampToValueAutomationEvent=(r,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:r}),createSetValueAutomationEvent=(r,e)=>({startTime:e,type:"setValue",value:r}),createSetValueCurveAutomationEvent=(r,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:r}),getTargetValueAtTime=(r,e,{startTime:t,target:n,timeConstant:s})=>n+(e-n)*Math.exp((t-r)/s),isExponentialRampToValueAutomationEvent=r=>r.type==="exponentialRampToValue",isLinearRampToValueAutomationEvent=r=>r.type==="linearRampToValue",isAnyRampToValueAutomationEvent=r=>isExponentialRampToValueAutomationEvent(r)||isLinearRampToValueAutomationEvent(r),isSetValueAutomationEvent=r=>r.type==="setValue",isSetValueCurveAutomationEvent=r=>r.type==="setValueCurve",getValueOfAutomationEventAtIndexAtTime=(r,e,t,n)=>{const s=r[e];return s===void 0?n:isAnyRampToValueAutomationEvent(s)||isSetValueAutomationEvent(s)?s.value:isSetValueCurveAutomationEvent(s)?s.values[s.values.length-1]:getTargetValueAtTime(t,getValueOfAutomationEventAtIndexAtTime(r,e-1,s.startTime,n),s)},getEndTimeAndValueOfPreviousAutomationEvent=(r,e,t,n,s)=>t===void 0?[n.insertTime,s]:isAnyRampToValueAutomationEvent(t)?[t.endTime,t.value]:isSetValueAutomationEvent(t)?[t.startTime,t.value]:isSetValueCurveAutomationEvent(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,getValueOfAutomationEventAtIndexAtTime(r,e-1,t.startTime,s)],isCancelAndHoldAutomationEvent=r=>r.type==="cancelAndHold",isCancelScheduledValuesAutomationEvent=r=>r.type==="cancelScheduledValues",getEventTime=r=>isCancelAndHoldAutomationEvent(r)||isCancelScheduledValuesAutomationEvent(r)?r.cancelTime:isExponentialRampToValueAutomationEvent(r)||isLinearRampToValueAutomationEvent(r)?r.endTime:r.startTime,getExponentialRampValueAtTime=(r,e,t,{endTime:n,value:s})=>t===s?s:0<t&&0<s||t<0&&s<0?t*(s/t)**((r-e)/(n-e)):0,getLinearRampValueAtTime=(r,e,t,{endTime:n,value:s})=>t+(r-e)/(n-e)*(s-t),interpolateValue=(r,e)=>{const t=Math.floor(e),n=Math.ceil(e);return t===n?r[t]:(1-(e-t))*r[t]+(1-(n-e))*r[n]},getValueCurveValueAtTime=(r,{duration:e,startTime:t,values:n})=>{const s=(r-t)/e*(n.length-1);return interpolateValue(n,s)},isSetTargetAutomationEvent=r=>r.type==="setTarget";class AutomationEventList{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=getEventTime(e);if(isCancelAndHoldAutomationEvent(e)||isCancelScheduledValuesAutomationEvent(e)){const n=this._automationEvents.findIndex(o=>isCancelScheduledValuesAutomationEvent(e)&&isSetValueCurveAutomationEvent(o)?o.startTime+o.duration>=t:getEventTime(o)>=t),s=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),isCancelAndHoldAutomationEvent(e)){const o=this._automationEvents[this._automationEvents.length-1];if(s!==void 0&&isAnyRampToValueAutomationEvent(s)){if(o!==void 0&&isSetTargetAutomationEvent(o))throw new Error("The internal list is malformed.");const u=o===void 0?s.insertTime:isSetValueCurveAutomationEvent(o)?o.startTime+o.duration:getEventTime(o),c=o===void 0?this._defaultValue:isSetValueCurveAutomationEvent(o)?o.values[o.values.length-1]:o.value,h=isExponentialRampToValueAutomationEvent(s)?getExponentialRampValueAtTime(t,u,c,s):getLinearRampValueAtTime(t,u,c,s),f=isExponentialRampToValueAutomationEvent(s)?createExtendedExponentialRampToValueAutomationEvent(h,t,this._currenTime):createExtendedLinearRampToValueAutomationEvent(h,t,this._currenTime);this._automationEvents.push(f)}if(o!==void 0&&isSetTargetAutomationEvent(o)&&this._automationEvents.push(createSetValueAutomationEvent(this.getValue(t),t)),o!==void 0&&isSetValueCurveAutomationEvent(o)&&o.startTime+o.duration>t){const u=t-o.startTime,c=(o.values.length-1)/o.duration,h=Math.max(2,1+Math.ceil(u*c)),f=u/(h-1)*c,d=o.values.slice(0,h);if(f<1)for(let p=1;p<h;p+=1){const S=f*p%1;d[p]=o.values[p-1]*(1-S)+o.values[p]*S}this._automationEvents[this._automationEvents.length-1]=createSetValueCurveAutomationEvent(d,o.startTime,u)}}}else{const n=this._automationEvents.findIndex(u=>getEventTime(u)>t),s=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(s!==void 0&&isSetValueCurveAutomationEvent(s)&&getEventTime(s)+s.duration>t)return!1;const o=isExponentialRampToValueAutomationEvent(e)?createExtendedExponentialRampToValueAutomationEvent(e.value,e.endTime,this._currenTime):isLinearRampToValueAutomationEvent(e)?createExtendedLinearRampToValueAutomationEvent(e.value,t,this._currenTime):e;if(n===-1)this._automationEvents.push(o);else{if(isSetValueCurveAutomationEvent(e)&&t+e.duration>getEventTime(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,o)}}return!0}flush(e){const t=this._automationEvents.findIndex(n=>getEventTime(n)>e);if(t>1){const n=this._automationEvents.slice(t-1),s=n[0];isSetTargetAutomationEvent(s)&&n.unshift(createSetValueAutomationEvent(getValueOfAutomationEventAtIndexAtTime(this._automationEvents,t-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(u=>getEventTime(u)>e),n=this._automationEvents[t],s=(t===-1?this._automationEvents.length:t)-1,o=this._automationEvents[s];if(o!==void 0&&isSetTargetAutomationEvent(o)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)||n.insertTime>e))return getTargetValueAtTime(e,getValueOfAutomationEventAtIndexAtTime(this._automationEvents,s-1,o.startTime,this._defaultValue),o);if(o!==void 0&&isSetValueAutomationEvent(o)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)))return o.value;if(o!==void 0&&isSetValueCurveAutomationEvent(o)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)||o.startTime+o.duration>e))return e<o.startTime+o.duration?getValueCurveValueAtTime(e,o):o.values[o.values.length-1];if(o!==void 0&&isAnyRampToValueAutomationEvent(o)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)))return o.value;if(n!==void 0&&isExponentialRampToValueAutomationEvent(n)){const[u,c]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,s,o,n,this._defaultValue);return getExponentialRampValueAtTime(e,u,c,n)}if(n!==void 0&&isLinearRampToValueAutomationEvent(n)){const[u,c]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,s,o,n,this._defaultValue);return getLinearRampValueAtTime(e,u,c,n)}return this._defaultValue}}const createCancelAndHoldAutomationEvent=r=>({cancelTime:r,type:"cancelAndHold"}),createCancelScheduledValuesAutomationEvent=r=>({cancelTime:r,type:"cancelScheduledValues"}),createExponentialRampToValueAutomationEvent=(r,e)=>({endTime:e,type:"exponentialRampToValue",value:r}),createLinearRampToValueAutomationEvent=(r,e)=>({endTime:e,type:"linearRampToValue",value:r}),createSetTargetAutomationEvent=(r,e,t)=>({startTime:e,target:r,timeConstant:t,type:"setTarget"}),createAbortError=()=>new DOMException("","AbortError"),createAddActiveInputConnectionToAudioNode=r=>(e,t,[n,s,o],u)=>{r(e[s],[t,n,o],c=>c[0]===t&&c[1]===n,u)},createAddAudioNodeConnections=r=>(e,t,n)=>{const s=[];for(let o=0;o<n.numberOfInputs;o+=1)s.push(new Set);r.set(e,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},createAddAudioParamConnections=r=>(e,t)=>{r.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},ACTIVE_AUDIO_NODE_STORE=new WeakSet,AUDIO_NODE_CONNECTIONS_STORE=new WeakMap,AUDIO_NODE_STORE=new WeakMap,AUDIO_PARAM_CONNECTIONS_STORE=new WeakMap,AUDIO_PARAM_STORE=new WeakMap,CONTEXT_STORE=new WeakMap,EVENT_LISTENERS=new WeakMap,CYCLE_COUNTERS=new WeakMap,NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS=new WeakMap,NODE_TO_PROCESSOR_MAPS=new WeakMap,handler={construct(){return handler}},isConstructible=r=>{try{const e=new Proxy(r,handler);new e}catch{return!1}return!0},IMPORT_STATEMENT_REGEX=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,splitImportStatements=(r,e)=>{const t=[];let n=r.replace(/^[\s]+/,""),s=n.match(IMPORT_STATEMENT_REGEX);for(;s!==null;){const o=s[1].slice(1,-1),u=s[0].replace(/([\s]+)?;?$/,"").replace(o,new URL(o,e).toString());t.push(u),n=n.slice(s[0].length).replace(/^[\s]+/,""),s=n.match(IMPORT_STATEMENT_REGEX)}return[t.join(";"),n]},verifyParameterDescriptors=r=>{if(r!==void 0&&!Array.isArray(r))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},verifyProcessorCtor=r=>{if(!isConstructible(r))throw new TypeError("The given value for processorCtor should be a constructor.");if(r.prototype===null||typeof r.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},createAddAudioWorkletModule=(r,e,t,n,s,o,u,c,h,f,d,p,S)=>{let E=0;return(N,D,L={credentials:"omit"})=>{const W=d.get(N);if(W!==void 0&&W.has(D))return Promise.resolve();const K=f.get(N);if(K!==void 0){const G=K.get(D);if(G!==void 0)return G}const se=o(N),ye=se.audioWorklet===void 0?s(D).then(([G,C])=>{const[T,O]=splitImportStatements(G,C),k=`${T};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${O}
})})(window,'_AWGS')`;return t(k)}).then(()=>{const G=S._AWGS.pop();if(G===void 0)throw new SyntaxError;n(se.currentTime,se.sampleRate,()=>G(class{},void 0,(C,T)=>{if(C.trim()==="")throw e();const O=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(se);if(O!==void 0){if(O.has(C))throw e();verifyProcessorCtor(T),verifyParameterDescriptors(T.parameterDescriptors),O.set(C,T)}else verifyProcessorCtor(T),verifyParameterDescriptors(T.parameterDescriptors),NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.set(se,new Map([[C,T]]))},se.sampleRate,void 0,void 0))}):Promise.all([s(D),Promise.resolve(r(p,p))]).then(([[G,C],T])=>{const O=E+1;E=O;const[k,q]=splitImportStatements(G,C),fe=`${k};((AudioWorkletProcessor,registerProcessor)=>{${q}
})(${T?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${T?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${T?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${O}',class extends AudioWorkletProcessor{process(){return !1}})`,we=new Blob([fe],{type:"application/javascript; charset=utf-8"}),Ee=URL.createObjectURL(we);return se.audioWorklet.addModule(Ee,L).then(()=>{if(c(se))return se;const De=u(se);return De.audioWorklet.addModule(Ee,L).then(()=>De)}).then(De=>{if(h===null)throw new SyntaxError;try{new h(De,`__sac${O}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(Ee))});return K===void 0?f.set(N,new Map([[D,ye]])):K.set(D,ye),ye.then(()=>{const G=d.get(N);G===void 0?d.set(N,new Set([D])):G.add(D)}).finally(()=>{const G=f.get(N);G!==void 0&&G.delete(D)}),ye}},getValueForKey=(r,e)=>{const t=r.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},pickElementFromSet=(r,e)=>{const t=Array.from(r).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[n]=t;return r.delete(n),n},deletePassiveInputConnectionToAudioNode=(r,e,t,n)=>{const s=getValueForKey(r,e),o=pickElementFromSet(s,u=>u[0]===t&&u[1]===n);return s.size===0&&r.delete(e),o},getEventListenersOfAudioNode=r=>getValueForKey(EVENT_LISTENERS,r),setInternalStateToActive=r=>{if(ACTIVE_AUDIO_NODE_STORE.has(r))throw new Error("The AudioNode is already stored.");ACTIVE_AUDIO_NODE_STORE.add(r),getEventListenersOfAudioNode(r).forEach(e=>e(!0))},isAudioWorkletNode=r=>"port"in r,setInternalStateToPassive=r=>{if(!ACTIVE_AUDIO_NODE_STORE.has(r))throw new Error("The AudioNode is not stored.");ACTIVE_AUDIO_NODE_STORE.delete(r),getEventListenersOfAudioNode(r).forEach(e=>e(!1))},setInternalStateToPassiveWhenNecessary=(r,e)=>{!isAudioWorkletNode(r)&&e.every(t=>t.size===0)&&setInternalStateToPassive(r)},createAddConnectionToAudioNode=(r,e,t,n,s,o,u,c,h,f,d,p,S)=>{const E=new WeakMap;return(N,D,L,W,K)=>{const{activeInputs:se,passiveInputs:ye}=o(D),{outputs:G}=o(N),C=c(N),T=O=>{const k=h(D),q=h(N);if(O){const J=deletePassiveInputConnectionToAudioNode(ye,N,L,W);r(se,N,J,!1),!K&&!p(N)&&t(q,k,L,W),S(D)&&setInternalStateToActive(D)}else{const J=n(se,N,L,W);e(ye,W,J,!1),!K&&!p(N)&&s(q,k,L,W);const ie=u(D);if(ie===0)d(D)&&setInternalStateToPassiveWhenNecessary(D,se);else{const xe=E.get(D);xe!==void 0&&clearTimeout(xe),E.set(D,setTimeout(()=>{d(D)&&setInternalStateToPassiveWhenNecessary(D,se)},ie*1e3))}}};return f(G,[D,L,W],O=>O[0]===D&&O[1]===L&&O[2]===W,!0)?(C.add(T),d(N)?r(se,N,[L,W,T],!0):e(ye,W,[N,L,T],!0),!0):!1}},createAddPassiveInputConnectionToAudioNode=r=>(e,t,[n,s,o],u)=>{const c=e.get(n);c===void 0?e.set(n,new Set([[s,t,o]])):r(c,[s,t,o],h=>h[0]===s&&h[1]===t,u)},createAddSilentConnection=r=>(e,t)=>{const n=r(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const s=()=>{t.removeEventListener("ended",s),t.disconnect(n),n.disconnect()};t.addEventListener("ended",s)},createAddUnrenderedAudioWorkletNode=r=>(e,t)=>{r(e).add(t)},DEFAULT_OPTIONS$j={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},createAnalyserNodeConstructor=(r,e,t,n,s,o)=>class extends r{constructor(c,h){const f=s(c),d={...DEFAULT_OPTIONS$j,...h},p=n(f,d),S=o(f)?e():null;super(c,!1,p,S),this._nativeAnalyserNode=p}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(c){this._nativeAnalyserNode.fftSize=c}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(c){const h=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=c,!(c>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=h,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(c){const h=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=c,!(this._nativeAnalyserNode.maxDecibels>c))throw this._nativeAnalyserNode.minDecibels=h,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(c){this._nativeAnalyserNode.smoothingTimeConstant=c}getByteFrequencyData(c){this._nativeAnalyserNode.getByteFrequencyData(c)}getByteTimeDomainData(c){this._nativeAnalyserNode.getByteTimeDomainData(c)}getFloatFrequencyData(c){this._nativeAnalyserNode.getFloatFrequencyData(c)}getFloatTimeDomainData(c){this._nativeAnalyserNode.getFloatTimeDomainData(c)}},isOwnedByContext=(r,e)=>r.context===e,createAnalyserNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(o,u)=>{let c=e(o);if(!isOwnedByContext(c,u)){const f={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,fftSize:c.fftSize,maxDecibels:c.maxDecibels,minDecibels:c.minDecibels,smoothingTimeConstant:c.smoothingTimeConstant};c=r(u,f)}return n.set(u,c),await t(o,u,c),c};return{render(o,u){const c=n.get(u);return c!==void 0?Promise.resolve(c):s(o,u)}}},testAudioBufferCopyChannelMethodsOutOfBoundsSupport=r=>{try{r.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},createIndexSizeError=()=>new DOMException("","IndexSizeError"),wrapAudioBufferGetChannelDataMethod=r=>{r.getChannelData=(e=>t=>{try{return e.call(r,t)}catch(n){throw n.code===12?createIndexSizeError():n}})(r.getChannelData)},DEFAULT_OPTIONS$i={numberOfChannels:1},createAudioBufferConstructor=(r,e,t,n,s,o,u,c)=>{let h=null;return class ko{constructor(d){if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:p,numberOfChannels:S,sampleRate:E}={...DEFAULT_OPTIONS$i,...d};h===null&&(h=new s(1,1,44100));const N=n!==null&&e(o,o)?new n({length:p,numberOfChannels:S,sampleRate:E}):h.createBuffer(S,p,E);if(N.numberOfChannels===0)throw t();return typeof N.copyFromChannel!="function"?(u(N),wrapAudioBufferGetChannelDataMethod(N)):e(testAudioBufferCopyChannelMethodsOutOfBoundsSupport,()=>testAudioBufferCopyChannelMethodsOutOfBoundsSupport(N))||c(N),r.add(N),N}static[Symbol.hasInstance](d){return d!==null&&typeof d=="object"&&Object.getPrototypeOf(d)===ko.prototype||r.has(d)}}},MOST_NEGATIVE_SINGLE_FLOAT=-34028234663852886e22,MOST_POSITIVE_SINGLE_FLOAT=-MOST_NEGATIVE_SINGLE_FLOAT,isActiveAudioNode=r=>ACTIVE_AUDIO_NODE_STORE.has(r),DEFAULT_OPTIONS$h={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},createAudioBufferSourceNodeConstructor=(r,e,t,n,s,o,u,c)=>class extends r{constructor(f,d){const p=o(f),S={...DEFAULT_OPTIONS$h,...d},E=s(p,S),N=u(p),D=N?e():null;super(f,!1,E,D),this._audioBufferSourceNodeRenderer=D,this._isBufferNullified=!1,this._isBufferSet=S.buffer!==null,this._nativeAudioBufferSourceNode=E,this._onended=null,this._playbackRate=t(this,N,E.playbackRate,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(f){if(this._nativeAudioBufferSourceNode.buffer=f,f!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(f){this._nativeAudioBufferSourceNode.loop=f}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(f){this._nativeAudioBufferSourceNode.loopEnd=f}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(f){this._nativeAudioBufferSourceNode.loopStart=f}get onended(){return this._onended}set onended(f){const d=typeof f=="function"?c(this,f):null;this._nativeAudioBufferSourceNode.onended=d;const p=this._nativeAudioBufferSourceNode.onended;this._onended=p!==null&&p===d?f:p}get playbackRate(){return this._playbackRate}start(f=0,d=0,p){if(this._nativeAudioBufferSourceNode.start(f,d,p),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=p===void 0?[f,d]:[f,d,p]),this.context.state!=="closed"){setInternalStateToActive(this);const S=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",S),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",S)}}stop(f=0){this._nativeAudioBufferSourceNode.stop(f),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=f)}},createAudioBufferSourceNodeRendererFactory=(r,e,t,n,s)=>()=>{const o=new WeakMap;let u=null,c=null;const h=async(f,d)=>{let p=t(f);const S=isOwnedByContext(p,d);if(!S){const E={buffer:p.buffer,channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,loop:p.loop,loopEnd:p.loopEnd,loopStart:p.loopStart,playbackRate:p.playbackRate.value};p=e(d,E),u!==null&&p.start(...u),c!==null&&p.stop(c)}return o.set(d,p),S?await r(d,f.playbackRate,p.playbackRate):await n(d,f.playbackRate,p.playbackRate),await s(f,d,p),p};return{set start(f){u=f},set stop(f){c=f},render(f,d){const p=o.get(d);return p!==void 0?Promise.resolve(p):h(f,d)}}},isAudioBufferSourceNode=r=>"playbackRate"in r,isBiquadFilterNode=r=>"frequency"in r&&"gain"in r,isConstantSourceNode=r=>"offset"in r,isGainNode=r=>!("frequency"in r)&&"gain"in r,isOscillatorNode=r=>"detune"in r&&"frequency"in r,isStereoPannerNode=r=>"pan"in r,getAudioNodeConnections=r=>getValueForKey(AUDIO_NODE_CONNECTIONS_STORE,r),getAudioParamConnections=r=>getValueForKey(AUDIO_PARAM_CONNECTIONS_STORE,r),deactivateActiveAudioNodeInputConnections=(r,e)=>{const{activeInputs:t}=getAudioNodeConnections(r);t.forEach(s=>s.forEach(([o])=>{e.includes(r)||deactivateActiveAudioNodeInputConnections(o,[...e,r])}));const n=isAudioBufferSourceNode(r)?[r.playbackRate]:isAudioWorkletNode(r)?Array.from(r.parameters.values()):isBiquadFilterNode(r)?[r.Q,r.detune,r.frequency,r.gain]:isConstantSourceNode(r)?[r.offset]:isGainNode(r)?[r.gain]:isOscillatorNode(r)?[r.detune,r.frequency]:isStereoPannerNode(r)?[r.pan]:[];for(const s of n){const o=getAudioParamConnections(s);o!==void 0&&o.activeInputs.forEach(([u])=>deactivateActiveAudioNodeInputConnections(u,e))}isActiveAudioNode(r)&&setInternalStateToPassive(r)},deactivateAudioGraph=r=>{deactivateActiveAudioNodeInputConnections(r.destination,[])},isValidLatencyHint=r=>r===void 0||typeof r=="number"||typeof r=="string"&&(r==="balanced"||r==="interactive"||r==="playback"),createAudioContextConstructor=(r,e,t,n,s,o,u,c,h)=>class extends r{constructor(d={}){if(h===null)throw new Error("Missing the native AudioContext constructor.");let p;try{p=new h(d)}catch(N){throw N.code===12&&N.message==="sampleRate is not in range"?t():N}if(p===null)throw n();if(!isValidLatencyHint(d.latencyHint))throw new TypeError(`The provided value '${d.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(d.sampleRate!==void 0&&p.sampleRate!==d.sampleRate)throw t();super(p,2);const{latencyHint:S}=d,{sampleRate:E}=p;if(this._baseLatency=typeof p.baseLatency=="number"?p.baseLatency:S==="balanced"?512/E:S==="interactive"||S===void 0?256/E:S==="playback"?1024/E:Math.max(2,Math.min(128,Math.round(S*E/128)))*128/E,this._nativeAudioContext=p,h.name==="webkitAudioContext"?(this._nativeGainNode=p.createGain(),this._nativeOscillatorNode=p.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(p.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,p.state==="running"){this._state="suspended";const N=()=>{this._state==="suspended"&&(this._state=null),p.removeEventListener("statechange",N)};p.addEventListener("statechange",N)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),deactivateAudioGraph(this)}))}createMediaElementSource(d){return new s(this,{mediaElement:d})}createMediaStreamDestination(){return new o(this)}createMediaStreamSource(d){return new u(this,{mediaStream:d})}createMediaStreamTrackSource(d){return new c(this,{mediaStreamTrack:d})}resume(){return this._state==="suspended"?new Promise((d,p)=>{const S=()=>{this._nativeAudioContext.removeEventListener("statechange",S),this._nativeAudioContext.state==="running"?d():this.resume().then(d,p)};this._nativeAudioContext.addEventListener("statechange",S)}):this._nativeAudioContext.resume().catch(d=>{throw d===void 0||d.code===15?e():d})}suspend(){return this._nativeAudioContext.suspend().catch(d=>{throw d===void 0?e():d})}},createAudioDestinationNodeConstructor=(r,e,t,n,s,o,u,c)=>class extends r{constructor(f,d){const p=o(f),S=u(p),E=s(p,d,S),N=S?e(c):null;super(f,!1,E,N),this._isNodeOfNativeOfflineAudioContext=S,this._nativeAudioDestinationNode=E}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(f){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(f>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=f}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(f){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=f}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},createAudioDestinationNodeRenderer=r=>{const e=new WeakMap,t=async(n,s)=>{const o=s.destination;return e.set(s,o),await r(n,s,o),o};return{render(n,s){const o=e.get(s);return o!==void 0?Promise.resolve(o):t(n,s)}}},createAudioListenerFactory=(r,e,t,n,s,o,u,c)=>(h,f)=>{const d=f.listener,p=()=>{const G=new Float32Array(1),C=e(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),T=u(f);let O=!1,k=[0,0,-1,0,1,0],q=[0,0,0];const J=()=>{if(O)return;O=!0;const we=n(f,256,9,0);we.onaudioprocess=({inputBuffer:Ee})=>{const De=[o(Ee,G,0),o(Ee,G,1),o(Ee,G,2),o(Ee,G,3),o(Ee,G,4),o(Ee,G,5)];De.some((We,je)=>We!==k[je])&&(d.setOrientation(...De),k=De);const Fe=[o(Ee,G,6),o(Ee,G,7),o(Ee,G,8)];Fe.some((We,je)=>We!==q[je])&&(d.setPosition(...Fe),q=Fe)},C.connect(we)},ie=we=>Ee=>{Ee!==k[we]&&(k[we]=Ee,d.setOrientation(...k))},xe=we=>Ee=>{Ee!==q[we]&&(q[we]=Ee,d.setPosition(...q))},fe=(we,Ee,De)=>{const Fe=t(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Ee});Fe.connect(C,0,we),Fe.start(),Object.defineProperty(Fe.offset,"defaultValue",{get(){return Ee}});const We=r({context:h},T,Fe.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT);return c(We,"value",je=>()=>je.call(We),je=>qe=>{try{je.call(We,qe)}catch(ft){if(ft.code!==9)throw ft}J(),T&&De(qe)}),We.cancelAndHoldAtTime=(je=>T?()=>{throw s()}:(...qe)=>{const ft=je.apply(We,qe);return J(),ft})(We.cancelAndHoldAtTime),We.cancelScheduledValues=(je=>T?()=>{throw s()}:(...qe)=>{const ft=je.apply(We,qe);return J(),ft})(We.cancelScheduledValues),We.exponentialRampToValueAtTime=(je=>T?()=>{throw s()}:(...qe)=>{const ft=je.apply(We,qe);return J(),ft})(We.exponentialRampToValueAtTime),We.linearRampToValueAtTime=(je=>T?()=>{throw s()}:(...qe)=>{const ft=je.apply(We,qe);return J(),ft})(We.linearRampToValueAtTime),We.setTargetAtTime=(je=>T?()=>{throw s()}:(...qe)=>{const ft=je.apply(We,qe);return J(),ft})(We.setTargetAtTime),We.setValueAtTime=(je=>T?()=>{throw s()}:(...qe)=>{const ft=je.apply(We,qe);return J(),ft})(We.setValueAtTime),We.setValueCurveAtTime=(je=>T?()=>{throw s()}:(...qe)=>{const ft=je.apply(We,qe);return J(),ft})(We.setValueCurveAtTime),We};return{forwardX:fe(0,0,ie(0)),forwardY:fe(1,0,ie(1)),forwardZ:fe(2,-1,ie(2)),positionX:fe(6,0,xe(0)),positionY:fe(7,0,xe(1)),positionZ:fe(8,0,xe(2)),upX:fe(3,0,ie(3)),upY:fe(4,1,ie(4)),upZ:fe(5,0,ie(5))}},{forwardX:S,forwardY:E,forwardZ:N,positionX:D,positionY:L,positionZ:W,upX:K,upY:se,upZ:ye}=d.forwardX===void 0?p():d;return{get forwardX(){return S},get forwardY(){return E},get forwardZ(){return N},get positionX(){return D},get positionY(){return L},get positionZ(){return W},get upX(){return K},get upY(){return se},get upZ(){return ye}}},isAudioNode$1=r=>"context"in r,isAudioNodeOutputConnection=r=>isAudioNode$1(r[0]),insertElementInSet=(r,e,t,n)=>{for(const s of r)if(t(s)){if(n)return!1;throw Error("The set contains at least one similar element.")}return r.add(e),!0},addActiveInputConnectionToAudioParam=(r,e,[t,n],s)=>{insertElementInSet(r,[e,t,n],o=>o[0]===e&&o[1]===t,s)},addPassiveInputConnectionToAudioParam=(r,[e,t,n],s)=>{const o=r.get(e);o===void 0?r.set(e,new Set([[t,n]])):insertElementInSet(o,[t,n],u=>u[0]===t,s)},isNativeAudioNodeFaker=r=>"inputs"in r,connectNativeAudioNodeToNativeAudioNode=(r,e,t,n)=>{if(isNativeAudioNodeFaker(e)){const s=e.inputs[n];return r.connect(s,t,0),[s,t,0]}return r.connect(e,t,n),[e,t,n]},deleteActiveInputConnection=(r,e,t)=>{for(const n of r)if(n[0]===e&&n[1]===t)return r.delete(n),n;return null},deleteActiveInputConnectionToAudioParam=(r,e,t)=>pickElementFromSet(r,n=>n[0]===e&&n[1]===t),deleteEventListenerOfAudioNode=(r,e)=>{if(!getEventListenersOfAudioNode(r).delete(e))throw new Error("Missing the expected event listener.")},deletePassiveInputConnectionToAudioParam=(r,e,t)=>{const n=getValueForKey(r,e),s=pickElementFromSet(n,o=>o[0]===t);return n.size===0&&r.delete(e),s},disconnectNativeAudioNodeFromNativeAudioNode=(r,e,t,n)=>{isNativeAudioNodeFaker(e)?r.disconnect(e.inputs[n],t,0):r.disconnect(e,t,n)},getNativeAudioNode=r=>getValueForKey(AUDIO_NODE_STORE,r),getNativeAudioParam=r=>getValueForKey(AUDIO_PARAM_STORE,r),isPartOfACycle=r=>CYCLE_COUNTERS.has(r),isPassiveAudioNode=r=>!ACTIVE_AUDIO_NODE_STORE.has(r),testAudioNodeDisconnectMethodSupport=(r,e)=>new Promise(t=>{if(e!==null)t(!0);else{const n=r.createScriptProcessor(256,1,1),s=r.createGain(),o=r.createBuffer(1,2,44100),u=o.getChannelData(0);u[0]=1,u[1]=1;const c=r.createBufferSource();c.buffer=o,c.loop=!0,c.connect(n).connect(r.destination),c.connect(s),c.disconnect(s),n.onaudioprocess=h=>{const f=h.inputBuffer.getChannelData(0);Array.prototype.some.call(f,d=>d===1)?t(!0):t(!1),c.stop(),n.onaudioprocess=null,c.disconnect(n),n.disconnect(r.destination)},c.start()}}),visitEachAudioNodeOnce=(r,e)=>{const t=new Map;for(const n of r)for(const s of n){const o=t.get(s);t.set(s,o===void 0?1:o+1)}t.forEach((n,s)=>e(s,n))},isNativeAudioNode$1=r=>"context"in r,wrapAudioNodeDisconnectMethod=r=>{const e=new Map;r.connect=(t=>(n,s=0,o=0)=>{const u=isNativeAudioNode$1(n)?t(n,s,o):t(n,s),c=e.get(n);return c===void 0?e.set(n,[{input:o,output:s}]):c.every(h=>h.input!==o||h.output!==s)&&c.push({input:o,output:s}),u})(r.connect.bind(r)),r.disconnect=(t=>(n,s,o)=>{if(t.apply(r),n===void 0)e.clear();else if(typeof n=="number")for(const[u,c]of e){const h=c.filter(f=>f.output!==n);h.length===0?e.delete(u):e.set(u,h)}else if(e.has(n))if(s===void 0)e.delete(n);else{const u=e.get(n);if(u!==void 0){const c=u.filter(h=>h.output!==s&&(h.input!==o||o===void 0));c.length===0?e.delete(n):e.set(n,c)}}for(const[u,c]of e)c.forEach(h=>{isNativeAudioNode$1(u)?r.connect(u,h.output,h.input):r.connect(u,h.output)})})(r.disconnect)},addConnectionToAudioParamOfAudioContext=(r,e,t,n)=>{const{activeInputs:s,passiveInputs:o}=getAudioParamConnections(e),{outputs:u}=getAudioNodeConnections(r),c=getEventListenersOfAudioNode(r),h=f=>{const d=getNativeAudioNode(r),p=getNativeAudioParam(e);if(f){const S=deletePassiveInputConnectionToAudioParam(o,r,t);addActiveInputConnectionToAudioParam(s,r,S,!1),!n&&!isPartOfACycle(r)&&d.connect(p,t)}else{const S=deleteActiveInputConnectionToAudioParam(s,r,t);addPassiveInputConnectionToAudioParam(o,S,!1),!n&&!isPartOfACycle(r)&&d.disconnect(p,t)}};return insertElementInSet(u,[e,t],f=>f[0]===e&&f[1]===t,!0)?(c.add(h),isActiveAudioNode(r)?addActiveInputConnectionToAudioParam(s,r,[t,h],!0):addPassiveInputConnectionToAudioParam(o,[r,t,h],!0),!0):!1},deleteInputConnectionOfAudioNode=(r,e,t,n)=>{const{activeInputs:s,passiveInputs:o}=getAudioNodeConnections(e),u=deleteActiveInputConnection(s[n],r,t);return u===null?[deletePassiveInputConnectionToAudioNode(o,r,t,n)[2],!1]:[u[2],!0]},deleteInputConnectionOfAudioParam=(r,e,t)=>{const{activeInputs:n,passiveInputs:s}=getAudioParamConnections(e),o=deleteActiveInputConnection(n,r,t);return o===null?[deletePassiveInputConnectionToAudioParam(s,r,t)[1],!1]:[o[2],!0]},deleteInputsOfAudioNode=(r,e,t,n,s)=>{const[o,u]=deleteInputConnectionOfAudioNode(r,t,n,s);if(o!==null&&(deleteEventListenerOfAudioNode(r,o),u&&!e&&!isPartOfACycle(r)&&disconnectNativeAudioNodeFromNativeAudioNode(getNativeAudioNode(r),getNativeAudioNode(t),n,s)),isActiveAudioNode(t)){const{activeInputs:c}=getAudioNodeConnections(t);setInternalStateToPassiveWhenNecessary(t,c)}},deleteInputsOfAudioParam=(r,e,t,n)=>{const[s,o]=deleteInputConnectionOfAudioParam(r,t,n);s!==null&&(deleteEventListenerOfAudioNode(r,s),o&&!e&&!isPartOfACycle(r)&&getNativeAudioNode(r).disconnect(getNativeAudioParam(t),n))},deleteAnyConnection=(r,e)=>{const t=getAudioNodeConnections(r),n=[];for(const s of t.outputs)isAudioNodeOutputConnection(s)?deleteInputsOfAudioNode(r,e,...s):deleteInputsOfAudioParam(r,e,...s),n.push(s[0]);return t.outputs.clear(),n},deleteConnectionAtOutput=(r,e,t)=>{const n=getAudioNodeConnections(r),s=[];for(const o of n.outputs)o[1]===t&&(isAudioNodeOutputConnection(o)?deleteInputsOfAudioNode(r,e,...o):deleteInputsOfAudioParam(r,e,...o),s.push(o[0]),n.outputs.delete(o));return s},deleteConnectionToDestination=(r,e,t,n,s)=>{const o=getAudioNodeConnections(r);return Array.from(o.outputs).filter(u=>u[0]===t&&(n===void 0||u[1]===n)&&(s===void 0||u[2]===s)).map(u=>(isAudioNodeOutputConnection(u)?deleteInputsOfAudioNode(r,e,...u):deleteInputsOfAudioParam(r,e,...u),o.outputs.delete(u),u[0]))},createAudioNodeConstructor=(r,e,t,n,s,o,u,c,h,f,d,p,S,E,N,D)=>class extends f{constructor(W,K,se,ye){super(se),this._context=W,this._nativeAudioNode=se;const G=d(W);p(G)&&t(testAudioNodeDisconnectMethodSupport,()=>testAudioNodeDisconnectMethodSupport(G,D))!==!0&&wrapAudioNodeDisconnectMethod(se),AUDIO_NODE_STORE.set(this,se),EVENT_LISTENERS.set(this,new Set),W.state!=="closed"&&K&&setInternalStateToActive(this),r(this,ye,se)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(W){this._nativeAudioNode.channelCount=W}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(W){this._nativeAudioNode.channelCountMode=W}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(W){this._nativeAudioNode.channelInterpretation=W}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(W,K=0,se=0){if(K<0||K>=this._nativeAudioNode.numberOfOutputs)throw s();const ye=d(this._context),G=N(ye);if(S(W)||E(W))throw o();if(isAudioNode$1(W)){const O=getNativeAudioNode(W);try{const q=connectNativeAudioNodeToNativeAudioNode(this._nativeAudioNode,O,K,se),J=isPassiveAudioNode(this);(G||J)&&this._nativeAudioNode.disconnect(...q),this.context.state!=="closed"&&!J&&isPassiveAudioNode(W)&&setInternalStateToActive(W)}catch(q){throw q.code===12?o():q}if(e(this,W,K,se,G)){const q=h([this],W);visitEachAudioNodeOnce(q,n(G))}return W}const C=getNativeAudioParam(W);if(C.name==="playbackRate"&&C.maxValue===1024)throw u();try{this._nativeAudioNode.connect(C,K),(G||isPassiveAudioNode(this))&&this._nativeAudioNode.disconnect(C,K)}catch(O){throw O.code===12?o():O}if(addConnectionToAudioParamOfAudioContext(this,W,K,G)){const O=h([this],W);visitEachAudioNodeOnce(O,n(G))}}disconnect(W,K,se){let ye;const G=d(this._context),C=N(G);if(W===void 0)ye=deleteAnyConnection(this,C);else if(typeof W=="number"){if(W<0||W>=this.numberOfOutputs)throw s();ye=deleteConnectionAtOutput(this,C,W)}else{if(K!==void 0&&(K<0||K>=this.numberOfOutputs)||isAudioNode$1(W)&&se!==void 0&&(se<0||se>=W.numberOfInputs))throw s();if(ye=deleteConnectionToDestination(this,C,W,K,se),ye.length===0)throw o()}for(const T of ye){const O=h([this],T);visitEachAudioNodeOnce(O,c)}}},createAudioParamFactory=(r,e,t,n,s,o,u,c,h,f,d,p,S)=>(E,N,D,L=null,W=null)=>{const K=D.value,se=new AutomationEventList(K),ye=N?n(se):null,G={get defaultValue(){return K},get maxValue(){return L===null?D.maxValue:L},get minValue(){return W===null?D.minValue:W},get value(){return D.value},set value(C){D.value=C,G.setValueAtTime(C,E.context.currentTime)},cancelAndHoldAtTime(C){if(typeof D.cancelAndHoldAtTime=="function")ye===null&&se.flush(E.context.currentTime),se.add(s(C)),D.cancelAndHoldAtTime(C);else{const T=Array.from(se).pop();ye===null&&se.flush(E.context.currentTime),se.add(s(C));const O=Array.from(se).pop();D.cancelScheduledValues(C),T!==O&&O!==void 0&&(O.type==="exponentialRampToValue"?D.exponentialRampToValueAtTime(O.value,O.endTime):O.type==="linearRampToValue"?D.linearRampToValueAtTime(O.value,O.endTime):O.type==="setValue"?D.setValueAtTime(O.value,O.startTime):O.type==="setValueCurve"&&D.setValueCurveAtTime(O.values,O.startTime,O.duration))}return G},cancelScheduledValues(C){return ye===null&&se.flush(E.context.currentTime),se.add(o(C)),D.cancelScheduledValues(C),G},exponentialRampToValueAtTime(C,T){if(C===0)throw new RangeError;if(!Number.isFinite(T)||T<0)throw new RangeError;const O=E.context.currentTime;return ye===null&&se.flush(O),Array.from(se).length===0&&(se.add(f(K,O)),D.setValueAtTime(K,O)),se.add(u(C,T)),D.exponentialRampToValueAtTime(C,T),G},linearRampToValueAtTime(C,T){const O=E.context.currentTime;return ye===null&&se.flush(O),Array.from(se).length===0&&(se.add(f(K,O)),D.setValueAtTime(K,O)),se.add(c(C,T)),D.linearRampToValueAtTime(C,T),G},setTargetAtTime(C,T,O){return ye===null&&se.flush(E.context.currentTime),se.add(h(C,T,O)),D.setTargetAtTime(C,T,O),G},setValueAtTime(C,T){return ye===null&&se.flush(E.context.currentTime),se.add(f(C,T)),D.setValueAtTime(C,T),G},setValueCurveAtTime(C,T,O){const k=C instanceof Float32Array?C:new Float32Array(C);if(p!==null&&p.name==="webkitAudioContext"){const q=T+O,J=E.context.sampleRate,ie=Math.ceil(T*J),xe=Math.floor(q*J),fe=xe-ie,we=new Float32Array(fe);for(let De=0;De<fe;De+=1){const Fe=(k.length-1)/O*((ie+De)/J-T),We=Math.floor(Fe),je=Math.ceil(Fe);we[De]=We===je?k[We]:(1-(Fe-We))*k[We]+(1-(je-Fe))*k[je]}ye===null&&se.flush(E.context.currentTime),se.add(d(we,T,O)),D.setValueCurveAtTime(we,T,O);const Ee=xe/J;Ee<q&&S(G,we[we.length-1],Ee),S(G,k[k.length-1],q)}else ye===null&&se.flush(E.context.currentTime),se.add(d(k,T,O)),D.setValueCurveAtTime(k,T,O);return G}};return t.set(G,D),e.set(G,E),r(G,ye),G},createAudioParamRenderer=r=>({replay(e){for(const t of r)if(t.type==="exponentialRampToValue"){const{endTime:n,value:s}=t;e.exponentialRampToValueAtTime(s,n)}else if(t.type==="linearRampToValue"){const{endTime:n,value:s}=t;e.linearRampToValueAtTime(s,n)}else if(t.type==="setTarget"){const{startTime:n,target:s,timeConstant:o}=t;e.setTargetAtTime(s,n,o)}else if(t.type==="setValue"){const{startTime:n,value:s}=t;e.setValueAtTime(s,n)}else if(t.type==="setValueCurve"){const{duration:n,startTime:s,values:o}=t;e.setValueCurveAtTime(o,s,n)}else throw new Error("Can't apply an unknown automation.")}});class ReadOnlyMap{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,s)=>e.call(t,n,s,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const DEFAULT_OPTIONS$g={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},createAudioWorkletNodeConstructor=(r,e,t,n,s,o,u,c,h,f,d,p,S,E)=>class extends e{constructor(D,L,W){var K;const se=c(D),ye=h(se),G=d({...DEFAULT_OPTIONS$g,...W});S(G);const C=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(se),T=C==null?void 0:C.get(L),O=ye||se.state!=="closed"?se:(K=u(se))!==null&&K!==void 0?K:se,k=s(O,ye?null:D.baseLatency,f,L,T,G),q=ye?n(L,G,T):null;super(D,!0,k,q);const J=[];k.parameters.forEach((xe,fe)=>{const we=t(this,ye,xe);J.push([fe,we])}),this._nativeAudioWorkletNode=k,this._onprocessorerror=null,this._parameters=new ReadOnlyMap(J),ye&&r(se,this);const{activeInputs:ie}=o(this);p(k,ie)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(D){const L=typeof D=="function"?E(this,D):null;this._nativeAudioWorkletNode.onprocessorerror=L;const W=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=W!==null&&W===L?D:W}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function copyFromChannel(r,e,t,n,s){if(typeof r.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),r.copyFromChannel(e[t],n,s);else{const o=r.getChannelData(n);if(e[t].byteLength===0)e[t]=o.slice(s,s+128);else{const u=new Float32Array(o.buffer,s*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(u)}}}const copyToChannel=(r,e,t,n,s)=>{typeof r.copyToChannel=="function"?e[t].byteLength!==0&&r.copyToChannel(e[t],n,s):e[t].byteLength!==0&&r.getChannelData(n).set(e[t],s)},createNestedArrays=(r,e)=>{const t=[];for(let n=0;n<r;n+=1){const s=[],o=typeof e=="number"?e:e[n];for(let u=0;u<o;u+=1)s.push(new Float32Array(128));t.push(s)}return t},getAudioWorkletProcessor=(r,e)=>{const t=getValueForKey(NODE_TO_PROCESSOR_MAPS,r),n=getNativeAudioNode(e);return getValueForKey(t,n)},processBuffer=async(r,e,t,n,s,o,u)=>{const c=e===null?Math.ceil(r.context.length/128)*128:e.length,h=n.channelCount*n.numberOfInputs,f=s.reduce((L,W)=>L+W,0),d=f===0?null:t.createBuffer(f,c,t.sampleRate);if(o===void 0)throw new Error("Missing the processor constructor.");const p=getAudioNodeConnections(r),S=await getAudioWorkletProcessor(t,r),E=createNestedArrays(n.numberOfInputs,n.channelCount),N=createNestedArrays(n.numberOfOutputs,s),D=Array.from(r.parameters.keys()).reduce((L,W)=>({...L,[W]:new Float32Array(128)}),{});for(let L=0;L<c;L+=128){if(n.numberOfInputs>0&&e!==null)for(let W=0;W<n.numberOfInputs;W+=1)for(let K=0;K<n.channelCount;K+=1)copyFromChannel(e,E[W],K,K,L);o.parameterDescriptors!==void 0&&e!==null&&o.parameterDescriptors.forEach(({name:W},K)=>{copyFromChannel(e,D,W,h+K,L)});for(let W=0;W<n.numberOfInputs;W+=1)for(let K=0;K<s[W];K+=1)N[W][K].byteLength===0&&(N[W][K]=new Float32Array(128));try{const W=E.map((se,ye)=>p.activeInputs[ye].size===0?[]:se),K=u(L/t.sampleRate,t.sampleRate,()=>S.process(W,N,D));if(d!==null)for(let se=0,ye=0;se<n.numberOfOutputs;se+=1){for(let G=0;G<s[se];G+=1)copyToChannel(d,N[se],G,ye+G,L);ye+=s[se]}if(!K)break}catch(W){r.dispatchEvent(new ErrorEvent("processorerror",{colno:W.colno,filename:W.filename,lineno:W.lineno,message:W.message}));break}}return d},createAudioWorkletNodeRendererFactory=(r,e,t,n,s,o,u,c,h,f,d,p,S,E,N,D)=>(L,W,K)=>{const se=new WeakMap;let ye=null;const G=async(C,T)=>{let O=d(C),k=null;const q=isOwnedByContext(O,T),J=Array.isArray(W.outputChannelCount)?W.outputChannelCount:Array.from(W.outputChannelCount);if(p===null){const ie=J.reduce((Ee,De)=>Ee+De,0),xe=s(T,{channelCount:Math.max(1,ie),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,ie)}),fe=[];for(let Ee=0;Ee<C.numberOfOutputs;Ee+=1)fe.push(n(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:J[Ee]}));const we=u(T,{channelCount:W.channelCount,channelCountMode:W.channelCountMode,channelInterpretation:W.channelInterpretation,gain:1});we.connect=e.bind(null,fe),we.disconnect=h.bind(null,fe),k=[xe,fe,we]}else q||(O=new p(T,L));if(se.set(T,k===null?O:k[2]),k!==null){if(ye===null){if(K===void 0)throw new Error("Missing the processor constructor.");if(S===null)throw new Error("Missing the native OfflineAudioContext constructor.");const De=C.channelCount*C.numberOfInputs,Fe=K.parameterDescriptors===void 0?0:K.parameterDescriptors.length,We=De+Fe;ye=processBuffer(C,We===0?null:await(async()=>{const qe=new S(We,Math.ceil(C.context.length/128)*128,T.sampleRate),ft=[],dt=[];for(let lt=0;lt<W.numberOfInputs;lt+=1)ft.push(u(qe,{channelCount:W.channelCount,channelCountMode:W.channelCountMode,channelInterpretation:W.channelInterpretation,gain:1})),dt.push(s(qe,{channelCount:W.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:W.channelCount}));const pt=await Promise.all(Array.from(C.parameters.values()).map(async lt=>{const Ft=o(qe,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:lt.value});return await E(qe,lt,Ft.offset),Ft})),Je=n(qe,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,De+Fe)});for(let lt=0;lt<W.numberOfInputs;lt+=1){ft[lt].connect(dt[lt]);for(let Ft=0;Ft<W.channelCount;Ft+=1)dt[lt].connect(Je,Ft,lt*W.channelCount+Ft)}for(const[lt,Ft]of pt.entries())Ft.connect(Je,0,De+lt),Ft.start(0);return Je.connect(qe.destination),await Promise.all(ft.map(lt=>N(C,qe,lt))),D(qe)})(),T,W,J,K,f)}const ie=await ye,xe=t(T,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[fe,we,Ee]=k;ie!==null&&(xe.buffer=ie,xe.start(0)),xe.connect(fe);for(let De=0,Fe=0;De<C.numberOfOutputs;De+=1){const We=we[De];for(let je=0;je<J[De];je+=1)fe.connect(We,Fe+je,je);Fe+=J[De]}return Ee}if(q)for(const[ie,xe]of C.parameters.entries())await r(T,xe,O.parameters.get(ie));else for(const[ie,xe]of C.parameters.entries())await E(T,xe,O.parameters.get(ie));return await N(C,T,O),O};return{render(C,T){c(T,C);const O=se.get(T);return O!==void 0?Promise.resolve(O):G(C,T)}}},createBaseAudioContextConstructor=(r,e,t,n,s,o,u,c,h,f,d,p,S,E,N,D,L,W,K,se)=>class extends N{constructor(G,C){super(G,C),this._nativeContext=G,this._audioWorklet=r===void 0?void 0:{addModule:(T,O)=>r(this,T,O)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new s(this)}createBuffer(G,C,T){return new t({length:C,numberOfChannels:G,sampleRate:T})}createBufferSource(){return new n(this)}createChannelMerger(G=6){return new o(this,{numberOfInputs:G})}createChannelSplitter(G=6){return new u(this,{numberOfOutputs:G})}createConstantSource(){return new c(this)}createConvolver(){return new h(this)}createDelay(G=1){return new d(this,{maxDelayTime:G})}createDynamicsCompressor(){return new p(this)}createGain(){return new S(this)}createIIRFilter(G,C){return new E(this,{feedback:C,feedforward:G})}createOscillator(){return new D(this)}createPanner(){return new L(this)}createPeriodicWave(G,C,T={disableNormalization:!1}){return new W(this,{...T,imag:C,real:G})}createStereoPanner(){return new K(this)}createWaveShaper(){return new se(this)}decodeAudioData(G,C,T){return f(this._nativeContext,G).then(O=>(typeof C=="function"&&C(O),O),O=>{throw typeof T=="function"&&T(O),O})}},DEFAULT_OPTIONS$f={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},createBiquadFilterNodeConstructor=(r,e,t,n,s,o,u,c)=>class extends r{constructor(f,d){const p=o(f),S={...DEFAULT_OPTIONS$f,...d},E=s(p,S),N=u(p),D=N?t():null;super(f,!1,E,D),this._Q=e(this,N,E.Q,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._detune=e(this,N,E.detune,1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT),-1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT)),this._frequency=e(this,N,E.frequency,f.sampleRate/2,0),this._gain=e(this,N,E.gain,40*Math.log10(MOST_POSITIVE_SINGLE_FLOAT),MOST_NEGATIVE_SINGLE_FLOAT),this._nativeBiquadFilterNode=E,c(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(f){this._nativeBiquadFilterNode.type=f}getFrequencyResponse(f,d,p){try{this._nativeBiquadFilterNode.getFrequencyResponse(f,d,p)}catch(S){throw S.code===11?n():S}if(f.length!==d.length||d.length!==p.length)throw n()}},createBiquadFilterNodeRendererFactory=(r,e,t,n,s)=>()=>{const o=new WeakMap,u=async(c,h)=>{let f=t(c);const d=isOwnedByContext(f,h);if(!d){const p={Q:f.Q.value,channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,gain:f.gain.value,type:f.type};f=e(h,p)}return o.set(h,f),d?(await r(h,c.Q,f.Q),await r(h,c.detune,f.detune),await r(h,c.frequency,f.frequency),await r(h,c.gain,f.gain)):(await n(h,c.Q,f.Q),await n(h,c.detune,f.detune),await n(h,c.frequency,f.frequency),await n(h,c.gain,f.gain)),await s(c,h,f),f};return{render(c,h){const f=o.get(h);return f!==void 0?Promise.resolve(f):u(c,h)}}},createCacheTestResult=(r,e)=>(t,n)=>{const s=e.get(t);if(s!==void 0)return s;const o=r.get(t);if(o!==void 0)return o;try{const u=n();return u instanceof Promise?(r.set(t,u),u.catch(()=>!1).then(c=>(r.delete(t),e.set(t,c),c))):(e.set(t,u),u)}catch{return e.set(t,!1),!1}},DEFAULT_OPTIONS$e={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},createChannelMergerNodeConstructor=(r,e,t,n,s)=>class extends r{constructor(u,c){const h=n(u),f={...DEFAULT_OPTIONS$e,...c},d=t(h,f),p=s(h)?e():null;super(u,!1,d,p)}},createChannelMergerNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(o,u)=>{let c=e(o);if(!isOwnedByContext(c,u)){const f={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,numberOfInputs:c.numberOfInputs};c=r(u,f)}return n.set(u,c),await t(o,u,c),c};return{render(o,u){const c=n.get(u);return c!==void 0?Promise.resolve(c):s(o,u)}}},DEFAULT_OPTIONS$d={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},createChannelSplitterNodeConstructor=(r,e,t,n,s,o)=>class extends r{constructor(c,h){const f=n(c),d=o({...DEFAULT_OPTIONS$d,...h}),p=t(f,d),S=s(f)?e():null;super(c,!1,p,S)}},createChannelSplitterNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(o,u)=>{let c=e(o);if(!isOwnedByContext(c,u)){const f={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,numberOfOutputs:c.numberOfOutputs};c=r(u,f)}return n.set(u,c),await t(o,u,c),c};return{render(o,u){const c=n.get(u);return c!==void 0?Promise.resolve(c):s(o,u)}}},createConnectAudioParam=r=>(e,t,n)=>r(t,e,n),createConnectMultipleOutputs=r=>(e,t,n=0,s=0)=>{const o=e[n];if(o===void 0)throw r();return isNativeAudioNode$1(t)?o.connect(t,0,s):o.connect(t,0)},createConnectedNativeAudioBufferSourceNodeFactory=r=>(e,t)=>{const n=r(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),s=e.createBuffer(1,2,44100);return n.buffer=s,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}},DEFAULT_OPTIONS$c={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},createConstantSourceNodeConstructor=(r,e,t,n,s,o,u)=>class extends r{constructor(h,f){const d=s(h),p={...DEFAULT_OPTIONS$c,...f},S=n(d,p),E=o(d),N=E?t():null;super(h,!1,S,N),this._constantSourceNodeRenderer=N,this._nativeConstantSourceNode=S,this._offset=e(this,E,S.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(h){const f=typeof h=="function"?u(this,h):null;this._nativeConstantSourceNode.onended=f;const d=this._nativeConstantSourceNode.onended;this._onended=d!==null&&d===f?h:d}start(h=0){if(this._nativeConstantSourceNode.start(h),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=h),this.context.state!=="closed"){setInternalStateToActive(this);const f=()=>{this._nativeConstantSourceNode.removeEventListener("ended",f),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeConstantSourceNode.addEventListener("ended",f)}}stop(h=0){this._nativeConstantSourceNode.stop(h),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=h)}},createConstantSourceNodeRendererFactory=(r,e,t,n,s)=>()=>{const o=new WeakMap;let u=null,c=null;const h=async(f,d)=>{let p=t(f);const S=isOwnedByContext(p,d);if(!S){const E={channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,offset:p.offset.value};p=e(d,E),u!==null&&p.start(u),c!==null&&p.stop(c)}return o.set(d,p),S?await r(d,f.offset,p.offset):await n(d,f.offset,p.offset),await s(f,d,p),p};return{set start(f){u=f},set stop(f){c=f},render(f,d){const p=o.get(d);return p!==void 0?Promise.resolve(p):h(f,d)}}},createConvertNumberToUnsignedLong=r=>e=>(r[0]=e,r[0]),DEFAULT_OPTIONS$b={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},createConvolverNodeConstructor=(r,e,t,n,s,o)=>class extends r{constructor(c,h){const f=n(c),d={...DEFAULT_OPTIONS$b,...h},p=t(f,d),E=s(f)?e():null;super(c,!1,p,E),this._isBufferNullified=!1,this._nativeConvolverNode=p,d.buffer!==null&&o(this,d.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(c){if(this._nativeConvolverNode.buffer=c,c===null&&this._nativeConvolverNode.buffer!==null){const h=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=h.createBuffer(1,1,h.sampleRate),this._isBufferNullified=!0,o(this,0)}else this._isBufferNullified=!1,o(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(c){this._nativeConvolverNode.normalize=c}},createConvolverNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(o,u)=>{let c=e(o);if(!isOwnedByContext(c,u)){const f={buffer:c.buffer,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,disableNormalization:!c.normalize};c=r(u,f)}return n.set(u,c),isNativeAudioNodeFaker(c)?await t(o,u,c.inputs[0]):await t(o,u,c),c};return{render(o,u){const c=n.get(u);return c!==void 0?Promise.resolve(c):s(o,u)}}},createCreateNativeOfflineAudioContext=(r,e)=>(t,n,s)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,s)}catch(o){throw o.name==="SyntaxError"?r():o}},createDataCloneError=()=>new DOMException("","DataCloneError"),detachArrayBuffer=r=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{const s=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>s();try{e.postMessage(r,[r])}catch{}finally{s()}})},createDecodeAudioData=(r,e,t,n,s,o,u,c,h,f,d)=>(p,S)=>{const E=u(p)?p:o(p);if(s.has(S)){const N=t();return Promise.reject(N)}try{s.add(S)}catch{}return e(h,()=>h(E))?E.decodeAudioData(S).then(N=>(detachArrayBuffer(S).catch(()=>{}),e(c,()=>c(N))||d(N),r.add(N),N)):new Promise((N,D)=>{const L=async()=>{try{await detachArrayBuffer(S)}catch{}},W=K=>{D(K),L()};try{E.decodeAudioData(S,K=>{typeof K.copyFromChannel!="function"&&(f(K),wrapAudioBufferGetChannelDataMethod(K)),r.add(K),L().then(()=>N(K))},K=>{W(K===null?n():K)})}catch(K){W(K)}})},createDecrementCycleCounter=(r,e,t,n,s,o,u,c)=>(h,f)=>{const d=e.get(h);if(d===void 0)throw new Error("Missing the expected cycle count.");const p=o(h.context),S=c(p);if(d===f){if(e.delete(h),!S&&u(h)){const E=n(h),{outputs:N}=t(h);for(const D of N)if(isAudioNodeOutputConnection(D)){const L=n(D[0]);r(E,L,D[1],D[2])}else{const L=s(D[0]);E.connect(L,D[1])}}}else e.set(h,d-f)},DEFAULT_OPTIONS$a={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},createDelayNodeConstructor=(r,e,t,n,s,o,u)=>class extends r{constructor(h,f){const d=s(h),p={...DEFAULT_OPTIONS$a,...f},S=n(d,p),E=o(d),N=E?t(p.maxDelayTime):null;super(h,!1,S,N),this._delayTime=e(this,E,S.delayTime),u(this,p.maxDelayTime)}get delayTime(){return this._delayTime}},createDelayNodeRendererFactory=(r,e,t,n,s)=>o=>{const u=new WeakMap,c=async(h,f)=>{let d=t(h);const p=isOwnedByContext(d,f);if(!p){const S={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,delayTime:d.delayTime.value,maxDelayTime:o};d=e(f,S)}return u.set(f,d),p?await r(f,h.delayTime,d.delayTime):await n(f,h.delayTime,d.delayTime),await s(h,f,d),d};return{render(h,f){const d=u.get(f);return d!==void 0?Promise.resolve(d):c(h,f)}}},createDeleteActiveInputConnectionToAudioNode=r=>(e,t,n,s)=>r(e[s],o=>o[0]===t&&o[1]===n),createDeleteUnrenderedAudioWorkletNode=r=>(e,t)=>{r(e).delete(t)},isDelayNode=r=>"delayTime"in r,createDetectCycles=(r,e,t)=>function n(s,o){const u=isAudioNode$1(o)?o:t(r,o);if(isDelayNode(u))return[];if(s[0]===u)return[s];if(s.includes(u))return[];const{outputs:c}=e(u);return Array.from(c).map(h=>n([...s,u],h[0])).reduce((h,f)=>h.concat(f),[])},getOutputAudioNodeAtIndex=(r,e,t)=>{const n=e[t];if(n===void 0)throw r();return n},createDisconnectMultipleOutputs=r=>(e,t=void 0,n=void 0,s=0)=>t===void 0?e.forEach(o=>o.disconnect()):typeof t=="number"?getOutputAudioNodeAtIndex(r,e,t).disconnect():isNativeAudioNode$1(t)?n===void 0?e.forEach(o=>o.disconnect(t)):s===void 0?getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0):getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0,s):n===void 0?e.forEach(o=>o.disconnect(t)):getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0),DEFAULT_OPTIONS$9={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},createDynamicsCompressorNodeConstructor=(r,e,t,n,s,o,u,c)=>class extends r{constructor(f,d){const p=o(f),S={...DEFAULT_OPTIONS$9,...d},E=n(p,S),N=u(p),D=N?t():null;super(f,!1,E,D),this._attack=e(this,N,E.attack),this._knee=e(this,N,E.knee),this._nativeDynamicsCompressorNode=E,this._ratio=e(this,N,E.ratio),this._release=e(this,N,E.release),this._threshold=e(this,N,E.threshold),c(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(f){const d=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=f,f>2)throw this._nativeDynamicsCompressorNode.channelCount=d,s()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(f){const d=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=f,f==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=d,s()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},createDynamicsCompressorNodeRendererFactory=(r,e,t,n,s)=>()=>{const o=new WeakMap,u=async(c,h)=>{let f=t(c);const d=isOwnedByContext(f,h);if(!d){const p={attack:f.attack.value,channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,knee:f.knee.value,ratio:f.ratio.value,release:f.release.value,threshold:f.threshold.value};f=e(h,p)}return o.set(h,f),d?(await r(h,c.attack,f.attack),await r(h,c.knee,f.knee),await r(h,c.ratio,f.ratio),await r(h,c.release,f.release),await r(h,c.threshold,f.threshold)):(await n(h,c.attack,f.attack),await n(h,c.knee,f.knee),await n(h,c.ratio,f.ratio),await n(h,c.release,f.release),await n(h,c.threshold,f.threshold)),await s(c,h,f),f};return{render(c,h){const f=o.get(h);return f!==void 0?Promise.resolve(f):u(c,h)}}},createEncodingError=()=>new DOMException("","EncodingError"),createEvaluateSource=r=>e=>new Promise((t,n)=>{if(r===null){n(new SyntaxError);return}const s=r.document.head;if(s===null)n(new SyntaxError);else{const o=r.document.createElement("script"),u=new Blob([e],{type:"application/javascript"}),c=URL.createObjectURL(u),h=r.onerror,f=()=>{r.onerror=h,URL.revokeObjectURL(c)};r.onerror=(d,p,S,E,N)=>{if(p===c||p===r.location.href&&S===1&&E===1)return f(),n(N),!1;if(h!==null)return h(d,p,S,E,N)},o.onerror=()=>{f(),n(new SyntaxError)},o.onload=()=>{f(),t()},o.src=c,o.type="module",s.appendChild(o)}}),createEventTargetConstructor=r=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,s){if(n!==null){let o=this._listeners.get(n);o===void 0&&(o=r(this,n),typeof n=="function"&&this._listeners.set(n,o)),this._nativeEventTarget.addEventListener(t,o,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,s){const o=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,o===void 0?null:o,s)}},createExposeCurrentFrameAndCurrentTime=r=>(e,t,n)=>{Object.defineProperties(r,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{r!==null&&(delete r.currentFrame,delete r.currentTime)}},createFetchSource=r=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw r()},DEFAULT_OPTIONS$8={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},createGainNodeConstructor=(r,e,t,n,s,o)=>class extends r{constructor(c,h){const f=s(c),d={...DEFAULT_OPTIONS$8,...h},p=n(f,d),S=o(f),E=S?t():null;super(c,!1,p,E),this._gain=e(this,S,p.gain,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get gain(){return this._gain}},createGainNodeRendererFactory=(r,e,t,n,s)=>()=>{const o=new WeakMap,u=async(c,h)=>{let f=t(c);const d=isOwnedByContext(f,h);if(!d){const p={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,gain:f.gain.value};f=e(h,p)}return o.set(h,f),d?await r(h,c.gain,f.gain):await n(h,c.gain,f.gain),await s(c,h,f),f};return{render(c,h){const f=o.get(h);return f!==void 0?Promise.resolve(f):u(c,h)}}},createGetActiveAudioWorkletNodeInputs=(r,e)=>t=>e(r,t),createGetAudioNodeRenderer=r=>e=>{const t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},createGetAudioNodeTailTime=r=>e=>{var t;return(t=r.get(e))!==null&&t!==void 0?t:0},createGetAudioParamRenderer=r=>e=>{const t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},createGetBackupOfflineAudioContext=r=>e=>r.get(e),createInvalidStateError=()=>new DOMException("","InvalidStateError"),createGetNativeContext=r=>e=>{const t=r.get(e);if(t===void 0)throw createInvalidStateError();return t},createGetOrCreateBackupOfflineAudioContext=(r,e)=>t=>{let n=r.get(t);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),r.set(t,n),n},createGetUnrenderedAudioWorkletNodes=r=>e=>{const t=r.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},createInvalidAccessError=()=>new DOMException("","InvalidAccessError"),wrapIIRFilterNodeGetFrequencyResponseMethod=r=>{r.getFrequencyResponse=(e=>(t,n,s)=>{if(t.length!==n.length||n.length!==s.length)throw createInvalidAccessError();return e.call(r,t,n,s)})(r.getFrequencyResponse)},DEFAULT_OPTIONS$7={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},createIIRFilterNodeConstructor=(r,e,t,n,s,o)=>class extends r{constructor(c,h){const f=n(c),d=s(f),p={...DEFAULT_OPTIONS$7,...h},S=e(f,d?null:c.baseLatency,p),E=d?t(p.feedback,p.feedforward):null;super(c,!1,S,E),wrapIIRFilterNodeGetFrequencyResponseMethod(S),this._nativeIIRFilterNode=S,o(this,1)}getFrequencyResponse(c,h,f){return this._nativeIIRFilterNode.getFrequencyResponse(c,h,f)}},filterBuffer=(r,e,t,n,s,o,u,c,h,f,d)=>{const p=f.length;let S=c;for(let E=0;E<p;E+=1){let N=t[0]*f[E];for(let D=1;D<s;D+=1){const L=S-D&h-1;N+=t[D]*o[L],N-=r[D]*u[L]}for(let D=s;D<n;D+=1)N+=t[D]*o[S-D&h-1];for(let D=s;D<e;D+=1)N-=r[D]*u[S-D&h-1];o[S]=f[E],u[S]=N,S=S+1&h-1,d[E]=N}return S},filterFullBuffer=(r,e,t,n)=>{const s=t instanceof Float64Array?t:new Float64Array(t),o=n instanceof Float64Array?n:new Float64Array(n),u=s.length,c=o.length,h=Math.min(u,c);if(s[0]!==1){for(let N=0;N<u;N+=1)o[N]/=s[0];for(let N=1;N<c;N+=1)s[N]/=s[0]}const f=32,d=new Float32Array(f),p=new Float32Array(f),S=e.createBuffer(r.numberOfChannels,r.length,r.sampleRate),E=r.numberOfChannels;for(let N=0;N<E;N+=1){const D=r.getChannelData(N),L=S.getChannelData(N);d.fill(0),p.fill(0),filterBuffer(s,u,o,c,h,d,p,0,f,D,L)}return S},createIIRFilterNodeRendererFactory=(r,e,t,n,s)=>(o,u)=>{const c=new WeakMap;let h=null;const f=async(d,p)=>{let S=null,E=e(d);const N=isOwnedByContext(E,p);if(p.createIIRFilter===void 0?S=r(p,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):N||(E=p.createIIRFilter(u,o)),c.set(p,S===null?E:S),S!==null){if(h===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const L=new t(d.context.destination.channelCount,d.context.length,p.sampleRate);h=(async()=>{await n(d,L,L.destination);const W=await s(L);return filterFullBuffer(W,p,o,u)})()}const D=await h;return S.buffer=D,S.start(0),S}return await n(d,p,E),E};return{render(d,p){const S=c.get(p);return S!==void 0?Promise.resolve(S):f(d,p)}}},createIncrementCycleCounterFactory=(r,e,t,n,s,o)=>u=>(c,h)=>{const f=r.get(c);if(f===void 0){if(!u&&o(c)){const d=n(c),{outputs:p}=t(c);for(const S of p)if(isAudioNodeOutputConnection(S)){const E=n(S[0]);e(d,E,S[1],S[2])}else{const E=s(S[0]);d.disconnect(E,S[1])}}r.set(c,h)}else r.set(c,f+h)},createIsAnyAudioContext=(r,e)=>t=>{const n=r.get(t);return e(n)||e(t)},createIsAnyAudioNode=(r,e)=>t=>r.has(t)||e(t),createIsAnyAudioParam=(r,e)=>t=>r.has(t)||e(t),createIsAnyOfflineAudioContext=(r,e)=>t=>{const n=r.get(t);return e(n)||e(t)},createIsNativeAudioContext=r=>e=>r!==null&&e instanceof r,createIsNativeAudioNode=r=>e=>r!==null&&typeof r.AudioNode=="function"&&e instanceof r.AudioNode,createIsNativeAudioParam=r=>e=>r!==null&&typeof r.AudioParam=="function"&&e instanceof r.AudioParam,createIsNativeContext=(r,e)=>t=>r(t)||e(t),createIsNativeOfflineAudioContext=r=>e=>r!==null&&e instanceof r,createIsSecureContext=r=>r!==null&&r.isSecureContext,createMediaElementAudioSourceNodeConstructor=(r,e,t,n)=>class extends r{constructor(o,u){const c=t(o),h=e(c,u);if(n(c))throw TypeError();super(o,!0,h,null),this._nativeMediaElementAudioSourceNode=h}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},DEFAULT_OPTIONS$6={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},createMediaStreamAudioDestinationNodeConstructor=(r,e,t,n)=>class extends r{constructor(o,u){const c=t(o);if(n(c))throw new TypeError;const h={...DEFAULT_OPTIONS$6,...u},f=e(c,h);super(o,!1,f,null),this._nativeMediaStreamAudioDestinationNode=f}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},createMediaStreamAudioSourceNodeConstructor=(r,e,t,n)=>class extends r{constructor(o,u){const c=t(o),h=e(c,u);if(n(c))throw new TypeError;super(o,!0,h,null),this._nativeMediaStreamAudioSourceNode=h}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},createMediaStreamTrackAudioSourceNodeConstructor=(r,e,t)=>class extends r{constructor(s,o){const u=t(s),c=e(u,o);super(s,!0,c,null)}},createMinimalBaseAudioContextConstructor=(r,e,t,n,s,o)=>class extends t{constructor(c,h){super(c),this._nativeContext=c,CONTEXT_STORE.set(this,c),n(c)&&s.set(c,new Set),this._destination=new r(this,h),this._listener=e(this,c),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(c){const h=typeof c=="function"?o(this,c):null;this._nativeContext.onstatechange=h;const f=this._nativeContext.onstatechange;this._onstatechange=f!==null&&f===h?c:f}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},testPromiseSupport=r=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=r.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},createMonitorConnections=(r,e)=>(t,n,s)=>{const o=new Set;return t.connect=(u=>(c,h=0,f=0)=>{const d=o.size===0;if(e(c))return u.call(t,c,h,f),r(o,[c,h,f],p=>p[0]===c&&p[1]===h&&p[2]===f,!0),d&&n(),c;u.call(t,c,h),r(o,[c,h],p=>p[0]===c&&p[1]===h,!0),d&&n()})(t.connect),t.disconnect=(u=>(c,h,f)=>{const d=o.size>0;if(c===void 0)u.apply(t),o.clear();else if(typeof c=="number"){u.call(t,c);for(const S of o)S[1]===c&&o.delete(S)}else{e(c)?u.call(t,c,h,f):u.call(t,c,h);for(const S of o)S[0]===c&&(h===void 0||S[1]===h)&&(f===void 0||S[2]===f)&&o.delete(S)}const p=o.size===0;d&&p&&s()})(t.disconnect),t},assignNativeAudioNodeOption=(r,e,t)=>{const n=e[t];n!==void 0&&n!==r[t]&&(r[t]=n)},assignNativeAudioNodeOptions=(r,e)=>{assignNativeAudioNodeOption(r,e,"channelCount"),assignNativeAudioNodeOption(r,e,"channelCountMode"),assignNativeAudioNodeOption(r,e,"channelInterpretation")},testAnalyserNodeGetFloatTimeDomainDataMethodSupport=r=>typeof r.getFloatTimeDomainData=="function",wrapAnalyserNodeGetFloatTimeDomainDataMethod=r=>{r.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);r.getByteTimeDomainData(t);const n=Math.max(t.length,r.fftSize);for(let s=0;s<n;s+=1)e[s]=(t[s]-128)*.0078125;return e}},createNativeAnalyserNodeFactory=(r,e)=>(t,n)=>{const s=t.createAnalyser();if(assignNativeAudioNodeOptions(s,n),!(n.maxDecibels>n.minDecibels))throw e();return assignNativeAudioNodeOption(s,n,"fftSize"),assignNativeAudioNodeOption(s,n,"maxDecibels"),assignNativeAudioNodeOption(s,n,"minDecibels"),assignNativeAudioNodeOption(s,n,"smoothingTimeConstant"),r(testAnalyserNodeGetFloatTimeDomainDataMethodSupport,()=>testAnalyserNodeGetFloatTimeDomainDataMethodSupport(s))||wrapAnalyserNodeGetFloatTimeDomainDataMethod(s),s},createNativeAudioBufferConstructor=r=>r===null?null:r.hasOwnProperty("AudioBuffer")?r.AudioBuffer:null,assignNativeAudioNodeAudioParamValue=(r,e,t)=>{const n=e[t];n!==void 0&&n!==r[t].value&&(r[t].value=n)},wrapAudioBufferSourceNodeStartMethodConsecutiveCalls=r=>{r.start=(e=>{let t=!1;return(n=0,s=0,o)=>{if(t)throw createInvalidStateError();e.call(r,n,s,o),t=!0}})(r.start)},wrapAudioScheduledSourceNodeStartMethodNegativeParameters=r=>{r.start=(e=>(t=0,n=0,s)=>{if(typeof s=="number"&&s<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(r,t,n,s)})(r.start)},wrapAudioScheduledSourceNodeStopMethodNegativeParameters=r=>{r.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(r,t)})(r.stop)},createNativeAudioBufferSourceNodeFactory=(r,e,t,n,s,o,u,c,h,f,d)=>(p,S)=>{const E=p.createBufferSource();return assignNativeAudioNodeOptions(E,S),assignNativeAudioNodeAudioParamValue(E,S,"playbackRate"),assignNativeAudioNodeOption(E,S,"buffer"),assignNativeAudioNodeOption(E,S,"loop"),assignNativeAudioNodeOption(E,S,"loopEnd"),assignNativeAudioNodeOption(E,S,"loopStart"),e(t,()=>t(p))||wrapAudioBufferSourceNodeStartMethodConsecutiveCalls(E),e(n,()=>n(p))||h(E),e(s,()=>s(p))||f(E,p),e(o,()=>o(p))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(E),e(u,()=>u(p))||d(E,p),e(c,()=>c(p))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(E),r(p,E),E},createNativeAudioContextConstructor=r=>r===null?null:r.hasOwnProperty("AudioContext")?r.AudioContext:r.hasOwnProperty("webkitAudioContext")?r.webkitAudioContext:null,createNativeAudioDestinationNodeFactory=(r,e)=>(t,n,s)=>{const o=t.destination;if(o.channelCount!==n)try{o.channelCount=n}catch{}s&&o.channelCountMode!=="explicit"&&(o.channelCountMode="explicit"),o.maxChannelCount===0&&Object.defineProperty(o,"maxChannelCount",{value:n});const u=r(t,{channelCount:n,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,gain:1});return e(u,"channelCount",c=>()=>c.call(u),c=>h=>{c.call(u,h);try{o.channelCount=h}catch(f){if(h>o.maxChannelCount)throw f}}),e(u,"channelCountMode",c=>()=>c.call(u),c=>h=>{c.call(u,h),o.channelCountMode=h}),e(u,"channelInterpretation",c=>()=>c.call(u),c=>h=>{c.call(u,h),o.channelInterpretation=h}),Object.defineProperty(u,"maxChannelCount",{get:()=>o.maxChannelCount}),u.connect(o),u},createNativeAudioWorkletNodeConstructor=r=>r===null?null:r.hasOwnProperty("AudioWorkletNode")?r.AudioWorkletNode:null,testClonabilityOfAudioWorkletNodeOptions=r=>{const{port1:e}=new MessageChannel;try{e.postMessage(r)}finally{e.close()}},createNativeAudioWorkletNodeFactory=(r,e,t,n,s)=>(o,u,c,h,f,d)=>{if(c!==null)try{const p=new c(o,h,d),S=new Map;let E=null;if(Object.defineProperties(p,{channelCount:{get:()=>d.channelCount,set:()=>{throw r()}},channelCountMode:{get:()=>"explicit",set:()=>{throw r()}},onprocessorerror:{get:()=>E,set:N=>{typeof E=="function"&&p.removeEventListener("processorerror",E),E=typeof N=="function"?N:null,typeof E=="function"&&p.addEventListener("processorerror",E)}}}),p.addEventListener=(N=>(...D)=>{if(D[0]==="processorerror"){const L=typeof D[1]=="function"?D[1]:typeof D[1]=="object"&&D[1]!==null&&typeof D[1].handleEvent=="function"?D[1].handleEvent:null;if(L!==null){const W=S.get(D[1]);W!==void 0?D[1]=W:(D[1]=K=>{K.type==="error"?(Object.defineProperties(K,{type:{value:"processorerror"}}),L(K)):L(new ErrorEvent(D[0],{...K}))},S.set(L,D[1]))}}return N.call(p,"error",D[1],D[2]),N.call(p,...D)})(p.addEventListener),p.removeEventListener=(N=>(...D)=>{if(D[0]==="processorerror"){const L=S.get(D[1]);L!==void 0&&(S.delete(D[1]),D[1]=L)}return N.call(p,"error",D[1],D[2]),N.call(p,D[0],D[1],D[2])})(p.removeEventListener),d.numberOfOutputs!==0){const N=t(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return p.connect(N).connect(o.destination),s(p,()=>N.disconnect(),()=>N.connect(o.destination))}return p}catch(p){throw p.code===11?n():p}if(f===void 0)throw n();return testClonabilityOfAudioWorkletNodeOptions(d),e(o,u,f,d)},computeBufferSize=(r,e)=>r===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(r*e))))),cloneAudioWorkletNodeOptions=r=>new Promise((e,t)=>{const{port1:n,port2:s}=new MessageChannel;n.onmessage=({data:o})=>{n.close(),s.close(),e(o)},n.onmessageerror=({data:o})=>{n.close(),s.close(),t(o)},s.postMessage(r)}),createAudioWorkletProcessorPromise=async(r,e)=>{const t=await cloneAudioWorkletNodeOptions(e);return new r(t)},createAudioWorkletProcessor=(r,e,t,n)=>{let s=NODE_TO_PROCESSOR_MAPS.get(r);s===void 0&&(s=new WeakMap,NODE_TO_PROCESSOR_MAPS.set(r,s));const o=createAudioWorkletProcessorPromise(t,n);return s.set(e,o),o},createNativeAudioWorkletNodeFakerFactory=(r,e,t,n,s,o,u,c,h,f,d,p,S)=>(E,N,D,L)=>{if(L.numberOfInputs===0&&L.numberOfOutputs===0)throw h();const W=Array.isArray(L.outputChannelCount)?L.outputChannelCount:Array.from(L.outputChannelCount);if(W.some(Pe=>Pe<1))throw h();if(W.length!==L.numberOfOutputs)throw e();if(L.channelCountMode!=="explicit")throw h();const K=L.channelCount*L.numberOfInputs,se=W.reduce((Pe,Ye)=>Pe+Ye,0),ye=D.parameterDescriptors===void 0?0:D.parameterDescriptors.length;if(K+ye>6||se>6)throw h();const G=new MessageChannel,C=[],T=[];for(let Pe=0;Pe<L.numberOfInputs;Pe+=1)C.push(u(E,{channelCount:L.channelCount,channelCountMode:L.channelCountMode,channelInterpretation:L.channelInterpretation,gain:1})),T.push(s(E,{channelCount:L.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:L.channelCount}));const O=[];if(D.parameterDescriptors!==void 0)for(const{defaultValue:Pe,maxValue:Ye,minValue:Nt,name:ct}of D.parameterDescriptors){const ht=o(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:L.parameterData[ct]!==void 0?L.parameterData[ct]:Pe===void 0?0:Pe});Object.defineProperties(ht.offset,{defaultValue:{get:()=>Pe===void 0?0:Pe},maxValue:{get:()=>Ye===void 0?MOST_POSITIVE_SINGLE_FLOAT:Ye},minValue:{get:()=>Nt===void 0?MOST_NEGATIVE_SINGLE_FLOAT:Nt}}),O.push(ht)}const k=n(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,K+ye)}),q=computeBufferSize(N,E.sampleRate),J=c(E,q,K+ye,Math.max(1,se)),ie=s(E,{channelCount:Math.max(1,se),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,se)}),xe=[];for(let Pe=0;Pe<L.numberOfOutputs;Pe+=1)xe.push(n(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:W[Pe]}));for(let Pe=0;Pe<L.numberOfInputs;Pe+=1){C[Pe].connect(T[Pe]);for(let Ye=0;Ye<L.channelCount;Ye+=1)T[Pe].connect(k,Ye,Pe*L.channelCount+Ye)}const fe=new ReadOnlyMap(D.parameterDescriptors===void 0?[]:D.parameterDescriptors.map(({name:Pe},Ye)=>{const Nt=O[Ye];return Nt.connect(k,0,K+Ye),Nt.start(0),[Pe,Nt.offset]}));k.connect(J);let we=L.channelInterpretation,Ee=null;const De=L.numberOfOutputs===0?[J]:xe,Fe={get bufferSize(){return q},get channelCount(){return L.channelCount},set channelCount(Pe){throw t()},get channelCountMode(){return L.channelCountMode},set channelCountMode(Pe){throw t()},get channelInterpretation(){return we},set channelInterpretation(Pe){for(const Ye of C)Ye.channelInterpretation=Pe;we=Pe},get context(){return J.context},get inputs(){return C},get numberOfInputs(){return L.numberOfInputs},get numberOfOutputs(){return L.numberOfOutputs},get onprocessorerror(){return Ee},set onprocessorerror(Pe){typeof Ee=="function"&&Fe.removeEventListener("processorerror",Ee),Ee=typeof Pe=="function"?Pe:null,typeof Ee=="function"&&Fe.addEventListener("processorerror",Ee)},get parameters(){return fe},get port(){return G.port2},addEventListener(...Pe){return J.addEventListener(Pe[0],Pe[1],Pe[2])},connect:r.bind(null,De),disconnect:f.bind(null,De),dispatchEvent(...Pe){return J.dispatchEvent(Pe[0])},removeEventListener(...Pe){return J.removeEventListener(Pe[0],Pe[1],Pe[2])}},We=new Map;G.port1.addEventListener=(Pe=>(...Ye)=>{if(Ye[0]==="message"){const Nt=typeof Ye[1]=="function"?Ye[1]:typeof Ye[1]=="object"&&Ye[1]!==null&&typeof Ye[1].handleEvent=="function"?Ye[1].handleEvent:null;if(Nt!==null){const ct=We.get(Ye[1]);ct!==void 0?Ye[1]=ct:(Ye[1]=ht=>{d(E.currentTime,E.sampleRate,()=>Nt(ht))},We.set(Nt,Ye[1]))}}return Pe.call(G.port1,Ye[0],Ye[1],Ye[2])})(G.port1.addEventListener),G.port1.removeEventListener=(Pe=>(...Ye)=>{if(Ye[0]==="message"){const Nt=We.get(Ye[1]);Nt!==void 0&&(We.delete(Ye[1]),Ye[1]=Nt)}return Pe.call(G.port1,Ye[0],Ye[1],Ye[2])})(G.port1.removeEventListener);let je=null;Object.defineProperty(G.port1,"onmessage",{get:()=>je,set:Pe=>{typeof je=="function"&&G.port1.removeEventListener("message",je),je=typeof Pe=="function"?Pe:null,typeof je=="function"&&(G.port1.addEventListener("message",je),G.port1.start())}}),D.prototype.port=G.port1;let qe=null;createAudioWorkletProcessor(E,Fe,D,L).then(Pe=>qe=Pe);const dt=createNestedArrays(L.numberOfInputs,L.channelCount),pt=createNestedArrays(L.numberOfOutputs,W),Je=D.parameterDescriptors===void 0?[]:D.parameterDescriptors.reduce((Pe,{name:Ye})=>({...Pe,[Ye]:new Float32Array(128)}),{});let lt=!0;const Ft=()=>{L.numberOfOutputs>0&&J.disconnect(ie);for(let Pe=0,Ye=0;Pe<L.numberOfOutputs;Pe+=1){const Nt=xe[Pe];for(let ct=0;ct<W[Pe];ct+=1)ie.disconnect(Nt,Ye+ct,ct);Ye+=W[Pe]}},$e=new Map;J.onaudioprocess=({inputBuffer:Pe,outputBuffer:Ye})=>{if(qe!==null){const Nt=p(Fe);for(let ct=0;ct<q;ct+=128){for(let ht=0;ht<L.numberOfInputs;ht+=1)for(let vt=0;vt<L.channelCount;vt+=1)copyFromChannel(Pe,dt[ht],vt,vt,ct);D.parameterDescriptors!==void 0&&D.parameterDescriptors.forEach(({name:ht},vt)=>{copyFromChannel(Pe,Je,ht,K+vt,ct)});for(let ht=0;ht<L.numberOfInputs;ht+=1)for(let vt=0;vt<W[ht];vt+=1)pt[ht][vt].byteLength===0&&(pt[ht][vt]=new Float32Array(128));try{const ht=dt.map((Lt,Xt)=>{if(Nt[Xt].size>0)return $e.set(Xt,q/128),Lt;const Ln=$e.get(Xt);return Ln===void 0?[]:(Lt.every(Mr=>Mr.every(Fr=>Fr===0))&&(Ln===1?$e.delete(Xt):$e.set(Xt,Ln-1)),Lt)});lt=d(E.currentTime+ct/E.sampleRate,E.sampleRate,()=>qe.process(ht,pt,Je));for(let Lt=0,Xt=0;Lt<L.numberOfOutputs;Lt+=1){for(let g=0;g<W[Lt];g+=1)copyToChannel(Ye,pt[Lt],g,Xt+g,ct);Xt+=W[Lt]}}catch(ht){lt=!1,Fe.dispatchEvent(new ErrorEvent("processorerror",{colno:ht.colno,filename:ht.filename,lineno:ht.lineno,message:ht.message}))}if(!lt){for(let ht=0;ht<L.numberOfInputs;ht+=1){C[ht].disconnect(T[ht]);for(let vt=0;vt<L.channelCount;vt+=1)T[ct].disconnect(k,vt,ht*L.channelCount+vt)}if(D.parameterDescriptors!==void 0){const ht=D.parameterDescriptors.length;for(let vt=0;vt<ht;vt+=1){const Lt=O[vt];Lt.disconnect(k,0,K+vt),Lt.stop()}}k.disconnect(J),J.onaudioprocess=null,Qt?Ft():Jt();break}}}};let Qt=!1;const Kt=u(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),nn=()=>J.connect(Kt).connect(E.destination),Jt=()=>{J.disconnect(Kt),Kt.disconnect()},nr=()=>{if(lt){Jt(),L.numberOfOutputs>0&&J.connect(ie);for(let Pe=0,Ye=0;Pe<L.numberOfOutputs;Pe+=1){const Nt=xe[Pe];for(let ct=0;ct<W[Pe];ct+=1)ie.connect(Nt,Ye+ct,ct);Ye+=W[Pe]}}Qt=!0},rr=()=>{lt&&(nn(),Ft()),Qt=!1};return nn(),S(Fe,nr,rr)},createNativeBiquadFilterNode=(r,e)=>{const t=r.createBiquadFilter();return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"Q"),assignNativeAudioNodeAudioParamValue(t,e,"detune"),assignNativeAudioNodeAudioParamValue(t,e,"frequency"),assignNativeAudioNodeAudioParamValue(t,e,"gain"),assignNativeAudioNodeOption(t,e,"type"),t},createNativeChannelMergerNodeFactory=(r,e)=>(t,n)=>{const s=t.createChannelMerger(n.numberOfInputs);return r!==null&&r.name==="webkitAudioContext"&&e(t,s),assignNativeAudioNodeOptions(s,n),s},wrapChannelSplitterNode=r=>{const e=r.numberOfOutputs;Object.defineProperty(r,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw createInvalidStateError()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw createInvalidStateError()}}),Object.defineProperty(r,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw createInvalidStateError()}})},createNativeChannelSplitterNode=(r,e)=>{const t=r.createChannelSplitter(e.numberOfOutputs);return assignNativeAudioNodeOptions(t,e),wrapChannelSplitterNode(t),t},createNativeConstantSourceNodeFactory=(r,e,t,n,s)=>(o,u)=>{if(o.createConstantSource===void 0)return t(o,u);const c=o.createConstantSource();return assignNativeAudioNodeOptions(c,u),assignNativeAudioNodeAudioParamValue(c,u,"offset"),e(n,()=>n(o))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(c),e(s,()=>s(o))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(c),r(o,c),c},interceptConnections=(r,e)=>(r.connect=e.connect.bind(e),r.disconnect=e.disconnect.bind(e),r),createNativeConstantSourceNodeFakerFactory=(r,e,t,n)=>(s,{offset:o,...u})=>{const c=s.createBuffer(1,2,44100),h=e(s,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),f=t(s,{...u,gain:o}),d=c.getChannelData(0);d[0]=1,d[1]=1,h.buffer=c,h.loop=!0;const p={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(N){f.channelCount=N},get channelCountMode(){return f.channelCountMode},set channelCountMode(N){f.channelCountMode=N},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(N){f.channelInterpretation=N},get context(){return f.context},get inputs(){return[]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get offset(){return f.gain},get onended(){return h.onended},set onended(N){h.onended=N},addEventListener(...N){return h.addEventListener(N[0],N[1],N[2])},dispatchEvent(...N){return h.dispatchEvent(N[0])},removeEventListener(...N){return h.removeEventListener(N[0],N[1],N[2])},start(N=0){h.start.call(h,N)},stop(N=0){h.stop.call(h,N)}},S=()=>h.connect(f),E=()=>h.disconnect(f);return r(s,h),n(interceptConnections(p,f),S,E)},createNativeConvolverNodeFactory=(r,e)=>(t,n)=>{const s=t.createConvolver();if(assignNativeAudioNodeOptions(s,n),n.disableNormalization===s.normalize&&(s.normalize=!n.disableNormalization),assignNativeAudioNodeOption(s,n,"buffer"),n.channelCount>2||(e(s,"channelCount",o=>()=>o.call(s),o=>u=>{if(u>2)throw r();return o.call(s,u)}),n.channelCountMode==="max"))throw r();return e(s,"channelCountMode",o=>()=>o.call(s),o=>u=>{if(u==="max")throw r();return o.call(s,u)}),s},createNativeDelayNode=(r,e)=>{const t=r.createDelay(e.maxDelayTime);return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"delayTime"),t},createNativeDynamicsCompressorNodeFactory=r=>(e,t)=>{const n=e.createDynamicsCompressor();if(assignNativeAudioNodeOptions(n,t),t.channelCount>2||t.channelCountMode==="max")throw r();return assignNativeAudioNodeAudioParamValue(n,t,"attack"),assignNativeAudioNodeAudioParamValue(n,t,"knee"),assignNativeAudioNodeAudioParamValue(n,t,"ratio"),assignNativeAudioNodeAudioParamValue(n,t,"release"),assignNativeAudioNodeAudioParamValue(n,t,"threshold"),n},createNativeGainNode=(r,e)=>{const t=r.createGain();return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"gain"),t},createNativeIIRFilterNodeFactory=r=>(e,t,n)=>{if(e.createIIRFilter===void 0)return r(e,t,n);const s=e.createIIRFilter(n.feedforward,n.feedback);return assignNativeAudioNodeOptions(s,n),s};function divide(r,e){const t=e[0]*e[0]+e[1]*e[1];return[(r[0]*e[0]+r[1]*e[1])/t,(r[1]*e[0]-r[0]*e[1])/t]}function multiply(r,e){return[r[0]*e[0]-r[1]*e[1],r[0]*e[1]+r[1]*e[0]]}function evaluatePolynomial(r,e){let t=[0,0];for(let n=r.length-1;n>=0;n-=1)t=multiply(t,e),t[0]+=r[n];return t}const createNativeIIRFilterNodeFakerFactory=(r,e,t,n)=>(s,o,{channelCount:u,channelCountMode:c,channelInterpretation:h,feedback:f,feedforward:d})=>{const p=computeBufferSize(o,s.sampleRate),S=f instanceof Float64Array?f:new Float64Array(f),E=d instanceof Float64Array?d:new Float64Array(d),N=S.length,D=E.length,L=Math.min(N,D);if(N===0||N>20)throw n();if(S[0]===0)throw e();if(D===0||D>20)throw n();if(E[0]===0)throw e();if(S[0]!==1){for(let O=0;O<D;O+=1)E[O]/=S[0];for(let O=1;O<N;O+=1)S[O]/=S[0]}const W=t(s,p,u,u);W.channelCount=u,W.channelCountMode=c,W.channelInterpretation=h;const K=32,se=[],ye=[],G=[];for(let O=0;O<u;O+=1){se.push(0);const k=new Float32Array(K),q=new Float32Array(K);k.fill(0),q.fill(0),ye.push(k),G.push(q)}W.onaudioprocess=O=>{const k=O.inputBuffer,q=O.outputBuffer,J=k.numberOfChannels;for(let ie=0;ie<J;ie+=1){const xe=k.getChannelData(ie),fe=q.getChannelData(ie);se[ie]=filterBuffer(S,N,E,D,L,ye[ie],G[ie],se[ie],K,xe,fe)}};const C=s.sampleRate/2;return interceptConnections({get bufferSize(){return p},get channelCount(){return W.channelCount},set channelCount(O){W.channelCount=O},get channelCountMode(){return W.channelCountMode},set channelCountMode(O){W.channelCountMode=O},get channelInterpretation(){return W.channelInterpretation},set channelInterpretation(O){W.channelInterpretation=O},get context(){return W.context},get inputs(){return[W]},get numberOfInputs(){return W.numberOfInputs},get numberOfOutputs(){return W.numberOfOutputs},addEventListener(...O){return W.addEventListener(O[0],O[1],O[2])},dispatchEvent(...O){return W.dispatchEvent(O[0])},getFrequencyResponse(O,k,q){if(O.length!==k.length||k.length!==q.length)throw r();const J=O.length;for(let ie=0;ie<J;ie+=1){const xe=-Math.PI*(O[ie]/C),fe=[Math.cos(xe),Math.sin(xe)],we=evaluatePolynomial(E,fe),Ee=evaluatePolynomial(S,fe),De=divide(we,Ee);k[ie]=Math.sqrt(De[0]*De[0]+De[1]*De[1]),q[ie]=Math.atan2(De[1],De[0])}},removeEventListener(...O){return W.removeEventListener(O[0],O[1],O[2])}},W)},createNativeMediaElementAudioSourceNode=(r,e)=>r.createMediaElementSource(e.mediaElement),createNativeMediaStreamAudioDestinationNode=(r,e)=>{const t=r.createMediaStreamDestination();return assignNativeAudioNodeOptions(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},createNativeMediaStreamAudioSourceNode=(r,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((o,u)=>o.id<u.id?-1:o.id>u.id?1:0);const n=t.slice(0,1),s=r.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(s,"mediaStream",{value:e}),s},createNativeMediaStreamTrackAudioSourceNodeFactory=(r,e)=>(t,{mediaStreamTrack:n})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(n);const s=new MediaStream([n]),o=t.createMediaStreamSource(s);if(n.kind!=="audio")throw r();if(e(t))throw new TypeError;return o},createNativeOfflineAudioContextConstructor=r=>r===null?null:r.hasOwnProperty("OfflineAudioContext")?r.OfflineAudioContext:r.hasOwnProperty("webkitOfflineAudioContext")?r.webkitOfflineAudioContext:null,createNativeOscillatorNodeFactory=(r,e,t,n,s,o)=>(u,c)=>{const h=u.createOscillator();return assignNativeAudioNodeOptions(h,c),assignNativeAudioNodeAudioParamValue(h,c,"detune"),assignNativeAudioNodeAudioParamValue(h,c,"frequency"),c.periodicWave!==void 0?h.setPeriodicWave(c.periodicWave):assignNativeAudioNodeOption(h,c,"type"),e(t,()=>t(u))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(h),e(n,()=>n(u))||o(h,u),e(s,()=>s(u))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(h),r(u,h),h},createNativePannerNodeFactory=r=>(e,t)=>{const n=e.createPanner();return n.orientationX===void 0?r(e,t):(assignNativeAudioNodeOptions(n,t),assignNativeAudioNodeAudioParamValue(n,t,"orientationX"),assignNativeAudioNodeAudioParamValue(n,t,"orientationY"),assignNativeAudioNodeAudioParamValue(n,t,"orientationZ"),assignNativeAudioNodeAudioParamValue(n,t,"positionX"),assignNativeAudioNodeAudioParamValue(n,t,"positionY"),assignNativeAudioNodeAudioParamValue(n,t,"positionZ"),assignNativeAudioNodeOption(n,t,"coneInnerAngle"),assignNativeAudioNodeOption(n,t,"coneOuterAngle"),assignNativeAudioNodeOption(n,t,"coneOuterGain"),assignNativeAudioNodeOption(n,t,"distanceModel"),assignNativeAudioNodeOption(n,t,"maxDistance"),assignNativeAudioNodeOption(n,t,"panningModel"),assignNativeAudioNodeOption(n,t,"refDistance"),assignNativeAudioNodeOption(n,t,"rolloffFactor"),n)},createNativePannerNodeFakerFactory=(r,e,t,n,s,o,u,c,h,f)=>(d,{coneInnerAngle:p,coneOuterAngle:S,coneOuterGain:E,distanceModel:N,maxDistance:D,orientationX:L,orientationY:W,orientationZ:K,panningModel:se,positionX:ye,positionY:G,positionZ:C,refDistance:T,rolloffFactor:O,...k})=>{const q=d.createPanner();if(k.channelCount>2||k.channelCountMode==="max")throw u();assignNativeAudioNodeOptions(q,k);const J={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},ie=t(d,{...J,channelInterpretation:"speakers",numberOfInputs:6}),xe=n(d,{...k,gain:1}),fe=n(d,{...J,gain:1}),we=n(d,{...J,gain:0}),Ee=n(d,{...J,gain:0}),De=n(d,{...J,gain:0}),Fe=n(d,{...J,gain:0}),We=n(d,{...J,gain:0}),je=s(d,256,6,1),qe=o(d,{...J,curve:new Float32Array([1,1]),oversample:"none"});let ft=[L,W,K],dt=[ye,G,C];const pt=new Float32Array(1);je.onaudioprocess=({inputBuffer:$e})=>{const Qt=[h($e,pt,0),h($e,pt,1),h($e,pt,2)];Qt.some((nn,Jt)=>nn!==ft[Jt])&&(q.setOrientation(...Qt),ft=Qt);const Kt=[h($e,pt,3),h($e,pt,4),h($e,pt,5)];Kt.some((nn,Jt)=>nn!==dt[Jt])&&(q.setPosition(...Kt),dt=Kt)},Object.defineProperty(we.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Ee.gain,"defaultValue",{get:()=>0}),Object.defineProperty(De.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Fe.gain,"defaultValue",{get:()=>0}),Object.defineProperty(We.gain,"defaultValue",{get:()=>0});const Je={get bufferSize(){},get channelCount(){return q.channelCount},set channelCount($e){if($e>2)throw u();xe.channelCount=$e,q.channelCount=$e},get channelCountMode(){return q.channelCountMode},set channelCountMode($e){if($e==="max")throw u();xe.channelCountMode=$e,q.channelCountMode=$e},get channelInterpretation(){return q.channelInterpretation},set channelInterpretation($e){xe.channelInterpretation=$e,q.channelInterpretation=$e},get coneInnerAngle(){return q.coneInnerAngle},set coneInnerAngle($e){q.coneInnerAngle=$e},get coneOuterAngle(){return q.coneOuterAngle},set coneOuterAngle($e){q.coneOuterAngle=$e},get coneOuterGain(){return q.coneOuterGain},set coneOuterGain($e){if($e<0||$e>1)throw e();q.coneOuterGain=$e},get context(){return q.context},get distanceModel(){return q.distanceModel},set distanceModel($e){q.distanceModel=$e},get inputs(){return[xe]},get maxDistance(){return q.maxDistance},set maxDistance($e){if($e<0)throw new RangeError;q.maxDistance=$e},get numberOfInputs(){return q.numberOfInputs},get numberOfOutputs(){return q.numberOfOutputs},get orientationX(){return fe.gain},get orientationY(){return we.gain},get orientationZ(){return Ee.gain},get panningModel(){return q.panningModel},set panningModel($e){q.panningModel=$e},get positionX(){return De.gain},get positionY(){return Fe.gain},get positionZ(){return We.gain},get refDistance(){return q.refDistance},set refDistance($e){if($e<0)throw new RangeError;q.refDistance=$e},get rolloffFactor(){return q.rolloffFactor},set rolloffFactor($e){if($e<0)throw new RangeError;q.rolloffFactor=$e},addEventListener(...$e){return xe.addEventListener($e[0],$e[1],$e[2])},dispatchEvent(...$e){return xe.dispatchEvent($e[0])},removeEventListener(...$e){return xe.removeEventListener($e[0],$e[1],$e[2])}};p!==Je.coneInnerAngle&&(Je.coneInnerAngle=p),S!==Je.coneOuterAngle&&(Je.coneOuterAngle=S),E!==Je.coneOuterGain&&(Je.coneOuterGain=E),N!==Je.distanceModel&&(Je.distanceModel=N),D!==Je.maxDistance&&(Je.maxDistance=D),L!==Je.orientationX.value&&(Je.orientationX.value=L),W!==Je.orientationY.value&&(Je.orientationY.value=W),K!==Je.orientationZ.value&&(Je.orientationZ.value=K),se!==Je.panningModel&&(Je.panningModel=se),ye!==Je.positionX.value&&(Je.positionX.value=ye),G!==Je.positionY.value&&(Je.positionY.value=G),C!==Je.positionZ.value&&(Je.positionZ.value=C),T!==Je.refDistance&&(Je.refDistance=T),O!==Je.rolloffFactor&&(Je.rolloffFactor=O),(ft[0]!==1||ft[1]!==0||ft[2]!==0)&&q.setOrientation(...ft),(dt[0]!==0||dt[1]!==0||dt[2]!==0)&&q.setPosition(...dt);const lt=()=>{xe.connect(q),r(xe,qe,0,0),qe.connect(fe).connect(ie,0,0),qe.connect(we).connect(ie,0,1),qe.connect(Ee).connect(ie,0,2),qe.connect(De).connect(ie,0,3),qe.connect(Fe).connect(ie,0,4),qe.connect(We).connect(ie,0,5),ie.connect(je).connect(d.destination)},Ft=()=>{xe.disconnect(q),c(xe,qe,0,0),qe.disconnect(fe),fe.disconnect(ie),qe.disconnect(we),we.disconnect(ie),qe.disconnect(Ee),Ee.disconnect(ie),qe.disconnect(De),De.disconnect(ie),qe.disconnect(Fe),Fe.disconnect(ie),qe.disconnect(We),We.disconnect(ie),ie.disconnect(je),je.disconnect(d.destination)};return f(interceptConnections(Je,q),lt,Ft)},createNativePeriodicWaveFactory=r=>(e,{disableNormalization:t,imag:n,real:s})=>{const o=n instanceof Float32Array?n:new Float32Array(n),u=s instanceof Float32Array?s:new Float32Array(s),c=e.createPeriodicWave(u,o,{disableNormalization:t});if(Array.from(n).length<2)throw r();return c},createNativeScriptProcessorNode=(r,e,t,n)=>r.createScriptProcessor(e,t,n),createNativeStereoPannerNodeFactory=(r,e)=>(t,n)=>{const s=n.channelCountMode;if(s==="clamped-max")throw e();if(t.createStereoPanner===void 0)return r(t,n);const o=t.createStereoPanner();return assignNativeAudioNodeOptions(o,n),assignNativeAudioNodeAudioParamValue(o,n,"pan"),Object.defineProperty(o,"channelCountMode",{get:()=>s,set:u=>{if(u!==s)throw e()}}),o},createNativeStereoPannerNodeFakerFactory=(r,e,t,n,s,o)=>{const c=new Float32Array([1,1]),h=Math.PI/2,f={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},d={...f,oversample:"none"},p=(N,D,L,W)=>{const K=new Float32Array(16385),se=new Float32Array(16385);for(let k=0;k<16385;k+=1){const q=k/16384*h;K[k]=Math.cos(q),se[k]=Math.sin(q)}const ye=t(N,{...f,gain:0}),G=n(N,{...d,curve:K}),C=n(N,{...d,curve:c}),T=t(N,{...f,gain:0}),O=n(N,{...d,curve:se});return{connectGraph(){D.connect(ye),D.connect(C.inputs===void 0?C:C.inputs[0]),D.connect(T),C.connect(L),L.connect(G.inputs===void 0?G:G.inputs[0]),L.connect(O.inputs===void 0?O:O.inputs[0]),G.connect(ye.gain),O.connect(T.gain),ye.connect(W,0,0),T.connect(W,0,1)},disconnectGraph(){D.disconnect(ye),D.disconnect(C.inputs===void 0?C:C.inputs[0]),D.disconnect(T),C.disconnect(L),L.disconnect(G.inputs===void 0?G:G.inputs[0]),L.disconnect(O.inputs===void 0?O:O.inputs[0]),G.disconnect(ye.gain),O.disconnect(T.gain),ye.disconnect(W,0,0),T.disconnect(W,0,1)}}},S=(N,D,L,W)=>{const K=new Float32Array(16385),se=new Float32Array(16385),ye=new Float32Array(16385),G=new Float32Array(16385),C=Math.floor(16385/2);for(let De=0;De<16385;De+=1)if(De>C){const Fe=(De-C)/(16384-C)*h;K[De]=Math.cos(Fe),se[De]=Math.sin(Fe),ye[De]=0,G[De]=1}else{const Fe=De/(16384-C)*h;K[De]=1,se[De]=0,ye[De]=Math.cos(Fe),G[De]=Math.sin(Fe)}const T=e(N,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),O=t(N,{...f,gain:0}),k=n(N,{...d,curve:K}),q=t(N,{...f,gain:0}),J=n(N,{...d,curve:se}),ie=n(N,{...d,curve:c}),xe=t(N,{...f,gain:0}),fe=n(N,{...d,curve:ye}),we=t(N,{...f,gain:0}),Ee=n(N,{...d,curve:G});return{connectGraph(){D.connect(T),D.connect(ie.inputs===void 0?ie:ie.inputs[0]),T.connect(O,0),T.connect(q,0),T.connect(xe,1),T.connect(we,1),ie.connect(L),L.connect(k.inputs===void 0?k:k.inputs[0]),L.connect(J.inputs===void 0?J:J.inputs[0]),L.connect(fe.inputs===void 0?fe:fe.inputs[0]),L.connect(Ee.inputs===void 0?Ee:Ee.inputs[0]),k.connect(O.gain),J.connect(q.gain),fe.connect(xe.gain),Ee.connect(we.gain),O.connect(W,0,0),xe.connect(W,0,0),q.connect(W,0,1),we.connect(W,0,1)},disconnectGraph(){D.disconnect(T),D.disconnect(ie.inputs===void 0?ie:ie.inputs[0]),T.disconnect(O,0),T.disconnect(q,0),T.disconnect(xe,1),T.disconnect(we,1),ie.disconnect(L),L.disconnect(k.inputs===void 0?k:k.inputs[0]),L.disconnect(J.inputs===void 0?J:J.inputs[0]),L.disconnect(fe.inputs===void 0?fe:fe.inputs[0]),L.disconnect(Ee.inputs===void 0?Ee:Ee.inputs[0]),k.disconnect(O.gain),J.disconnect(q.gain),fe.disconnect(xe.gain),Ee.disconnect(we.gain),O.disconnect(W,0,0),xe.disconnect(W,0,0),q.disconnect(W,0,1),we.disconnect(W,0,1)}}},E=(N,D,L,W,K)=>{if(D===1)return p(N,L,W,K);if(D===2)return S(N,L,W,K);throw s()};return(N,{channelCount:D,channelCountMode:L,pan:W,...K})=>{if(L==="max")throw s();const se=r(N,{...K,channelCount:1,channelCountMode:L,numberOfInputs:2}),ye=t(N,{...K,channelCount:D,channelCountMode:L,gain:1}),G=t(N,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:W});let{connectGraph:C,disconnectGraph:T}=E(N,D,ye,G,se);Object.defineProperty(G.gain,"defaultValue",{get:()=>0}),Object.defineProperty(G.gain,"maxValue",{get:()=>1}),Object.defineProperty(G.gain,"minValue",{get:()=>-1});const O={get bufferSize(){},get channelCount(){return ye.channelCount},set channelCount(ie){ye.channelCount!==ie&&(k&&T(),{connectGraph:C,disconnectGraph:T}=E(N,ie,ye,G,se),k&&C()),ye.channelCount=ie},get channelCountMode(){return ye.channelCountMode},set channelCountMode(ie){if(ie==="clamped-max"||ie==="max")throw s();ye.channelCountMode=ie},get channelInterpretation(){return ye.channelInterpretation},set channelInterpretation(ie){ye.channelInterpretation=ie},get context(){return ye.context},get inputs(){return[ye]},get numberOfInputs(){return ye.numberOfInputs},get numberOfOutputs(){return ye.numberOfOutputs},get pan(){return G.gain},addEventListener(...ie){return ye.addEventListener(ie[0],ie[1],ie[2])},dispatchEvent(...ie){return ye.dispatchEvent(ie[0])},removeEventListener(...ie){return ye.removeEventListener(ie[0],ie[1],ie[2])}};let k=!1;const q=()=>{C(),k=!0},J=()=>{T(),k=!1};return o(interceptConnections(O,se),q,J)}},createNativeWaveShaperNodeFactory=(r,e,t,n,s,o,u)=>(c,h)=>{const f=c.createWaveShaper();if(o!==null&&o.name==="webkitAudioContext"&&c.createGain().gain.automationRate===void 0)return t(c,h);assignNativeAudioNodeOptions(f,h);const d=h.curve===null||h.curve instanceof Float32Array?h.curve:new Float32Array(h.curve);if(d!==null&&d.length<2)throw e();assignNativeAudioNodeOption(f,{curve:d},"curve"),assignNativeAudioNodeOption(f,h,"oversample");let p=null,S=!1;return u(f,"curve",D=>()=>D.call(f),D=>L=>(D.call(f,L),S&&(n(L)&&p===null?p=r(c,f):!n(L)&&p!==null&&(p(),p=null)),L)),s(f,()=>{S=!0,n(f.curve)&&(p=r(c,f))},()=>{S=!1,p!==null&&(p(),p=null)})},createNativeWaveShaperNodeFakerFactory=(r,e,t,n,s)=>(o,{curve:u,oversample:c,...h})=>{const f=o.createWaveShaper(),d=o.createWaveShaper();assignNativeAudioNodeOptions(f,h),assignNativeAudioNodeOptions(d,h);const p=t(o,{...h,gain:1}),S=t(o,{...h,gain:-1}),E=t(o,{...h,gain:1}),N=t(o,{...h,gain:-1});let D=null,L=!1,W=null;const K={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(G){p.channelCount=G,S.channelCount=G,f.channelCount=G,E.channelCount=G,d.channelCount=G,N.channelCount=G},get channelCountMode(){return f.channelCountMode},set channelCountMode(G){p.channelCountMode=G,S.channelCountMode=G,f.channelCountMode=G,E.channelCountMode=G,d.channelCountMode=G,N.channelCountMode=G},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(G){p.channelInterpretation=G,S.channelInterpretation=G,f.channelInterpretation=G,E.channelInterpretation=G,d.channelInterpretation=G,N.channelInterpretation=G},get context(){return f.context},get curve(){return W},set curve(G){if(G!==null&&G.length<2)throw e();if(G===null)f.curve=G,d.curve=G;else{const C=G.length,T=new Float32Array(C+2-C%2),O=new Float32Array(C+2-C%2);T[0]=G[0],O[0]=-G[C-1];const k=Math.ceil((C+1)/2),q=(C+1)/2-1;for(let J=1;J<k;J+=1){const ie=J/k*q,xe=Math.floor(ie),fe=Math.ceil(ie);T[J]=xe===fe?G[xe]:(1-(ie-xe))*G[xe]+(1-(fe-ie))*G[fe],O[J]=xe===fe?-G[C-1-xe]:-((1-(ie-xe))*G[C-1-xe])-(1-(fe-ie))*G[C-1-fe]}T[k]=C%2===1?G[k-1]:(G[k-2]+G[k-1])/2,f.curve=T,d.curve=O}W=G,L&&(n(W)&&D===null?D=r(o,p):D!==null&&(D(),D=null))},get inputs(){return[p]},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get oversample(){return f.oversample},set oversample(G){f.oversample=G,d.oversample=G},addEventListener(...G){return p.addEventListener(G[0],G[1],G[2])},dispatchEvent(...G){return p.dispatchEvent(G[0])},removeEventListener(...G){return p.removeEventListener(G[0],G[1],G[2])}};u!==null&&(K.curve=u instanceof Float32Array?u:new Float32Array(u)),c!==K.oversample&&(K.oversample=c);const se=()=>{p.connect(f).connect(E),p.connect(S).connect(d).connect(N).connect(E),L=!0,n(W)&&(D=r(o,p))},ye=()=>{p.disconnect(f),f.disconnect(E),p.disconnect(S),S.disconnect(d),d.disconnect(N),N.disconnect(E),L=!1,D!==null&&(D(),D=null)};return s(interceptConnections(K,E),se,ye)},createNotSupportedError=()=>new DOMException("","NotSupportedError"),DEFAULT_OPTIONS$5={numberOfChannels:1},createOfflineAudioContextConstructor=(r,e,t,n,s)=>class extends r{constructor(u,c,h){let f;if(typeof u=="number"&&c!==void 0&&h!==void 0)f={length:c,numberOfChannels:u,sampleRate:h};else if(typeof u=="object")f=u;else throw new Error("The given parameters are not valid.");const{length:d,numberOfChannels:p,sampleRate:S}={...DEFAULT_OPTIONS$5,...f},E=n(p,d,S);e(testPromiseSupport,()=>testPromiseSupport(E))||E.addEventListener("statechange",(()=>{let N=0;const D=L=>{this._state==="running"&&(N>0?(E.removeEventListener("statechange",D),L.stopImmediatePropagation(),this._waitForThePromiseToSettle(L)):N+=1)};return D})()),super(E,p),this._length=d,this._nativeOfflineAudioContext=E,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",s(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,deactivateAudioGraph(this)}))}_waitForThePromiseToSettle(u){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(u):setTimeout(()=>this._waitForThePromiseToSettle(u))}},DEFAULT_OPTIONS$4={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},createOscillatorNodeConstructor=(r,e,t,n,s,o,u)=>class extends r{constructor(h,f){const d=s(h),p={...DEFAULT_OPTIONS$4,...f},S=t(d,p),E=o(d),N=E?n():null,D=h.sampleRate/2;super(h,!1,S,N),this._detune=e(this,E,S.detune,153600,-153600),this._frequency=e(this,E,S.frequency,D,-D),this._nativeOscillatorNode=S,this._onended=null,this._oscillatorNodeRenderer=N,this._oscillatorNodeRenderer!==null&&p.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=p.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(h){const f=typeof h=="function"?u(this,h):null;this._nativeOscillatorNode.onended=f;const d=this._nativeOscillatorNode.onended;this._onended=d!==null&&d===f?h:d}get type(){return this._nativeOscillatorNode.type}set type(h){this._nativeOscillatorNode.type=h,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(h){this._nativeOscillatorNode.setPeriodicWave(h),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=h)}start(h=0){if(this._nativeOscillatorNode.start(h),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=h),this.context.state!=="closed"){setInternalStateToActive(this);const f=()=>{this._nativeOscillatorNode.removeEventListener("ended",f),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeOscillatorNode.addEventListener("ended",f)}}stop(h=0){this._nativeOscillatorNode.stop(h),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=h)}},createOscillatorNodeRendererFactory=(r,e,t,n,s)=>()=>{const o=new WeakMap;let u=null,c=null,h=null;const f=async(d,p)=>{let S=t(d);const E=isOwnedByContext(S,p);if(!E){const N={channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,detune:S.detune.value,frequency:S.frequency.value,periodicWave:u===null?void 0:u,type:S.type};S=e(p,N),c!==null&&S.start(c),h!==null&&S.stop(h)}return o.set(p,S),E?(await r(p,d.detune,S.detune),await r(p,d.frequency,S.frequency)):(await n(p,d.detune,S.detune),await n(p,d.frequency,S.frequency)),await s(d,p,S),S};return{set periodicWave(d){u=d},set start(d){c=d},set stop(d){h=d},render(d,p){const S=o.get(p);return S!==void 0?Promise.resolve(S):f(d,p)}}},DEFAULT_OPTIONS$3={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},createPannerNodeConstructor=(r,e,t,n,s,o,u)=>class extends r{constructor(h,f){const d=s(h),p={...DEFAULT_OPTIONS$3,...f},S=t(d,p),E=o(d),N=E?n():null;super(h,!1,S,N),this._nativePannerNode=S,this._orientationX=e(this,E,S.orientationX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationY=e(this,E,S.orientationY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationZ=e(this,E,S.orientationZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionX=e(this,E,S.positionX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionY=e(this,E,S.positionY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionZ=e(this,E,S.positionZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),u(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(h){this._nativePannerNode.coneInnerAngle=h}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(h){this._nativePannerNode.coneOuterAngle=h}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(h){this._nativePannerNode.coneOuterGain=h}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(h){this._nativePannerNode.distanceModel=h}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(h){this._nativePannerNode.maxDistance=h}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(h){this._nativePannerNode.panningModel=h}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(h){this._nativePannerNode.refDistance=h}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(h){this._nativePannerNode.rolloffFactor=h}},createPannerNodeRendererFactory=(r,e,t,n,s,o,u,c,h,f)=>()=>{const d=new WeakMap;let p=null;const S=async(E,N)=>{let D=null,L=o(E);const W={channelCount:L.channelCount,channelCountMode:L.channelCountMode,channelInterpretation:L.channelInterpretation},K={...W,coneInnerAngle:L.coneInnerAngle,coneOuterAngle:L.coneOuterAngle,coneOuterGain:L.coneOuterGain,distanceModel:L.distanceModel,maxDistance:L.maxDistance,panningModel:L.panningModel,refDistance:L.refDistance,rolloffFactor:L.rolloffFactor},se=isOwnedByContext(L,N);if("bufferSize"in L)D=n(N,{...W,gain:1});else if(!se){const ye={...K,orientationX:L.orientationX.value,orientationY:L.orientationY.value,orientationZ:L.orientationZ.value,positionX:L.positionX.value,positionY:L.positionY.value,positionZ:L.positionZ.value};L=s(N,ye)}if(d.set(N,D===null?L:D),D!==null){if(p===null){if(u===null)throw new Error("Missing the native OfflineAudioContext constructor.");const J=new u(6,E.context.length,N.sampleRate),ie=e(J,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});ie.connect(J.destination),p=(async()=>{const xe=await Promise.all([E.orientationX,E.orientationY,E.orientationZ,E.positionX,E.positionY,E.positionZ].map(async(fe,we)=>{const Ee=t(J,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:we===0?1:0});return await c(J,fe,Ee.offset),Ee}));for(let fe=0;fe<6;fe+=1)xe[fe].connect(ie,0,fe),xe[fe].start(0);return f(J)})()}const ye=await p,G=n(N,{...W,gain:1});await h(E,N,G);const C=[];for(let J=0;J<ye.numberOfChannels;J+=1)C.push(ye.getChannelData(J));let T=[C[0][0],C[1][0],C[2][0]],O=[C[3][0],C[4][0],C[5][0]],k=n(N,{...W,gain:1}),q=s(N,{...K,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:O[0],positionY:O[1],positionZ:O[2]});G.connect(k).connect(q.inputs[0]),q.connect(D);for(let J=128;J<ye.length;J+=128){const ie=[C[0][J],C[1][J],C[2][J]],xe=[C[3][J],C[4][J],C[5][J]];if(ie.some((fe,we)=>fe!==T[we])||xe.some((fe,we)=>fe!==O[we])){T=ie,O=xe;const fe=J/N.sampleRate;k.gain.setValueAtTime(0,fe),k=n(N,{...W,gain:0}),q=s(N,{...K,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:O[0],positionY:O[1],positionZ:O[2]}),k.gain.setValueAtTime(1,fe),G.connect(k).connect(q.inputs[0]),q.connect(D)}}return D}return se?(await r(N,E.orientationX,L.orientationX),await r(N,E.orientationY,L.orientationY),await r(N,E.orientationZ,L.orientationZ),await r(N,E.positionX,L.positionX),await r(N,E.positionY,L.positionY),await r(N,E.positionZ,L.positionZ)):(await c(N,E.orientationX,L.orientationX),await c(N,E.orientationY,L.orientationY),await c(N,E.orientationZ,L.orientationZ),await c(N,E.positionX,L.positionX),await c(N,E.positionY,L.positionY),await c(N,E.positionZ,L.positionZ)),isNativeAudioNodeFaker(L)?await h(E,N,L.inputs[0]):await h(E,N,L),L};return{render(E,N){const D=d.get(N);return D!==void 0?Promise.resolve(D):S(E,N)}}},DEFAULT_OPTIONS$2={disableNormalization:!1},createPeriodicWaveConstructor=(r,e,t,n)=>class Ro{constructor(o,u){const c=e(o),h=n({...DEFAULT_OPTIONS$2,...u}),f=r(c,h);return t.add(f),f}static[Symbol.hasInstance](o){return o!==null&&typeof o=="object"&&Object.getPrototypeOf(o)===Ro.prototype||t.has(o)}},createRenderAutomation=(r,e)=>(t,n,s)=>(r(n).replay(s),e(n,t,s)),createRenderInputsOfAudioNode=(r,e,t)=>async(n,s,o)=>{const u=r(n);await Promise.all(u.activeInputs.map((c,h)=>Array.from(c).map(async([f,d])=>{const S=await e(f).render(f,s),E=n.context.destination;!t(f)&&(n!==E||!t(n))&&S.connect(o,d,h)})).reduce((c,h)=>[...c,...h],[]))},createRenderInputsOfAudioParam=(r,e,t)=>async(n,s,o)=>{const u=e(n);await Promise.all(Array.from(u.activeInputs).map(async([c,h])=>{const d=await r(c).render(c,s);t(c)||d.connect(o,h)}))},createRenderNativeOfflineAudioContext=(r,e,t,n)=>s=>r(testPromiseSupport,()=>testPromiseSupport(s))?Promise.resolve(r(n,n)).then(o=>{if(!o){const u=t(s,512,0,1);s.oncomplete=()=>{u.onaudioprocess=null,u.disconnect()},u.onaudioprocess=()=>s.currentTime,u.connect(s.destination)}return s.startRendering()}):new Promise(o=>{const u=e(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.oncomplete=c=>{u.disconnect(),o(c.renderedBuffer)},u.connect(s.destination),s.startRendering()}),createSetActiveAudioWorkletNodeInputs=r=>(e,t)=>{r.set(e,t)},createSetAudioNodeTailTime=r=>(e,t)=>r.set(e,t),createStartRendering=(r,e,t,n,s,o,u,c)=>(h,f)=>t(h).render(h,f).then(()=>Promise.all(Array.from(n(f)).map(d=>t(d).render(d,f)))).then(()=>s(f)).then(d=>(typeof d.copyFromChannel!="function"?(u(d),wrapAudioBufferGetChannelDataMethod(d)):e(o,()=>o(d))||c(d),r.add(d),d)),DEFAULT_OPTIONS$1={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},createStereoPannerNodeConstructor=(r,e,t,n,s,o)=>class extends r{constructor(c,h){const f=s(c),d={...DEFAULT_OPTIONS$1,...h},p=t(f,d),S=o(f),E=S?n():null;super(c,!1,p,E),this._pan=e(this,S,p.pan)}get pan(){return this._pan}},createStereoPannerNodeRendererFactory=(r,e,t,n,s)=>()=>{const o=new WeakMap,u=async(c,h)=>{let f=t(c);const d=isOwnedByContext(f,h);if(!d){const p={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,pan:f.pan.value};f=e(h,p)}return o.set(h,f),d?await r(h,c.pan,f.pan):await n(h,c.pan,f.pan),isNativeAudioNodeFaker(f)?await s(c,h,f.inputs[0]):await s(c,h,f),f};return{render(c,h){const f=o.get(h);return f!==void 0?Promise.resolve(f):u(c,h)}}},createTestAudioBufferConstructorSupport=r=>()=>{if(r===null)return!1;try{new r({length:1,sampleRate:44100})}catch{return!1}return!0},createTestAudioWorkletProcessorPostMessageSupport=(r,e)=>async()=>{if(r===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),s=URL.createObjectURL(t);let o=!1,u=!1;try{await n.audioWorklet.addModule(s);const c=new r(n,"a",{numberOfOutputs:0}),h=n.createOscillator();c.port.onmessage=()=>o=!0,c.onprocessorerror=()=>u=!0,h.connect(c),h.start(0),await n.startRendering()}catch{}finally{URL.revokeObjectURL(s)}return o&&!u},createTestOfflineAudioContextCurrentTimeSupport=(r,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),n=r(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(s=>{t.oncomplete=()=>{n.disconnect(),s(t.currentTime!==0)},t.startRendering()})},createUnknownError=()=>new DOMException("","UnknownError"),DEFAULT_OPTIONS={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},createWaveShaperNodeConstructor=(r,e,t,n,s,o,u)=>class extends r{constructor(h,f){const d=s(h),p={...DEFAULT_OPTIONS,...f},S=t(d,p),N=o(d)?n():null;super(h,!0,S,N),this._isCurveNullified=!1,this._nativeWaveShaperNode=S,u(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(h){if(h===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(h.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=h}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(h){this._nativeWaveShaperNode.oversample=h}},createWaveShaperNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(o,u)=>{let c=e(o);if(!isOwnedByContext(c,u)){const f={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,curve:c.curve,oversample:c.oversample};c=r(u,f)}return n.set(u,c),isNativeAudioNodeFaker(c)?await t(o,u,c.inputs[0]):await t(o,u,c),c};return{render(o,u){const c=n.get(u);return c!==void 0?Promise.resolve(c):s(o,u)}}},createWindow=()=>typeof window>"u"?null:window,createWrapAudioBufferCopyChannelMethods=(r,e)=>t=>{t.copyFromChannel=(n,s,o=0)=>{const u=r(o),c=r(s);if(c>=t.numberOfChannels)throw e();const h=t.length,f=t.getChannelData(c),d=n.length;for(let p=u<0?-u:0;p+u<h&&p<d;p+=1)n[p]=f[p+u]},t.copyToChannel=(n,s,o=0)=>{const u=r(o),c=r(s);if(c>=t.numberOfChannels)throw e();const h=t.length,f=t.getChannelData(c),d=n.length;for(let p=u<0?-u:0;p+u<h&&p<d;p+=1)f[p+u]=n[p]}},createWrapAudioBufferCopyChannelMethodsOutOfBounds=r=>e=>{e.copyFromChannel=(t=>(n,s,o=0)=>{const u=r(o),c=r(s);if(u<e.length)return t.call(e,n,c,u)})(e.copyFromChannel),e.copyToChannel=(t=>(n,s,o=0)=>{const u=r(o),c=r(s);if(u<e.length)return t.call(e,n,c,u)})(e.copyToChannel)},createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer=r=>(e,t)=>{const n=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),r(e,"buffer",s=>()=>{const o=s.call(e);return o===n?null:o},s=>o=>s.call(e,o===null?n:o))},createWrapChannelMergerNode=(r,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw r()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw r()}});const s=t.createBufferSource();e(n,()=>{const c=n.numberOfInputs;for(let h=0;h<c;h+=1)s.connect(n,0,h)},()=>s.disconnect(n))},getFirstSample=(r,e,t)=>r.copyFromChannel===void 0?r.getChannelData(t)[0]:(r.copyFromChannel(e,t),e[0]),isDCCurve=r=>{if(r===null)return!1;const e=r.length;return e%2!==0?r[Math.floor(e/2)]!==0:r[e/2-1]+r[e/2]!==0},overwriteAccessors=(r,e,t,n)=>{let s=r;for(;!s.hasOwnProperty(e);)s=Object.getPrototypeOf(s);const{get:o,set:u}=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(r,e,{get:t(o),set:n(u)})},sanitizeAudioWorkletNodeOptions=r=>({...r,outputChannelCount:r.outputChannelCount!==void 0?r.outputChannelCount:r.numberOfInputs===1&&r.numberOfOutputs===1?[r.channelCount]:Array.from({length:r.numberOfOutputs},()=>1)}),sanitizeChannelSplitterOptions=r=>({...r,channelCount:r.numberOfOutputs}),sanitizePeriodicWaveOptions=r=>{const{imag:e,real:t}=r;return e===void 0?t===void 0?{...r,imag:[0,0],real:[0,0]}:{...r,imag:Array.from(t,()=>0),real:t}:t===void 0?{...r,imag:e,real:Array.from(e,()=>0)}:{...r,imag:e,real:t}},setValueAtTimeUntilPossible=(r,e,t)=>{try{r.setValueAtTime(e,t)}catch(n){if(n.code!==9)throw n;setValueAtTimeUntilPossible(r,e,t+1e-7)}},testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport=r=>{const e=r.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},testAudioBufferSourceNodeStartMethodOffsetClampingSupport=r=>{const e=r.createBufferSource(),t=r.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},testAudioBufferSourceNodeStopMethodNullifiedBufferSupport=r=>{const e=r.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},testAudioScheduledSourceNodeStartMethodNegativeParametersSupport=r=>{const e=r.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport=r=>{const e=r.createBuffer(1,1,44100),t=r.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},testAudioScheduledSourceNodeStopMethodNegativeParametersSupport=r=>{const e=r.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},testAudioWorkletNodeOptionsClonability=r=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(r)}finally{e.close(),t.close()}},wrapAudioBufferSourceNodeStartMethodOffsetClamping=r=>{r.start=(e=>(t=0,n=0,s)=>{const o=r.buffer,u=o===null?n:Math.min(o.duration,n);o!==null&&u>o.duration-.5/r.context.sampleRate?e.call(r,t,0,0):e.call(r,t,u,s)})(r.start)},wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls=(r,e)=>{const t=e.createGain();r.connect(t);const n=(s=>()=>{s.call(r,t),r.removeEventListener("ended",n)})(r.disconnect);r.addEventListener("ended",n),interceptConnections(r,t),r.stop=(s=>{let o=!1;return(u=0)=>{if(o)try{s.call(r,u)}catch{t.gain.setValueAtTime(0,u)}else s.call(r,u),o=!0}})(r.stop)},wrapEventListener=(r,e)=>t=>{const n={value:r};return Object.defineProperties(t,{currentTarget:n,target:n}),typeof e=="function"?e.call(r,t):e.handleEvent.call(r,t)},addActiveInputConnectionToAudioNode=createAddActiveInputConnectionToAudioNode(insertElementInSet),addPassiveInputConnectionToAudioNode=createAddPassiveInputConnectionToAudioNode(insertElementInSet),deleteActiveInputConnectionToAudioNode=createDeleteActiveInputConnectionToAudioNode(pickElementFromSet),audioNodeTailTimeStore=new WeakMap,getAudioNodeTailTime=createGetAudioNodeTailTime(audioNodeTailTimeStore),cacheTestResult=createCacheTestResult(new Map,new WeakMap),window$1=createWindow(),createNativeAnalyserNode=createNativeAnalyserNodeFactory(cacheTestResult,createIndexSizeError),getAudioNodeRenderer=createGetAudioNodeRenderer(getAudioNodeConnections),renderInputsOfAudioNode=createRenderInputsOfAudioNode(getAudioNodeConnections,getAudioNodeRenderer,isPartOfACycle),createAnalyserNodeRenderer=createAnalyserNodeRendererFactory(createNativeAnalyserNode,getNativeAudioNode,renderInputsOfAudioNode),getNativeContext=createGetNativeContext(CONTEXT_STORE),nativeOfflineAudioContextConstructor=createNativeOfflineAudioContextConstructor(window$1),isNativeOfflineAudioContext=createIsNativeOfflineAudioContext(nativeOfflineAudioContextConstructor),audioParamAudioNodeStore=new WeakMap,eventTargetConstructor=createEventTargetConstructor(wrapEventListener),nativeAudioContextConstructor=createNativeAudioContextConstructor(window$1),isNativeAudioContext=createIsNativeAudioContext(nativeAudioContextConstructor),isNativeAudioNode=createIsNativeAudioNode(window$1),isNativeAudioParam=createIsNativeAudioParam(window$1),nativeAudioWorkletNodeConstructor=createNativeAudioWorkletNodeConstructor(window$1),audioNodeConstructor=createAudioNodeConstructor(createAddAudioNodeConnections(AUDIO_NODE_CONNECTIONS_STORE),createAddConnectionToAudioNode(addActiveInputConnectionToAudioNode,addPassiveInputConnectionToAudioNode,connectNativeAudioNodeToNativeAudioNode,deleteActiveInputConnectionToAudioNode,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getAudioNodeTailTime,getEventListenersOfAudioNode,getNativeAudioNode,insertElementInSet,isActiveAudioNode,isPartOfACycle,isPassiveAudioNode),cacheTestResult,createIncrementCycleCounterFactory(CYCLE_COUNTERS,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,isActiveAudioNode),createIndexSizeError,createInvalidAccessError,createNotSupportedError,createDecrementCycleCounter(connectNativeAudioNodeToNativeAudioNode,CYCLE_COUNTERS,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,getNativeContext,isActiveAudioNode,isNativeOfflineAudioContext),createDetectCycles(audioParamAudioNodeStore,getAudioNodeConnections,getValueForKey),eventTargetConstructor,getNativeContext,isNativeAudioContext,isNativeAudioNode,isNativeAudioParam,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor),analyserNodeConstructor=createAnalyserNodeConstructor(audioNodeConstructor,createAnalyserNodeRenderer,createIndexSizeError,createNativeAnalyserNode,getNativeContext,isNativeOfflineAudioContext),audioBufferStore=new WeakSet,nativeAudioBufferConstructor=createNativeAudioBufferConstructor(window$1),convertNumberToUnsignedLong=createConvertNumberToUnsignedLong(new Uint32Array(1)),wrapAudioBufferCopyChannelMethods=createWrapAudioBufferCopyChannelMethods(convertNumberToUnsignedLong,createIndexSizeError),wrapAudioBufferCopyChannelMethodsOutOfBounds=createWrapAudioBufferCopyChannelMethodsOutOfBounds(convertNumberToUnsignedLong),audioBufferConstructor=createAudioBufferConstructor(audioBufferStore,cacheTestResult,createNotSupportedError,nativeAudioBufferConstructor,nativeOfflineAudioContextConstructor,createTestAudioBufferConstructorSupport(nativeAudioBufferConstructor),wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),addSilentConnection=createAddSilentConnection(createNativeGainNode),renderInputsOfAudioParam=createRenderInputsOfAudioParam(getAudioNodeRenderer,getAudioParamConnections,isPartOfACycle),connectAudioParam=createConnectAudioParam(renderInputsOfAudioParam),createNativeAudioBufferSourceNode=createNativeAudioBufferSourceNodeFactory(addSilentConnection,cacheTestResult,testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport,testAudioBufferSourceNodeStartMethodOffsetClampingSupport,testAudioBufferSourceNodeStopMethodNullifiedBufferSupport,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioBufferSourceNodeStartMethodOffsetClamping,createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer(overwriteAccessors),wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),renderAutomation=createRenderAutomation(createGetAudioParamRenderer(getAudioParamConnections),renderInputsOfAudioParam),createAudioBufferSourceNodeRenderer=createAudioBufferSourceNodeRendererFactory(connectAudioParam,createNativeAudioBufferSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),createAudioParam=createAudioParamFactory(createAddAudioParamConnections(AUDIO_PARAM_CONNECTIONS_STORE),audioParamAudioNodeStore,AUDIO_PARAM_STORE,createAudioParamRenderer,createCancelAndHoldAutomationEvent,createCancelScheduledValuesAutomationEvent,createExponentialRampToValueAutomationEvent,createLinearRampToValueAutomationEvent,createSetTargetAutomationEvent,createSetValueAutomationEvent,createSetValueCurveAutomationEvent,nativeAudioContextConstructor,setValueAtTimeUntilPossible),audioBufferSourceNodeConstructor=createAudioBufferSourceNodeConstructor(audioNodeConstructor,createAudioBufferSourceNodeRenderer,createAudioParam,createInvalidStateError,createNativeAudioBufferSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),audioDestinationNodeConstructor=createAudioDestinationNodeConstructor(audioNodeConstructor,createAudioDestinationNodeRenderer,createIndexSizeError,createInvalidStateError,createNativeAudioDestinationNodeFactory(createNativeGainNode,overwriteAccessors),getNativeContext,isNativeOfflineAudioContext,renderInputsOfAudioNode),createBiquadFilterNodeRenderer=createBiquadFilterNodeRendererFactory(connectAudioParam,createNativeBiquadFilterNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),setAudioNodeTailTime=createSetAudioNodeTailTime(audioNodeTailTimeStore),biquadFilterNodeConstructor=createBiquadFilterNodeConstructor(audioNodeConstructor,createAudioParam,createBiquadFilterNodeRenderer,createInvalidAccessError,createNativeBiquadFilterNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),monitorConnections=createMonitorConnections(insertElementInSet,isNativeAudioNode),wrapChannelMergerNode=createWrapChannelMergerNode(createInvalidStateError,monitorConnections),createNativeChannelMergerNode=createNativeChannelMergerNodeFactory(nativeAudioContextConstructor,wrapChannelMergerNode),createChannelMergerNodeRenderer=createChannelMergerNodeRendererFactory(createNativeChannelMergerNode,getNativeAudioNode,renderInputsOfAudioNode),channelMergerNodeConstructor=createChannelMergerNodeConstructor(audioNodeConstructor,createChannelMergerNodeRenderer,createNativeChannelMergerNode,getNativeContext,isNativeOfflineAudioContext),createChannelSplitterNodeRenderer=createChannelSplitterNodeRendererFactory(createNativeChannelSplitterNode,getNativeAudioNode,renderInputsOfAudioNode),channelSplitterNodeConstructor=createChannelSplitterNodeConstructor(audioNodeConstructor,createChannelSplitterNodeRenderer,createNativeChannelSplitterNode,getNativeContext,isNativeOfflineAudioContext,sanitizeChannelSplitterOptions),createNativeConstantSourceNodeFaker=createNativeConstantSourceNodeFakerFactory(addSilentConnection,createNativeAudioBufferSourceNode,createNativeGainNode,monitorConnections),createNativeConstantSourceNode=createNativeConstantSourceNodeFactory(addSilentConnection,cacheTestResult,createNativeConstantSourceNodeFaker,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport),createConstantSourceNodeRenderer=createConstantSourceNodeRendererFactory(connectAudioParam,createNativeConstantSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),constantSourceNodeConstructor=createConstantSourceNodeConstructor(audioNodeConstructor,createAudioParam,createConstantSourceNodeRenderer,createNativeConstantSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createNativeConvolverNode=createNativeConvolverNodeFactory(createNotSupportedError,overwriteAccessors),createConvolverNodeRenderer=createConvolverNodeRendererFactory(createNativeConvolverNode,getNativeAudioNode,renderInputsOfAudioNode),convolverNodeConstructor=createConvolverNodeConstructor(audioNodeConstructor,createConvolverNodeRenderer,createNativeConvolverNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createDelayNodeRenderer=createDelayNodeRendererFactory(connectAudioParam,createNativeDelayNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),delayNodeConstructor=createDelayNodeConstructor(audioNodeConstructor,createAudioParam,createDelayNodeRenderer,createNativeDelayNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativeDynamicsCompressorNode=createNativeDynamicsCompressorNodeFactory(createNotSupportedError),createDynamicsCompressorNodeRenderer=createDynamicsCompressorNodeRendererFactory(connectAudioParam,createNativeDynamicsCompressorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),dynamicsCompressorNodeConstructor=createDynamicsCompressorNodeConstructor(audioNodeConstructor,createAudioParam,createDynamicsCompressorNodeRenderer,createNativeDynamicsCompressorNode,createNotSupportedError,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createGainNodeRenderer=createGainNodeRendererFactory(connectAudioParam,createNativeGainNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),gainNodeConstructor=createGainNodeConstructor(audioNodeConstructor,createAudioParam,createGainNodeRenderer,createNativeGainNode,getNativeContext,isNativeOfflineAudioContext),createNativeIIRFilterNodeFaker=createNativeIIRFilterNodeFakerFactory(createInvalidAccessError,createInvalidStateError,createNativeScriptProcessorNode,createNotSupportedError),renderNativeOfflineAudioContext=createRenderNativeOfflineAudioContext(cacheTestResult,createNativeGainNode,createNativeScriptProcessorNode,createTestOfflineAudioContextCurrentTimeSupport(createNativeGainNode,nativeOfflineAudioContextConstructor)),createIIRFilterNodeRenderer=createIIRFilterNodeRendererFactory(createNativeAudioBufferSourceNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderInputsOfAudioNode,renderNativeOfflineAudioContext),createNativeIIRFilterNode=createNativeIIRFilterNodeFactory(createNativeIIRFilterNodeFaker),iIRFilterNodeConstructor=createIIRFilterNodeConstructor(audioNodeConstructor,createNativeIIRFilterNode,createIIRFilterNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createAudioListener=createAudioListenerFactory(createAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeScriptProcessorNode,createNotSupportedError,getFirstSample,isNativeOfflineAudioContext,overwriteAccessors),unrenderedAudioWorkletNodeStore=new WeakMap,minimalBaseAudioContextConstructor=createMinimalBaseAudioContextConstructor(audioDestinationNodeConstructor,createAudioListener,eventTargetConstructor,isNativeOfflineAudioContext,unrenderedAudioWorkletNodeStore,wrapEventListener),createNativeOscillatorNode=createNativeOscillatorNodeFactory(addSilentConnection,cacheTestResult,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),createOscillatorNodeRenderer=createOscillatorNodeRendererFactory(connectAudioParam,createNativeOscillatorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),oscillatorNodeConstructor=createOscillatorNodeConstructor(audioNodeConstructor,createAudioParam,createNativeOscillatorNode,createOscillatorNodeRenderer,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createConnectedNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNodeFactory(createNativeAudioBufferSourceNode),createNativeWaveShaperNodeFaker=createNativeWaveShaperNodeFakerFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeGainNode,isDCCurve,monitorConnections),createNativeWaveShaperNode=createNativeWaveShaperNodeFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeWaveShaperNodeFaker,isDCCurve,monitorConnections,nativeAudioContextConstructor,overwriteAccessors),createNativePannerNodeFaker=createNativePannerNodeFakerFactory(connectNativeAudioNodeToNativeAudioNode,createInvalidStateError,createNativeChannelMergerNode,createNativeGainNode,createNativeScriptProcessorNode,createNativeWaveShaperNode,createNotSupportedError,disconnectNativeAudioNodeFromNativeAudioNode,getFirstSample,monitorConnections),createNativePannerNode=createNativePannerNodeFactory(createNativePannerNodeFaker),createPannerNodeRenderer=createPannerNodeRendererFactory(connectAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeGainNode,createNativePannerNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),pannerNodeConstructor=createPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativePannerNode,createPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativePeriodicWave=createNativePeriodicWaveFactory(createIndexSizeError),periodicWaveConstructor=createPeriodicWaveConstructor(createNativePeriodicWave,getNativeContext,new WeakSet,sanitizePeriodicWaveOptions),nativeStereoPannerNodeFakerFactory=createNativeStereoPannerNodeFakerFactory(createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeGainNode,createNativeWaveShaperNode,createNotSupportedError,monitorConnections),createNativeStereoPannerNode=createNativeStereoPannerNodeFactory(nativeStereoPannerNodeFakerFactory,createNotSupportedError),createStereoPannerNodeRenderer=createStereoPannerNodeRendererFactory(connectAudioParam,createNativeStereoPannerNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),stereoPannerNodeConstructor=createStereoPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativeStereoPannerNode,createStereoPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext),createWaveShaperNodeRenderer=createWaveShaperNodeRendererFactory(createNativeWaveShaperNode,getNativeAudioNode,renderInputsOfAudioNode),waveShaperNodeConstructor=createWaveShaperNodeConstructor(audioNodeConstructor,createInvalidStateError,createNativeWaveShaperNode,createWaveShaperNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),isSecureContext=createIsSecureContext(window$1),exposeCurrentFrameAndCurrentTime=createExposeCurrentFrameAndCurrentTime(window$1),backupOfflineAudioContextStore=new WeakMap,getOrCreateBackupOfflineAudioContext=createGetOrCreateBackupOfflineAudioContext(backupOfflineAudioContextStore,nativeOfflineAudioContextConstructor),addAudioWorkletModule=isSecureContext?createAddAudioWorkletModule(cacheTestResult,createNotSupportedError,createEvaluateSource(window$1),exposeCurrentFrameAndCurrentTime,createFetchSource(createAbortError),getNativeContext,getOrCreateBackupOfflineAudioContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,new WeakMap,new WeakMap,createTestAudioWorkletProcessorPostMessageSupport(nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor),window$1):void 0,isNativeContext=createIsNativeContext(isNativeAudioContext,isNativeOfflineAudioContext),decodeAudioData=createDecodeAudioData(audioBufferStore,cacheTestResult,createDataCloneError,createEncodingError,new WeakSet,getNativeContext,isNativeContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,testPromiseSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),baseAudioContextConstructor=createBaseAudioContextConstructor(addAudioWorkletModule,analyserNodeConstructor,audioBufferConstructor,audioBufferSourceNodeConstructor,biquadFilterNodeConstructor,channelMergerNodeConstructor,channelSplitterNodeConstructor,constantSourceNodeConstructor,convolverNodeConstructor,decodeAudioData,delayNodeConstructor,dynamicsCompressorNodeConstructor,gainNodeConstructor,iIRFilterNodeConstructor,minimalBaseAudioContextConstructor,oscillatorNodeConstructor,pannerNodeConstructor,periodicWaveConstructor,stereoPannerNodeConstructor,waveShaperNodeConstructor),mediaElementAudioSourceNodeConstructor=createMediaElementAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaElementAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioDestinationNodeConstructor=createMediaStreamAudioDestinationNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioDestinationNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioSourceNodeConstructor=createMediaStreamAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),createNativeMediaStreamTrackAudioSourceNode=createNativeMediaStreamTrackAudioSourceNodeFactory(createInvalidStateError,isNativeOfflineAudioContext),mediaStreamTrackAudioSourceNodeConstructor=createMediaStreamTrackAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamTrackAudioSourceNode,getNativeContext),audioContextConstructor=createAudioContextConstructor(baseAudioContextConstructor,createInvalidStateError,createNotSupportedError,createUnknownError,mediaElementAudioSourceNodeConstructor,mediaStreamAudioDestinationNodeConstructor,mediaStreamAudioSourceNodeConstructor,mediaStreamTrackAudioSourceNodeConstructor,nativeAudioContextConstructor),getUnrenderedAudioWorkletNodes=createGetUnrenderedAudioWorkletNodes(unrenderedAudioWorkletNodeStore),addUnrenderedAudioWorkletNode=createAddUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),connectMultipleOutputs=createConnectMultipleOutputs(createIndexSizeError),deleteUnrenderedAudioWorkletNode=createDeleteUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),disconnectMultipleOutputs=createDisconnectMultipleOutputs(createIndexSizeError),activeAudioWorkletNodeInputsStore=new WeakMap,getActiveAudioWorkletNodeInputs=createGetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore,getValueForKey),createNativeAudioWorkletNodeFaker=createNativeAudioWorkletNodeFakerFactory(connectMultipleOutputs,createIndexSizeError,createInvalidStateError,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,createNativeScriptProcessorNode,createNotSupportedError,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getActiveAudioWorkletNodeInputs,monitorConnections),createNativeAudioWorkletNode=createNativeAudioWorkletNodeFactory(createInvalidStateError,createNativeAudioWorkletNodeFaker,createNativeGainNode,createNotSupportedError,monitorConnections),createAudioWorkletNodeRenderer=createAudioWorkletNodeRendererFactory(connectAudioParam,connectMultipleOutputs,createNativeAudioBufferSourceNode,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,deleteUnrenderedAudioWorkletNode,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getNativeAudioNode,nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),getBackupOfflineAudioContext=createGetBackupOfflineAudioContext(backupOfflineAudioContextStore),setActiveAudioWorkletNodeInputs=createSetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore),audioWorkletNodeConstructor=isSecureContext?createAudioWorkletNodeConstructor(addUnrenderedAudioWorkletNode,audioNodeConstructor,createAudioParam,createAudioWorkletNodeRenderer,createNativeAudioWorkletNode,getAudioNodeConnections,getBackupOfflineAudioContext,getNativeContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,sanitizeAudioWorkletNodeOptions,setActiveAudioWorkletNodeInputs,testAudioWorkletNodeOptionsClonability,wrapEventListener):void 0,createNativeOfflineAudioContext=createCreateNativeOfflineAudioContext(createNotSupportedError,nativeOfflineAudioContextConstructor),startRendering=createStartRendering(audioBufferStore,cacheTestResult,getAudioNodeRenderer,getUnrenderedAudioWorkletNodes,renderNativeOfflineAudioContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),offlineAudioContextConstructor=createOfflineAudioContextConstructor(baseAudioContextConstructor,cacheTestResult,createInvalidStateError,createNativeOfflineAudioContext,startRendering),isAnyAudioContext=createIsAnyAudioContext(CONTEXT_STORE,isNativeAudioContext),isAnyAudioNode=createIsAnyAudioNode(AUDIO_NODE_STORE,isNativeAudioNode),isAnyAudioParam=createIsAnyAudioParam(AUDIO_PARAM_STORE,isNativeAudioParam),isAnyOfflineAudioContext=createIsAnyOfflineAudioContext(CONTEXT_STORE,isNativeOfflineAudioContext);function assert(r,e){if(!r)throw new Error(e)}function assertRange(r,e,t=1/0){if(!(e<=r&&r<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${r}`)}function assertContextRunning(r){!r.isOffline&&r.state!=="running"&&warn('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let defaultLogger=console;function log(...r){defaultLogger.log(...r)}function warn(...r){defaultLogger.warn(...r)}function isUndef(r){return typeof r>"u"}function isDefined(r){return!isUndef(r)}function isFunction(r){return typeof r=="function"}function isNumber(r){return typeof r=="number"}function isObject(r){return Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object}function isBoolean(r){return typeof r=="boolean"}function isArray(r){return Array.isArray(r)}function isString(r){return typeof r=="string"}function isNote(r){return isString(r)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(r)}function createAudioContext(r){return new audioContextConstructor(r)}function createOfflineAudioContext(r,e,t){return new offlineAudioContextConstructor(r,e,t)}const theWindow=typeof self=="object"?self:null,hasAudioContext=theWindow&&(theWindow.hasOwnProperty("AudioContext")||theWindow.hasOwnProperty("webkitAudioContext"));function createAudioWorkletNode(r,e,t){return assert(isDefined(audioWorkletNodeConstructor),"This node only works in a secure context (https or localhost)"),new audioWorkletNodeConstructor(r,e,t)}function __decorate(r,e,t,n){var s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var c=r.length-1;c>=0;c--)(u=r[c])&&(o=(s<3?u(o):s>3?u(e,t,o):u(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}function __awaiter(r,e,t,n){function s(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function c(d){try{f(n.next(d))}catch(p){u(p)}}function h(d){try{f(n.throw(d))}catch(p){u(p)}}function f(d){d.done?o(d.value):s(d.value).then(c,h)}f((n=n.apply(r,e||[])).next())})}class Ticker{constructor(e,t,n){this._callback=e,this._type=t,this._updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(e*1e3,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function isAudioParam(r){return isAnyAudioParam(r)}function isAudioNode(r){return isAnyAudioNode(r)}function isOfflineAudioContext(r){return isAnyOfflineAudioContext(r)}function isAudioContext(r){return isAnyAudioContext(r)}function isAudioBuffer(r){return r instanceof AudioBuffer}function noCopy(r,e){return r==="value"||isAudioParam(e)||isAudioNode(e)||isAudioBuffer(e)}function deepMerge(r,...e){if(!e.length)return r;const t=e.shift();if(isObject(r)&&isObject(t))for(const n in t)noCopy(n,t[n])?r[n]=t[n]:isObject(t[n])?(r[n]||Object.assign(r,{[n]:{}}),deepMerge(r[n],t[n])):Object.assign(r,{[n]:t[n]});return deepMerge(r,...e)}function deepEquals(r,e){return r.length===e.length&&r.every((t,n)=>e[n]===t)}function optionsFromArguments(r,e,t=[],n){const s={},o=Array.from(e);if(isObject(o[0])&&n&&!Reflect.has(o[0],n)&&(Object.keys(o[0]).some(c=>Reflect.has(r,c))||(deepMerge(s,{[n]:o[0]}),t.splice(t.indexOf(n),1),o.shift())),o.length===1&&isObject(o[0]))deepMerge(s,o[0]);else for(let u=0;u<t.length;u++)isDefined(o[u])&&(s[t[u]]=o[u]);return deepMerge(r,s)}function getDefaultsFromInstance(r){return r.constructor.getDefaults()}function defaultArg(r,e){return isUndef(r)?e:r}function omitFromObject(r,e){return e.forEach(t=>{Reflect.has(r,t)&&delete r[t]}),r}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Tone{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||theWindow&&this.toString()===theWindow.TONE_DEBUG_CLASS)&&log(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Tone.version=version;const EPSILON=1e-6;function GT(r,e){return r>e+EPSILON}function GTE(r,e){return GT(r,e)||EQ(r,e)}function LT(r,e){return r+EPSILON<e}function EQ(r,e){return Math.abs(r-e)<EPSILON}function clamp(r,e,t){return Math.max(Math.min(r,t),e)}class Timeline extends Tone{constructor(){super(),this.name="Timeline",this._timeline=[];const e=optionsFromArguments(Timeline.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(assert(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];assert(GTE(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(EQ(this._timeline[t].time,e)){for(let n=t;n>=0&&EQ(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&GTE(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let n=0;const s=this._timeline.length;let o=s;if(s>0&&this._timeline[s-1][t]<=e)return s-1;for(;n<o;){let u=Math.floor(n+(o-n)/2);const c=this._timeline[u],h=this._timeline[u+1];if(EQ(c[t],e)){for(let f=u;f<this._timeline.length;f++){const d=this._timeline[f];if(EQ(d[t],e))u=f;else break}return u}else{if(LT(c[t],e)&&GT(h[t],e))return u;GT(c[t],e)?o=u:n=u+1}}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return n!==-1&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let s=this._search(e),o=this._search(t);return s!==-1&&o!==-1?(this._timeline[s].time!==e&&(s+=1),this._timeline[o].time===t&&(o-=1),this._iterate(n,s,o)):s===-1&&this._iterate(n,0,o),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(n!==-1&&EQ(this._timeline[n].time,e)){let s=n;for(let o=n;o>=0&&EQ(this._timeline[o].time,e);o--)s=o;this._iterate(o=>{t(o)},s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const notifyNewContext=[];function onContextInit(r){notifyNewContext.push(r)}function initializeContext(r){notifyNewContext.forEach(e=>e(r))}const notifyCloseContext=[];function onContextClose(r){notifyCloseContext.push(r)}function closeContext(r){notifyCloseContext.forEach(e=>e(r))}class Emitter extends Tone{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(s=>{isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(s)||(this._events[s]=[]),this._events[s].push(t)}),this}once(e,t){const n=(...s)=>{t(...s),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(s=>{if(isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(isUndef(t))this._events[e]=[];else{const o=this._events[e];for(let u=o.length-1;u>=0;u--)o[u]===t&&o.splice(u,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let s=0,o=n.length;s<o;s++)n[s].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const n=Object.getOwnPropertyDescriptor(Emitter.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class BaseContext extends Emitter{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Context extends BaseContext{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Timeline,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=optionsFromArguments(Context.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=createAudioContext({latencyHint:e.latencyHint}),this._ticker=new Ticker(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(initializeContext(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){assert(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){assert(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){assert(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){assert(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return createAudioWorkletNode(this.rawContext,e,t)}addAudioWorkletModule(e,t){return __awaiter(this,void 0,void 0,function*(){assert(isDefined(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)})}workletsAreReady(){return __awaiter(this,void 0,void 0,function*(){const e=[];this._workletModules.forEach(t=>e.push(t)),yield Promise.all(e)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,isString(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25;break}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return isAudioContext(this._context)?this._context.resume():Promise.resolve()}close(){return __awaiter(this,void 0,void 0,function*(){isAudioContext(this._context)&&(yield this._context.close()),this._initialized&&closeContext(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let o=0;o<n.length;o++)n[o]=e;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=t,s.loop=!0,s.start(0),this._constants.set(e,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,s=()=>{const o=this.now();this._timeouts.add({callback:()=>{e(),s()},id:n,time:o+t})};return s(),n}}class DummyContext extends BaseContext{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return __awaiter(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function readOnly(r,e){isArray(e)?e.forEach(t=>readOnly(r,t)):Object.defineProperty(r,e,{enumerable:!0,writable:!1})}function writable(r,e){isArray(e)?e.forEach(t=>writable(r,t)):Object.defineProperty(r,e,{writable:!0})}const noOp=()=>{};class ToneAudioBuffer extends Tone{constructor(){super(),this.name="ToneAudioBuffer",this.onload=noOp;const e=optionsFromArguments(ToneAudioBuffer.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&isAudioBuffer(e.url)||e.url instanceof ToneAudioBuffer?this.set(e.url):isString(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:noOp,onload:noOp,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:getContext().sampleRate}set(e){return e instanceof ToneAudioBuffer?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return __awaiter(this,void 0,void 0,function*(){const t=ToneAudioBuffer.load(e).then(n=>{this.set(n),this.onload(this)});ToneAudioBuffer.downloads.push(t);try{yield t}finally{const n=ToneAudioBuffer.downloads.indexOf(t);ToneAudioBuffer.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=isArray(e)&&e[0].length>0,n=t?e.length:1,s=t?e[0].length:e.length,o=getContext(),u=o.createBuffer(n,s,o.sampleRate),c=!t&&n===1?[e]:e;for(let h=0;h<n;h++)u.copyToChannel(c[h],h);return this._buffer=u,this}toMono(e){if(isNumber(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const n=this.numberOfChannels;for(let s=0;s<n;s++){const o=this.toArray(s);for(let u=0;u<o.length;u++)t[u]+=o[u]}t=t.map(s=>s/n),this.fromArray(t)}return this}toArray(e){if(isNumber(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const n=Math.floor(e*this.sampleRate),s=Math.floor(t*this.sampleRate);assert(n<s,"The start time must be less than the end time");const o=s-n,u=getContext().createBuffer(this.numberOfChannels,o,this.sampleRate);for(let c=0;c<this.numberOfChannels;c++)u.copyToChannel(this.getChannelData(c).subarray(n,s),c);return new ToneAudioBuffer(u)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new ToneAudioBuffer().fromArray(e)}static fromUrl(e){return __awaiter(this,void 0,void 0,function*(){return yield new ToneAudioBuffer().load(e)})}static load(e){return __awaiter(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let h=c[0];for(const f of c)if(ToneAudioBuffer.supportsType(f)){h=f;break}e=e.replace(t[0],h)}const n=ToneAudioBuffer.baseUrl===""||ToneAudioBuffer.baseUrl.endsWith("/")?ToneAudioBuffer.baseUrl:ToneAudioBuffer.baseUrl+"/",s=yield fetch(n+e);if(!s.ok)throw new Error(`could not load url: ${e}`);const o=yield s.arrayBuffer();return yield getContext().decodeAudioData(o)})}static supportsType(e){const t=e.split("."),n=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return __awaiter(this,void 0,void 0,function*(){for(yield Promise.resolve();ToneAudioBuffer.downloads.length;)yield ToneAudioBuffer.downloads[0]})}}ToneAudioBuffer.baseUrl="";ToneAudioBuffer.downloads=[];class OfflineContext extends Context{constructor(){super({clockSource:"offline",context:isOfflineAudioContext(arguments[0])?arguments[0]:createOfflineAudioContext(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:isOfflineAudioContext(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=isOfflineAudioContext(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return __awaiter(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(s=>setTimeout(s,1)))}})}render(e=!0){return __awaiter(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new ToneAudioBuffer(t)})}close(){return Promise.resolve()}}const dummyContext=new DummyContext;let globalContext=dummyContext;function getContext(){return globalContext===dummyContext&&hasAudioContext&&setContext(new Context),globalContext}function setContext(r){isAudioContext(r)?globalContext=new Context(r):isOfflineAudioContext(r)?globalContext=new OfflineContext(r):globalContext=r}if(theWindow&&!theWindow.TONE_SILENCE_LOGGING){const e=` * Tone.js v${version} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function dbToGain(r){return Math.pow(10,r/20)}function gainToDb(r){return 20*(Math.log(r)/Math.LN10)}function intervalToFrequencyRatio(r){return Math.pow(2,r/12)}let A4=440;function getA4(){return A4}function setA4(r){A4=r}function ftom(r){return Math.round(ftomf(r))}function ftomf(r){return 69+12*Math.log2(r/A4)}function mtof(r){return A4*Math.pow(2,(r-69)/12)}class TimeBaseClass extends Tone{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),s=t==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let s=0;return e&&e!=="0"&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(s+=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof TimeBaseClass&&this.fromType(this._val),isUndef(this._val))return this._noArg();if(isString(this._val)&&isUndef(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(isObject(this._val)){let e=0;for(const t in this._val)if(isDefined(this._val[t])){const n=this._val[t],s=new this.constructor(this.context,t).valueOf()*n;e+=s}return e}if(isDefined(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return isString(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class TimeClass extends TimeBaseClass{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new TimeClass(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),s=this.valueOf(),c=Math.round(s/n)*n-s;return s+c*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let o=1;o<9;o++){const u=Math.pow(2,o);t.push(u+"n."),t.push(u+"n"),t.push(u+"t")}t.push("0");let n=t[0],s=new TimeClass(this.context,t[0]).toSeconds();return t.forEach(o=>{const u=new TimeClass(this.context,o).toSeconds();Math.abs(u-e)<Math.abs(s-e)&&(n=o,s=u)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let s=t%1*4;t=Math.floor(t)%this._getTimeSignature();const o=s.toString();return o.length>3&&(s=parseFloat(parseFloat(o).toFixed(3))),[n,t,s].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ftom(this.toFrequency())}_now(){return this.context.now()}}class FrequencyClass extends TimeClass{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return getA4()}static set A4(e){setA4(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:FrequencyClass.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const s=noteToScaleIndex[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?s:FrequencyClass.mtof(s)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let s=1;return e&&e!=="0"&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(s*=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(e){return new FrequencyClass(this.context,this.valueOf()*intervalToFrequencyRatio(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return ftom(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/FrequencyClass.A4);let n=Math.round(12*t)+57;const s=Math.floor(n/12);return s<0&&(n+=-12*s),scaleIndexToNote[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return mtof(e)}static ftom(e){return ftom(e)}}const noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class TransportTimeClass extends TimeClass{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ToneWithContext extends Tone{constructor(){super();const e=optionsFromArguments(ToneWithContext.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:getContext()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new TimeClass(this.context,e).toSeconds()}toFrequency(e){return new FrequencyClass(this.context,e).toFrequency()}toTicks(e){return new TransportTimeClass(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(n=>{isUndef(e[n])&&delete t[n]}),t}get(){const e=getDefaultsFromInstance(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const n=this[t];isDefined(n)&&isDefined(n.value)&&isDefined(n.setValueAtTime)?e[t]=n.value:n instanceof ToneWithContext?e[t]=n._getPartialProperties(e[t]):isArray(n)||isNumber(n)||isString(n)||isBoolean(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&isDefined(this[t])&&(this[t]&&isDefined(this[t].value)&&isDefined(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof ToneWithContext?this[t].set(e[t]):this[t]=e[t])}),this}}class StateTimeline extends Timeline{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,n){return assertRange(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){const n=this._search(t);for(let s=n;s>=0;s--){const o=this._timeline[s];if(o.state===e)return o}}getNextState(e,t){const n=this._search(t);if(n!==-1)for(let s=n;s<this._timeline.length;s++){const o=this._timeline[s];if(o.state===e)return o}}}class Param extends ToneWithContext{constructor(){super(optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"]);for(assert(isDefined(e.param)&&(isAudioParam(e.param)||e.param instanceof Param),"param must be an AudioParam");!isAudioParam(e.param);)e.param=e.param._param;this._swappable=isDefined(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Timeline(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,isDefined(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return isDefined(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return isDefined(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return isDefined(this.maxValue)&&isDefined(this.minValue)&&assertRange(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?dbToGain(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?gainToDb(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),s=this._fromType(e);return assert(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),s=this._events.get(t);let o=this._initialValue;if(s===null)o=this._initialValue;else if(s.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const u=this._events.getBefore(s.time);let c;u===null?c=this._initialValue:c=u.value,s.type==="setTargetAtTime"&&(o=this._exponentialApproach(s.time,c,s.value,s.constant,t))}else if(n===null)o=s.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let u=s.value;if(s.type==="setTargetAtTime"){const c=this._events.getBefore(s.time);c===null?u=this._initialValue:u=c.value}n.type==="linearRampToValueAtTime"?o=this._linearInterpolate(s.time,u,n.time,n.value,t):o=this._exponentialInterpolate(s.time,u,n.time,n.value,t)}else o=s.value;return this._toType(o)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),s=this.toSeconds(t);return assert(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=EQ(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(t);return assert(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,s),this.cancelAndHoldAtTime(t+n*.9),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const s=this._fromType(e);assert(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const o=this.toSeconds(t);return this._assertRange(s),assert(isFinite(s)&&isFinite(o),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:o,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",e,o,n),this._param.setTargetAtTime(s,o,n),this}setValueCurveAtTime(e,t,n,s=1){n=this.toSeconds(n),t=this.toSeconds(t);const o=this._fromType(e[0])*s;this.setValueAtTime(this._toType(o),t);const u=n/(e.length-1);for(let c=1;c<e.length;c++){const h=this._fromType(e[c])*s;this.linearRampToValueAtTime(this._toType(h),t+c*u)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return assert(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));assert(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const s=this._events.get(t),o=this._events.getAfter(t);return s&&EQ(s.time,t)?o?(this._param.cancelScheduledValues(o.time),this._events.cancel(o.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):o&&(this._param.cancelScheduledValues(o.time),this._events.cancel(o.time),o.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),t):o.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&n.type==="setTargetAtTime"){const s=this._events.getAfter(n.time),o=s?s.time:t+2,u=(o-t)/10;for(let c=t;c<o;c+=u)e.linearRampToValueAtTime(this.getValueAtTime(c),c)}return this._events.forEachAfter(this.context.currentTime,s=>{s.type==="cancelScheduledValues"?e.cancelScheduledValues(s.time):s.type==="setTargetAtTime"?e.setTargetAtTime(s.value,s.time,s.constant):e[s.type](s.value,s.time)}),this}setParam(e){assert(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,s,o){return n+(t-n)*Math.exp(-(o-e)/s)}_linearInterpolate(e,t,n,s,o){return t+(s-t)*((o-e)/(n-e))}_exponentialInterpolate(e,t,n,s,o){return t*Math.pow(s/t,(o-e)/(n-e))}}class ToneAudioNode extends ToneWithContext{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return isDefined(this.input)?isAudioParam(this.input)||this.input instanceof Param?1:this.input.numberOfInputs:0}get numberOfOutputs(){return isDefined(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return isDefined(e)&&(e instanceof ToneAudioNode||isAudioNode(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();assert(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return connect(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return warn("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return disconnect(this,e,t,n),this}chain(...e){return connectSeries(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),isDefined(this.input)&&(this.input instanceof ToneAudioNode?this.input.dispose():isAudioNode(this.input)&&this.input.disconnect()),isDefined(this.output)&&(this.output instanceof ToneAudioNode?this.output.dispose():isAudioNode(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function connectSeries(...r){const e=r.shift();r.reduce((t,n)=>(t instanceof ToneAudioNode?t.connect(n):isAudioNode(t)&&connect(t,n),n),e)}function connect(r,e,t=0,n=0){for(assert(isDefined(r),"Cannot connect from undefined node"),assert(isDefined(e),"Cannot connect to undefined node"),(e instanceof ToneAudioNode||isAudioNode(e))&&assert(e.numberOfInputs>0,"Cannot connect to node with no inputs"),assert(r.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof ToneAudioNode||e instanceof Param;)isDefined(e.input)&&(e=e.input);for(;r instanceof ToneAudioNode;)isDefined(r.output)&&(r=r.output);isAudioParam(e)?r.connect(e,t):r.connect(e,t,n)}function disconnect(r,e,t=0,n=0){if(isDefined(e))for(;e instanceof ToneAudioNode;)e=e.input;for(;!isAudioNode(r);)isDefined(r.output)&&(r=r.output);isAudioParam(e)?r.disconnect(e,t):isAudioNode(e)?r.disconnect(e,t,n):r.disconnect()}class Gain extends ToneAudioNode{constructor(){super(optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"]);this.gain=new Param({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),readOnly(this,"gain")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class OneShotSource extends ToneAudioNode{constructor(e){super(e),this.onended=noOp,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Gain({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const n=this.toSeconds(t);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:noOp})}_startGain(e,t=1){assert(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){assert(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==noOp&&(this.onended(this),this.onended=noOp,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),assert(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class ToneConstantSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"]);connect(this._source,this._gainNode),this.offset=new Param({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Signal extends ToneAudioNode{constructor(){super(optionsFromArguments(Signal.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=optionsFromArguments(Signal.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ToneConstantSource({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,s){return this._param.setValueCurveAtTime(e,t,n,s),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function connectSignal(r,e,t,n){(e instanceof Param||isAudioParam(e)||e instanceof Signal&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Signal&&(e.overridden=!0)),connect(r,e,t,n)}class TickParam extends Param{constructor(){super(optionsFromArguments(TickParam.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Timeline(1/0),this._multiplier=1;const e=optionsFromArguments(TickParam.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Param.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const s=this._fromType(e),o=this._events.get(t),u=Math.round(Math.max(1/n,1));for(let c=0;c<=u;c++){const h=n*c+t,f=this._exponentialApproach(o.time,o.value,s,n,h);this.linearRampToValueAtTime(this._toType(f),h)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const s=this._events.get(n),o=this._events.previousEvent(s),u=this._getTicksUntilEvent(o,n);return s.ticks=Math.max(u,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const s=this._events.get(n),o=this._events.previousEvent(s),u=this._getTicksUntilEvent(o,n);return s.ticks=Math.max(u,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),s=this._events.get(t),o=Math.round(Math.max((t-s.time)*10,1)),u=(t-s.time)/o;for(let c=0;c<=o;c++){const h=u*c+s.time,f=this._exponentialInterpolate(s.time,s.value,t,n,h);this.linearRampToValueAtTime(this._toType(f),h)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(isUndef(e.ticks)){const u=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(u,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let s=this._fromType(this.getValueAtTime(t));const o=this._events.get(t);return o&&o.time===t&&o.type==="setValueAtTime"&&(s=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+s)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(t);return this.getTimeOfTick(s+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type==="linearRampToValueAtTime"&&t.value!==n.value){const s=this._fromType(this.getValueAtTime(t.time)),u=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-t.time),c=Math.sqrt(Math.pow(s,2)-2*u*(t.ticks-e)),h=(-s+c)/u,f=(-s-c)/u;return(h>0?h:f)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),s=this.toSeconds(e),o=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-o}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class TickSignal extends Signal{constructor(){super(optionsFromArguments(TickSignal.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=optionsFromArguments(TickSignal.getDefaults(),arguments,["value"]);this.input=this._param=new TickParam({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Signal.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class TickSource extends ToneWithContext{constructor(){super(optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new StateTimeline,this._tickOffset=new Timeline;const e=optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"]);this.frequency=new TickSignal({context:this.context,units:e.units,value:e.frequency}),readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ToneWithContext.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),isDefined(t)&&this.setTicksAtTime(t,n)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);let o=n,u=0;return this._state.forEachBetween(n.time,t+this.sampleTime,c=>{let h=o.time;const f=this._tickOffset.get(c.time);f&&f.time>=o.time&&(u=f.ticks,h=f.time),o.state==="started"&&c.state!=="started"&&(u+=this.frequency.getTicksAtTime(c.time)-this.frequency.getTicksAtTime(h)),o=c}),this._state.remove(s),u}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let s=t,o=0;return this._state.forEachBetween(t.time,e+this.sampleTime,u=>{let c=s.time;const h=this._tickOffset.get(u.time);h&&h.time>=s.time&&(o=h.seconds,c=h.time),s.state==="started"&&u.state!=="started"&&(o+=u.time-c),s=u}),this._state.remove(n),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),s=this._state.get(t),o=Math.max(n.time,s.time),u=this.frequency.getTicksAtTime(o)+e-n.ticks;return this.frequency.getTimeOfTick(u)}forEachTickBetween(e,t,n){let s=this._state.get(e);this._state.forEachBetween(e,t,u=>{s&&s.state==="started"&&u.state!=="started"&&this.forEachTickBetween(Math.max(s.time,e),u.time-this.sampleTime,n),s=u});let o=null;if(s&&s.state==="started"){const u=Math.max(s.time,e),c=this.frequency.getTicksAtTime(u),h=this.frequency.getTicksAtTime(s.time),f=c-h;let d=Math.ceil(f)-f;d=EQ(d,1)?0:d;let p=this.frequency.getTimeOfTick(c+d);for(;p<t;){try{n(p,Math.round(this.getTicksAtTime(p)))}catch(S){o=S;break}p+=this.frequency.getDurationOfTicks(1,p)}}if(o)throw o;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Clock extends ToneWithContext{constructor(){super(optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=noOp,this._lastUpdate=0,this._state=new StateTimeline("stopped"),this._boundLoop=this._loop.bind(this);const e=optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new TickSource({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{callback:noOp,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){assertContextRunning(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":const s=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,s);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,t,(n,s)=>{this.callback(n,s)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Emitter.mixin(Clock);class ToneAudioBuffers extends Tone{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=optionsFromArguments(ToneAudioBuffers.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:noOp,onload:noOp,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return assert(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=noOp,s=noOp){return isString(t)?this._buffers.set(e.toString(),new ToneAudioBuffer(this.baseUrl+t,n,s)):this._buffers.set(e.toString(),new ToneAudioBuffer(t,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class MidiClass extends FrequencyClass{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return ftom(super._frequencyToUnits(e))}_ticksToUnits(e){return ftom(super._ticksToUnits(e))}_beatsToUnits(e){return ftom(super._beatsToUnits(e))}_secondsToUnits(e){return ftom(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return mtof(this.toMidi())}transpose(e){return new MidiClass(this.context,this.toMidi()+e)}}class TicksClass extends TransportTimeClass{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}let Draw$1=class extends ToneWithContext{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Timeline,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}};onContextInit(r=>{r.draw=new Draw$1({context:r})});onContextClose(r=>{r.draw.dispose()});class IntervalTimeline extends Tone{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){assert(isDefined(e.time),"Events must have a time property"),assert(isDefined(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new IntervalNode(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let n,s=null;if(t>0)if(e.left.right===null)n=e.left,n.right=e.right,s=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,s=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,s=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,s=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),s&&this._rebalance(s)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),s=e.right;s&&(e.right=s.left,s.left=e),t!==null?n?t.left=s:t.right=s:this._setRoot(s)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),s=e.left;s&&(e.left=s.right,s.right=e),t!==null?n?t.left=s:t.right=s:this._setRoot(s)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let s=1;s<t.length;s++)t[s].low>n.low&&(n=t[s]);return n.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(s=>{s.event&&t(s.event)})}return this}forEachFrom(e,t){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(s=>{s.event&&t(s.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class IntervalNode{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Volume extends ToneAudioNode{constructor(){super(optionsFromArguments(Volume.getDefaults(),arguments,["volume"])),this.name="Volume";const e=optionsFromArguments(Volume.getDefaults(),arguments,["volume"]);this.input=this.output=new Gain({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,readOnly(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Destination extends ToneAudioNode{constructor(){super(optionsFromArguments(Destination.getDefaults(),arguments)),this.name="Destination",this.input=new Volume({context:this.context}),this.output=new Gain({context:this.context}),this.volume=this.input.volume;const e=optionsFromArguments(Destination.getDefaults(),arguments);connectSeries(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),connectSeries(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}onContextInit(r=>{r.destination=new Destination({context:r})});onContextClose(r=>{r.destination.dispose()});class TimelineValue extends Tone{constructor(e){super(),this.name="TimelineValue",this._timeline=new Timeline({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class TransportEvent{constructor(e,t){this.id=TransportEvent._eventId++;const n=Object.assign(TransportEvent.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:noOp,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}TransportEvent._eventId=0;class TransportRepeatEvent extends TransportEvent{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(TransportRepeatEvent.getDefaults(),t);this.duration=new TicksClass(e.context,n.duration).valueOf(),this._interval=new TicksClass(e.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},TransportEvent.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}let Transport$1=class ki extends ToneWithContext{constructor(){super(optionsFromArguments(ki.getDefaults(),arguments)),this.name="Transport",this._loop=new TimelineValue(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Timeline,this._repeatedEvents=new IntervalTimeline,this._syncedSignals=[],this._swingAmount=0;const e=optionsFromArguments(ki.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Clock({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),readOnly(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const n=t%(this._swingTicks*2)/(this._swingTicks*2),s=Math.sin(n*Math.PI)*this._swingAmount;e+=new TicksClass(this.context,this._swingTicks*2/3).toSeconds()*s}this._timeline.forEachAtTime(t,n=>n.invoke(e))}schedule(e,t){const n=new TransportEvent(this,{callback:e,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,s=1/0){const o=new TransportRepeatEvent(this,{callback:e,duration:new TimeClass(this.context,s).toTicks(),interval:new TimeClass(this.context,t).toTicks(),time:new TransportTimeClass(this.context,n).toTicks()});return this._addEvent(o,this._repeatedEvents)}scheduleOnce(e,t){const n=new TransportEvent(this,{callback:e,once:!0,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new TicksClass(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return isDefined(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){isArray(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new TimeClass(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new TimeClass(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new TicksClass(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new TicksClass(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(t),s=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t),o=t+s;this.emit("stop",o),this._clock.setTicksAtTime(e,o),this.emit("start",o,this._clock.getSecondsAtTime(o))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),n=this.getTicksAtTime(t),s=e-n%e;return this._clock.nextTickTime(s,t)}}syncSignal(e,t){if(!t){const s=this.now();if(e.getValueAtTime(s)!==0){const u=1/(60/this.bpm.getValueAtTime(s)/this.PPQ);t=e.getValueAtTime(s)/u}else t=0}const n=new Gain(t);return this.bpm.connect(n),n.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:n,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),writable(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}};Emitter.mixin(Transport$1);onContextInit(r=>{r.transport=new Transport$1({context:r})});onContextClose(r=>{r.transport.dispose()});class Source extends ToneAudioNode{constructor(e){super(e),this.input=void 0,this._state=new StateTimeline("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=noOp,this._syncedStop=noOp,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Volume({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,onstop:noOp,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let s=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(s=this._clampToCurrentTime(s),!this._synced&&this._state.getValueAtTime(s)==="started")assert(GT(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,t,n);else if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const o=this._state.get(s);o&&(o.offset=this.toSeconds(defaultArg(t,0)),o.duration=n?this.toSeconds(n):void 0);const u=this.context.transport.schedule(c=>{this._start(c,t,n)},s);this._scheduled.push(u),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else assertContextRunning(this.context),this._start(s,t,n);return this}stop(e){let t=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||isDefined(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const n=this._state.get(t);if(n&&n.state==="started"&&n.time!==t){const s=t-this.toSeconds(n.time);let o;n.duration&&(o=this.toSeconds(n.duration)-s),this._start(e,this.toSeconds(n.offset)+s,o)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=noOp,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ToneBufferSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"]);connect(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Param({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ToneAudioBuffer(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{url:new ToneAudioBuffer,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,s=1){assert(this.buffer.loaded,"buffer is either not set or not loaded");const o=this.toSeconds(e);this._startGain(o,s),this.loop?t=defaultArg(t,this.loopStart):t=defaultArg(t,0);let u=Math.max(this.toSeconds(t),0);if(this.loop){const c=this.toSeconds(this.loopEnd)||this.buffer.duration,h=this.toSeconds(this.loopStart),f=c-h;GTE(u,c)&&(u=(u-h)%f+h),EQ(u,this.buffer.duration)&&(u=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,LT(u,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(o,u)),isDefined(n)){let c=this.toSeconds(n);c=Math.max(c,0),this.stop(o+c)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Noise extends Source{constructor(){super(optionsFromArguments(Noise.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=optionsFromArguments(Noise.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(assert(e in _noiseBuffers,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=_noiseBuffers[this._type];this._source=new ToneBufferSource({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const BUFFER_LENGTH=44100*5,NUM_CHANNELS=2,_noiseCache={brown:null,pink:null,white:null},_noiseBuffers={get brown(){if(!_noiseCache.brown){const r=[];for(let e=0;e<NUM_CHANNELS;e++){const t=new Float32Array(BUFFER_LENGTH);r[e]=t;let n=0;for(let s=0;s<BUFFER_LENGTH;s++){const o=Math.random()*2-1;t[s]=(n+.02*o)/1.02,n=t[s],t[s]*=3.5}}_noiseCache.brown=new ToneAudioBuffer().fromArray(r)}return _noiseCache.brown},get pink(){if(!_noiseCache.pink){const r=[];for(let e=0;e<NUM_CHANNELS;e++){const t=new Float32Array(BUFFER_LENGTH);r[e]=t;let n,s,o,u,c,h,f;n=s=o=u=c=h=f=0;for(let d=0;d<BUFFER_LENGTH;d++){const p=Math.random()*2-1;n=.99886*n+p*.0555179,s=.99332*s+p*.0750759,o=.969*o+p*.153852,u=.8665*u+p*.3104856,c=.55*c+p*.5329522,h=-.7616*h-p*.016898,t[d]=n+s+o+u+c+h+f+p*.5362,t[d]*=.11,f=p*.115926}}_noiseCache.pink=new ToneAudioBuffer().fromArray(r)}return _noiseCache.pink},get white(){if(!_noiseCache.white){const r=[];for(let e=0;e<NUM_CHANNELS;e++){const t=new Float32Array(BUFFER_LENGTH);r[e]=t;for(let n=0;n<BUFFER_LENGTH;n++)t[n]=Math.random()*2-1}_noiseCache.white=new ToneAudioBuffer().fromArray(r)}return _noiseCache.white}};function generateWaveform(r,e){return __awaiter(this,void 0,void 0,function*(){const t=e/r.context.sampleRate,n=new OfflineContext(1,t,r.context.sampleRate);return new r.constructor(Object.assign(r.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class ToneOscillatorNode extends OneShotSource{constructor(){super(optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"]);connect(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Param({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Param({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Oscillator extends Source{constructor(){super(optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),readOnly(this,"frequency"),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new ToneOscillatorNode({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Oscillator._periodicWaveCache.find(t=>t.phase===this._phase&&deepEquals(t.partials,this._partials));{const e=Oscillator._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(isDefined(n)){const{partials:s,wave:o}=n;this._wave=o,this._partials=s,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[s,o]=this._getRealImaginary(e,this._phase),u=this.context.createPeriodicWave(s,o);this._wave=u,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Oscillator._periodicWaveCache.push({imag:o,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:s,type:this._type,wave:this._wave}),Oscillator._periodicWaveCache.length>100&&Oscillator._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){assertRange(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const s=new Float32Array(e);this._partials.forEach((o,u)=>s[u]=o),this._partials=Array.from(s),this.type=this._type}}_getRealImaginary(e,t){let s=2048;const o=new Float32Array(s),u=new Float32Array(s);let c=1;if(e==="custom"){if(c=this._partials.length+1,this._partialCount=this._partials.length,s=c,this._partials.length===0)return[o,u]}else{const h=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);h?(c=parseInt(h[2],10)+1,this._partialCount=parseInt(h[2],10),e=h[1],c=Math.max(c,2),s=c):this._partialCount=0,this._partials=[]}for(let h=1;h<s;++h){const f=2/(h*Math.PI);let d;switch(e){case"sine":d=h<=c?1:0,this._partials[h-1]=d;break;case"square":d=h&1?2*f:0,this._partials[h-1]=d;break;case"sawtooth":d=f*(h&1?1:-1),this._partials[h-1]=d;break;case"triangle":h&1?d=2*(f*f)*(h-1>>1&1?-1:1):d=0,this._partials[h-1]=d;break;case"custom":d=this._partials[h-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}d!==0?(o[h]=-d*Math.sin(t*h),u[h]=d*Math.cos(t*h)):(o[h]=0,u[h]=0)}return[o,u]}_inverseFFT(e,t,n){let s=0;const o=e.length;for(let u=0;u<o;u++)s+=e[u]*Math.cos(u*n)+t[u]*Math.sin(u*n);return s}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const s=Math.PI*2,o=32;for(let u=0;u<o;u++)n=Math.max(this._inverseFFT(e,t,u/o*s),n);return clamp(-this._inverseFFT(e,t,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Oscillator._periodicWaveCache=[];class SignalOperator extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(SignalOperator.getDefaults(),arguments,["context"])))}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}}class WaveShaper extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]);isArray(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):isFunction(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Signal.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let s=0,o=t;s<o;s++){const u=s/(o-1)*2-1;n[s]=e(u,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(n=>n.includes(e));assert(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class AudioToGain extends SignalOperator{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new WaveShaper({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Multiply extends Signal{constructor(){super(Object.assign(optionsFromArguments(Multiply.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=optionsFromArguments(Multiply.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Gain({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Signal.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class AMOscillator extends Source{constructor(){super(optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new AudioToGain({context:this.context}),this._modulationNode=new Gain({context:this.context});const e=optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),readOnly(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class FMOscillator extends Source{constructor(){super(optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Gain({context:this.context,gain:0});const e=optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Multiply({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),readOnly(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class PulseOscillator extends Source{constructor(){super(optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Gain({context:this.context,gain:0}),this._thresh=new WaveShaper({context:this.context,mapping:t=>t<=0?-1:1});const e=optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"]);this.width=new Signal({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),readOnly(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class FatOscillator extends Source{constructor(){super(optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach((s,o)=>s.detune.value=t+n*o)}}get count(){return this._oscillators.length}set count(e){if(assertRange(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const n=new Oscillator({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):noOp});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class PWMOscillator extends Source{constructor(){super(optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Multiply({context:this.context,value:2});const e=optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new PulseOscillator({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),readOnly(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const OmniOscillatorSourceMap={am:AMOscillator,fat:FatOscillator,fm:FMOscillator,oscillator:Oscillator,pulse:PulseOscillator,pwm:PWMOscillator};class OmniOscillator extends Source{constructor(){super(optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Oscillator.getDefaults(),FMOscillator.getDefaults(),AMOscillator.getDefaults(),FatOscillator.getDefaults(),PulseOscillator.getDefaults(),PWMOscillator.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=OmniOscillatorSourceMap[e],n=this.now();if(this._oscillator){const s=this._oscillator;s.stop(n),this.context.setTimeout(()=>s.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof OmniOscillatorSourceMap[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&isString(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function range(r,e=1/0){const t=new WeakMap;return function(n,s){Reflect.defineProperty(n,s,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(o){assertRange(o,r,e),t.set(this,o)}})}}function timeRange(r,e=1/0){const t=new WeakMap;return function(n,s){Reflect.defineProperty(n,s,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(o){assertRange(this.toSeconds(o),r,e),t.set(this,o)}})}}class Player extends Source{constructor(){super(optionsFromArguments(Player.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=optionsFromArguments(Player.getDefaults(),arguments,["url","onload"]);this._buffer=new ToneAudioBuffer({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1,reverse:!1})}load(e){return __awaiter(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=noOp){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){this._loop?t=defaultArg(t,this._loopStart):t=defaultArg(t,0);const s=this.toSeconds(t),o=n;n=defaultArg(n,Math.max(this._buffer.duration-s,0));let u=this.toSeconds(n);u=u/this._playbackRate,e=this.toSeconds(e);const c=new ToneBufferSource({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+u),this._state.setStateAtTime("stopped",e+u,{implicitEnd:!0})),this._activeSources.add(c),this._loop&&isUndef(o)?c.start(e,s):c.start(e,s,u-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){this._stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="started"){const s=this.toSeconds(e);this._stop(n),this._start(n,s)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(s=>s.cancelStop())),this._activeSources.forEach(s=>{s.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}__decorate([timeRange(0)],Player.prototype,"fadeIn",void 0);__decorate([timeRange(0)],Player.prototype,"fadeOut",void 0);class GainToAudio extends SignalOperator{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new WaveShaper({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Envelope extends ToneAudioNode{constructor(){super(optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Signal({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(isString(e))return e;{let n;for(n in EnvelopeCurves)if(EnvelopeCurves[n][t]===e)return n;return e}}_setCurve(e,t,n){if(isString(n)&&Reflect.has(EnvelopeCurves,n)){const s=EnvelopeCurves[n];isObject(s)?e!=="_decayCurve"&&(this[e]=s[t]):this[e]=s}else if(isArray(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){assert(["linear","exponential"].some(t=>t===e),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let s=this.toSeconds(this.attack);const o=this.toSeconds(this.decay),u=this.getValueAtTime(e);if(u>0){const c=1/s;s=(1-u)/c}if(s<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,s,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,s,e);else{this._sig.cancelAndHoldAtTime(e);let c=this._attackCurve;for(let h=1;h<c.length;h++)if(c[h-1]<=u&&u<=c[h]){c=this._attackCurve.slice(h),c[0]=u;break}this._sig.setValueCurveAtTime(c,e,s,t)}if(o&&this.sustain<1){const c=t*this.sustain,h=e+s;this.log("decay",h),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(c,o+h):this._sig.exponentialApproachValueAtTime(c,h,o)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(assert(isArray(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,n=new OfflineContext(1,t,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),o=s+this.toSeconds(this.release),u=o*.1,c=o+u,h=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/c,decay:t*this.toSeconds(this.decay)/c,release:t*this.toSeconds(this.release)/c,context:n}));return h._sig.toDestination(),h.triggerAttackRelease(t*(s+u)/c,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}__decorate([timeRange(0)],Envelope.prototype,"attack",void 0);__decorate([timeRange(0)],Envelope.prototype,"decay",void 0);__decorate([range(0,1)],Envelope.prototype,"sustain",void 0);__decorate([timeRange(0)],Envelope.prototype,"release",void 0);const EnvelopeCurves=(()=>{let e,t;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/(128-1)*(Math.PI/2));const s=[],o=6.4;for(e=0;e<128-1;e++){t=e/(128-1);const S=Math.sin(t*(Math.PI*2)*o-Math.PI/2)+1;s[e]=S/10+t*.83}s[128-1]=1;const u=[],c=5;for(e=0;e<128;e++)u[e]=Math.ceil(e/(128-1)*c)/c;const h=[];for(e=0;e<128;e++)t=e/(128-1),h[e]=.5*(1-Math.cos(Math.PI*t));const f=[];for(e=0;e<128;e++){t=e/(128-1);const S=Math.pow(t,3)*4+.2,E=Math.cos(S*Math.PI*2*t);f[e]=Math.abs(E*(1-t))}function d(S){const E=new Array(S.length);for(let N=0;N<S.length;N++)E[N]=1-S[N];return E}function p(S){return S.slice(0).reverse()}return{bounce:{In:d(f),Out:f},cosine:{In:n,Out:p(n)},exponential:"exponential",linear:"linear",ripple:{In:s,Out:d(s)},sine:{In:h,Out:d(h)},step:{In:u,Out:d(u)}}})();class Instrument extends ToneAudioNode{constructor(){super(optionsFromArguments(Instrument.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=optionsFromArguments(Instrument.getDefaults(),arguments);this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...s)=>{const o=s[t],u=this.context.transport.schedule(c=>{s[t]=c,n.apply(this,s)},o);this._scheduledEvents.push(u)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,n,s){const o=this.toSeconds(n),u=this.toSeconds(t);return this.triggerAttack(e,o,s),this.triggerRelease(o+u),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Monophonic extends Instrument{constructor(){super(optionsFromArguments(Monophonic.getDefaults(),arguments));const e=optionsFromArguments(Monophonic.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Instrument.getDefaults(),{detune:0,onsilence:noOp,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const s=this.toSeconds(t);return this._triggerEnvelopeAttack(s,n),this.setNote(e,s),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),s=e instanceof FrequencyClass?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const o=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,o,n)}else this.frequency.setValueAtTime(s,n);return this}}__decorate([timeRange(0)],Monophonic.prototype,"portamento",void 0);class AmplitudeEnvelope extends Envelope{constructor(){super(optionsFromArguments(AmplitudeEnvelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Gain({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Synth extends Monophonic{constructor(){super(optionsFromArguments(Synth.getDefaults(),arguments)),this.name="Synth";const e=optionsFromArguments(Synth.getDefaults(),arguments);this.oscillator=new OmniOscillator(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new AmplitudeEnvelope(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),readOnly(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Monophonic.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(omitFromObject(OmniOscillator.getDefaults(),[...Object.keys(Source.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),s=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+s)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class MembraneSynth extends Synth{constructor(){super(optionsFromArguments(MembraneSynth.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=optionsFromArguments(MembraneSynth.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,readOnly(this,["oscillator","envelope"])}static getDefaults(){return deepMerge(Monophonic.getDefaults(),Synth.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),s=this.toFrequency(e instanceof FrequencyClass?e.toFrequency():e),o=s*this.octaves;return this.oscillator.frequency.setValueAtTime(o,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}__decorate([range(0)],MembraneSynth.prototype,"octaves",void 0);__decorate([timeRange(0)],MembraneSynth.prototype,"pitchDecay",void 0);const workletContext=new Set;function addToWorklet(r){workletContext.add(r)}function registerProcessor(r,e){const t=`registerProcessor("${r}", ${e})`;workletContext.add(t)}const toneAudioWorkletProcessor=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;addToWorklet(toneAudioWorkletProcessor);const singleIOProcess=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;addToWorklet(singleIOProcess);const delayLine=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;addToWorklet(delayLine);const workletName$1="feedback-comb-filter",feedbackCombFilter=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;registerProcessor(workletName$1,feedbackCombFilter);class PolySynth extends Instrument{constructor(){super(optionsFromArguments(PolySynth.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const e=optionsFromArguments(PolySynth.getDefaults(),arguments,["voice","options"]);assert(!isNumber(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const t=e.voice.getDefaults();this.options=Object.assign(t,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{maxPolyphony:32,options:{},voice:Synth})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const t=this._activeVoices.findIndex(n=>n.voice===e);this._activeVoices.splice(t,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return e.connect(this.output),this._voices.push(e),e}else warn("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),t=this._voices.indexOf(e);this._voices.splice(t,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,t,n){e.forEach(s=>{const o=new MidiClass(this.context,s).toMidi(),u=this._getNextAvailableVoice();u&&(u.triggerAttack(s,t,n),this._activeVoices.push({midi:o,voice:u,released:!1}),this.log("triggerAttack",s,t))})}_triggerRelease(e,t){e.forEach(n=>{const s=new MidiClass(this.context,n).toMidi(),o=this._activeVoices.find(({midi:u,released:c})=>u===s&&!c);o&&(o.voice.triggerRelease(t),o.released=!0,this.log("triggerRelease",n,t))})}_scheduleEvent(e,t,n,s){assert(!this.disposed,"Synth was already disposed"),n<=this.now()?e==="attack"?this._triggerAttack(t,n,s):this._triggerRelease(t,n):this.context.setTimeout(()=>{this._scheduleEvent(e,t,n,s)},n-this.now())}triggerAttack(e,t,n){Array.isArray(e)||(e=[e]);const s=this.toSeconds(t);return this._scheduleEvent("attack",e,s,n),this}triggerRelease(e,t){Array.isArray(e)||(e=[e]);const n=this.toSeconds(t);return this._scheduleEvent("release",e,n),this}triggerAttackRelease(e,t,n,s){const o=this.toSeconds(n);if(this.triggerAttack(e,o,s),isArray(t)){assert(isArray(e),"If the duration is an array, the notes must also be an array"),e=e;for(let u=0;u<e.length;u++){const c=t[Math.min(u,t.length-1)],h=this.toSeconds(c);assert(h>0,"The duration must be greater than 0"),this.triggerRelease(e[u],o+h)}}else{const u=this.toSeconds(t);assert(u>0,"The duration must be greater than 0"),this.triggerRelease(e,o+u)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(e){const t=omitFromObject(e,["onsilence","context"]);return this.options=deepMerge(this.options,t),this._voices.forEach(n=>n.set(t)),this._dummyVoice.set(t),this}get(){return this._dummyVoice.get()}releaseAll(e){const t=this.toSeconds(e);return this._activeVoices.forEach(({voice:n})=>{n.triggerRelease(t)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Sampler extends Instrument{constructor(){super(optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(n=>{const s=parseInt(n,10);if(assert(isNote(n)||isNumber(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),isNote(n)){const o=new FrequencyClass(this.context,n).toMidi();t[o]=e.urls[n]}else isNumber(s)&&isFinite(s)&&(t[s]=e.urls[s])}),this._buffers=new ToneAudioBuffers({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:noOp,onerror:noOp,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(s=>{const o=ftomf(new FrequencyClass(this.context,s).toFrequency()),u=Math.round(o),c=o-u,h=this._findClosest(u),f=u-h,d=this._buffers.get(f),p=intervalToFrequencyRatio(h+c),S=new ToneBufferSource({url:d,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:p}).connect(this.output);S.start(t,0,d.duration/p,n),isArray(this._activeSources.get(u))||this._activeSources.set(u,[]),this._activeSources.get(u).push(S),S.onended=()=>{if(this._activeSources&&this._activeSources.has(u)){const E=this._activeSources.get(u),N=E.indexOf(S);N!==-1&&E.splice(N,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{const s=new FrequencyClass(this.context,n).toMidi();if(this._activeSources.has(s)&&this._activeSources.get(s).length){const o=this._activeSources.get(s);t=this.toSeconds(t),o.forEach(u=>{u.stop(t)}),this._activeSources.set(s,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,s=1){const o=this.toSeconds(n);return this.triggerAttack(e,o,s),isArray(t)?(assert(isArray(e),"notes must be an array when duration is array"),e.forEach((u,c)=>{const h=t[Math.min(c,t.length-1)];this.triggerRelease(u,o+this.toSeconds(h))})):this.triggerRelease(e,o+this.toSeconds(t)),this}add(e,t,n){if(assert(isNote(e)||isFinite(e),`note must be a pitch or midi: ${e}`),isNote(e)){const s=new FrequencyClass(this.context,e).toMidi();this._buffers.add(s,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}__decorate([timeRange(0)],Sampler.prototype,"attack",void 0);__decorate([timeRange(0)],Sampler.prototype,"release",void 0);class CrossFade extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(CrossFade.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new GainToAudio({context:this.context}),this.a=new Gain({context:this.context,gain:0}),this.b=new Gain({context:this.context,gain:0}),this.output=new Gain({context:this.context}),this._internalChannels=[this.a,this.b];const e=optionsFromArguments(CrossFade.getDefaults(),arguments,["fade"]);this.fade=new Signal({context:this.context,units:"normalRange",value:e.fade}),readOnly(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",connect(this._split,this.a.gain,0),connect(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Effect extends ToneAudioNode{constructor(e){super(e),this.name="Effect",this._dryWet=new CrossFade({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Gain({context:this.context}),this.effectReturn=new Gain({context:this.context}),this.input=new Gain({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],readOnly(this,"wet")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Panner extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(Panner.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=optionsFromArguments(Panner.getDefaults(),arguments,["pan"]);this.pan=new Param({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",readOnly(this,"pan")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const workletName="bit-crusher",bitCrusherWorklet=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;registerProcessor(workletName,bitCrusherWorklet);class Merge extends ToneAudioNode{constructor(){super(optionsFromArguments(Merge.getDefaults(),arguments,["channels"])),this.name="Merge";const e=optionsFromArguments(Merge.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Reverb extends Effect{constructor(){super(optionsFromArguments(Reverb.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=optionsFromArguments(Reverb.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Effect.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),assertRange(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),assertRange(e,0),this._preDelay=e,this.generate()}generate(){return __awaiter(this,void 0,void 0,function*(){const e=this.ready,t=new OfflineContext(2,this._decay+this._preDelay,this.context.sampleRate),n=new Noise({context:t}),s=new Noise({context:t}),o=new Merge({context:t});n.connect(o,0,0),s.connect(o,0,1);const u=new Gain({context:t}).toDestination();o.connect(u),n.start(0),s.start(0),u.gain.setValueAtTime(0,0),u.gain.setValueAtTime(1,this._preDelay),u.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const c=t.render();return this.ready=c.then(noOp),yield e,this._convolver.buffer=(yield c).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Solo extends ToneAudioNode{constructor(){super(optionsFromArguments(Solo.getDefaults(),arguments,["solo"])),this.name="Solo";const e=optionsFromArguments(Solo.getDefaults(),arguments,["solo"]);this.input=this.output=new Gain({context:this.context}),Solo._allSolos.has(this.context)||Solo._allSolos.set(this.context,new Set),Solo._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Solo._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Solo._soloed.has(this.context)||Solo._soloed.set(this.context,new Set),Solo._soloed.get(this.context).add(this)}_removeSolo(){Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).delete(this)}_isSoloed(){return Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).has(this)}_noSolos(){return!Solo._soloed.has(this.context)||Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Solo._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Solo._allSolos=new Map;Solo._soloed=new Map;class PanVol extends ToneAudioNode{constructor(){super(optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Panner({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Channel extends ToneAudioNode{constructor(){super(optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Solo({solo:e.solo,context:this.context}),this._panVol=this.output=new PanVol({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Channel.buses.has(e)||Channel.buses.set(e,new Gain({context:this.context})),Channel.buses.get(e)}send(e,t=0){const n=this._getBus(e),s=new Gain({context:this.context,units:"decibels",gain:t});return this.connect(s),s.connect(n),s}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Channel.buses=new Map;class Listener extends ToneAudioNode{constructor(){super(...arguments),this.name="Listener",this.positionX=new Param({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Param({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Param({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Param({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Param({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Param({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Param({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Param({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Param({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}onContextInit(r=>{r.listener=new Listener({context:r})});onContextClose(r=>{r.listener.dispose()});const Transport=getContext().transport;getContext().destination;getContext().destination;getContext().listener;const Draw=getContext().draw;getContext();const canvas=document.getElementById("hydra-canvas");function fullscreenCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight}fullscreenCanvas();window.addEventListener("resize",fullscreenCanvas);const synth=new PolySynth(Synth,{volume:-10,envelope:{attack:6,decay:.1,sustain:.1,release:1}}).toDestination(),reverb=new Reverb({decay:8,preDelay:.01}).toDestination();synth.connect(reverb);const scale=["A3","C3","D3","E3","G3","A4","C4","D4","E4","G5","A5","C5","D5","E1","G2"];function generateNote(){return scale[Math.floor(Math.random()*scale.length)]}Transport.scheduleRepeat(r=>{const e=generateNote(),t=Math.random()*(12-8)+8,n=Math.random()*.5;synth.triggerAttackRelease(e,t,r,n),Draw.schedule(()=>{const o=`hsl(${Math.random()*360}, 100%, 50%)`;document.body.style.backgroundColor=o},r)},"4n");Transport.start();window.onload=startHydra;function startHydra(){new HydraRenderer;const r=gradient(360).rotate(.25).repeat(2,1).brightness(()=>Math.random()*.5+.5).out(),e=shape(4).repeat(2,1).rotate(.1).scale(()=>Math.random()*2+1).modulate(osc(.2)).out();osc(10).color(()=>r).rotate(.8).kaleid(5).modulate(osc(2,.25,.2).rotate(.1,.9),()=>e).out()}
